var Wirecloud={constants:{WORKSPACE_PREFERENCES:[{"defaultValue":false,"description":"Allows other users to open this workspace (in read-only mode). (default: disabled)","type":"boolean","name":"public","label":"Public"},{"description":"Default layout for the new widgets.","defaultValue":"Fixed","label":"Default layout","type":"select","initialEntries":[{"value":"Fixed","label":"Base"},{"value":"Free","label":"Free"}],"name":"initiallayout"},{"defaultValue":{"verticalmargin":3,"smart":"false","horizontalmargin":4,"type":"columnlayout","columns":20,"cellheight":12},"type":"layout","name":"baselayout","label":"Base layout"}],FIWARE_PORTALS:[{"url":"https://cloud.lab.fiware.org","name":"Cloud","logout_path":"/logout"},{"url":"https://store.lab.fiware.org","name":"Store","logout_path":"/logout"},{"url":"https://mashup.lab.fiware.org","active":true,"name":"Mashup","logout_path":"/logout"},{"url":"https://data.lab.fiware.org","name":"Data","logout_path":"/user/_logout"},{"url":"https://account.lab.fiware.org","name":"Account","logout_path":"/users/sign_out"},{"url":"http://help.lab.fiware.org","name":"Help\u0026info"}],FIWARE_HOME:"https://lab.fiware.org",AVAILABLE_LANGUAGES:[{"value":"af","label":"Afrikaans"},{"value":"ar","label":"Arabic"},{"value":"az","label":"Azerbaijani"},{"value":"bg","label":"Bulgarian"},{"value":"be","label":"Belarusian"},{"value":"bn","label":"Bengali"},{"value":"br","label":"Breton"},{"value":"bs","label":"Bosnian"},{"value":"ca","label":"Catalan"},{"value":"cs","label":"Czech"},{"value":"cy","label":"Welsh"},{"value":"da","label":"Danish"},{"value":"de","label":"German"},{"value":"el","label":"Greek"},{"value":"en","label":"English"},{"value":"en-gb","label":"British English"},{"value":"eo","label":"Esperanto"},{"value":"es","label":"Spanish"},{"value":"es-ar","label":"Argentinian Spanish"},{"value":"es-mx","label":"Mexican Spanish"},{"value":"es-ni","label":"Nicaraguan Spanish"},{"value":"es-ve","label":"Venezuelan Spanish"},{"value":"et","label":"Estonian"},{"value":"eu","label":"Basque"},{"value":"fa","label":"Persian"},{"value":"fi","label":"Finnish"},{"value":"fr","label":"French"},{"value":"fy-nl","label":"Frisian"},{"value":"ga","label":"Irish"},{"value":"gl","label":"Galician"},{"value":"he","label":"Hebrew"},{"value":"hi","label":"Hindi"},{"value":"hr","label":"Croatian"},{"value":"hu","label":"Hungarian"},{"value":"ia","label":"Interlingua"},{"value":"id","label":"Indonesian"},{"value":"is","label":"Icelandic"},{"value":"it","label":"Italian"},{"value":"ja","label":"Japanese"},{"value":"ka","label":"Georgian"},{"value":"kk","label":"Kazakh"},{"value":"km","label":"Khmer"},{"value":"kn","label":"Kannada"},{"value":"ko","label":"Korean"},{"value":"lb","label":"Luxembourgish"},{"value":"lt","label":"Lithuanian"},{"value":"lv","label":"Latvian"},{"value":"mk","label":"Macedonian"},{"value":"ml","label":"Malayalam"},{"value":"mn","label":"Mongolian"},{"value":"my","label":"Burmese"},{"value":"nb","label":"Norwegian Bokmal"},{"value":"ne","label":"Nepali"},{"value":"nl","label":"Dutch"},{"value":"nn","label":"Norwegian Nynorsk"},{"value":"os","label":"Ossetic"},{"value":"pa","label":"Punjabi"},{"value":"pl","label":"Polish"},{"value":"pt","label":"Portuguese"},{"value":"pt-br","label":"Brazilian Portuguese"},{"value":"ro","label":"Romanian"},{"value":"ru","label":"Russian"},{"value":"sk","label":"Slovak"},{"value":"sl","label":"Slovenian"},{"value":"sq","label":"Albanian"},{"value":"sr","label":"Serbian"},{"value":"sr-latn","label":"Serbian Latin"},{"value":"sv","label":"Swedish"},{"value":"sw","label":"Swahili"},{"value":"ta","label":"Tamil"},{"value":"te","label":"Telugu"},{"value":"th","label":"Thai"},{"value":"tr","label":"Turkish"},{"value":"tt","label":"Tatar"},{"value":"udm","label":"Udmurt"},{"value":"uk","label":"Ukrainian"},{"value":"ur","label":"Urdu"},{"value":"vi","label":"Vietnamese"},{"value":"zh-cn","label":"Simplified Chinese"},{"value":"zh-tw","label":"Traditional Chinese"}],TAB_PREFERENCES:[{"description":"Default layout for the new widgets.","inheritByDefault":true,"defaultValue":"Fixed","label":"Default layout","inheritable":true,"type":"select","initialEntries":[{"value":"Fixed","label":"Base"},{"value":"Free","label":"Free"}],"name":"initiallayout"},{"name":"baselayout","inheritByDefault":true,"defaultValue":{"verticalmargin":3,"smart":"false","horizontalmargin":4,"type":"columnlayout","columns":20,"cellheight":12},"label":"Base layout","inheritable":true,"type":"layout"}],CURRENT_MODE:"smartphone"},ui:{}};if(window.StyledElements==null){window.StyledElements={};}
(function(){"use strict";var Utils={};Utils.gettext=function gettext(text){return text;};Utils.interpolate=function interpolate(pattern,attributes){return pattern.replace(/%\(\w+\)s/g,function(match){return String(attributes[match.slice(2,-2)]);});};Utils.Template=function Template(template){this.template=template;};Utils.Template.prototype.evaluate=function evaluate(context){return Utils.interpolate(this.template,context);};Utils.stopPropagationListener=function stopPropagationListener(e){e.stopPropagation();};Utils.preventDefaultListener=function preventDefaultListener(e){e.preventDefault();};Utils.callCallback=function callCallback(callback){if(typeof callback==='function'){try{callback.apply(null,Array.prototype.slice.call(arguments,1));}catch(error){}}};Utils.onFullscreenChange=function onFullscreenChange(element,callback){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
element.ownerDocument.addEventListener('fullscreenchange',callback,true);element.ownerDocument.addEventListener('msfullscreenchange',callback,true);element.ownerDocument.addEventListener('mozfullscreenchange',callback,true);element.ownerDocument.addEventListener('webkitfullscreenchange',callback,true);};Utils.removeFullscreenChangeCallback=function onFullscreenChange(element,callback){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
element.ownerDocument.removeEventListener('fullscreenchange',callback,true);element.ownerDocument.removeEventListener('msfullscreenchange',callback,true);element.ownerDocument.removeEventListener('mozfullscreenchange',callback,true);element.ownerDocument.removeEventListener('webkitfullscreenchange',callback,true);};Utils.isFullscreenSupported=function isFullscreenSupported(){if('fullscreenEnabled'in document){return document.fullscreenEnabled;}else if('mozFullScreenEnabled'in document){return document.mozFullScreenEnabled;}else if('webkitFullscreenEnabled'in document){return document.webkitFullscreenEnabled;}};var fix_nonparticipanting_capturing_groups=function fix_nonparticipanting_capturing_groups(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undefined){this[i]=undefined;}}};Utils.split=function split(str,separator,limit){if(!separator instanceof RegExp){return str.split(separator,limit);}
var output=[],lastLastIndex=0,flags=(separator.ignoreCase?"i":"")+
(separator.multiline?"m":"")+
(separator.sticky?"y":""),separator2,match,lastIndex,lastLength;separator=new RegExp(separator.source,flags+"g");str=str+"";if(!Utils.split._compliantExecNpcg){separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags);}
if(limit===undefined||+limit<0){limit=Infinity;}else{limit=Math.floor(+limit);if(!limit){return[];}}
while((match=separator.exec(str))){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!Utils.split._compliantExecNpcg&&match.length>1){match[0].replace(separator2,fix_nonparticipanting_capturing_groups.bind(match));}
if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1));}
lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break;}}
if(separator.lastIndex===match.index){separator.lastIndex++;}}
if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("");}}else{output.push(str.slice(lastLastIndex));}
return output.length>limit?output.slice(0,limit):output;};Utils.split._compliantExecNpcg=/()??/.exec("")[1]===undefined;Utils.split._nativeSplit=String.prototype.split;Utils.hasWord=function hasWord(text,word){return text.match(new RegExp("(^\\s*|\\s+)"+word+"(\\s+|\\s*$)","g"))!=null;};Utils.removeWord=function removeWord(text,word){return text.replace(new RegExp("(^\\s*|\\s+)"+word+"(\\s+|\\s*$)","g")," ").trim();};Utils.appendWord=function appendWord(text,word){return Utils.removeWord(text,word)+(" "+word);};Utils.prependWord=function prependWord(text,word){return word+" "+Utils.removeWord(text,word);};Utils.escapeRegExp=function escapeRegExp(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");};var tmp_div=document.createElement('div');Utils.escapeHTML=function escapeHTML(text){tmp_div.textContent=text;return tmp_div.innerHTML;};if(!String.prototype.startsWith){Utils.startsWith=function startsWith(text,searchString,position){position=position||0;return text.indexOf(searchString,position)===position;};}else{Utils.startsWith=function startsWith(text,searchString,position){return text.startsWith(searchString,position);};}
if(!String.prototype.endsWith){Utils.endsWith=function endsWith(text,searchString,position){position=position||text.length;position=position-searchString.length;var lastIndex=text.lastIndexOf(searchString);return lastIndex!==-1&&lastIndex===position;};}else{Utils.endsWith=function endsWith(text,searchString,position){return text.endsWith(searchString,position);};}
Utils.getRelativePosition=function getRelativePosition(element1,element2){var coordinates={x:element1.offsetLeft,y:element1.offsetTop};var contextDocument=element1.ownerDocument;if(element1===element2){return{x:0,y:0};}
var parentNode=element1.offsetParent;while(parentNode!=element2){var cssStyle=contextDocument.defaultView.getComputedStyle(parentNode,null);var p=cssStyle.getPropertyValue('position');if(p!='static'){coordinates.y+=parentNode.offsetTop+cssStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);coordinates.x+=parentNode.offsetLeft+cssStyle.getPropertyCSSValue('border-left-width').getFloatValue(CSSPrimitiveValue.CSS_PX);coordinates.y-=parentNode.scrollTop;coordinates.x-=parentNode.scrollLeft;}
parentNode=parentNode.offsetParent;}
return coordinates;};Utils.getEventActions=function getEventActions(eventVar){var i,actions,contactSlots,nslotsByLabel,slotInfo,actionLabel;contactSlots=eventVar.getFinalSlots();nslotsByLabel={};actions=[];for(i=0;i<contactSlots.length;i+=1){slotInfo=contactSlots[i];if(nslotsByLabel[slotInfo.action_label]==null){nslotsByLabel[slotInfo.action_label]=1;}else{nslotsByLabel[slotInfo.action_label]+=1;}}
for(i=0;i<contactSlots.length;i+=1){slotInfo=contactSlots[i];actionLabel=slotInfo.action_label;if(nslotsByLabel[actionLabel]>1){actionLabel+=' ('+slotInfo.iGadgetName+')';}
actions.push({value:slotInfo,label:actionLabel});}
return actions;};Utils.XML={};Utils.XML.isElement=function isElement(element){return element&&('nodeType'in element)&&(element.nodeType===1);};if(window.Attr){Utils.XML.isAttribute=function isAttribute(element){return element instanceof Attr;};}else{Utils.XML.isAttribute=function isAttribute(element){return element&&('nodeType'in element)&&(element.nodeType===2);};}
if(document.createElementNS!=null){Utils.XML.createElementNS=function createElementNS(document,namespace,nodename){if(namespace){return document.createElementNS(namespace,nodename);}else{return document.createElement(nodename);}};}else{Utils.XML.createElementNS=function createElementNS(document,namespace,nodename){return document.createNode(1,nodename,namespace?namespace:"");};}
if(document.documentElement.getAttributeNS!=null){Utils.XML.getAttributeNS=function getAttributeNS(element,namespace,name){return element.getAttributeNS(namespace,name);};}else{Utils.XML.getAttributeNS=function getAttributeNS(element,namespace,name){for(var i=0;i<element.attributes.length;i++){var attr=element.attributes[i];if(attr.baseName==name&&attr.namespaceURI==namespace){return attr.nodeValue;}}
return"";};}
if(document.documentElement.hasAttribute!=null){Utils.XML.hasAttribute=function hasAttribute(element,name){return element.hasAttribute(name);};}else{Utils.XML.hasAttribute=function hasAttribute(element,name){return element.getAttribute(name)!==null;};}
if(document.documentElement.hasAttributeNS!=null){Utils.XML.hasAttributeNS=function hasAttribute(element,namespace,name){return element.hasAttributeNS(namespace,name);};}else{Utils.XML.hasAttributeNS=function hasAttributeNS(element,namespace,name){for(var i=0;i<element.attributes.length;i++){var attr=element.attributes[i];if(attr.baseName==name&&attr.namespaceURI==namespace){return true;}}
return false;};}
if(document.documentElement.setAttributeNS!=null){Utils.XML.setAttributeNS=function setAttributeNS(element,namespace,name,value){element.setAttributeNS(namespace,name,value);};}else{Utils.XML.setAttributeNS=function setAttributeNS(element,namespace,name,value){var attr;if(!('createNode'in element.ownerDocument)){alert('setAttributeNS is not supported in this browser');}
attr=element.ownerDocument.createNode(2,name,namespace);attr.nodeValue=value;element.setAttributeNode(attr);};}
if(document.implementation&&document.implementation.createDocument){Utils.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){return document.implementation.createDocument(namespaceURL,rootTagName,null);};}else if(window.ActiveXObject){Utils.XML.createDocument=function(namespaceURL,rootTagName,doctype){var doc=new ActiveXObject("MSXML2.DOMDocument");doc.appendChild(Utils.XML.createElementNS(doc,namespaceURL,rootTagName));return doc;};}else{Utils.XML.createDocument=function(namespaceURL,rootTagName,doctype){alert('createDocument is not supported in this browser');};}
if(window.DOMParser){Utils.XML.parseFromString=function parseFromString(text,type,fromAjax){var result,new_header,parser=new DOMParser();fromAjax=fromAjax!==undefined?fromAjax:true;if(fromAjax){result=text.match(new RegExp('<\\?xml(?:[^/]|/[^>])*standalone="([^"]+)"(?:[^/]|/[^>])*\\?>'));if(result&&(result[1]==='yes'||result[1]==='no')){new_header='<?xml version="1.0" standalone="'+result[1]+'" ?>';}else{new_header='<?xml version="1.0" ?>';}
text=text.replace(/<\?xml([^\/]|\/[^>])*\?>/g,new_header);}
return parser.parseFromString(text,type);};}else if(window.ActiveXObject){Utils.XML.parseFromString=function parseFromString(text,type,fromAjax){var xml=new ActiveXObject("Microsoft.XMLDOM");xml.async=false;xml.loadXML(text);return xml;};}else{Utils.XML.parseFromString=function parseFromString(text,type,fromAjax){var req=new XMLHttpRequest();req.open('GET','data:'+(type||"application/xml")+';charset=utf-8,'+encodeURIComponent(text),false);if(req.overrideMimeType){req.overrideMimeType(type);}
req.send(null);return req.responseXML;};}
if(window.XMLSerializer){Utils.XML.serializeXML=function serializeXML(node){return(new XMLSerializer()).serializeToString(node);};}else{Utils.XML.serializeXML=function serializeXML(node){if(node.xml){return node.xml;}else{throw"Error serializating xml";}};}
if(document.evaluate){Utils.XML.getChildElementByTagNameNS=function getChildElementByTagNameNS(element,ns,tagName){var xpathResult=element.ownerDocument.evaluate('s:'+tagName,element,function(namespace){return namespace==='s'?ns:null;},XPathResult.FIRST_ORDERED_NODE_TYPE,null);return xpathResult.singleNodeValue;};}else{Utils.XML.getChildElementByTagNameNS=function getChildElementByTagNameNS(element,ns,tagName){var i,currentChild;for(i=0;i<element.childNodes.length;i++){currentChild=element.childNodes[i];if(currentChild.namespaceURI===ns&&currentChild.localName===tagName){return currentChild;}}
return null;};}
Utils.values=function values(object){var result=[];for(var key in object){result.push(object[key]);}
return result;};Utils.clone=function clone(obj1){var result;if(obj1==null){return obj1;}else if(Array.isArray(obj1)){result=[];}else{result={};}
for(var key in obj1){result[key]=obj1[key];}
return result;};Utils.isEmptyObject=function isEmptyObject(obj){var name;for(name in obj){return false;}
return true;};Utils.removeFromParent=function removeFromParent(domNode){if(domNode.parentNode!=null){domNode.parentNode.removeChild(domNode);}};Utils.merge=function merge(obj1,obj2){if(obj2!=null){for(var key in obj2){obj1[key]=obj2[key];}}
return obj1;};StyledElements.Utils=Utils;})();Wirecloud.Utils=StyledElements.Utils;Wirecloud.Utils.gettext=gettext;Wirecloud.URLs={"LOGIN_VIEW":'/login',"LOGOUT_VIEW":'/logout',"LOCAL_REPOSITORY":'/',"LOCAL_RESOURCE_COLLECTION":'/api/resources',"LOCAL_RESOURCE_ENTRY":new Wirecloud.Utils.Template('/api/resource/%(vendor)s/%(name)s/%(version)s'),"LOCAL_UNVERSIONED_RESOURCE_ENTRY":new Wirecloud.Utils.Template('/api/resource/%(vendor)s/%(name)s'),"IWIDGET_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidgets'),"IWIDGET_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s'),"IWIDGET_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/preferences'),"IWIDGET_PROPERTIES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/properties'),"IWIDGET_VERSION_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/version'),"PLATFORM_CONTEXT_COLLECTION":'/api/context',"PLATFORM_PREFERENCES":'/api/preferences/platform',"PROXY":new Wirecloud.Utils.Template('/cdp/%(protocol)s/%(domain)s%(path)s'),"WORKSPACE_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/preferences'),"TAB_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tabs'),"TAB_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s'),"TAB_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/preferences'),"THEME_ENTRY":new Wirecloud.Utils.Template('/api/theme/%(name)s'),"MARKET_COLLECTION":'/api/markets',"GLOBAL_MARKET_ENTRY":new Wirecloud.Utils.Template('/api/market/%(market)s'),"MARKET_ENTRY":new Wirecloud.Utils.Template('/api/market/%(user)s/%(market)s'),"WIRING_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/wiring'),"OPERATOR_ENTRY":new Wirecloud.Utils.Template('/api/operator/%(vendor)s/%(name)s/%(version)s/html'),"WIDGET_CODE_ENTRY":new Wirecloud.Utils.Template('/api/widget/%(vendor)s/%(name)s/%(version)s/xhtml'),"WORKSPACE_COLLECTION":'/api/workspaces',"WORKSPACE_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s'),"WORKSPACE_PUBLISH":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/publish'),"WORKSPACE_RESOURCE_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/resources'),"WORKSPACE_VIEW":new Wirecloud.Utils.Template('/%(owner)s/%(name)s'),"PUBLISH_ON_OTHER_MARKETPLACE":'/api/markets/publish',"WORKSPACE_MERGE":new Wirecloud.Utils.Template('/api/workspace/%(to_ws_id)s/merge'),"DJANGO_ADMIN":'/admin/',"FIWARE_RESOURCES_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/resources'),"FIWARE_OFFERING_ENTRY":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/%(store)s/offering/%(offering_id)s'),"FIWARE_FULL_SEARCH":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/search/%(search_string)s'),"FIWARE_STORE_RESOURCES_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/%(store)s/resources'),"FIWARE_STORE_SEARCH":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/search/%(store)s/%(search_string)s'),"FIWARE_STORE_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/stores'),"FIWARE_STORE_START_PURCHASE":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/store/%(store)s/start_purchase'),};var LayoutManagerFactory=function(){var instance=null;function LayoutManager(){this.header={_initUserMenu:function(){},refresh:function(){}};}
LayoutManager.prototype._init=function _init(){};LayoutManager.prototype._startComplexTask=function _startComplexTask(task,subtasks){this.monitor=new Wirecloud.TaskMonitorModel(task,subtasks);return this.monitor;};LayoutManager.prototype.logSubTask=function logSubTask(msg,totalSteps){this.monitor.nextSubtask(msg);};LayoutManager.prototype.logStep=function logStep(){};LayoutManager.prototype._notifyPlatformReady=function _notifyPlatformReady(){this.monitor=null;};LayoutManager.prototype.changeCurrentView=function changeCurrentView(){};LayoutManager.prototype.onHashChange=function(state){var ws_id,tab_id,tab,nextWorkspace,opManager,dragboard;opManager=OpManagerFactory.getInstance();ws_id=parseInt(state.workspace,10);if(ws_id!==Wirecloud.activeWorkspace.id){nextWorkspace=opManager.workspaceInstances[ws_id];Wirecloud.changeActiveWorkspace(nextWorkspace,state.tab);return;}
if(state.view!==this.currentViewType){switch(state.view){case"dragboard":dragboard=null;tab_id=parseInt(state.tab,10);if(state.tab!==Wirecloud.activeWorkspace.visibleTab.id){tab=Wirecloud.activeWorkspace.getTab(state.tab);if(typeof tab!=="undefined"){dragboard=tab.getDragboard();}}
if(dragboard===null){dragboard=Wirecloud.activeWorkspace.getActiveDragboard();}
this.showDragboard(dragboard);break;default:}}};LayoutManager.prototype.resizeWrapper=function resizeWrapper(state){updateLayout();};return new function(){this.getInstance=function(){if(instance==null){instance=new LayoutManager();}
return instance;}}}();"use strict";function updateLayout(){var orient=(window.orientation===0||window.orientation===180)?"portrait":"landscape";document.body.className=orient;document.body.style.height=window.innerHeight+'px';document.body.style.width=window.innerWidth+'px';OpManagerFactory.getInstance().alternatives.repaint();if(Wirecloud.activeWorkspace!=null){Wirecloud.activeWorkspace.updateLayout(orient);}}
function checkTab(){var opManager,xoffset,tabWidth,halfTabWidth,scroll,STEP_H,steps,step,i,tabContainer,xoffset,tabWidth,newTabIndex;opManager=OpManagerFactory.getInstance();if(opManager.visibleLayer==="tabs_container"){tabContainer=Wirecloud.activeWorkspace.layout.getCenterContainer().wrapperElement;xoffset=tabContainer.scrollLeft;tabWidth=window.innerWidth;newTabIndex=Math.round(xoffset/tabWidth);Wirecloud.activeWorkspace.updateVisibleTab(newTabIndex);}}
(function(){"use strict";function MobileScrollManager(element,options){var touchstart,touchend,touchmove,searchTarget,scrollParentY,scrollParentX,baseX,baseY,baseScrollTop,baseScrollLeft,target,defaultOptions;searchTarget=function(element,property,nextLevel){var computedStyle,prop_value,currentElement=element;while(currentElement!==null){computedStyle=element.ownerDocument.defaultView.getComputedStyle(currentElement,null);prop_value=computedStyle.getPropertyValue(property);if(prop_value==='auto'||prop_value==='scroll'){return currentElement;}
currentElement=currentElement.parentElement;}
if(nextLevel&&element.ownerDocument!==nextLevel.ownerDocument){return searchTarget(nextLevel,property,null);}
return null;};scrollParentY=function(element,extraScroll){var newScrollTop,newExtraScroll=0,parentElement;parentElement=searchTarget(element.parentElement,'overflow-y');if(parentElement!==null){newScrollTop=parentElement.scrollTop+extraScroll;if(newScrollTop<0){newExtraScroll=newScrollTop;newScrollTop=0;}else if((newScrollTop+target.clientHeight>target.scrollHeight)){newExtraScroll=newScrollTop;newScrollTop=parentElement.scrollHeight-parentElement.clientHeight;newExtraScroll-=newScrollTop;}
parentElement.scrollTop=newScrollTop;if(newExtraScroll!==0){scrollParentY(parentElement.parentElement,newExtraScroll);}}};scrollParentX=function(element,extraScroll){var parentElement=searchTarget(element.parentElement,'overflow-x');if(parentElement!==null){parentElement.scrollLeft+=extraScroll;}};touchstart=function(event){target=searchTarget(event.target,'overflow-y');if(target!==null){baseX=event.touches[0].screenX;baseY=event.touches[0].screenY;baseScrollTop=target.scrollTop;baseScrollLeft=target.scrollLeft;}};touchmove=function(event){var tmpScroll;if(target===null||event.touches.length>1){return;}
var eventX=event.touches[0].screenX;var eventY=event.touches[0].screenY;var newScrollLeft=baseScrollLeft+(baseX-eventX);var newScrollTop=baseScrollTop+(baseY-eventY);baseX=eventX;baseY=eventY;if(newScrollLeft<0){if(options.propagate){scrollParentX(target,newScrollLeft);}
newScrollLeft=0;}else if((newScrollLeft+target.clientWidth>target.scrollWidth)){tmpScroll=newScrollLeft;newScrollLeft=target.scrollWidth-target.clientWidth;if(options.propagate){tmpScroll-=newScrollLeft;scrollParentX(target,tmpScroll);}}
if(newScrollTop<0){if(options.propagate){scrollParentY(target,newScrollTop);}
newScrollTop=0;}else if((newScrollTop+target.clientHeight>target.scrollHeight)){tmpScroll=newScrollTop;newScrollTop=target.scrollHeight-target.clientHeight;if(options.propagate){tmpScroll-=newScrollTop;scrollParentY(target,tmpScroll);}}
baseScrollLeft=newScrollLeft;baseScrollTop=newScrollTop;target.scrollLeft=newScrollLeft;target.scrollTop=newScrollTop;if(options.propagate===false){event.stopPropagation();event.preventDefault();}};touchend=function(event){target=null;if(options.onend){try{options.onend.call(this);}catch(e){}}
if(options.propagate===false){event.stopPropagation();event.preventDefault();}};defaultOptions={'capture':true,'propagate':true,'parentContainer':null,'onend':null};options=Wirecloud.Utils.merge(defaultOptions,options);element.addEventListener('touchstart',touchstart,options.capture);element.addEventListener('touchmove',touchmove,options.capture);element.addEventListener('touchend',touchend,options.capture);element.addEventListener('touchcancel',touchend,options.capture);}
window.MobileScrollManager=MobileScrollManager;})();"use strict";var OpManagerFactory=(function(){var instance=null,Singleton;function OpManager(){OpManager.prototype.showDragboard=function(iWidgetId){var dragboard=Wirecloud.activeWorkspace.getIWidget(iWidgetId).dragboard;dragboard.paint(iWidgetId);this.visibleLayer="dragboard";};OpManager.prototype.showWidgetsMenu=function(){this.alternatives.showAlternative(this.workspaceTabsAlternative);this.visibleLayer="tabs_container";Wirecloud.activeWorkspace.show();};OpManager.prototype.showWorkspaceMenu=function(){var workspaceId,workspace,workspaceEntry;this.workspaceListElement.innerHTML='';for(workspaceId in this.workspaceInstances){workspace=this.workspaceInstances[workspaceId];workspaceEntry=document.createElement('li');workspaceEntry.textContent=workspace.name;if(workspace===Wirecloud.activeWorkspace){workspaceEntry.setAttribute('class','selected');workspaceEntry.addEventListener('click',function(){this.alternatives.showAlternative(Wirecloud.activeWorkspace.tabsContainerElement);}.bind(this),false);}else{workspaceEntry.addEventListener('click',Wirecloud.changeActiveWorkspace.bind(Wirecloud,workspace),false);}
this.workspaceListElement.appendChild(workspaceEntry);}
this.alternatives.showAlternative(this.workspaceListAlternative);this.visibleLayer="workspace_menu";};this.visibleLayer=null;this.workspaceInstances={};this.workspacesByUserAndName={};this.workspaceMenuElement=document.getElementById('workspace_menu');this.workspaceListElement=document.getElementById('workspace_list');this.alternatives=new StyledElements.StyledAlternatives();this.workspaceListAlternative=this.alternatives.createAlternative();this.workspaceListAlternative.appendChild(this.workspaceMenuElement);this.workspaceTabsAlternative=this.alternatives.createAlternative({'class':'tabs_container'});this.iwidgetViewAlternative=this.alternatives.createAlternative();this.globalDragboard=new MobileDragboard();this.iwidgetViewAlternative.appendChild(this.globalDragboard);this.alternatives.addEventListener('preTransition',function(alternatives,out_alternative,in_alternative){alternatives.repaint();in_alternative.repaint();});this.alternatives.insertInto(document.body);}
Singleton=function(){this.getInstance=function(){if(instance===null||instance===undefined){instance=new OpManager();}
return instance;};};return new Singleton();}());"use strict";function IWidget(widget,iWidgetId,iWidgetCode,iWidgetName,dragboard,alternative,description){this.code=iWidgetCode;this.dragboard=dragboard;this.element=null;this.content=null;this.internal_iwidget=new Wirecloud.IWidget(widget,dragboard.tab,description);Object.defineProperties(this,{'id':{get:function(){return this.internal_iwidget.id;}},'widget':{get:function(){return this.internal_iwidget.widget;}},'name':{get:function(){return this.internal_iwidget.name;}},'alternative':{value:alternative}});this.codeURL=this.internal_iwidget.widget.code_url+"#id="+this.id;this.loaded=false;this.alternative.addEventListener('show',function(){this.dragboard._updateIWidgetInfo(this);this.paint();}.bind(this));}
IWidget.prototype.paint=function(){if(this.element!==null){return;}
var contents=this.internal_iwidget.buildInterface(Wirecloud.currentTheme.templates['iwidget_smartphone'],this);this.element=contents.element;this.content=this.element.getElementsByTagName('iframe')[0];this.alternative.appendChild(this.element);this.internal_iwidget.addEventListener('load',function(){new MobileScrollManager(this.content.contentDocument,{'capture':true,'propagate':true});}.bind(this));this.content.setAttribute("src",this.codeURL);};IWidget.prototype.load=IWidget.prototype.paint;IWidget.prototype.destroy=function(){if(this.element){Wirecloud.Utils.removeFromParent(this.element);this.element=null;this.content=null;}
if(this.internal_iwidget!=null){this.internal_iwidget.destroy();this.internal_iwidget=null;}};(function(){"use strict";var Dragboard=function Dragboard(tab,workspace,dragboardElement){this.currentCode=1;this.dragboardElement=document.getElementById('dragboard');this.barElement=document.getElementById('bar');this.iWidgets={};this.tab=tab;this.workspace=workspace;this.parseTab(tab.tabInfo);};Dragboard.prototype.paint=function(iWidgetId){var opManager,iWidget;opManager=OpManagerFactory.getInstance();iWidget=this.getIWidget(iWidgetId);opManager.alternatives.showAlternative(opManager.iwidgetViewAlternative);opManager.globalDragboard.show(iWidget.alternative);opManager.visibleLayer="dragboard";updateLayout();};Dragboard.prototype.parseTab=function(tabInfo){var curIWidget,iwidget,widget,i,container,opManager=OpManagerFactory.getInstance();this.currentCode=1;this.iWidgets={};this.iwidgets=tabInfo.iwidgets;for(i=0;i<this.iwidgets.length;i+=1){curIWidget=this.iwidgets[i];widget=this.workspace.resources.getResourceId(curIWidget.widget);container=opManager.globalDragboard.newIWidgetContainer();iwidget=new IWidget(widget,curIWidget.id,curIWidget.code,curIWidget.name,this,container,curIWidget);this.iWidgets[curIWidget.id]=iwidget;if(curIWidget.code>=this.currentCode){this.currentCode=curIWidget.code+1;}}};Dragboard.prototype.destroy=function(){var key;for(key in this.iWidgets){this.iWidgets[key].destroy();}
this.iWidgets=null;};Dragboard.prototype.getIWidgets=function(){return Wirecloud.Utils.values(this.iWidgets);};Dragboard.prototype.getIWidget=function(iWidgetId){return this.iWidgets[iWidgetId];};Dragboard.prototype._updateIWidgetInfo=function(iWidget){OpManagerFactory.getInstance().globalDragboard._updateIWidgetInfo(iWidget);this.workspace.updateVisibleTab(this.tab.index);};window.Dragboard=Dragboard;})();(function(view){"use strict";if(!('SVGElement'in view)){return;}
var svg_element=document.createElementNS("http://www.w3.org/2000/svg","svg:path");if('classList'in svg_element){return;}
var DOMEx=function(type,message){this.name=type;this.code=DOMException[type];this.message=message;};DOMEx.prototype=Error.prototype;var checkTokenAndGetIndex=function checkTokenAndGetIndex(classList,token){if(token===""){throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");}
if(/\s/.test(token)){throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");}
return classList.indexOf(token);};var ClassList=function ClassList(elem){var trimmedClasses=(elem.getAttribute("class")||"").trim(),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0;for(;i<classes.length;i++){this.push(classes[i]);}
this._updateClassName=function(){elem.setAttribute("class",this.toString());};};ClassList.prototype=[];ClassList.prototype.item=function item(i){return this[i]||null;};ClassList.prototype.contains=function contains(token){token+="";return checkTokenAndGetIndex(this,token)!==-1;};ClassList.prototype.add=function add(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";if(checkTokenAndGetIndex(this,token)===-1){this.push(token);updated=true;}}while(++i<l);if(updated){this._updateClassName();}};ClassList.prototype.remove=function remove(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";var index=checkTokenAndGetIndex(this,token);if(index!==-1){this.splice(index,1);updated=true;}}while(++i<l);if(updated){this._updateClassName();}};ClassList.prototype.toggle=function toggle(token,force){token+="";var result=this.contains(token),method=result?force!==true&&"remove":force!==false&&"add";if(method){this[method](token);}
return!result;};ClassList.prototype.toString=function toString(){return this.join(" ");};var classListGetter=function(){return new ClassList(this);};Object.defineProperty(view.SVGElement.prototype,"classList",{get:classListGetter});})(window);(function(){"use strict";var check_basic_requirements=function check_basic_requirements(){var tester={};if(!('addEventListener'in document.documentElement)){throw new Error('Missing basic DOM event support');}
if(!('JSON'in window)){throw new Error('Missing JSON support');}
if(!('freeze'in Object)){throw new Error('Missing Object.freeze support');}
if(!('defineProperty'in Object)){throw new Error('Missing Object.defineProperty support');}
try{tester={};Object.defineProperty(tester,'property',{});}catch(e){throw new Error('Missing proper Object.defineProperty support');}
if(!('defineProperties'in Object)){throw new Error('Missing Object.defineProperties support');}
if(!('defineProperties'in Object)){throw new Error('Missing Object.defineProperties support');}
if(!('classList'in document.documentElement)){throw new Error('Missing Element.classList support');}
if(window.history==null||typeof window.history.pushState!=='function'||typeof window.history.replaceState!=='function'){throw new Error("Missing HTML5's history API support");}
if(!('pointerEvents'in document.documentElement.style)){throw new Error('Missing pointer-events support for HTML elements');}};Wirecloud.check_basic_requirements=check_basic_requirements;})();(function(window){"use strict";var _internalGetCurrentStyle,cssProperties=[];var useInternalComputedStyle=typeof window.getComputedStyle==="undefined";if(!useInternalComputedStyle){try{var computedStyle,width;computedStyle=document.defaultView.getComputedStyle(document.documentElement,null);width=computedStyle.getPropertyCSSValue('width');width=width.getFloatValue(width.CSS_PX);}catch(e){useInternalComputedStyle=true;cssProperties=computedStyle;var _nativeGetComputedStyle=document.defaultView.getComputedStyle;_internalGetCurrentStyle=function _internalGetCurrentStyle(element,property,ieProperty){var computedStyle=_nativeGetComputedStyle.call(document.defaultView,element,null);return computedStyle.getPropertyValue(property);};}}else{_internalGetCurrentStyle=function _internalGetCurrentStyle(element,property,ieProperty){var value=element.currentStyle[ieProperty];if(value==='auto'){value=element.runtimeStyle[ieProperty];}
return value;};}
if(useInternalComputedStyle){var CSSPrimitiveValue=function CSSPrimitiveValue(element,property,ieProperty){if(arguments.length===0){return;}
this._element=element;this._property=property;this._ieProperty=ieProperty;this.cssText=_internalGetCurrentStyle(this._element,this._property,this._ieProperty);};CSSPrimitiveValue.CSS_PX=1;var _ValueRegExp=new RegExp('(\\d+|\\d+.\\d+)(\\w+)');CSSPrimitiveValue.prototype.getFloatValue=function getFloatValue(unit){var result;if(unit===CSSPrimitiveValue.CSS_PX){if(this.cssText===""){return 0;}
var parentNode=this._element.parentNode;var testElement=this._element.ownerDocument.createElement('div');testElement.style.visibility="hidden";testElement.style.padding="0";testElement.style.margin="0";testElement.style.border="0";var matching=/border-(top|right|bottom|left)-width/.exec(this._property);var side=matching!==null?matching[1]:null;matching=_ValueRegExp.exec(this.cssText);if(matching!=null){var value=matching[1];var units=matching[2];if(units=="px"){return parseInt(value,10);}else{testElement.style.height=this.cssText;}}else if((matching==null)&&(side!=null)){var property='border-'+side+'-style';var ieProperty=ComputedCSSStyleDeclaration.prototype._getIEProperty(property);var borderStyle=_internalGetCurrentStyle(this._element,property,ieProperty);if(borderStyle==="none"){return 0;}
var extraElement=this._element.ownerDocument.createElement('div');testElement.style.fontSize="0";testElement.style.lineHeight="0";extraElement.style.padding="0";extraElement.style.margin="0";extraElement.style.border="0";extraElement.style.width="1px";extraElement.style.borderTopWidth=this.cssText;extraElement.style.borderTopStyle=borderStyle;testElement.appendChild(extraElement);}else{throw new Error();}
parentNode.appendChild(testElement);if(testElement.offsetHeight!=null){result=testElement.offsetHeight;}else{throw new Error();}
parentNode.removeChild(testElement);return result;}else{throw new Error();}};var _rgbaColorParser=new RegExp('rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)');var _rgbColorParser=new RegExp('rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)');var _hexColorParser=new RegExp('#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})','i');var hex2value=function hex2value(hex){hex=hex.toUpperCase();return("0123456789ABCDEF".indexOf(hex.substr(0,1))*16)+"0123456789ABCDEF".indexOf(hex.substr(1,1));};CSSPrimitiveValue.prototype.getRGBColorValue=function getRGBColorValue(){switch(this._property){case'background-color':case'color':var red,green,blue,alpha='1';var matching=_rgbColorParser.exec(this.cssText);if(matching!==null){red=matching[1];green=matching[2];blue=matching[3];}else{matching=_rgbaColorParser.exec(this.cssText);if(matching!==null){red=matching[1];green=matching[2];blue=matching[3];alpha=matching[4];}else{matching=_hexColorParser.exec(this.cssText);if(matching===null){var parentNode=this._element.parentNode;var testElement=this._element.ownerDocument.createElement('table');testElement.setAttribute('bgcolor',this.cssText);testElement.style.visibility="hidden";parentNode.appendChild(testElement);var bgColor=testElement.bgColor;matching=_hexColorParser.exec(bgColor);if(matching===null){throw new Error('Error on getRGBColorValue');}
parentNode.removeChild(testElement);}
red=hex2value(matching[1]);green=hex2value(matching[2]);blue=hex2value(matching[3]);}}
return{red:new CSSColorComponentValue(red),green:new CSSColorComponentValue(green),blue:new CSSColorComponentValue(blue),alpha:new CSSColorComponentValue(alpha)};default:throw new Error();}};var CSSColorComponentValue=function CSSColorComponentValue(value){this.cssText=""+value;};CSSColorComponentValue.prototype=new CSSPrimitiveValue();CSSColorComponentValue.prototype.getFloatValue=function getFloatValue(unit){return parseInt(this.cssText,10);};var ComputedCSSStyleDeclaration=function ComputedCSSStyleDeclaration(element){this._element=element;};if(Object.defineProperty){var _defProp=function(object,property){Object.defineProperty(object,property,{get:function(){return this.getPropertyValue(property);},enumerable:true,configurable:false});};var i;for(i=0;i<cssProperties.length;i+=1){_defProp(ComputedCSSStyleDeclaration.prototype,cssProperties[i]);}}
ComputedCSSStyleDeclaration.prototype._getIEProperty=function _getIEProperty(property){if(property==='float'){return"styleFloat";}else{return property.replace(/-\w/g,function(a){return a.substr(1,1).toUpperCase();});}};ComputedCSSStyleDeclaration.prototype.getPropertyCSSValue=function getPropertyCSSValue(property){return new CSSPrimitiveValue(this._element,property,this._getIEProperty(property));};ComputedCSSStyleDeclaration.prototype.getPropertyValue=function getPropertyValue(property){return _internalGetCurrentStyle(this._element,property,this._getIEProperty(property));};window.CSSPrimitiveValue=CSSPrimitiveValue;window.CSSColorComponentValue=CSSColorComponentValue;window.getComputedStyle=function getComputedStyle(element,context){if(element==null){throw new Error('Operation is not supported');}
return new ComputedCSSStyleDeclaration(element);};if(window.document.defaultView===undefined){window.document.defaultView=window;}}})(window);(function(){"use strict";Wirecloud.constants.LOGGING={ERROR_MSG:1,WARN_MSG:2,INFO_MSG:3};Wirecloud.constants.HTTP_STATUS_DESCRIPTIONS={"0":gettext("Connection Refused"),"400":gettext("Bad Request"),"401":gettext("Unauthorized"),"402":gettext("Payment Required"),"403":gettext("Forbidden"),"404":gettext("Not Found"),"405":gettext("Method Not Allowed"),"406":gettext("Not Acceptable"),"407":gettext("Proxy Authentication Required"),"408":gettext("Request Timeout"),"409":gettext("Conflict"),"410":gettext("Gone"),"411":gettext("Length Required"),"412":gettext("Precondition Failed"),"413":gettext("Request Entity Too Large"),"414":gettext("Request-URI Too Long"),"415":gettext("Unsupported Media Type"),"416":gettext("Requested Range Not Satisfiable"),"417":gettext("Expectation Failed"),"422":gettext("Unprocessable Entity"),"423":gettext("Locked"),"424":gettext("Failed Dependency"),"426":gettext("Upgrade Required"),"500":gettext("Internal Server Error"),"501":gettext("Not Implemented"),"502":gettext("Bad Gateway"),"503":gettext("Service Unavailable"),"504":gettext("Gateway Timeout"),"505":gettext("HTTP Version Not Supported"),"506":gettext("Variant Also Negotiates"),"507":gettext("Insufficient Storage"),"508":gettext("Loop Detected"),"510":gettext("Not Extended")};Wirecloud.constants.UNKNOWN_STATUS_CODE_DESCRIPTION=gettext("Unknown status code");})();(function(){"use strict";var Event=function Event(){this.handlers=[];};Event.prototype.addEventListener=function addEventListener(handler){if(typeof handler!=='function'){throw new TypeError('Handlers must be functions');}
this.handlers.push(handler);};Event.prototype.removeEventListener=function removeEventListener(handler){if(typeof handler!=='function'){throw new TypeError('Handlers must be functions');}
var index=this.handlers.indexOf(handler);if(index!=-1){this.handlers.splice(index,1);}};Event.prototype.clearEventListeners=function clearEventListeners(){this.handlers.length=0;};Event.prototype.dispatch=function dispatch(){for(var i=0;i<this.handlers.length;i++){try{this.handlers[i].apply(null,arguments);}catch(e){}}};StyledElements.Event=Event;})();(function(){"use strict";var preferencesChanged=function preferencesChanged(preferences,modifiedValues){if('language'in modifiedValues){window.location.reload();}};Object.defineProperty(Wirecloud,'events',{value:{'activeworkspacechanged':new StyledElements.Event()}});Object.freeze(Wirecloud.events);var onCreateWorkspaceSuccess=function onCreateWorkspaceSuccess(options,response){var workspace=null;if([201,204].indexOf(response.status)===-1){onCreateWorkspaceFailure.call(this,options,response);}
if(response.status===201){workspace=JSON.parse(response.responseText);this.workspaceInstances[workspace.id]=workspace;if(!(workspace.creator in this.workspacesByUserAndName)){this.workspacesByUserAndName[workspace.creator]={};}
this.workspacesByUserAndName[workspace.creator][workspace.name]=workspace;}
if(typeof options.onSuccess==='function'){try{options.onSuccess(workspace);}catch(e){}}};var onCreateWorkspaceFailure=function onCreateWorkspaceFailure(options,response,e){var msg,details;msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding the workspace: %(errorMsg)s."),response,e);if(typeof options.onFailure==='function'){try{if(response.status===422){details=JSON.parse(response.responseText).details;}}catch(e){}
try{options.onFailure(msg,details);}catch(e){}}};var onWorkspaceRemoved=function onWorkspaceRemoved(workspace){delete this.workspacesByUserAndName[workspace.workspaceState.creator][workspace.workspaceState.name];delete this.workspaceInstances[workspace.id];var username=Wirecloud.contextManager.get('username');Wirecloud.changeActiveWorkspace(Wirecloud.Utils.values(this.workspacesByUserAndName[username])[0]);};var onMergeSuccess=function onMergeSuccess(options,response){Wirecloud.changeActiveWorkspace(Wirecloud.activeWorkspace.workspaceState);};var onMergeFailure=function onMergeFailure(options,response,e){var msg,details;msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error merging the mashup: %(errorMsg)s."),response,e);if(typeof options.onFailure==='function'){try{if(response.status===422){details=JSON.parse(response.responseText).details;}}catch(e){}
try{options.onFailure(msg,details);}catch(e){}}};Wirecloud.init=function init(options){this.workspaceInstances={};this.workspacesByUserAndName={};options=Wirecloud.Utils.merge({'monitor':null},options);Wirecloud.UserInterfaceManager.init();if(options.monitor==null){var layoutManager=LayoutManagerFactory.getInstance();layoutManager.resizeWrapper();options.monitor=layoutManager._startComplexTask(gettext('Loading Wirecloud Platform'),4);layoutManager.logSubTask(gettext('Retrieving Wirecloud code'));layoutManager.logStep('');layoutManager.logSubTask(gettext('Retrieving initial data'),4);}else if(!(options.monitor instanceof Wirecloud.TaskMonitorModel)){throw new TypeError('Invalid monitor');}
if(typeof options.onSuccess!=='function'){options.onSuccess=function(){Wirecloud.HistoryManager.init();var state=Wirecloud.HistoryManager.getCurrentState();LayoutManagerFactory.getInstance().changeCurrentView('workspace',true);if(state.workspace_name!==''){var workspace=this.workspacesByUserAndName[state.workspace_creator][state.workspace_name];this.changeActiveWorkspace(workspace,state.tab,{replaceNavigationState:true});}else{Wirecloud.createWorkspace({name:gettext('Workspace'),onSuccess:function(workspace){Wirecloud.changeActiveWorkspace(workspace,null,{replaceNavigationState:true});}});}}.bind(this);}
window.addEventListener("beforeunload",Wirecloud.unload.bind(this),true);var loaded_modules=0;var checkPlatformReady=function checkPlatformReady(){loaded_modules+=1;if(loaded_modules===4){options.onSuccess();}};Wirecloud.io.makeRequest(Wirecloud.URLs.PLATFORM_CONTEXT_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var url;options.monitor.nextSubtask('Processing initial context data');Wirecloud.contextManager=new Wirecloud.ContextManager(Wirecloud,JSON.parse(response.responseText));Wirecloud.contextManager.modify({'mode':Wirecloud.constants.CURRENT_MODE});LayoutManagerFactory.getInstance().header._initUserMenu();url=Wirecloud.URLs.THEME_ENTRY.evaluate({name:Wirecloud.contextManager.get('theme')})+"?v="+Wirecloud.contextManager.get('version_hash');Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){Wirecloud.currentTheme=new Wirecloud.ui.Theme(JSON.parse(response.responseText));LayoutManagerFactory.getInstance()._init();checkPlatformReady();}});Wirecloud.LocalCatalogue.reload({onSuccess:checkPlatformReady,onFailure:function(response){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error retrieving available resources: %(errorMsg)s."),response);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();}});}});Wirecloud.io.makeRequest(Wirecloud.URLs.PLATFORM_PREFERENCES,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var values=JSON.parse(response.responseText);Wirecloud.preferences=Wirecloud.PreferenceManager.buildPreferences('platform',values);},onFailure:function(response){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error retrieving platform preferences data: %(errorMsg)s"),response);Wirecloud.preferences=Wirecloud.PreferenceManager.buildPreferences('platform',{});},onComplete:function(){Wirecloud.preferences.addEventListener('post-commit',preferencesChanged.bind(this));checkPlatformReady();}.bind(this)});Wirecloud.io.makeRequest(Wirecloud.URLs.WORKSPACE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var workspaces=JSON.parse(response.responseText);for(var i=0;i<workspaces.length;i++){var workspace=workspaces[i];this.workspaceInstances[workspace.id]=workspace;if(!(workspace.creator in this.workspacesByUserAndName)){this.workspacesByUserAndName[workspace.creator]={};}
this.workspacesByUserAndName[workspace.creator][workspace.name]=workspace;}
checkPlatformReady();}.bind(this),onFailure:function(response){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error retrieving workspace list"),response);}});};Wirecloud.unload=function unload(){var layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext('Unloading Wirecloud Platform'));if(this.activeWorkspace!=null){this.activeWorkspace.unload();this.activeWorkspace=null;}};Wirecloud.logout=function logout(){window.location=Wirecloud.URLs.LOGOUT_VIEW;};Wirecloud.changeActiveWorkspace=function changeActiveWorkspace(workspace,initial_tab,options){var workspace_full_name,msg,state,steps=this.activeWorkspace!=null?2:1;options=Wirecloud.Utils.merge({replaceNavigationState:false},options);LayoutManagerFactory.getInstance()._startComplexTask(gettext("Changing current workspace"),steps);if(this.activeWorkspace!=null){this.activeWorkspace.unload();}
state={workspace_creator:workspace.creator,workspace_name:workspace.name,view:"workspace"};if(initial_tab){state.tab=initial_tab;}
workspace_full_name=workspace.creator+'/'+workspace.name;document.title=workspace_full_name;if(options.replaceNavigationState===true){Wirecloud.HistoryManager.replaceState(state);}else if(options.replaceNavigationState!=='leave'){Wirecloud.HistoryManager.pushState(state);}
msg=interpolate(gettext("Downloading workspace (%(name)s) data"),{name:workspace_full_name},true);LayoutManagerFactory.getInstance().logSubTask(msg,1);new Wirecloud.WorkspaceCatalogue(workspace.id,{onSuccess:function(workspace_resources){var workspaceUrl=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({'workspace_id':workspace.id});Wirecloud.io.makeRequest(workspaceUrl,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var workspace_data=JSON.parse(response.responseText);if(workspace_data.empty_params.length>0){var preferences,preferenceValues,param,i,dialog;preferenceValues={};for(i=0;i<workspace_data.empty_params.length;i+=1){param=workspace_data.empty_params[i];if(workspace_data.preferences[param]!=null){preferenceValues[param]=workspace_data.preferences[param];}}
LayoutManagerFactory.getInstance().header.refresh();preferences=Wirecloud.PreferenceManager.buildPreferences('workspace',preferenceValues,{workspaceState:workspace_data},workspace_data.empty_params);preferences.addEventListener('post-commit',function(){setTimeout(function(){Wirecloud.changeActiveWorkspace(workspace,initial_tab,options);},0);}.bind(this));LayoutManagerFactory.getInstance()._notifyPlatformReady();dialog=new Wirecloud.ui.PreferencesWindowMenu('workspace',preferences);dialog.setCancelable(false);dialog.show();return;}
this.activeWorkspace=new Workspace(workspace_data,workspace_resources);this.activeWorkspace.addEventListener('removed',onWorkspaceRemoved.bind(this));this.activeWorkspace.contextManager.addCallback(function(updated_attributes){var workspace,old_name;if('name'in updated_attributes){workspace=this.workspaceInstances[this.activeWorkspace.id];old_name=workspace.name;delete this.workspacesByUserAndName[workspace.creator][old_name];workspace.name=updated_attributes.name;this.workspacesByUserAndName[workspace.creator][workspace.name]=workspace;}}.bind(this));LayoutManagerFactory.getInstance()._notifyPlatformReady();LayoutManagerFactory.getInstance().header.refresh();this.events.activeworkspacechanged.dispatch(this.activeWorkspace);if(typeof options.onSuccess==="function"){try{options.onSuccess();}catch(e){}}}.bind(this)});}.bind(this)});};Wirecloud.createWorkspace=function createWorkspace(options){var body;options=Wirecloud.Utils.merge({allow_renaming:true,dry_run:false},options);body={allow_renaming:!!options.allow_renaming,dry_run:!!options.dry_run};if(options.name!=null){body.name=options.name;}
if(options.mashup!=null){body.mashup=options.mashup;}
Wirecloud.io.makeRequest(Wirecloud.URLs.WORKSPACE_COLLECTION,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(body),onSuccess:onCreateWorkspaceSuccess.bind(this,options),onFailure:onCreateWorkspaceFailure.bind(this,options)});};Wirecloud.mergeWorkspace=function mergeWorkspace(resource,options){if(options==null){options={};}
if(options.monitor){options.monitor.logSubTask(gettext("Merging mashup"));}
var active_ws_id=Wirecloud.activeWorkspace.id;var mergeURL=Wirecloud.URLs.WORKSPACE_MERGE.evaluate({to_ws_id:active_ws_id});Wirecloud.io.makeRequest(mergeURL,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({'mashup':resource.uri}),onSuccess:onMergeSuccess.bind(this,options),onFailure:onMergeFailure.bind(this,options)});};})();(function(){"use strict";var UserInterfaceManager={currentWindowMenu:null,currentPopups:[]};var coverLayerElement=null;var fadeInCover=function fadeInCover(){coverLayerElement.classList.add('in');};var showCover=function showCover(){coverLayerElement.style.display="block";setTimeout(fadeInCover,0);};var hideCover=function hideCover(){coverLayerElement.classList.remove('in');coverLayerElement.style.display="none";};UserInterfaceManager.init=function init(){if(coverLayerElement!=null){return;}
coverLayerElement=document.createElement('div');coverLayerElement.id='menu_layer';coverLayerElement.className='disabled_background fade';coverLayerElement.style.display='none';document.body.insertBefore(coverLayerElement,document.body.firstChild);document.addEventListener('keydown',function(event){if(event.keyCode===27){Wirecloud.UserInterfaceManager.handleEscapeEvent();}},true);};UserInterfaceManager.handleEscapeEvent=function handleEscapeEvent(){if(this.currentPopups.length>0){this.currentPopups[this.currentPopups.length-1].hide();}};UserInterfaceManager._unregisterRootWindowMenu=function _unregisterRootWindowMenu(window_menu){this._unregisterPopup(window_menu);this.currentWindowMenu=null;hideCover();};UserInterfaceManager._registerRootWindowMenu=function _registerRootWindowMenu(window_menu){if(!(window_menu instanceof Wirecloud.ui.WindowMenu)){throw TypeError('window_menu must be a WindowMenu instance');}
if(this.currentWindowMenu!=null){this.currentWindowMenu.hide();hideCover();}
this.currentWindowMenu=window_menu;this._registerPopup(window_menu);showCover();};UserInterfaceManager._unregisterPopup=function _unregisterPopup(popup){var index=this.currentPopups.indexOf(popup);if(index!==-1){this.currentPopups.splice(index,1);}};UserInterfaceManager._registerPopup=function _registerPopup(popup){if(popup!=null&&!('hide'in popup)){throw new TypeError('invalid popup parameter');}
this._unregisterPopup(popup);this.currentPopups.push(popup);};Wirecloud.UserInterfaceManager=UserInterfaceManager;})();Wirecloud.location={'domain':document.location.protocol+'//'+document.location.host,'protocol':document.location.protocol.substr(0,document.location.protocol.length-1),'host':document.location.host};(function(){"use strict";var HANDLER_RE=new RegExp(/^on(?:Create|Complete|Exception|Failure|Interactive|Loaded|Loading|Success|Uninitialized|\d{3})$/);var setRequestHeaders=function setRequestHeaders(){var headers,name;headers=Wirecloud.Utils.merge({'X-Requested-With':'XMLHttpRequest','Accept':'text/javascript, text/html, application/xml, text/xml, */*'},this.options.requestHeaders);if(!('Content-Type'in headers)&&this.options.contentType!=null){headers['Content-Type']=this.options.contentType;if(this.options.encoding!=null){headers['Content-Type']+='; charset='+this.options.encoding;}}
for(name in headers){if(headers[name]!=null){this.transport.setRequestHeader(name,headers[name]);}}};var onReadyStateChange=function onReadyStateChange(){if(this.transport.readyState==4){var response=new Response(this);try{if(('on'+response.status)in this.options){this.options['on'+response.status](response);}else if(this.options.onSuccess&&(response.status>=200&&response.status<300)){this.options.onSuccess(response);}else if(this.options.onFailure&&(response.status<200||response.status>=300)){this.options.onFailure(response);}}catch(e){if(this.options.onException){try{this.options.onException(response,e);}catch(e2){}}}
if(this.options.onComplete){try{this.options.onComplete(response);}catch(e){if(this.options.onException){try{this.options.onException(response,e);}catch(e2){}}}}}};var Response=function Response(request){Object.defineProperties(this,{'request':{value:request},'transport':{value:request.transport},'status':{value:request.transport.status},'statusText':{value:request.transport.statusText},'response':{value:request.transport.response}});if(request.options.responseType==null||request.options.responseType===''){Object.defineProperties(this,{'responseText':{value:request.transport.responseText},'responseXML':{value:request.transport.responseXML}});}};Response.prototype.getHeader=function getHeader(name){try{return this.transport.getResponseHeader(name);}catch(e){return null;}};Response.prototype.getAllResponseHeaders=function getAllResponseHeaders(){return this.transport.getAllResponseHeaders();};var toQueryString=function toQueryString(parameters){var key,query='';if(typeof parameters==='string'){return parameters;}
for(key in parameters){query+='&'+encodeURIComponent(key)+'='+encodeURIComponent(parameters[key]);}
return query.substr(1);};var Request=function Request(url,options){var key;this.url=url;this.options=Wirecloud.Utils.merge({method:'POST',asynchronous:true,responseType:null,contentType:null,encoding:null,postBody:null},options);for(key in this.options){if(HANDLER_RE.test(key)&&this.options[key]!=null&&typeof this.options[key]!=='function'){throw new TypeError(interpolate('Invalid %(callback)s callback',{callback:key},true));}}
this.method=this.options.method.toUpperCase();if(this.options.parameters!=null&&(typeof this.options.parameters==='string'||typeof this.options.parameters==='object')){if(['PUT','POST'].indexOf(this.method)!==-1&&this.options.postBody==null){this.options.postBody=toQueryString(this.options.parameters);if(this.options.contentType==null){this.options.contentType='application/x-www-form-urlencoded';}
if(this.options.encoding==null){this.options.encoding='UTF-8';}}else{if(this.url.indexOf('?')!==-1){this.url+='&'+toQueryString(this.options.parameters);}else{this.url+='?'+toQueryString(this.options.parameters);}}}
this.transport=new XMLHttpRequest();if(this.options.withCredentials===true&&this.options.supportsAccessControl){this.transport.withCredentials=true;}
this.transport.open(this.options.method,this.url,this.options.asynchronous);if(this.options.responseType){this.transport.responseType=this.options.responseType;}
this.transport.addEventListener('readystatechange',onReadyStateChange.bind(this),true);if(typeof this.options.onUploadProgress==='function'){this.transport.upload.addEventListener('progress',options.onUploadProgress,false);}
setRequestHeaders.call(this);this.transport.send(this.options.postBody);};var io={};io.buildProxyURL=function buildProxyURL(url,options){var final_url,protocolEnd,link,forceProxy,hostStart,pathStart,protocol,host,rest;if(options==null){options={};}
forceProxy=!!options.forceProxy;if(url.length>4&&url.indexOf('www.')===0){url='http://'+url;}
protocol=Wirecloud.location.protocol;host=Wirecloud.location.host;protocolEnd=url.indexOf('://');if(protocolEnd!==-1){hostStart=protocolEnd+3;pathStart=url.indexOf('/',hostStart);if(pathStart===-1){pathStart=url.length;}
protocol=url.substr(0,protocolEnd);host=url.substr(hostStart,pathStart-hostStart);rest=url.substring(pathStart);final_url=url;}else{if(url.charAt(0)==='/'){rest=url;}else{rest='/'+url;}
if(!forceProxy){final_url=Wirecloud.location.domain+rest;}}
if(forceProxy||(options.supportsAccessControl!==true&&(protocol!==Wirecloud.location.protocol||host!==Wirecloud.location.host))){final_url=Wirecloud.location.domain+
Wirecloud.URLs.PROXY.evaluate({protocol:protocol,domain:host,path:rest});}
return final_url;};io.makeRequest=function makeRequest(url,options){var key;if(options!=null&&options.context!=null){for(key in options){if(HANDLER_RE.test(key)&&typeof options[key]==='function'){options[key]=options[key].bind(options.context);}}}
return new Request(Wirecloud.io.buildProxyURL(url,options),options);};Wirecloud.io=io;})();(function(){"use strict";var ContextManager=function ContextManager(contextInstance,context_description){Object.defineProperty(this,'instance',{value:contextInstance});var context={};var handlers=[];for(var key in context_description){if(context_description==null||typeof context_description[key]!=='object'){delete context_description[key];}
context_description[key].name=key;if('value'in context_description[key]){context[key]=context_description[key].value;delete context_description[key].value;}else{context[key]=null;}
Object.freeze(context_description[key]);}
Object.freeze(context_description);Object.defineProperty(this,'getAvailableContext',{value:function getAvailableContext(){return context_description;}});Object.defineProperty(this,'addCallback',{value:function addCallback(handler){if(typeof handler!=='function'){throw new TypeError();}
handlers.push(handler);}});Object.defineProperty(this,'removeCallback',{value:function removeCallback(handler){var index;if(typeof handler!=='function'){throw new TypeError();}
index=handlers.indexOf(handler);if(index!==-1){handlers.splice(index,1);}}});Object.defineProperty(this,'get',{value:function get(key){return context[key];}});Object.defineProperty(this,'modify',{value:function get(values){var key,i,updated_values={};if(typeof values!=='object'){throw new TypeError();}
for(key in values){if(!context.hasOwnProperty(key)){throw new TypeError(key);}}
for(key in values){if(context[key]!==values[key]){context[key]=values[key];updated_values[key]=values[key];}}
if(!Wirecloud.Utils.isEmptyObject(updated_values)){for(i=0;i<handlers.length;i+=1){try{handlers[i](updated_values);}catch(e){}}}}});};Wirecloud.ContextManager=ContextManager;})();(function(){"use strict";var PreferenceError=function PreferenceError(message){this.name="PreferenceError";this.message=message||"";};PreferenceError.prototype=new Error();PreferenceError.prototype.constructor=PreferenceError;Object.freeze(PreferenceError.prototype);Object.freeze(PreferenceError);Wirecloud.PreferenceError=PreferenceError;})();(function(){"use strict";var UserPrefDef=function UserPrefDef(name,type,options){if(options.default!=null&&typeof options.default!=="string"){throw new TypeError('Invalid default option');}
if(type==='list'){type='select';}
if('value'in options){delete options.value;}
Object.defineProperty(this,'name',{value:name});Object.defineProperty(this,'type',{value:type});Object.defineProperty(this,'label',{value:options.label});Object.defineProperty(this,'description',{value:options.description});Object.defineProperty(this,'options',{value:options});var default_value='';if(options.type==='boolean'){default_value=options.default.trim().toLowerCase()==='true';}else if(options.type==='number'&&options.default!=null){default_value=Number(options.default);}else if(options.default!=null){default_value=options.default;}
Object.defineProperty(this,'default',{value:default_value});};Wirecloud.UserPrefDef=UserPrefDef;})();(function(){"use strict";var UserPref=function UserPref(pref_def,readOnly,hidden,currentValue){Object.defineProperty(this,'meta',{value:pref_def});Object.defineProperty(this,'readOnly',{value:!!readOnly});Object.defineProperty(this,'hidden',{value:!!hidden});if(pref_def.type==='boolean'&&typeof currentValue==='string'){this.value=currentValue.trim().toLowerCase()==='true';}else if(pref_def.type==='number'&&typeof currentValue==='string'){this.value=Number(currentValue);}else{this.value=currentValue;}};UserPref.prototype.getInterfaceDescription=function getInterfaceDescription(){var desc,type;type=this.meta.type;if(type==='list'){type='select';}
desc=Wirecloud.Utils.merge(this.meta.options,{'type':type,'defaultValue':this.meta.default,'initiallyDisabled':this.readOnly,'initialValue':this.value,'required':false});if(type==='select'){desc.initialEntries=this.meta.options.options;desc.required=true;}
return desc;};Wirecloud.UserPref=UserPref;})();(function(){"use strict";var PersistentVariable=function PersistentVariable(def,commiter,readonly,currentValue){Object.defineProperty(this,'meta',{value:def});Object.defineProperty(this,'readnOnly',{value:readonly});Object.defineProperty(this,'commiter',{value:commiter});this.value=currentValue;};PersistentVariable.prototype.get=function get(){return this.value;};PersistentVariable.prototype.set=function set(new_value){if(this.readOnly){throw new Error('Read only properties cannot be modified');}
this.value=new_value;this.commiter.add(this.meta.name,this.value);};Wirecloud.PersistentVariable=PersistentVariable;})();(function(){"use strict";var PersistentVariableDef=function PersistentVariableDef(name,type,options){if(options.default!=null&&typeof options.default!=="string"){throw new TypeError('Invalid default option');}
if('value'in options){delete options.value;}
Object.defineProperty(this,'name',{value:name});Object.defineProperty(this,'type',{value:type});Object.defineProperty(this,'label',{value:options.label});Object.defineProperty(this,'description',{value:options.description});Object.defineProperty(this,'options',{value:options});Object.defineProperty(this,'default',{value:options.default});};Wirecloud.PersistentVariableDef=PersistentVariableDef;})();(function(){var PolicyManager={},policy={};Object.defineProperty(PolicyManager,'evaluate',{value:function evaluate(context,action){var context;if(context in policy){context=policy[context];}else{return true;}
if(action in context){return context[action];}else{return true;}}});Object.preventExtensions(PolicyManager);Object.defineProperty(Wirecloud,'PolicyManager',{value:PolicyManager});})();(function(){"use strict";var currentState={};var onpopstate=function onpopstate(event){if(event.state===null){return;}
currentState=event.state;LayoutManagerFactory.getInstance().onHashChange(event.state);};var prepareData=function prepareData(data){var key,default_data={view:"workspace"};data=Wirecloud.Utils.merge(default_data,data);for(key in data){data[key]=""+data[key];}
return data;};var buildURL=function buildURL(data){var key,hash='';for(key in data){if(key==='workspace_name'||key==='workspace_creator'){continue;}
hash+='&'+encodeURI(key)+'='+encodeURI(data[key]);}
return window.location.protocol+"//"+
window.location.host+"/"+encodeURIComponent(data.workspace_creator)+'/'+encodeURIComponent(data.workspace_name)+
window.location.search+'#'+hash.substr(1);};var HistoryManager={};HistoryManager.init=function init(){var initialState=this._parseStateFromHash(window.location.hash);this._parseWorkspaceFromPathName(window.location.pathname,initialState);window.addEventListener("popstate",onpopstate.bind(this),true);initialState=prepareData(initialState);var url=buildURL(initialState);history.replaceState(initialState,document.title,url);currentState=initialState;};HistoryManager._parseStateFromHash=function _parseStateFromHash(hash){var definitions,i,pair,key,value,data={};if(hash.charAt(0)==='#'){hash=hash.substr(1);}
if(hash.length===0){return data;}
definitions=hash.split('&');for(i=0;i<definitions.length;i+=1){pair=definitions[i].split('=');key=decodeURIComponent(pair[0]);value=decodeURIComponent(pair[1]);data[key]=value;}
return data;};HistoryManager._parseWorkspaceFromPathName=function _parseWorkspaceFromPathName(pathname,status){var index,index2;index=pathname.lastIndexOf('/');index2=pathname.lastIndexOf('/',index-1);status.workspace_creator=decodeURIComponent(pathname.substring(index2+1,index));status.workspace_name=decodeURIComponent(pathname.substring(index+1));};HistoryManager.pushState=function pushState(data){var url,key,equal;data=prepareData(data);equal=true;for(key in data){if(data[key]!==currentState[key]){equal=false;break;}}
if(equal){return;}
url=buildURL(data);history.pushState(data,document.title,url);currentState=data;};HistoryManager.replaceState=function replaceState(data){var url,key,equal;data=prepareData(data);equal=true;for(key in data){if(data[key]!==currentState[key]){equal=false;break;}}
if(equal){return;}
url=buildURL(data);history.replaceState(data,document.title,url);currentState=data;};HistoryManager.getCurrentState=function getCurrentState(){return Wirecloud.Utils.clone(currentState);};Wirecloud.HistoryManager=HistoryManager;})();(function(){"use strict";var VERSION_RE=/^((?:[1-9]\d*\.|0\.)*(?:[1-9]\d*|0))((?:a|b|rc)[1-9]\d*)?$/;var Version=function Version(version,source){var groups;if(typeof version=='string'){groups=version.match(VERSION_RE);this.array=groups[1].split('.').map(function(x){return parseInt(x,10);});this.pre_version=groups[2]!=null?groups[2]:null;this.text=version;}else if(version instanceof Array){this.array=version;this.pre_version=null;this.text=version.join('.');}else{throw new TypeError();}
this.source=source;Object.freeze(this);};Version.prototype.compareTo=function compareTo(version){var len,value1,value2,pre_version1,pre_version2,i;len=Math.max(this.array.length,version.array.length);for(i=0;i<len;i+=1){value1=this.array[i]!=null?this.array[i]:0;value2=version.array[i]!=null?version.array[i]:0;if(value1!==value2){return value1-value2;}}
pre_version1=this.pre_version;if(pre_version1==null){pre_version1="z";}
pre_version2=version.pre_version;if(pre_version2==null){pre_version2="z";}
if(pre_version1<pre_version2){return-1;}else if(pre_version1>pre_version2){return 1;}else{return 0;}};Version.prototype.toString=function toString(){return this.text;};Wirecloud.Version=Version;})();(function(){"use strict";var MashableApplicationComponent=function MashableApplicationComponent(desc){var vendor,name,version,uri,title,description,changelog;if(!('vendor'in desc)||desc.vendor.trim()===''){throw new TypeError(gettext('missing vendor'));}
vendor=desc.vendor.trim();Object.defineProperty(this,'vendor',{value:vendor});if(!('name'in desc)||desc.name.trim()===''){throw new TypeError(gettext('missing name'));}
name=desc.name.trim();Object.defineProperty(this,'name',{value:name});if(!('version'in desc)||desc.version.trim()===''){throw new TypeError(gettext('missing version'));}
version=new Wirecloud.Version(desc.version.trim());Object.defineProperty(this,'version',{value:version});uri=desc.name.trim();Object.defineProperty(this,'uri',{value:vendor+'/'+name+'/'+version.text});if(typeof desc.type!=='string'){throw new TypeError(gettext('missing type'));}
Object.defineProperty(this,'type',{value:desc.type});if(!('changelog'in desc)||desc.changelog.trim()===''){changelog='';}else{changelog=desc.changelog;}
Object.defineProperty(this,'changelog',{value:changelog});if(!('title'in desc)||desc.title.trim()===''){title=name;}else{title=desc.title;}
Object.defineProperty(this,'title',{value:title});description=desc.description;if(description==null||description.trim()===''){description='';}
Object.defineProperty(this,'description',{value:description});};Wirecloud.MashableApplicationComponent=MashableApplicationComponent;})();(function(){"use strict";var Widget=function Widget(data){var i,preference,property;Wirecloud.MashableApplicationComponent.call(this,data);this.id=this.uri;this.code_url=Wirecloud.URLs.WIDGET_CODE_ENTRY.evaluate({vendor:this.vendor,name:this.name,version:this.version.text})+"?v="+Wirecloud.contextManager.get('version_hash');this.code_content_type=data.code_content_type;this.doc=data.doc;this.preferences={};this.preferenceList=[];for(i=0;i<data.preferences.length;i++){preference=new Wirecloud.UserPrefDef(data.preferences[i].name,data.preferences[i].type,data.preferences[i]);this.preferences[preference.name]=preference;this.preferenceList.push(preference);}
Object.freeze(this.preferences);Object.freeze(this.preferenceList);this.properties={}
this.propertyList=[];for(i=0;i<data.properties.length;i++){property=new Wirecloud.PersistentVariableDef(data.properties[i].name,data.properties[i].type,data.properties[i]);this.properties[property.name]=property;this.propertyList.push(property);}
Object.freeze(this.properties);Object.freeze(this.propertyList);this.inputList=data.wiring.inputs;this.inputs={};for(i=0;i<this.inputList.length;i++){this.inputs[this.inputList[i].name]=this.inputList[i];}
this.outputList=data.wiring.outputs;this.outputs={};for(i=0;i<this.outputList.length;i++){this.outputs[this.outputList[i].name]=this.outputList[i];}
this.image=data.image;this.default_width=data.widget_width;this.default_height=data.widget_height;this.getIcon=function getIcon(){return data.smartphoneimage!==''?data.smartphoneimage:data.image;};this.getIPhoneImageURI=this.getIcon;var lastVersion=this.version;var showcaseLastVersion=this.version;var catalogueLastVersion=null;var upToDate=true;this.getLastVersion=function getLastVersion(){if(lastVersion==null){if(catalogueLastVersion==null||showcaseLastVersion.compareTo(catalogueLastVersion)>=0){lastVersion=showcaseLastVersion;}else{lastVersion=catalogueLastVersion;}}
return lastVersion;};this.setLastVersion=function setLastVersion(v){var oldVersion=this.getLastVersion();if(v.source==='showcase'){showcaseLastVersion=v;}else{catalogueLastVersion=v;}
lastVersion=null;var newVersion=this.getLastVersion();upToDate=this.version.compareTo(newVersion)===0;return oldVersion.compareTo(newVersion)!==0;};this.isUpToDate=function isUpToDate(){return upToDate;};Object.freeze(this);};Widget.prototype.getInfoString=function getInfoString(){var transObj={vendor:this.vendor,name:this.name,version:this.version};var msg=gettext("[WidgetVendor: %(vendor)s, WidgetName: %(name)s, WidgetVersion: %(version)s]");return interpolate(msg,transObj,true);};Wirecloud.Widget=Widget;})();(function(){"use strict";var PreferenceDef=function PreferenceDef(name,inheritable,inheritByDefault,hidden,options){Object.defineProperties(this,{name:{value:name},label:{value:options.label},description:{value:options.description},inheritable:{value:!!inheritable},inheritByDefault:{value:!!(inheritable&&inheritByDefault)},default:{value:options.defaultValue},hidden:{value:!!hidden},options:{value:options}});Object.freeze(this);};Wirecloud.PreferenceDef=PreferenceDef;})();(function(){"use strict";var PlatformPref=function PlatformPref(manager,preferenceDef,inherit,value){Object.defineProperty(this,'meta',{value:preferenceDef});Object.defineProperty(this,'manager',{value:manager});this.inherit=inherit;if(value!=null){this.value=Wirecloud.ui.InputInterfaceFactory.parse(preferenceDef.options.type,value);}else{this.value=preferenceDef.default;}
this.handlers=[];};PlatformPref.prototype.getEffectiveValue=function getEffectiveValue(){if(this.inherit){return this.manager.getParentValue(this.meta.name);}
return this.value;};PlatformPref.prototype.addHandler=function addHandler(handler){this.handlers.push(handler);};PlatformPref.prototype._propagate=function _propagate(){for(var i=0;i<this.handlers.length;i++){try{this.handlers[i](this.scope,this.name,this.value);}catch(e){}}};PlatformPref.prototype.setDefaultValue=function setDefaultValue(){this.setValue(this.definition.inputInterface.getDefaultValue());};Wirecloud.PlatformPref=PlatformPref;})();(function(){"use strict";var PreferencesDef=function PreferencesDef(definitions){if(arguments.length==0){return;}
Object.defineProperty(this,'preferences',{value:definitions});};Wirecloud.PreferencesDef=PreferencesDef;})();(function(){"use strict";var PlatformPreferencesDef=function PlatformPreferencesDef(definitions){Wirecloud.PreferencesDef.call(this,definitions);};PlatformPreferencesDef.prototype=new Wirecloud.PreferencesDef();PlatformPreferencesDef.prototype.buildPreferences=function buildPreferences(values){return new Wirecloud.PlatformPreferences(this,values);};Wirecloud.PlatformPreferencesDef=PlatformPreferencesDef;})();(function(){"use strict";var WorkspacePreferencesDef=function WorkspacePreferencesDef(definitions,args){var extra_prefs,empty_params,i,param,workspace=args[1];extra_prefs=Wirecloud.PreferenceManager.processDefinitions(workspace.workspaceState.extra_prefs);if(Array.isArray(args[2])&&args[2].length>0){empty_params=args[2];definitions={};for(i=0;i<empty_params.length;i+=1){param=empty_params[i];definitions[param]=extra_prefs[param];}}else if(workspace.workspaceState!=null){definitions=Wirecloud.Utils.merge(definitions,extra_prefs);}
Wirecloud.PreferencesDef.call(this,definitions);};WorkspacePreferencesDef.prototype=new Wirecloud.PreferencesDef();WorkspacePreferencesDef.prototype.buildPreferences=function buildPreferences(values,workspace){return new Wirecloud.WorkspacePreferences(this,workspace,values);};Wirecloud.WorkspacePreferencesDef=WorkspacePreferencesDef;})();(function(){"use strict";var TabPreferencesDef=function TabPreferencesDef(definitions){Wirecloud.PreferencesDef.call(this,definitions);};TabPreferencesDef.prototype=new Wirecloud.PreferencesDef();TabPreferencesDef.prototype.buildPreferences=function buildPreferences(values,tab){return new Wirecloud.TabPreferences(this,tab,values);};Wirecloud.TabPreferencesDef=TabPreferencesDef;})();(function(){"use strict";var ObjectWithEvents=function ObjectWithEvents(events){events=events?events:[];this.events={};for(var i=0;i<events.length;i++){this.events[events[i]]=new StyledElements.Event();}};ObjectWithEvents.prototype.addEventListener=function addEventListener(event,handler){if(this.events[event]==null){throw new Error(StyledElements.Utils.interpolate("Unhandled event \"%(event)s\"",{event:event}));}
this.events[event].addEventListener(handler);};ObjectWithEvents.prototype.clearEventListeners=function clearEventListeners(event){if(event==null){for(event in this.events){this.events[event].clearEventListeners();}}else{if(this.events[event]==null){throw new TypeError(StyledElements.Utils.interpolate("Unhandled event \"%(event)s\"",{event:event}));}
this.events[event].clearEventListeners();}};ObjectWithEvents.prototype.removeEventListener=function removeEventListener(event,handler){if(this.events[event]==null){throw new Error(StyledElements.Utils.interpolate("Unhandled event \"%(event)s\"",{event:event}));}
this.events[event].removeEventListener(handler);};ObjectWithEvents.prototype.destroy=function destroy(){this.events=null;};StyledElements.ObjectWithEvents=ObjectWithEvents;})();(function(){"use strict";var StyledElement=function StyledElement(events){StyledElements.ObjectWithEvents.call(this,events);this.wrapperElement=null;this.enabled=true;};StyledElement.prototype=new StyledElements.ObjectWithEvents();StyledElement.prototype.insertInto=function insertInto(element,refElement){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
if(refElement instanceof StyledElements.StyledElement){refElement=refElement.wrapperElement;}
if(refElement){element.insertBefore(this.wrapperElement,refElement);}else{element.appendChild(this.wrapperElement);}
return this;};StyledElement.prototype._getUsableHeight=function _getUsableHeight(){var parentElement=this.wrapperElement.parentNode;if(!StyledElements.Utils.XML.isElement(parentElement)){return null;}
var parentStyle=document.defaultView.getComputedStyle(parentElement,null);if(parentStyle.getPropertyCSSValue('display')==null){return null;}
var containerStyle=document.defaultView.getComputedStyle(this.wrapperElement,null);var height=parentElement.offsetHeight-
parentStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
parentStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);return height;};StyledElement.prototype._getUsableWidth=function _getUsableWidth(){var parentElement=this.wrapperElement.parentNode;if(!StyledElements.Utils.XML.isElement(parentElement)){return null;}
var parentStyle=document.defaultView.getComputedStyle(parentElement,null);var containerStyle=document.defaultView.getComputedStyle(this.wrapperElement,null);var width=parentElement.offsetWidth-
parentStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX)-
parentStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);return width;};StyledElement.prototype.repaint=function repaint(temporal){};StyledElement.prototype.hasClassName=function hasClassName(className){return this.wrapperElement.classList.contains(className);};StyledElement.prototype.addClassName=function addClassName(className){var i,tokens;className=className.trim();if(className===''){return;}
tokens=className.split(/\s+/);for(i=0;i<tokens.length;i++){this.wrapperElement.classList.add(tokens[i]);}
return this;};StyledElement.prototype.removeClassName=function removeClassName(className){var i,tokens;className=className.trim();if(className===''){return;}
tokens=className.split(/\s+/);for(i=0;i<tokens.length;i++){this.wrapperElement.classList.remove(tokens[i]);}
return this;};StyledElement.prototype.setDisabled=function setDisabled(disable){if(disable){return this.disable();}else{return this.enable();}};StyledElement.prototype.enable=function enable(){this.enabled=true;this.removeClassName('disabled');return this;};StyledElement.prototype.disable=function disable(){this.enabled=false;this.addClassName('disabled');return this;};StyledElement.prototype.getBoundingClientRect=function(){return this.wrapperElement.getBoundingClientRect();};StyledElements.StyledElement=StyledElement;})();(function(){"use strict";var StyledInputElement=function StyledInputElement(defaultValue,events){this.inputElement=null;this.defaultValue=defaultValue;StyledElements.StyledElement.call(this,events);};StyledInputElement.prototype=new StyledElements.StyledElement();StyledInputElement.prototype.getValue=function getValue(){return this.inputElement.value;};StyledInputElement.prototype.setValue=function setValue(newValue){this.inputElement.value=newValue;return this;};StyledInputElement.prototype.reset=function reset(){return this.setValue(this.defaultValue);};StyledInputElement.prototype.enable=function enable(){StyledElements.StyledElement.prototype.enable.call(this);this.inputElement.disabled=false;return this;};StyledInputElement.prototype.disable=function disable(){StyledElements.StyledElement.prototype.disable.call(this);this.inputElement.disabled=true;return this;};StyledInputElement.prototype.focus=function focus(){this.inputElement.focus();return this;};StyledElements.StyledInputElement=StyledInputElement;})();(function(){"use strict";var CommandQueue=function CommandQueue(context,initFunc,stepFunc){var running=false;var elements=[];var step=0;var stepTimes=null;function doStep(){if(stepFunc(step,context)){var timeDiff=stepTimes[step]-(new Date()).getTime();if(timeDiff<0){timeDiff=0;}
step++;setTimeout(doStep,timeDiff);}else{doInit();}}
function doInit(){var command;do{command=elements.shift();}while(command!==undefined&&!(stepTimes=initFunc(context,command)));if(command!==undefined){step=0;var timeDiff=stepTimes[step]-(new Date()).getTime();if(timeDiff<0){timeDiff=0;}
setTimeout(doStep,timeDiff);}else{running=false;}}
this.addCommand=function addCommand(command){if(command===undefined){return;}
elements.push(command);if(!running){running=true;doInit();}};};StyledElements.CommandQueue=CommandQueue;})();(function(){"use strict";var Container=function Container(options,events){var defaultOptions={'extending':false,'class':'','useFullHeight':false};options=StyledElements.Utils.merge(defaultOptions,options);if(options.extending){return;}
StyledElements.StyledElement.call(this,events);this.useFullHeight=options.useFullHeight;this.wrapperElement=document.createElement("div");this.children=[];if(options.id){this.wrapperElement.setAttribute("id",options.id);}
this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"container");};Container.prototype=new StyledElements.StyledElement();Container.prototype.appendChild=function appendChild(element,refElement){if(element instanceof StyledElements.StyledElement){element.insertInto(this.wrapperElement,refElement);this.children.push(element);}else{if(refElement instanceof StyledElements.StyledElement){refElement=refElement.wrapperElement;}
if(refElement!=null){this.wrapperElement.insertBefore(element,refElement);}else{this.wrapperElement.appendChild(element);}}};Container.prototype.removeChild=function appendChild(element){var index;if(element instanceof StyledElements.StyledElement){index=this.children.indexOf(element);this.children.splice(index,1);this.wrapperElement.removeChild(element.wrapperElement);}else{this.wrapperElement.removeChild(element);}};Container.prototype.repaint=function repaint(temporal){temporal=temporal!==undefined?temporal:false;if(this.useFullHeight){if(this.wrapperElement.classList.contains('hidden')){this.wrapperElement.style.height="";return;}
var height=this._getUsableHeight();if(height==null){return;}
this.wrapperElement.style.height=(height+"px");}
for(var i=0;i<this.children.length;i++){this.children[i].repaint(temporal);}
if(this.disabledLayer!=null){this.disabledLayer.style.height=this.wrapperElement.scrollHeight+'px';this.disabledLayer.style.lineHeight=this.wrapperElement.clientHeight+'px';}};Container.prototype.clear=function clear(){this.children=[];this.wrapperElement.innerHTML="";if(this.disabledLayer!=null){this.wrapperElement.appendChild(this.disabledLayer);}};Container.prototype.isDisabled=function isDisabled(){return this.disabledLayer!=null;};Container.prototype.setDisabled=function setDisabled(disabled){if(this.isDisabled()==disabled){return;}
if(disabled){this.disabledLayer=document.createElement('div');this.disabledLayer.className='disable-layer';this.disabled_icon=document.createElement('i');this.disabled_icon.className='disable-icon icon-spin icon-spinner';this.disabledLayer.appendChild(this.disabled_icon);this.wrapperElement.appendChild(this.disabledLayer);this.wrapperElement.classList.add('disabled');this.disabledLayer.style.height=this.wrapperElement.scrollHeight+'px';this.disabledLayer.style.lineHeight=this.wrapperElement.clientHeight+'px';}else{this.wrapperElement.classList.remove('disabled');this.disabledLayer.parentNode.removeChild(this.disabledLayer);this.disabledLayer=null;this.disable_icon=null;}
this.enabled=!disabled;};Container.prototype.enable=function enable(){this.setDisabled(false);};Container.prototype.disable=function disable(){this.setDisabled(true);};StyledElements.Container=Container;})();(function(){"use strict";var clickCallback=function clickCallback(e){e.preventDefault();e.stopPropagation();if(this._related_input){this._related_input.focus();}};var Addon=function Addon(options){var defaultOptions={'text':null,'title':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement("span");this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"add-on");if(options.title){this.setTitle(options.title);}
if(options.text){this.setLabel(options.text);}
this._clickCallback=clickCallback.bind(this);this.wrapperElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._clickCallback,true);};Addon.prototype=new StyledElements.Container();Addon.prototype.setDisabled=function setDisabled(disabled){if(disabled){this.addClassName('disabled');}else{this.removeClassName('disabled');}
this.enabled=!disabled;};Addon.prototype.setLabel=function setLabel(label){this.clear();this.wrapperElement.textContent=label;};Addon.prototype.setTitle=function setTitle(title){this.wrapperElement.setAttribute('title',title);};Addon.prototype.assignInput=function assignInput(input){this._related_input=input;};Addon.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._clickCallback,true);delete this.wrapperElement;delete this._clickCallback;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Addon=Addon;})();(function(){"use strict";var Accordion=function Accordion(options){var defaultOptions={'class':'','exclusive':true,'full':true};options=StyledElements.Utils.merge(defaultOptions,options);this.exclusive=options.exclusive;this.full=options.full;this.children=[];this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"styled_accordion");};Accordion.prototype=new StyledElements.StyledElement();Accordion.prototype.createContainer=function createContainer(options){var expander,defaultOptions={'listenOnTitle':true};options=StyledElements.Utils.merge(defaultOptions,options);expander=new StyledElements.Expander(options);expander.insertInto(this.wrapperElement);if(this.exclusive){expander.addEventListener('expandChange',function(expander,expanded){var old_expander;if(expanded){old_expander=this.currentContainer;this.currentContainer=expander;if(old_expander){old_expander.setExpanded(false);old_expander.wrapperElement.style.height='';}}else if(this.currentContainer===expander){expander.wrapperElement.style.height='';this.currentContainer=null;}
this.repaint();}.bind(this));}else if(this.full){expander.addEventListener('expandChange',function(expanded){this.repaint();}.bind(this));}
this.children.push(expander);if(this.currentContainer==null){expander.setExpanded(true);}
return expander;};Accordion.prototype.repaint=function repaint(temporal){var height,computedStyle,i;height=this._getUsableHeight();if(height==null||this.currentContainer==null){return;}
for(i=0;i<this.children.length;i+=1){if(this.children[i]===this.currentContainer){continue;}
computedStyle=document.defaultView.getComputedStyle(this.currentContainer.wrapperElement,null);height-=this.children[i].wrapperElement.offsetHeight;height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);}
computedStyle=document.defaultView.getComputedStyle(this.currentContainer.wrapperElement,null);height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX);this.currentContainer.wrapperElement.style.height=height+'px';this.currentContainer.repaint(temporal);};Accordion.prototype.destroy=function destroy(){var i;for(i=0;i<this.children.length;i+=1){this.children[i].destroy();}
this.children=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Accordion=Accordion;})();(function(){"use strict";var Expander=function Expander(options){var defaultOptions={'class':'','listenOnTitle':false,'expandButton':true,'buttonFloat':'left','title':null};options=StyledElements.Utils.merge(defaultOptions,options);if(!options.expandButton&&!options.listenOnTitle){throw new TypeError();}
StyledElements.StyledElement.call(this,['expandChange']);this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord("panel se-expander",options['class']);var header=document.createElement('div');header.className='panel-heading';this.wrapperElement.appendChild(header);this.toggleButton=null;if(options.expandButton){this.toggleButton=new StyledElements.ToggleButton({'class':'icon-expand','plain':true});this.toggleButton.insertInto(header);}
this.titleContainer=new StyledElements.Container({'class':'title'});this.titleContainer.insertInto(header);if(options.title){this.titleContainer.appendChild(document.createTextNode(options.title));}
this.contentContainer=new StyledElements.Container({'class':'panel-body'});this.contentContainer.insertInto(this.wrapperElement);var callback=function(){this.setExpanded(!this.isExpanded());}.bind(this);if(this.toggleButton){this.toggleButton.addEventListener('click',callback);}
if(options.listenOnTitle){this.titleContainer.wrapperElement.style.cursor="pointer";this.titleContainer.wrapperElement.addEventListener('click',callback,false);}};Expander.prototype=new StyledElements.StyledElement();Expander.prototype.repaint=function repaint(temporal){var height,computedStyle;if(this.isExpanded()){height=this.wrapperElement.clientHeight;if(height==null){return;}
computedStyle=document.defaultView.getComputedStyle(this.titleContainer.wrapperElement,null);height-=this.titleContainer.wrapperElement.offsetHeight;height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);computedStyle=document.defaultView.getComputedStyle(this.contentContainer.wrapperElement,null);height-=computedStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);if(height<0){height=0;}
this.contentContainer.wrapperElement.style.height=height+'px';this.contentContainer.repaint(temporal);}};Expander.prototype.isExpanded=function isExpanded(){return this.hasClassName('expanded');};Expander.prototype.setExpanded=function setExpanded(expanded){if(this.isExpanded()==expanded){return;}
if(expanded){this.addClassName('expanded');}else{this.removeClassName('expanded');this.contentContainer.wrapperElement.style.height='';}
if(this.toggleButton){this.toggleButton.setChecked(expanded);}
this.events.expandChange.dispatch(this,expanded);};Expander.prototype.getTitleContainer=function getTitleContainer(){return this.titleContainer;};Expander.prototype.appendChild=function appendChild(element){this.contentContainer.appendChild(element);};Expander.prototype.removeChild=function removeChild(element){this.contentContainer.removeChild(element);};Expander.prototype.clear=function clear(){this.contentContainer.clear();};StyledElements.Expander=Expander;})();(function(){"use strict";var Fragment=function Fragment(elements){var tmp_element;if(Array.isArray(elements)){this.elements=elements;}else if(typeof elements==='string'){tmp_element=document.createElement('div');tmp_element.innerHTML=elements;this.elements=Array.prototype.slice.call(tmp_element.childNodes);}else{this.elements=[];}};Fragment.prototype=new StyledElements.StyledElement();Fragment.prototype.insertInto=function insertInto(element,refElement){var i,currentElement;if(refElement instanceof StyledElements.StyledElement){refElement=refElement.wrapperElement;}
for(i=0;i<this.elements.length;i+=1){currentElement=this.elements[i];if(currentElement instanceof StyledElements.StyledElement){currentElement.insertInto(element,refElement);}else{element.insertBefore(currentElement,refElement);}}};Fragment.prototype.repaint=function repaint(){var i;for(i=0;i<this.elements.length;i++){if(typeof this.elements[i].repaint==='function'){this.elements[i].repaint();}}
return this;};Fragment.prototype.appendChild=function appendChild(element){this.elements.push(element);return this;};StyledElements.Fragment=Fragment;})();(function(){"use strict";var PaginatedSource,onSuccessCallback,onErrorCallback;onSuccessCallback=function onSuccessCallback(elements,options){if(typeof this.pOptions.processFunc==='function'){this.pOptions.processFunc(elements,options);}
this.currentPage=parseInt(options.current_page,10);this.currentElements=elements;if(this.pCachedTotalCount!==options.total_count){this.pCachedTotalCount=options.total_count;this._calculatePages();this.events.paginationChanged.dispatch(this);}
this.events.requestEnd.dispatch(this);};onErrorCallback=function onErrorCallback(error){this.currentElements=[];if(error==null){error={'message':'unknown cause'};}
this.events.requestEnd.dispatch(this,error);};PaginatedSource=function PaginatedSource(options){var defaultOptions={'pageSize':25,'requestFunc':null,'processFunc':null};StyledElements.ObjectWithEvents.call(this,['optionsChanged','paginationChanged','requestStart','requestEnd']);this.pOptions=StyledElements.Utils.merge(defaultOptions,options);this.currentPage=1;this.currentElements=[];this.totalPages=1;};PaginatedSource.prototype=new StyledElements.ObjectWithEvents();PaginatedSource.prototype.getCurrentPage=function getCurrentPage(){return this.currentElements;};PaginatedSource.prototype.changeOptions=function changeOptions(options){var new_page_size,old_offset,key,changed=false;if(typeof options!=='object'){return;}
for(key in options){if(key==='pageSize'){new_page_size=parseInt(options.pageSize,10);if(!isNaN(new_page_size)&&new_page_size!==this.pOptions.pageSize){changed=true;old_offset=(this.currentPage-1)*this.pOptions.pageSize;this.currentPage=Math.floor(old_offset/new_page_size)+1;this.pOptions.pageSize=new_page_size;this._calculatePages();}}else{changed=true;this.pOptions[key]=options[key];this.currentPage=1;}}
if(changed){this.events.optionsChanged.dispatch(this,this.pOptions);this.refresh();}};PaginatedSource.prototype.goToFirst=function goToFirst(){this.changePage(0);};PaginatedSource.prototype.goToPrevious=function goToPrevious(){this.changePage(this.currentPage-1);};PaginatedSource.prototype.goToNext=function goToNext(){this.changePage(this.currentPage+1);};PaginatedSource.prototype.goToLast=function goToLast(){this.changePage(this.totalPages);};PaginatedSource.prototype._calculatePages=function _calculatePages(){this.totalPages=Math.ceil(this.pCachedTotalCount/this.pOptions.pageSize);if(this.totalPages<=0){this.totalPages=1;}};PaginatedSource.prototype.refresh=function refresh(){this.events.requestStart.dispatch(this);this.pOptions.requestFunc(this.currentPage,this.pOptions,onSuccessCallback.bind(this),onErrorCallback.bind(this));};PaginatedSource.prototype.changePage=function changePage(idx){if(idx<1){idx=1;}else if(idx>this.totalPages){idx=this.totalPages;}
this.events.requestStart.dispatch(this);this.pOptions.requestFunc(idx,this.pOptions,onSuccessCallback.bind(this),onErrorCallback.bind(this));};StyledElements.PaginatedSource=PaginatedSource;})();(function(){"use strict";var GUIBuilder,processTComponent,processTree,processRoot,extractOptions,NAMESPACE,TEMPLATE_NAMESPACE;NAMESPACE='http://wirecloud.conwet.fi.upm.es/StyledElements';TEMPLATE_NAMESPACE='http://wirecloud.conwet.fi.upm.es/Template';processTComponent=function processTComponent(element,tcomponents,context){var options,parsed_options,tcomponent,new_component;tcomponent=tcomponents[element.localName];if(typeof tcomponent==='function'){options=element.textContent.trim();if(options!==''){try{parsed_options=JSON.parse(options);}catch(e){}}
new_component=tcomponent(parsed_options,tcomponents,context);}else{new_component=tcomponent;}
if(typeof new_component==='string'){new_component=element.ownerDocument.createTextNode(new_component);}else if(new_component!=null){new_component=new_component;}else{new_component=element.ownerDocument.createTextNode('');}
return new_component;};processTree=function processTree(builder,element,tcomponents,context){var i,child,component,new_component;for(i=0;i<element.childNodes.length;i+=1){child=element.childNodes[i];if(!StyledElements.Utils.XML.isElement(child)){continue;}
if(child.namespaceURI===NAMESPACE){component=builder.build(child,tcomponents,context);component.insertInto(element,child);element.removeChild(child);}else if(child.namespaceURI===TEMPLATE_NAMESPACE){new_component=processTComponent(child,tcomponents,context);if(new_component instanceof StyledElements.StyledElement){new_component.insertInto(element,child);}else{element.insertBefore(new_component,child);}
element.removeChild(child);}else{processTree(builder,child,tcomponents,context);}}};processRoot=function processRoot(builder,element,tcomponents,context){var i,children,child,component;children=Array.prototype.slice.call(element.childNodes,0);for(i=0;i<children.length;i+=1){child=children[i];if(!StyledElements.Utils.XML.isElement(child)){continue;}
if(child.namespaceURI===NAMESPACE){component=builder.build(child,tcomponents,context);children[i]=component;}else if(child.namespaceURI===TEMPLATE_NAMESPACE){children[i]=processTComponent(child,tcomponents,context);}else{processTree(builder,child,tcomponents,context);}}
return new StyledElements.Fragment(children);};extractOptions=function extractOptions(element){var options,options_element;options=null;options_element=StyledElements.Utils.XML.getChildElementByTagNameNS(element,'http://wirecloud.conwet.fi.upm.es/StyledElements','options');if(options_element!=null){options_element.parentNode.removeChild(options_element);try{options=JSON.parse(options_element.textContent);}catch(e){}}
return options;};GUIBuilder=function GUIBuilder(){var mapping={'borderlayout':function(builder,element,options,tcomponents,context){var layout=new StyledElements.BorderLayout(options);var populateContainer=function populateContainer(element,xpath,container){var container_element,fragment;container_element=StyledElements.Utils.XML.getChildElementByTagNameNS(element,'http://wirecloud.conwet.fi.upm.es/StyledElements',xpath);if(container_element!=null){options=extractOptions(container_element);if(options!=null&&'class'in options){container.addClassName(options['class']);}
fragment=processRoot(builder,container_element,tcomponents,context);container.appendChild(fragment);}};populateContainer(element,'northcontainer',layout.getNorthContainer());populateContainer(element,'westcontainer',layout.getWestContainer());populateContainer(element,'centercontainer',layout.getCenterContainer());populateContainer(element,'eastcontainer',layout.getEastContainer());populateContainer(element,'southcontainer',layout.getSouthContainer());return layout;},'button':function(builder,element,options){options=StyledElements.Utils.merge({},options);options.text=element.textContent;return new StyledElements.StyledButton(options);},'select':function(builder,element,options){return new StyledElements.StyledSelect(options);}};this.build=function(element,tcomponents,context){var builder,options;builder=mapping[element.localName];options=extractOptions(element);return builder(this,element,options,tcomponents,context);};};GUIBuilder.prototype.DEFAULT_OPENING='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml">';GUIBuilder.prototype.DEFAULT_CLOSING='</s:styledgui>';GUIBuilder.prototype.parse=function parse(document,tcomponents,context){if(typeof document==='string'){document=StyledElements.Utils.XML.parseFromString(document,'application/xml');}
if(!(document instanceof Document)){throw new TypeError('document is not a Document or cannot be parsed into a Document');}
return processRoot(this,document.documentElement,tcomponents,context);};StyledElements.GUIBuilder=GUIBuilder;})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="tooltip fade" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"><t:content/></div></div></s:styledgui>';var setPosition=function setPosition(refPosition,position){this.element.classList.remove('top','right','bottom','left');switch(position){case'top':this.element.classList.add('top');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=(refPosition.top-this.element.offsetHeight)+"px";break;case'right':this.element.classList.add('right');this.element.style.left=refPosition.right+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;case'bottom':this.element.classList.add('bottom');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=refPosition.bottom+"px";break;case'left':this.element.classList.add('left');this.element.style.left=(refPosition.left-this.element.offsetWidth)+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;}};var standsOut=function standsOut(){var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setPosition.call(this,refPosition,position);var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.element.style.top="";this.element.style.bottom="10px";element_box=this.element.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.element.style.top="10px";}};var searchBestPosition=function(refPosition,positions){var i=0,weights=[];do{setPosition.call(this,refPosition,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,positions);}};var _show=function _show(refPosition){Wirecloud.UserInterfaceManager._registerPopup(this);if(this.visible){this.repaint();return;}
if('getBoundingClientRect'in refPosition){refPosition=refPosition.getBoundingClientRect();}
this.element=builder.parse(template,{content:this.options.content}).elements[0];document.body.appendChild(this.element);searchBestPosition.call(this,refPosition,this.options.placement);this.element.classList.add('in');};var Tooltip=function Tooltip(options){var defaultOptions={'content':'','class':'','placement':['right','bottom','left','top']};Object.defineProperty(this,'options',{value:StyledElements.Utils.merge(defaultOptions,options)});StyledElements.StyledElement.call(this,[]);Object.defineProperties(this,{visible:{get:function(){return this.element!=null;}},_show:{value:_show.bind(this),enumerable:false}});};Tooltip.prototype=new StyledElements.StyledElement();Tooltip.prototype.bind=function bind(element){element.addEventListener('focus',this.show.bind(this,element),false);element.addEventListener('blur',this.hide.bind(this),false);element.addEventListener('mouseenter',this.show.bind(this,element),false);element.addEventListener('mouseleave',this.hide.bind(this),false);element.addEventListener('click',this.hide.bind(this),false);};Tooltip.prototype.toggle=function toggle(refElement){if(this.visible){this.hide();}else{this._show(refElement);}};Tooltip.prototype.show=function show(refElement){this._show(refElement);};var _hide=function _hide(){if(this.element!=null){document.body.removeChild(this.element);this.element=null;Wirecloud.UserInterfaceManager._unregisterPopup(this);}};Tooltip.prototype.hide=function hide(){if(!this.visible){return;}
if(this.element.classList.contains('in')){this.element.addEventListener('transitionend',_hide.bind(this));this.element.classList.remove('in');}else{_hide.call(this);}};StyledElements.Tooltip=Tooltip;})();(function(){"use strict";var clickCallback=function clickCallback(e){e.preventDefault();e.stopPropagation();if(this.enabled){this.events.click.dispatch(this);}};var keydownCallback=function keydownCallback(e){if(this.enabled&&e.keyCode===13){this.events.click.dispatch(this);}};var onmouseenter=function onmouseenter(){this.events.mouseenter.dispatch(this);};var onmouseleave=function onmouseleave(){this.events.mouseleave.dispatch(this);};var onfocus=function onfocus(){this.events.focus.dispatch(this);};var onblur=function onblur(){this.events.blur.dispatch(this);};var StyledButton=function StyledButton(options){var defaultOptions={'text':null,'title':'','class':'','plain':false,'iconHeight':24,'iconWidth':24,'icon':null,'iconClass':null,'usedInForm':false};options=StyledElements.Utils.merge(defaultOptions,options);if(options.extending){return;}
StyledElements.StyledElement.call(this,['click','focus','blur','mouseenter','mouseleave']);if(options.usedInForm){this.wrapperElement=document.createElement("button");this.wrapperElement.setAttribute('type','button');}else{this.wrapperElement=document.createElement("div");}
this.wrapperElement.setAttribute('tabindex','0');this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"styled_button");if(options.id!=null){this.wrapperElement.setAttribute('id',options.id);}
if(options.plain){this.wrapperElement.classList.add('plain');}
if(options.icon!=null){this.icon=document.createElement("img");this.icon.className="icon";this.icon.style.width=options.iconWidth+'px';this.icon.style.height=options.iconHeight+'px';this.icon.src=options.icon;this.wrapperElement.appendChild(this.icon);}
if(options.text!=null||options.iconClass!=null){this.label=document.createElement('span');if(options.text!=null){this.label.appendChild(document.createTextNode(options.text));}
if(options.iconClass!=null){this.label.classList.add(options.iconClass);}
this.wrapperElement.appendChild(this.label);}
if(options.title){this.setTitle(options.title);}
this._clickCallback=clickCallback.bind(this);this._keydownCallback=keydownCallback.bind(this);this.wrapperElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._clickCallback,true);this.wrapperElement.addEventListener('keydown',this._keydownCallback,false);this.wrapperElement.addEventListener('focus',onfocus.bind(this),true);this.wrapperElement.addEventListener('blur',onblur.bind(this),true);this.wrapperElement.addEventListener('mouseenter',onmouseenter.bind(this),false);this.wrapperElement.addEventListener('mouseleave',onmouseleave.bind(this),false);};StyledButton.prototype=new StyledElements.StyledElement();StyledButton.prototype.Tooltip=StyledElements.Tooltip;StyledButton.prototype.focus=function focus(){this.wrapperElement.focus();};StyledButton.prototype.blur=function blur(){this.wrapperElement.blur();};StyledButton.prototype.setLabel=function setLabel(label){this.label.textContent=label;return this;};StyledButton.prototype.clearClassName=function clearClassName(){this.wrapperElement.className='styled_button';return this;};StyledButton.prototype.addIconClassName=function addIconClassName(classname){this.label.classList.add(classname);};StyledButton.prototype.removeIconClassName=function removeIconClassName(classname){this.label.classList.remove(classname);};StyledButton.prototype.setTitle=function setTitle(title){if(title==null||title===''){if(this.tooltip!=null){this.tooltip.destroy();this.tooltip=null;}}else{if(this.tooltip==null){this.tooltip=new this.Tooltip({content:title,placement:['bottom','top','right','left']});this.tooltip.bind(this);}
this.tooltip.options.content=title;}};StyledButton.prototype.click=function click(){if(this.enabled){this.events.click.dispatch(this);}};StyledButton.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._clickCallback,true);this.wrapperElement.removeEventListener('keydown',this._keydownCallback,false);delete this._clickCallback;delete this._keydownCallback;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.StyledButton=StyledButton;})();(function(){"use strict";var POPUP_POSITIONS=['left-bottom','right-bottom','top-left','top-right','bottom-right','bottom-left'];Object.freeze(POPUP_POSITIONS);var DEFAULT_PLACEMENT=['bottom-left','bottom-right','top-left','top-right'];Object.freeze(DEFAULT_PLACEMENT);var setPosition=function setPosition(refPosition,placement){var i=0;for(i=0;i<POPUP_POSITIONS.length;i++){this.wrapperElement.classList.remove('se-popup-menu-'+POPUP_POSITIONS[i]);}
this.wrapperElement.classList.add('se-popup-menu-'+placement);switch(placement){case'left-bottom':this.wrapperElement.style.left=(refPosition.left-this.wrapperElement.offsetWidth+1)+"px";this.wrapperElement.style.top=(refPosition.top-1)+"px";break;case'right-bottom':this.wrapperElement.style.left=(refPosition.right-1)+"px";this.wrapperElement.style.top=(refPosition.top-1)+"px";break;case'top-left':this.wrapperElement.style.top=(refPosition.top-this.wrapperElement.offsetHeight+1)+"px";this.wrapperElement.style.left=refPosition.left+"px";break;case'top-right':this.wrapperElement.style.top=(refPosition.top-this.wrapperElement.offsetHeight+1)+"px";this.wrapperElement.style.left=(refPosition.right-this.wrapperElement.offsetWidth)+"px";break;case'bottom-right':this.wrapperElement.style.top=(refPosition.bottom-1)+"px";this.wrapperElement.style.left=(refPosition.right-this.wrapperElement.offsetWidth)+"px";break;default:case'bottom-left':this.wrapperElement.style.top=(refPosition.bottom-1)+"px";this.wrapperElement.style.left=refPosition.left+"px";break;}};var standsOut=function standsOut(){var parent_box=this.wrapperElement.parentElement.getBoundingClientRect();var element_box=this.wrapperElement.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,placements){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var placement=placements[index];setPosition.call(this,refPosition,placement);var parent_box=this.wrapperElement.parentElement.getBoundingClientRect();var element_box=this.wrapperElement.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.wrapperElement.style.top="";this.wrapperElement.style.bottom="10px";element_box=this.wrapperElement.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.wrapperElement.style.top="10px";}};var PopupMenuBase=function PopupMenuBase(options){var defaultOptions={'placement':null};options=StyledElements.Utils.merge(defaultOptions,options);if(options.extending){return;}
StyledElements.ObjectWithEvents.call(this,['itemOver','visibilityChange']);this.wrapperElement=document.createElement('div');this.wrapperElement.className='se-popup-menu hidden';this._context=null;if('position'in options){if(Array.isArray(options.position)){this._placement=options.position;}else if(typeof options.position==='string'){this._placement=[options.placement];}else{this._placement=DEFAULT_PLACEMENT;}}else{if(Array.isArray(options.placement)){this._placement=options.placement;}else if(typeof options.placement==='string'){this._placement=[options.placement];}else{this._placement=DEFAULT_PLACEMENT;}}
this._items=[];this._dynamicItems=[];this._submenus=[];this._menuItemCallback=this._menuItemCallback.bind(this);this._menuItemEnterCallback=this._menuItemEnterCallback.bind(this);};PopupMenuBase.prototype=new StyledElements.ObjectWithEvents();PopupMenuBase.prototype._append=function _append(child,where){if(child instanceof StyledElements.MenuItem){child.addEventListener('click',this._menuItemCallback);child.addEventListener('mouseover',this._menuItemEnterCallback);}else if(child instanceof StyledElements.SubMenuItem){child.addEventListener('click',this._menuItemCallback);child.addEventListener('mouseover',this._menuItemEnterCallback);child._setParentPopupMenu(this);}else if(child instanceof StyledElements.DynamicMenuItems||child instanceof StyledElements.Separator){}else if(child!=null){throw new TypeError('Invalid chlid element');}else{throw new TypeError('The new child element is null');}
where.push(child);};PopupMenuBase.prototype.append=function append(child){this._append(child,this._items);};PopupMenuBase.prototype.appendSeparator=function appendSeparator(){this.append(new StyledElements.Separator());};PopupMenuBase.prototype.setContext=function setContext(context){this._context=context;};PopupMenuBase.prototype._menuItemCallback=function _menuItemCallback(menuItem){if(menuItem.wrapperElement.classList.contains('submenu')){this.show();menuItem.wrapperElement.classList.add("hovered");}else{this.hide();}
if(typeof menuItem.run==='function'){menuItem.run(this._context,menuItem.context);}};PopupMenuBase.prototype.isVisible=function isVisible(){return StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode);};PopupMenuBase.prototype.show=function show(refPosition){var i,j,item,generatedItems,generatedItem;if(this.isVisible()){return;}
for(i=0;i<this._items.length;i+=1){item=this._items[i];if(item instanceof StyledElements.DynamicMenuItems){generatedItems=item.build(this._context);for(j=0;j<generatedItems.length;j+=1){generatedItem=generatedItems[j];this._append(generatedItem,this._dynamicItems);if(generatedItem instanceof StyledElements.MenuItem||generatedItem instanceof StyledElements.Separator){generatedItem.insertInto(this.wrapperElement);}else if(generatedItem instanceof StyledElements.SubMenuItem){generatedItem._getMenuItem().insertInto(this.wrapperElement);}}}else if(item instanceof StyledElements.MenuItem||item instanceof StyledElements.Separator){item.insertInto(this.wrapperElement);}else if(item instanceof StyledElements.SubMenuItem){item._getMenuItem().insertInto(this.wrapperElement);this._submenus.push(item);}else{this.wrapperElement.appendChild(item);}}
this.wrapperElement.classList.remove('hidden');try{window.parent.document.body.appendChild(this.wrapperElement);}catch(e){document.body.appendChild(this.wrapperElement);}
Wirecloud.UserInterfaceManager._registerPopup(this);this.events.visibilityChange.dispatch(this);if(!('left'in refPosition)&&'x'in refPosition&&'y'in refPosition){this.wrapperElement.style.top=refPosition.y+"px";this.wrapperElement.style.left=refPosition.x+"px";}else{i=0;var weights=[];do{setPosition.call(this,refPosition,this._placement[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<this._placement.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,this._placement);}}
this.wrapperElement.style.display='block';};PopupMenuBase.prototype.hide=function hide(){var i,aux;if(!this.isVisible()){return;}
this.wrapperElement.classList.add('hidden');this.wrapperElement.style.bottom="";for(i=0;i<this._submenus.length;i+=1){this._submenus[i].hide();}
for(i=0;i<this._dynamicItems.length;i+=1){aux=this._dynamicItems[i];if(aux instanceof StyledElements.SubMenuItem){aux.hide();}
aux.destroy();}
this._dynamicItems=[];this._submenus=[];this.wrapperElement.innerHTML='';StyledElements.Utils.removeFromParent(this.wrapperElement);Wirecloud.UserInterfaceManager._unregisterPopup(this);this.events.visibilityChange.dispatch(this);};PopupMenuBase.prototype._menuItemEnterCallback=function _menuItemEnterCallback(menuItem){this.events.itemOver.dispatch(this,menuItem);};PopupMenuBase.prototype.destroy=function destroy(){var i,item;this.hide();for(i=0;i<this._items.length;i+=1){item=this._items[i];if(item instanceof StyledElements.MenuItem){item.destroy();}}
this._items=null;this._menuItemCallback=null;this._context=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.PopupMenuBase=PopupMenuBase;})();(function(){"use strict";var disableCallback=function disableCallback(e){if(e.button!==0){return;}
var boundingBox=this.wrapperElement.getBoundingClientRect();if(e.clientX<boundingBox.left||e.clientX>boundingBox.right||e.clientY<boundingBox.top||e.clientY>boundingBox.bottom){setTimeout(this.hide.bind(this),0);}};var PopupMenu=function PopupMenu(options){StyledElements.PopupMenuBase.call(this,options);this._disableCallback=disableCallback.bind(this);};PopupMenu.prototype=new StyledElements.PopupMenuBase({extending:true});PopupMenu.prototype.show=function show(refPosition){document.addEventListener("click",this._disableCallback,true);StyledElements.PopupMenuBase.prototype.show.call(this,refPosition);};PopupMenu.prototype.hide=function hide(){StyledElements.PopupMenuBase.prototype.hide.call(this);document.removeEventListener("click",this._disableCallback,true);document.removeEventListener("contextmenu",this._disableCallback,true);};PopupMenu.prototype.destroy=function destroy(){this._disableCallback=null;StyledElements.PopupMenuBase.prototype.destroy.call(this);};StyledElements.PopupMenu=PopupMenu;})();(function(){"use strict";StyledElements.DynamicMenuItems=function DynamicMenuItems(){};StyledElements.DynamicMenuItems.prototype.build=function build(){return[];};})();(function(){"use strict";var MenuItem=function MenuItem(text,handler,context){StyledElements.StyledElement.call(this,['click','mouseover','mouseout']);this.wrapperElement=document.createElement("div");this.wrapperElement.classList.add("se-popup-menu-item");var span=document.createElement("span");span.appendChild(document.createTextNode(text));this.wrapperElement.appendChild(span);this.run=handler;this.context=context;this._mouseoverEventHandler=function(event){if(this.enabled){this.wrapperElement.classList.add("hovered");this.events.mouseover.dispatch(this);}}.bind(this);this.wrapperElement.addEventListener("mouseover",this._mouseoverEventHandler,false);this._mouseoutEventHandler=function(event){if(this.enabled){this.wrapperElement.classList.remove("hovered");this.events.mouseout.dispatch(this);}}.bind(this);this.wrapperElement.addEventListener("mouseout",this._mouseoutEventHandler,false);this._clickHandler=function(event){event.stopPropagation();if(this.enabled){this.wrapperElement.classList.remove("hovered");this.events.mouseout.dispatch(this);this.events.click.dispatch(this);}}.bind(this);this.wrapperElement.addEventListener("click",this._clickHandler,true);};MenuItem.prototype=new StyledElements.StyledElement();MenuItem.prototype.destroy=function destroy(){if(StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode)){StyledElements.Utils.removeFromParent(this.wrapperElement);}
this.wrapperElement.removeEventListener("mouseover",this._mouseoverEventHandler,false);this.wrapperElement.removeEventListener("mouseout",this._mouseoutEventHandler,false);this.wrapperElement.removeEventListener("click",this._clickHandler,true);this._mouseoverEventHandler=null;this._mouseoutEventHandler=null;this._clickHandler=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.MenuItem=MenuItem;})();(function(){"use strict";var Separator=function Separator(){StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement("hr");};Separator.prototype=new StyledElements.StyledElement();Separator.prototype.destroy=function destroy(){if(StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode)){StyledElements.Utils.removeFromParent(this.wrapperElement);}
StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Separator=Separator;})();(function(){"use strict";var SubMenuItem=function SubMenuItem(text,handler,options){if(arguments.length===0){return true;}
options=StyledElements.Utils.merge({'position':['right-bottom','left-bottom']},options);StyledElements.PopupMenuBase.call(this,options);this.wrapperElement.classList.add('se-popup-submenu');this.menuItem=new StyledElements.MenuItem(text,handler);this.menuItem.addClassName('submenu');};SubMenuItem.prototype=new StyledElements.PopupMenuBase({extending:true});SubMenuItem.prototype._getContext=function _getContext(){if(this.parentMenu instanceof SubMenuItem){return this.parentMenu._getContext();}else{return this.parentMenu._context;}};SubMenuItem.prototype._menuItemCallback=function _menuItemCallback(menuItem){var currentMenu=this;while(currentMenu.parentMenu){currentMenu=currentMenu.parentMenu;}
currentMenu.hide();menuItem.run(currentMenu._context);};SubMenuItem.prototype._setParentPopupMenu=function _setParentPopupMenu(popupMenu){this.parentMenu=popupMenu;this.parentMenu.addEventListener('itemOver',function(popupMenu,item){if(item===this.menuItem){this.show(this.menuItem.wrapperElement.getBoundingClientRect());}else{this.hide();}}.bind(this));};SubMenuItem.prototype._getMenuItem=function _getMenuItem(){return this.menuItem;};SubMenuItem.prototype.addEventListener=function addEventListener(eventId,handler){switch(eventId){case'mouseover':case'click':return this.menuItem.addEventListener(eventId,handler);default:return StyledElements.PopupMenuBase.prototype.addEventListener.call(this,eventId,handler);}};SubMenuItem.prototype.enable=function enable(){this.menuItem.enable();};SubMenuItem.prototype.disable=function disable(){this.menuItem.disable();};SubMenuItem.prototype.setDisabled=function setDisabled(disabled){this.menuItem.setDisabled(disabled);};SubMenuItem.prototype.destroy=function destroy(){if(this.menuItem){this.menuItem.destroy();}
this.menuItem=null;StyledElements.PopupMenuBase.prototype.destroy.call(this);};StyledElements.SubMenuItem=SubMenuItem;})();(function(){"use strict";var visibilityChangeListener=function visibilityChangeListener(){if(this.popup_menu.isVisible()){this.wrapperElement.classList.add('open');}else{this.wrapperElement.classList.remove('open');}};var PopupButton=function PopupButton(options){var defaultOptions={'menuOptions':null,'menu':null};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledButton.call(this,options);if(options.menu!=null){this.popup_menu=options.menu;this._owned_popup_menu=false;}else{this.popup_menu=new this.PopupMenu(options.menuOptions);this._owned_popup_menu=true;}
this.addEventListener('click',function(){if(this.popup_menu.isVisible()){this.popup_menu.hide();}else{this.popup_menu.show(this.getBoundingClientRect());}}.bind(this));this._visibilityChangeListener=visibilityChangeListener.bind(this);this.popup_menu.addEventListener('visibilityChange',this._visibilityChangeListener);};PopupButton.prototype=new StyledElements.StyledButton({extending:true});PopupButton.prototype.PopupMenu=StyledElements.PopupMenu;PopupButton.prototype.getPopupMenu=function getPopupMenu(){return this.popup_menu;};PopupButton.prototype.replacePopupMenu=function replacePopupMenu(new_popup_menu){if(this._owned_popup_menu){this.popup_menu.destroy();this._owned_popup_menu=false;}
this.popup_menu=new_popup_menu;};PopupButton.prototype.destroy=function destroy(){StyledElements.StyledButton.prototype.destroy.call(this);if(this._owned_popup_menu){this.popup_menu.destroy();}else{this.popup_menu.removeEventListener('visibilityChange',this._visibilityChangeListener);}
this.popup_menu=null;};StyledElements.PopupButton=PopupButton;})();(function(){"use strict";var getFieldValue=function getFieldValue(item,field){var fieldPath,currentNode,currentField;if(typeof field==="string"){fieldPath=[field];}else{fieldPath=field.slice();}
currentNode=item;while(currentNode!==null&&fieldPath.length>0){currentField=fieldPath.splice(0,1)[0];currentNode=currentNode[currentField];}
if(currentNode===null||fieldPath.length>0){return"";}
return currentNode;};var elementPassFilter=function elementPassFilter(element,pattern){return Object.getOwnPropertyNames(element).some(function(key,index,array){var value=getFieldValue(element,key);switch(typeof value){case"number":return pattern.test(""+value);case"string":return pattern.test(value);default:return false;}});};var filterElements=function filterElements(keywords){var filteredElements,i,element;if(!keywords){this.filteredElements=this.elements;return;}
this._currentPattern=new RegExp(StyledElements.Utils.escapeRegExp(keywords),'i');filteredElements=[];for(i=0;i<this.elements.length;i+=1){element=this.elements[i];if(elementPassFilter.call(this,element,this._currentPattern)){filteredElements.push(element);}}
this.filteredElements=filteredElements;};var sortElements=function sortElements(order){var sort_id,inverse,column,sortFunc,parseDate;if(order==null){this.sortedElements=this.filteredElements;return;}
sort_id=order[0];inverse=false;if(sort_id[0]==='-'){inverse=true;sort_id=sort_id.substr(1);}
column=this.sort_info[sort_id];sortFunc=column.sortFunc;if(sortFunc==null){switch(column.type){case"date":if(typeof column.dateparser==='function'){parseDate=column.dateparser;}else{parseDate=function(string){return new Date(string);};}
sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);try{value1=parseDate(value1);}catch(e){value1=new Date(0);}
value2=getFieldValue(value2,this.field);try{value2=parseDate(value2);}catch(e2){value2=new Date(0);}
return value1-value2;}.bind({field:column.field});break;case"number":sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);value1=value1!==null?Number(value1):0;value2=getFieldValue(value2,this.field);value2=value2!==null?Number(value2):0;return value1-value2;}.bind({field:column.field});break;default:sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);value1=value1!==null?value1:'';value2=getFieldValue(value2,this.field);value2=value2!==null?value2:'';return value1.localeCompare(value2);}.bind({field:column.field});}}
if(inverse){sortFunc=function(value1,value2){return-this(value1,value2);}.bind(sortFunc);}
this.sortedElements=this.filteredElements.sort(sortFunc);};var requestFunc=function requestFunc(index,options,onSuccess,onError){var page=index;if(index>this.totalPages){index=this.totalPages;}
index-=1;var start=index*options.pageSize;var end=start+options.pageSize;var elements=this.sortedElements.slice(start,end);onSuccess(elements,{current_page:page,total_count:this.filteredElements.length});};var StaticPaginatedSource=function StaticPaginatedSource(options){if(typeof options!=='object'){options={};}
options.requestFunc=requestFunc.bind(this);StyledElements.PaginatedSource.call(this,options);this.sort_info=options.sort_info;if(typeof this.sort_info!=='object'){this.sort_info={};}
if(Array.isArray(options.initialElements)){this.changeElements(options.initialElements);}else{this.elements=[];this.filteredElements=[];this.sortedElements=[];}};StaticPaginatedSource.prototype=new StyledElements.PaginatedSource();StaticPaginatedSource.prototype.changeOptions=function changeOptions(newOptions){var force_sort=false;if('keywords'in newOptions){filterElements.call(this,newOptions.keywords);force_sort=true;}
if('order'in newOptions){sortElements.call(this,newOptions.order);}else if(force_sort){sortElements.call(this,this.pOptions.order);}
StyledElements.PaginatedSource.prototype.changeOptions.call(this,newOptions);};StaticPaginatedSource.prototype.changeElements=function changeElements(newElements){if(Array.isArray(newElements)){this.elements=newElements;}else{this.elements=[];}
filterElements.call(this,this.pOptions.keywords);sortElements.call(this,this.pOptions.order);this.refresh();};StaticPaginatedSource.prototype.addElement=function addElement(newElement){this.elements.push(newElement);if(elementPassFilter.call(this,newElement,this._currentPattern)){this.filteredElements.push(newElement);sortElements.call(this,this.pOptions.order);this.refresh();}};StyledElements.StaticPaginatedSource=StaticPaginatedSource;})();(function(){"use strict";var StyledFileField,onchange,onclick,onfocus,onblur;onclick=function onclick(e){if(e.target===this.inputElement){return;}
this.inputElement.click();e.stopPropagation();e.preventDefault();return false;};onchange=function onchange(){var file,filename;file=this.getValue();if(file!=null){filename=file.name;}else{filename='';}
this.name_preview.textContent=filename;this.name_preview.setAttribute('title',filename);this.events.change.dispatch(this);};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};StyledFileField=function StyledFileField(options){var defaultOptions={'class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.layout=new StyledElements.HorizontalLayout({'class':'se-file-field input input-append'});this.wrapperElement=this.layout.wrapperElement;if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
var wrapper=document.createElement('div');wrapper.className='input_wrapper';this.wrapperElement.appendChild(wrapper);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","file");this.inputElement.setAttribute('tabindex',0);wrapper.appendChild(this.inputElement);if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.name_preview=document.createElement('div');this.name_preview.className='filename';this.layout.getCenterContainer().appendChild(this.name_preview);var button=document.createElement('div');button.className='styled_button';var button_span=document.createElement('span');button_span.textContent=StyledElements.Utils.gettext('Select');button.appendChild(button_span);this.layout.getEastContainer().appendChild(button);this._onchange=onchange.bind(this);this._onclick=onclick.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._onclick,true);this.inputElement.addEventListener('change',this._onchange,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);};StyledFileField.prototype=new StyledElements.StyledInputElement();StyledFileField.prototype.repaint=function repaint(){this.layout.repaint();};StyledFileField.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledInputElement.prototype.insertInto.call(this,element,refElement);this.repaint();};StyledFileField.prototype.getValue=function getValue(){return this.inputElement.files[0];};StyledFileField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._onclick,true);this.inputElement.removeEventListener('change',this._onchange,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._onchange;delete this._onfocus;delete this._onblur;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledFileField=StyledFileField;})();(function(){"use strict";var update=function update(inc){var value=Number(this.inputElement.value);if(!isNaN(value)){value=Math.round((value+inc)*100)/100;if(value>this.options.max){value=this.options.max;}else if(value<this.options.min){value=this.options.min;}}else if(inc>0&&this.options.min!==Number.NEGATIVE_INFINITY){value=this.options.min;}else if(inc<0&&this.options.max!==Number.POSITIVE_INFINITY){value=this.options.max;}else{value=0;}
this.inputElement.value=value;};var onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};var onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};var StyledNumericField=function StyledNumericField(options){var defaultOptions={'initialValue':0,'class':'','min':Number.NEGATIVE_INFINITY,'max':Number.POSITIVE_INFINITY,'inc':1};this.options=options=StyledElements.Utils.merge(defaultOptions,options);options.min=Number(options.min);options.max=Number(options.max);options.inc=Number(options.inc);options.initialValue=Number(options.initialValue);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.wrapperElement=document.createElement("div");this.wrapperElement.className="se-numeric-field";this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","text");if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);var topButton=new StyledElements.StyledButton({'class':'se-numeric-field-top-button',iconClass:'icon-caret-up'});var bottomButton=new StyledElements.StyledButton({'class':'se-numeric-field-bottom-button',iconClass:'icon-caret-down'});topButton.addEventListener("click",update.bind(this,options.inc));bottomButton.addEventListener("click",update.bind(this,-options.inc));this.inputElement.addEventListener("focus",onfocus.bind(this),true);this.inputElement.addEventListener("blur",onblur.bind(this),true);this.wrapperElement.appendChild(this.inputElement);topButton.insertInto(this.wrapperElement);bottomButton.insertInto(this.wrapperElement);};StyledNumericField.prototype=new StyledElements.StyledInputElement();StyledNumericField.prototype.getValue=function getValue(){return Number(this.inputElement.value);};StyledElements.StyledNumericField=StyledNumericField;})();(function(){"use strict";var StyledTextField,oninput,onfocus,onblur,onkeypress;oninput=function oninput(){this.events.change.dispatch(this);};onfocus=function onfocus(){this.events.focus.dispatch(this);};onblur=function onblur(){this.events.blur.dispatch(this);};onkeypress=function onkeypress(event){if(event.keyCode===13){this.events.submit.dispatch(this);}};StyledTextField=function StyledTextField(options){var defaultOptions={'initialValue':'','class':'','placeholder':null};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur','submit']);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","text");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-text-field";if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.placeholder!=null){this.setPlaceholder(options.placeholder);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this._onkeypress=onkeypress.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);this.inputElement.addEventListener('keypress',this._onkeypress,true);};StyledTextField.prototype=new StyledElements.StyledInputElement();StyledTextField.prototype.setPlaceholder=function setPlaceholder(placeholder){this.inputElement.setAttribute('placeholder',placeholder);};StyledTextField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);this.inputElement.removeEventListener('keypress',this._onkeypress,true);delete this._oninput;delete this._onfocus;delete this._onblur;delete this._onkeypress;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledTextField=StyledTextField;})();(function(){"use strict";var StyledTextArea,oninput,onfocus,onblur;oninput=function oninput(){this.events.change.dispatch(this);};onfocus=function onfocus(){this.events.focus.dispatch(this);};onblur=function onblur(){this.events.blur.dispatch(this);};StyledTextArea=function StyledTextArea(options){var defaultOptions={'initialValue':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['blur','change','focus']);this.inputElement=document.createElement("textarea");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-text-area";if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.setValue(options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);};StyledTextArea.prototype=new StyledElements.StyledInputElement();StyledTextArea.prototype.select=function select(){this.inputElement.select();};StyledTextArea.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._oninput;delete this._onfocus;delete this._onblur;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledTextArea=StyledTextArea;})();(function(){"use strict";var itemListener=function itemListener(){if(this.listComponent.enabled){this.listComponent.toggleElementSelection(this.value);}};var _cleanSelection=function _cleanSelection(){for(var i=0;i<this.currentSelection.length;i++){var value=this.currentSelection[i];this.entriesByValue[value].element.classList.remove("selected");}
this.currentSelection=[];};var StyledList=function StyledList(options){options=StyledElements.Utils.merge({'class':'','id':null,'multivalued':false,'initialEntries':[],'initialSelection':[]},options);StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"styled_list");if(options.id!=null){this.wrapperElement.id=options.id;}
this.content=document.createElement("div");this.wrapperElement.appendChild(this.content);this.entries=[];this.entriesByValue={};this.currentSelection=[];this.addEntries(options.initialEntries);this.select(options.initialSelection);if(options.full){this.wrapperElement.classList.add("full");}
this.multivalued=options.multivalued;if(options.allowEmpty===undefined){this.allowEmpty=this.multivalued;}else{this.allowEmpty=options.allowEmpty;}};StyledList.prototype=new StyledElements.StyledElement();StyledList.prototype.addEntries=function addEntries(entries){var entryValue,entryText;if(entries==null||entries.length===0){return;}
if(!Array.isArray(entries)){throw new TypeError();}
for(var i=0;i<entries.length;i++){var entry=entries[i];if(Array.isArray(entry)){entryValue=entry[0];entryText=entry[1];}else{entryValue=entries[i].value;entryText=entries[i].label;}
entryText=entryText?entryText:entryValue;var row=document.createElement("div");row.className="row";var context={listComponent:this,value:entryValue};row.addEventListener("click",itemListener.bind(context),true);entry.element=row;row.appendChild(document.createTextNode(entryText));this.content.appendChild(row);this.entriesByValue[entryValue]=entry;}
this.entries=this.entries.concat(entries);};StyledList.prototype.removeEntryByValue=function removeEntryByValue(value){var entry,index;entry=this.entriesByValue[value];delete this.entriesByValue[value];this.entries.slice(this.entries.indexOf(entry),1);StyledElements.Utils.removeFromParent(entry.element);if(index!==-1){this.currentSelection.splice(index,1);this.event.change.dispatch(this,this.currentSelection,[],[value]);}};StyledList.prototype.clear=function clear(){this.cleanSelection();this.content.innerHTML='';this.entries=[];this.entriesByValue={};};StyledList.prototype.getSelection=function getSelection(){return StyledElements.Utils.clone(this.currentSelection);};StyledList.prototype.cleanSelection=function cleanSelection(){if(this.currentSelection.length===0){return;}
var oldSelection=this.currentSelection;_cleanSelection.call(this);this.events.change.dispatch(this,[],[],oldSelection);};StyledList.prototype.select=function select(selection){_cleanSelection.call(this);this.addSelection(selection);};StyledList.prototype.addSelection=function addSelection(selection){var i,entry,addedValues=[],removedValues=[];if(selection.length===0){return;}
if(!this.multivalued){if(selection[0]===this.currentSelection[0]){return;}
removedValues=this.currentSelection;_cleanSelection.call(this);if(selection.length>1){selection=selection.splice(0,1);}}
for(i=0;i<selection.length;i++){entry=selection[i];if(this.currentSelection.indexOf(entry)===-1){this.entriesByValue[entry].element.classList.add("selected");this.currentSelection.push(entry);addedValues.push(entry);}}
this.events.change.dispatch(this,this.currentSelection,addedValues,removedValues);};StyledList.prototype.removeSelection=function removeSelection(selection){var i,entry,index,removedValues=[];if(selection.length===0){return;}
for(i=0;i<selection.length;i++){entry=selection[i];this.entriesByValue[entry].element.classList.remove("selected");index=this.currentSelection.indexOf(entry);if(index!==-1){this.currentSelection.splice(index,1);this.entriesByValue[entry].element.classList.remove("selected");removedValues.push(entry);}}
if(removedValues.length>0){this.events.change.dispatch(this,this.currentSelection,[],removedValues);}};StyledList.prototype.toggleElementSelection=function toggleElementSelection(element){if(!this.entriesByValue[element].element.classList.contains("selected")){this.addSelection([element]);}else if(this.allowEmpty){this.removeSelection([element]);}};StyledElements.StyledList=StyledList;})();(function(){"use strict";var StyledPasswordField,oninput,onfocus,onblur;oninput=function oninput(){this.events.change.dispatch(this);};onfocus=function onfocus(){this.events.focus.dispatch(this);};onblur=function onblur(){this.events.blur.dispatch(this);};StyledPasswordField=function StyledPasswordField(options){var defaultOptions={'initialValue':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","password");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-password-field";if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
if('name'in options){this.inputElement.setAttribute("name",options.name);}
if('id'in options){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);};StyledPasswordField.prototype=new StyledElements.StyledInputElement();StyledPasswordField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledPasswordField=StyledPasswordField;})();(function(){"use strict";var StyledSelect,onchange,onfocus,onblur;onchange=function onchange(event){if(this.enabled){var optionList=event.target;this.textDiv.textContent=optionList[optionList.selectedIndex].text;this.events.change.dispatch(this);}};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};StyledSelect=function StyledSelect(options){options=StyledElements.Utils.merge({'class':'','initialEntries':[],'initialValue':null,'idFunc':function(value){if(typeof value==='string'){return value;}else if(value===null||value===undefined){return'';}else if(typeof value==='number'){return''+value;}else{throw new TypeError();}}},options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"se-select");var div=document.createElement("div");div.className="se-select-arrow";this.inputElement=document.createElement("select");if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id){this.wrapperElement.setAttribute("id",options.id);}
this.textDiv=document.createElement("div");this.textDiv.className="se-select-text";this.wrapperElement.appendChild(this.textDiv);this.wrapperElement.appendChild(div);this.wrapperElement.appendChild(this.inputElement);this.optionsByValue={};this.optionValues={};this.idFunc=options.idFunc;this.addEntries(options.initialEntries);this._onchange=onchange.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('change',this._onchange,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);var selectedIndex=this.inputElement.options.selectedIndex;if(selectedIndex!==-1){this.textDiv.textContent=this.inputElement.options[selectedIndex].text;}};StyledSelect.prototype=new StyledElements.StyledInputElement();StyledSelect.prototype.getLabel=function getLabel(){return this.textDiv.textContent;};StyledSelect.prototype.getValue=function getValue(){return this.optionValues[this.inputElement.value];};StyledSelect.prototype.setValue=function setValue(newValue){if(typeof newValue!=='string'){try{newValue=this.idFunc(newValue);}catch(e){newValue=null;}}
if(newValue===null||!(newValue in this.optionValues)){if(this.defaultValue!=null){newValue=this.defaultValue;}else if(this.inputElement.options.length>0){newValue=this.inputElement.options[0].value;}else{StyledElements.StyledInputElement.prototype.setValue.call(this,'');this.textDiv.textContent='';return;}}
StyledElements.StyledInputElement.prototype.setValue.call(this,newValue);this.textDiv.textContent=this.optionsByValue[newValue];};StyledSelect.prototype.addEntries=function addEntries(newEntries){var oldSelectedIndex,optionValue,optionLabel;oldSelectedIndex=this.inputElement.options.selectedIndex;if(newEntries==null||newEntries.length===0){return;}
for(var i=0;i<newEntries.length;i++){var option=document.createElement("option");if(newEntries[i]instanceof Array){optionValue=newEntries[i][0];optionLabel=newEntries[i][1];}else{optionValue=newEntries[i].value;optionLabel=newEntries[i].label;}
optionLabel=optionLabel?optionLabel:optionValue;var realValue=optionValue;if(typeof optionValue!=='string'){optionValue=this.idFunc(optionValue);}
option.setAttribute("value",optionValue);option.appendChild(document.createTextNode(optionLabel));if(this.defaultValue==optionValue){option.setAttribute("selected","selected");}
this.inputElement.appendChild(option);this.optionValues[optionValue]=realValue;this.optionsByValue[optionValue]=optionLabel;}
var selectedIndex=this.inputElement.options.selectedIndex;if(oldSelectedIndex!==selectedIndex){this.textDiv.textContent=this.inputElement.options[selectedIndex].text;}};StyledSelect.prototype.clear=function clear(){this.textDiv.textContent="";this.inputElement.textContent="";this.optionsByValue={};this.optionsValues={};};StyledSelect.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('change',this._onchange,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._onchange;delete this._onfocus;delete this._onblur;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledSelect=StyledSelect;})();(function(){"use strict";StyledElements.ToggleButton=function ToggleButton(options){var defaultOptions={'initiallyChecked':false};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledButton.call(this,options);if(options.checkedIcon==null){options.checkedIcon=options.icon;}
if(options.checkedText==null){options.checkedText=options.text;}
this._icon=options.icon;this._checkedIcon=options.checkedIcon;this._text=options.text;this._checkedText=options.checkedText;this._checked=false;this.setChecked(options.initiallyChecked);};StyledElements.ToggleButton.prototype=new StyledElements.StyledButton({extending:true});StyledElements.ToggleButton.prototype.isChecked=function isChecked(checked){return this._checked;};StyledElements.ToggleButton.prototype.setChecked=function setChecked(checked){if(checked==this.isChecked()){return;}
if(checked){this.wrapperElement.classList.add('checked');if(this.icon){this.icon.src=this._checkedIcon;}
if(this.label){this.label.textContent=this._checkedText;}}else{this.wrapperElement.classList.remove('checked');if(this.icon){this.icon.src=this._icon;}
if(this.label){this.label.textContent=this._text;}}
this._checked=checked;};StyledElements.ToggleButton.prototype._clickCallback=function _clickCallback(event){if(!this.enabled){return;}
event.stopPropagation();this.setChecked(!this.isChecked());this.events.click.dispatch(this);};})();(function(){"use strict";var clickCallback=function clickCallback(id,e){e.preventDefault();e.stopPropagation();this.switchPill(id);};var Pills=function Pills(options){var defaultOptions={'class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement("ul");this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"se-pills");this.activePill=null;this.pills={};};Pills.prototype=new StyledElements.Container();Pills.prototype.add=function add(id,label){var pill=document.createElement('li');pill.className='se-pill';pill.textContent=label;pill.addEventListener('click',clickCallback.bind(this,id),true);this.wrapperElement.appendChild(pill);this.pills[id]=pill;};Pills.prototype.switchPill=function switchPill(id){if(!(id in this.pills)){throw new TypeError('Invalid pill id');}
if(id==this.activePill){return;}
if(this.activePill!=null){this.pills[this.activePill].classList.remove('active');}
this.activePill=id;this.pills[this.activePill].classList.add('active');this.events.change.dispatch(this,id);};StyledElements.Pills=Pills;})();(function(){"use strict";var Tab=function Tab(id,notebook,options){if(arguments.length===0){return;}
if(!(notebook instanceof StyledElements.StyledNotebook)){throw new Error("Invalid notebook argument");}
var defaultOptions={'closable':true,'containerOptions':{},'name':''};options=StyledElements.Utils.merge(defaultOptions,options);if(options.closeable){options.closable=options.closeable;}
options.useFullHeight=true;Object.defineProperties(this,{'notebook':{value:notebook},'tabId':{value:id}});this.tabElement=document.createElement("div");this.tabElement.className="se-notebook-tab";this.name=document.createElement('span');this.tabElement.appendChild(this.name);StyledElements.Container.call(this,options.containerOptions,['show','hide','close']);this.wrapperElement.classList.add("se-notebook-tab-content");this.wrapperElement.classList.add("hidden");this.tabElement.addEventListener("click",function(){this.notebook.goToTab(this.tabId);}.bind(this),false);if(options.closable){var closeButton=new this.Button({iconClass:"icon-remove",plain:true,'class':"close_button"});closeButton.insertInto(this.tabElement);closeButton.addEventListener("click",this.close.bind(this),false);}
this.rename(options.name);this.setTitle(options.title);};Tab.prototype=new StyledElements.Container({extending:true});Tab.prototype.Tooltip=StyledElements.Tooltip;Tab.prototype.Button=StyledElements.StyledButton;Tab.prototype.close=function close(){this.notebook.removeTab(this.tabId);};Tab.prototype.rename=function rename(newName){this.nameText=newName;this.name.textContent=this.nameText;};Tab.prototype.setTitle=function setTitle(title){if(title==null||title===''){if(this.tooltip!=null){this.tooltip.destroy();this.tooltip=null;}}else{if(this.tooltip==null){this.tooltip=new this.Tooltip({content:title,placement:['bottom','top','right','left']});this.tooltip.bind(this.tabElement);}
this.tooltip.options.content=title;}};Tab.prototype.setIcon=function setIcon(iconURL){if(iconURL==null){if(this.tabIcon!=null){StyledElements.Utils.removeFromParent(this.tabIcon);this.tabIcon=null;}
return;}
if(this.tabIcon==null){this.tabIcon=document.createElement('img');this.tabElement.insertBefore(this.tabIcon,this.tabElement.firstChild);}
this.tabIcon.src=iconURL;};Tab.prototype.setVisible=function setVisible(newStatus){if(newStatus){this.tabElement.classList.add("selected");this.wrapperElement.classList.remove("hidden");this.repaint(false);this.events.show.dispatch(this);}else{this.tabElement.classList.remove("selected");this.wrapperElement.classList.add("hidden");this.events.hide.dispatch(this);}};Tab.prototype.getId=function getId(){return this.tabId;};Tab.prototype.getTabElement=function getTabElement(){return this.tabElement;};StyledElements.Tab=Tab;})();(function(){"use strict";var onNewTab=function onNewTab(){this.events.newTab.dispatch(this);};var StyledNotebook=function StyledNotebook(options){var tabWrapper;StyledElements.StyledElement.call(this,['change','changed','tabDeletion','tabInsertion','newTab']);var defaultOptions={'class':'','focusOnSetVisible':true,'full':true};options=StyledElements.Utils.merge(defaultOptions,options);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"se-notebook");tabWrapper=new StyledElements.HorizontalLayout({'class':'se-notebook-tabs-wrapper','autoHeight':false});this.tabWrapper=tabWrapper;tabWrapper.insertInto(this.wrapperElement);this.tabArea=new StyledElements.Container();tabWrapper.getCenterContainer().appendChild(this.tabArea);this.tabArea.addClassName('se-notebook-tab-area');this.moveLeftButton=new this.Button({'class':'move_left','iconClass':'icon-caret-left'});tabWrapper.getWestContainer().appendChild(this.moveLeftButton);this.moveRightButton=new this.Button({'class':'move_right','iconClass':'icon-caret-right'});tabWrapper.getEastContainer().appendChild(this.moveRightButton);this.contentArea=document.createElement("div");this.contentArea.className="se-notebook-content-wrapper";this.wrapperElement.appendChild(this.contentArea);this.tabs=[];this.tabsById=[];this.visibleTab=null;this.maxTabElementWidth=null;if(options.id!=null){this.wrapperElement.setAttribute('id',options.id);}
if(options.full){this.wrapperElement.classList.add('full');}
this.focusOnSetVisible=options.focusOnSetVisible;this.events.newTab.addEventListener=function addEventListener(listener){var new_tab_main_listener;if(this.new_tab_button_tabs==null){new_tab_main_listener=onNewTab.bind(this);this.new_tab_button_tabs=new this.Button({iconClass:'icon-plus','class':'se-notebook-new-tab',title:StyledElements.Utils.gettext('Add Tab')});this.new_tab_button_tabs.addEventListener('click',new_tab_main_listener);this.tabArea.appendChild(this.new_tab_button_tabs);this.new_tab_button_left=new this.Button({iconClass:'icon-plus','class':'se-notebook-new-tab',title:StyledElements.Utils.gettext('Add Tab')});this.new_tab_button_left.addEventListener('click',new_tab_main_listener);this.addButton(this.new_tab_button_left);}
StyledElements.Event.prototype.addEventListener.call(this.events.newTab,listener);}.bind(this);var context={control:this,initialScrollLeft:null,finalScrollLeft:null,steps:null,step:null,inc:null};var stepFunc=function stepFunc(step,context){var scrollLeft=context.initialScrollLeft+Math.floor((step+1)*context.inc);if((context.inc<0)&&(scrollLeft>context.finalScrollLeft)||(context.inc>0)&&(scrollLeft<context.finalScrollLeft)){context.control.tabArea.wrapperElement.scrollLeft=Math.round(scrollLeft);return true;}else{context.control.tabArea.wrapperElement.scrollLeft=context.finalScrollLeft;enableDisableButtons.call(context.control);return false;}};var initFunc=function initFunc(context,command){var firstVisibleTab,currentTab,maxScrollLeft,baseTime,stepTimes,computedStyle,padding;context.initialScrollLeft=context.control.tabArea.wrapperElement.scrollLeft;computedStyle=document.defaultView.getComputedStyle(context.control.tabArea.wrapperElement,null);padding=computedStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);switch(command.type){case'shiftLeft':if(isTabVisible.call(context.control,0)){return false;}
firstVisibleTab=getFirstVisibleTab.call(context.control);currentTab=context.control.tabs[firstVisibleTab-1].getTabElement();context.finalScrollLeft=currentTab.offsetLeft-padding;break;case'shiftRight':if(isLastTabVisible.call(context.control)){return false;}
firstVisibleTab=getFirstVisibleTab.call(context.control);currentTab=context.control.tabs[firstVisibleTab+1].getTabElement();context.finalScrollLeft=currentTab.offsetLeft-padding;break;case'focus':currentTab=context.control.tabsById[command.tabId].getTabElement();if(isTabVisible.call(context.control,context.control.getTabIndex(command.tabId),true)){return false;}
context.finalScrollLeft=currentTab.offsetLeft-padding;break;}
maxScrollLeft=context.control.tabArea.wrapperElement.scrollWidth-context.control.tabArea.wrapperElement.clientWidth;if(context.finalScrollLeft>maxScrollLeft){context.finalScrollLeft=maxScrollLeft;}
baseTime=(new Date()).getTime()+100;stepTimes=[];context.steps=6;for(var i=0;i<=context.steps;i++){stepTimes[i]=baseTime+(i*100);}
context.inc=Math.floor((context.finalScrollLeft-context.initialScrollLeft)/context.steps);return stepTimes;};this.transitionsQueue=new StyledElements.CommandQueue(context,initFunc,stepFunc);this.moveLeftButton.addEventListener("click",this.shiftLeftTabs.bind(this));this.moveRightButton.addEventListener("click",this.shiftRightTabs.bind(this));Object.defineProperty(this,'fullscreen',{get:function(){if('fullscreenElement'in document){return document.fullscreenElement===this.wrapperElement;}else if('msFullscreenElement'in document){return document.msFullscreenElement===this.wrapperElement;}else if('mozFullScreenElement'in document){return document.mozFullScreenElement===this.wrapperElement;}else if('webkitFullscreenElement'in document){return document.webkitFullscreenElement===this.wrapperElement;}}});};StyledNotebook.prototype=new StyledElements.StyledElement();StyledNotebook.prototype.Button=StyledElements.StyledButton;StyledNotebook.prototype.Tab=StyledElements.Tab;var isTabVisible=function isTabVisible(tabIndex,full){var tabElement,tabAreaStart,tabAreaEnd,tabOffsetRight;tabElement=this.tabs[tabIndex].getTabElement();tabAreaStart=this.tabArea.wrapperElement.scrollLeft;tabAreaEnd=tabAreaStart+this.tabArea.wrapperElement.clientWidth;if(full){tabOffsetRight=tabElement.offsetLeft+tabElement.offsetWidth;return tabElement.offsetLeft>=tabAreaStart&&tabOffsetRight<=tabAreaEnd;}else{return tabElement.offsetLeft>=tabAreaStart&&tabElement.offsetLeft<=tabAreaEnd;}};var isLastTabVisible=function isLastTabVisible(){var lastTab=this.tabs.length-1;if(this.tabs.length===0||isTabVisible.call(this,lastTab,true)){return true;}
if(!isTabVisible.call(this,lastTab)){return false;}
return this.tabs.length<2||!isTabVisible.call(this,lastTab-1);};var enableDisableButtons=function enableDisableButtons(){if(this.tabs.length===0){this.moveLeftButton.disable();this.moveRightButton.disable();if(this.new_tab_button_tabs!=null){this.new_tab_button_tabs.enable();this.new_tab_button_left.disable();}
return;}
var first_tab_visible=isTabVisible.call(this,0);var last_tab_visible=isLastTabVisible.call(this);this.moveLeftButton.setDisabled(first_tab_visible);this.moveRightButton.setDisabled(last_tab_visible);if(this.new_tab_button_tabs!=null){if(first_tab_visible&&last_tab_visible){this.new_tab_button_tabs.enable();this.new_tab_button_left.disable();}else{this.new_tab_button_tabs.disable();this.new_tab_button_left.enable();}
this.tabWrapper.repaint();}};var getFirstVisibleTab=function getFirstVisibleTab(){var i;for(i=0;i<this.tabs.length;i+=1){if(isTabVisible.call(this,i)){return i;}}
return null;};StyledNotebook.prototype.shiftLeftTabs=function shiftLeftTabs(){this.transitionsQueue.addCommand({type:'shiftLeft'});};StyledNotebook.prototype.shiftRightTabs=function shiftRightTabs(){this.transitionsQueue.addCommand({type:'shiftRight'});};StyledNotebook.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.repaint();};StyledNotebook.prototype.createTab=function createTab(options){var defaultOptions={'initiallyVisible':false,'name':'','tab_constructor':this.Tab};options=StyledElements.Utils.merge(defaultOptions,options);var tabId=this.tabsById.push(null);if((options.tab_constructor!=this.Tab)&&!(options.tab_constructor.prototype instanceof StyledElements.Tab)){throw new TypeError();}
var tab=new options.tab_constructor(tabId,this,options);this.tabs[this.tabs.length]=tab;this.tabsById[tabId]=tab;var tabElement=tab.getTabElement();this.tabArea.appendChild(tabElement,this.new_tab_button_tabs);tab.insertInto(this.contentArea);if(this.maxTabElementWidth==null){this._computeMaxTabElementWidth();}
tabElement.style.maxWidth=this.maxTabElementWidth+'px';if(!this.visibleTab){this.visibleTab=tab;tab.setVisible(true);}
enableDisableButtons.call(this);if(options.initiallyVisible){this.goToTab(tabId);}
this.events.tabInsertion.dispatch(this);return tab;};StyledNotebook.prototype.getTab=function getTab(id){return this.tabsById[id];};StyledNotebook.prototype.getTabByLabel=function getTabByLabel(label){for(var i=0;i<this.tabs.length;i++){if(this.tabs[i].nameText===label){return this.tabs[i];}}
return null;};StyledNotebook.prototype.getVisibleTab=function getVisibleTab(){return this.visibleTab;};StyledNotebook.prototype.getTabByIndex=function getTabByIndex(index){return this.tabs[index];};StyledNotebook.prototype.getTabIndex=function getTabIndex(id){for(var i=0;i<this.tabs.length;i++){if(this.tabs[i].tabId==id){return i;}}
return null;};StyledNotebook.prototype.removeTab=function removeTab(id){var index,tabToExtract,nextTab;if(!this.tabsById[id]){return;}
delete this.tabsById[id];index=this.getTabIndex(id);tabToExtract=this.tabs.splice(index,1)[0];this.tabArea.removeChild(tabToExtract.getTabElement());this.contentArea.removeChild(tabToExtract.wrapperElement);enableDisableButtons.call(this);if((this.visibleTab===tabToExtract)&&(this.tabs.length>0)){nextTab=this.tabs[index];if(!nextTab){nextTab=this.tabs[index-1];}
this.goToTab(nextTab.tabId);}
tabToExtract.events.close.dispatch(tabToExtract,this);this.events.tabDeletion.dispatch(this,tabToExtract);};StyledNotebook.prototype.goToTab=function goToTab(tab,options){var newTab,oldTab;if(tab instanceof StyledElements.Tab){if(this.tabsById[tab.tabId]!==tab){throw new TypeError('tab is not owned by this notebook');}
newTab=tab;}else{newTab=this.tabsById[tab];if(newTab==null){throw new TypeError('Invalid tab id');}}
oldTab=this.visibleTab;if(options==null){options={};}
if(this.visibleTab&&newTab==this.visibleTab){if(this.focusOnSetVisible){this.focus(newTab.tabId);}
return;}
this.events.change.dispatch(this,oldTab,newTab,options.context);if(this.visibleTab){this.visibleTab.setVisible(false);}
this.visibleTab=newTab;this.visibleTab.setVisible(true);if(this.focusOnSetVisible){this.focus(newTab.tabId);}
this.events.changed.dispatch(this,oldTab,newTab,options.context);};StyledNotebook.prototype.getNumberOfTabs=function getNumberOfTabs(){return this.tabs.length;};StyledNotebook.prototype.focus=function focus(tabId){this.transitionsQueue.addCommand({type:'focus',tabId:tabId});};StyledNotebook.prototype._computeMaxTabElementWidth=function _computeMaxTabElementWidth(){var tabAreaWidth,tabElement,computedStyle,tabAreaComputedStyle;if(this.tabs.length===0){this.maxTabElementWidth=null;return;}
tabAreaWidth=this.tabArea.wrapperElement.clientWidth;tabElement=this.tabs[0].getTabElement();computedStyle=document.defaultView.getComputedStyle(tabElement,null);if(computedStyle.getPropertyCSSValue('display')==null){this.maxTabElementWidth=null;return;}
tabAreaComputedStyle=document.defaultView.getComputedStyle(this.tabArea.wrapperElement,null);tabAreaWidth-=tabAreaComputedStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);tabAreaWidth-=tabAreaComputedStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);this.maxTabElementWidth=tabAreaWidth;};var repaint_tab_area=function repaint_tab_area(){var i,j,tabElement,maxWidth,tabComputedStyle,childComputedStyle;this._computeMaxTabElementWidth();for(i=0;i<this.tabs.length;i++){tabElement=this.tabs[i].getTabElement();maxWidth=this.maxTabElementWidth;tabComputedStyle=document.defaultView.getComputedStyle(tabElement,null);maxWidth-=tabComputedStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=tabComputedStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=tabComputedStyle.getPropertyCSSValue('border-left-width').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=tabComputedStyle.getPropertyCSSValue('border-right-width').getFloatValue(CSSPrimitiveValue.CSS_PX);for(j=1;j<tabElement.childNodes.length;j++){childComputedStyle=document.defaultView.getComputedStyle(tabElement.childNodes[j],null);maxWidth-=tabElement.childNodes[j].offsetWidth;maxWidth-=childComputedStyle.getPropertyCSSValue('margin-left').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=childComputedStyle.getPropertyCSSValue('margin-right').getFloatValue(CSSPrimitiveValue.CSS_PX);}
tabElement.style.maxWidth=this.maxTabElementWidth+'px';tabElement.firstChild.style.maxWidth=maxWidth+'px';}};StyledNotebook.prototype.repaint=function repaint(temporal){var i,height;temporal=temporal!==undefined?temporal:false;if(this.fullscreen!==true){height=this._getUsableHeight();if(height==null){return;}
this.wrapperElement.style.height=(height+"px");}else{this.wrapperElement.style.height='';}
this.tabWrapper.repaint();repaint_tab_area.call(this);enableDisableButtons.call(this);if(temporal){if(this.visibleTab){this.visibleTab.repaint(true);}}else{for(i=0;i<this.tabs.length;i++){this.tabs[i].repaint(false);}}};StyledNotebook.prototype.isDisabled=function isDisabled(){return this.disabledLayer!=null;};StyledNotebook.prototype.setDisabled=function setDisabled(disabled){if(this.isDisabled()==disabled){return;}
if(disabled){this.disabledLayer=document.createElement('div');this.disabledLayer.classList.add('disable-layer');this.wrapperElement.appendChild(this.disabledLayer);}else{StyledElements.Utils.removeFromParent(this.disabledLayer);this.disabledLayer=null;}
this.enabled=!disabled;};StyledNotebook.prototype.enable=function enable(){this.setDisabled(false);};StyledNotebook.prototype.disable=function disable(){this.setDisabled(true);};StyledNotebook.prototype.clear=function clear(){this.tabs=[];this.tabsById=[];this.visibleTab=null;this.tabArea.clear();this.contentArea.innerHTML='';enableDisableButtons.call(this);};StyledNotebook.prototype.addButton=function addButton(button,position){if(!(button instanceof StyledElements.StyledButton)&&!(button instanceof StyledElements.StyledSelect)){throw new TypeError();}
position=position||'right';switch(position){case'left':this.tabWrapper.getWestContainer().appendChild(button,this.moveLeftButton);break;case'right':this.tabWrapper.getEastContainer().appendChild(button);break;}};StyledNotebook.prototype.requestFullscreen=function requestFullscreen(){if('requestFullscreen'in this.wrapperElement){this.wrapperElement.requestFullscreen();}else if('msRequestFullscreen'in this.wrapperElement){this.wrapperElement.msRequestFullscreen();}else if('mozRequestFullScreen'in this.wrapperElement){this.wrapperElement.mozRequestFullScreen();}else if('webkitRequestFullscreen'in this.wrapperElement){this.wrapperElement.webkitRequestFullscreen();}};StyledNotebook.prototype.exitFullscreen=function exitFullscreen(){if(this.fullscreen!==true){return;}
if('exitFullscreen'in document){document.exitFullscreen();}else if('msExitFullscreen'in document){document.msExitFullscreen();}else if('mozCancelFullScreen'in document){document.mozCancelFullScreen();}else if('webkitExitFullscreen'in document){document.webkitExitFullscreen();}};StyledNotebook.prototype.destroy=function destroy(){if(StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode)){StyledElements.Utils.removeFromParent(this.wrapperElement);}
this.tabs=null;this.tabsById=null;this.visibleTab=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.StyledNotebook=StyledNotebook;})();(function(){"use strict";var Alternative=function Alternative(id,options){var defaultOptions;if(arguments.length===0){return;}
defaultOptions={useFullHeight:true};options=StyledElements.Utils.merge(defaultOptions,options);this.altId=id;StyledElements.Container.call(this,options,['show','hide']);this.wrapperElement.classList.add("hidden");};Alternative.prototype=new StyledElements.Container({extending:true});Alternative.prototype.setVisible=function setVisible(newStatus){if(newStatus){this.wrapperElement.classList.remove("hidden");this.repaint(false);this.events.show.dispatch(this);}else{this.wrapperElement.classList.add("hidden");this.repaint(false);this.events.hide.dispatch(this);}};Alternative.prototype.isVisible=function isVisible(newStatus){return!this.wrapperElement.classList.contains("hidden");};Alternative.prototype.getId=function getId(){return this.altId;};StyledElements.Alternative=Alternative;})();(function(){"use strict";var StyledAlternatives=function StyledAlternatives(options){var defaultOptions={'class':'','full':true,'defaultEffect':'None'};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['preTransition','postTransition']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"alternatives");this.contentArea=document.createElement("div");this.contentArea.className="wrapper";this.wrapperElement.appendChild(this.contentArea);this.visibleAlt=null;this.alternatives={};this.alternativeList=[];this.nextAltId=0;if(options.id){this.wrapperElement.setAttribute("id",options.id);}
if(options.full){this.wrapperElement.classList.add("full");}
this.defaultEffect=options.defaultEffect;var context={alternativesObject:this,inAlternative:null,outAlternative:null,width:null,steps:null,step:null,inc:null};var stepFunc=function stepFunc(step,context){var newLeftPosOut,newLeftPosIn,offset=Math.floor(step*context.inc);if(context.inc<0){newLeftPosOut=offset;newLeftPosIn=context.width+offset;}else{newLeftPosOut=offset;newLeftPosIn=-context.width+offset;}
if((context.inc<0)&&(newLeftPosIn>0)||(context.inc>0)&&(newLeftPosOut<context.width)){context.outAlternative.wrapperElement.style.left=newLeftPosOut+"px";context.inAlternative.wrapperElement.style.left=newLeftPosIn+"px";return true;}else{context.outAlternative.setVisible(false);context.outAlternative.wrapperElement.style.left='';context.outAlternative.wrapperElement.style.width='';context.inAlternative.wrapperElement.style.left='';context.inAlternative.wrapperElement.style.width='';context.alternativesObject.visibleAlt=context.inAlternative;StyledElements.Utils.callCallback(context.onComplete,context.alternativesObject,context.outAlternative,context.inAlternative);context.alternativesObject.events.postTransition.dispatch(context.alternativesObject,context.outAlternative,context.inAlternative);return false;}};var initFunc=function initFunc(context,command){context.outAlternative=context.alternativesObject.visibleAlt;context.inAlternative=command.id;context.onComplete=command.onComplete;if(context.inAlternative!=null){context.inAlternative=context.alternativesObject.alternatives[context.inAlternative];}
if(context.inAlternative==null||context.inAlternative==context.outAlternative){StyledElements.Utils.callCallback(context.onComplete,context.alternativesObject,context.outAlternative,context.inAlternative);return false;}
context.alternativesObject.events.preTransition.dispatch(context.alternativesObject,context.outAlternative,context.inAlternative);var baseTime=(new Date()).getTime()+150;context.width=context.alternativesObject.wrapperElement.offsetWidth;context.inAlternative.wrapperElement.style.width=context.width+"px";context.outAlternative.wrapperElement.style.width=context.width+"px";context.inAlternative.setVisible(true);var stepTimes=[];switch(context.alternativesObject.defaultEffect){case StyledAlternatives.HORIZONTAL_SLICE:context.steps=6;for(var i=0;i<=context.steps;i++){stepTimes[i]=baseTime+(i*150);}
context.inc=Math.floor(context.width/context.steps);if(context.inAlternative.getId()>context.outAlternative.getId()){context.inAlternative.wrapperElement.style.left=context.width+"px";context.inc=-context.inc;}else{context.inAlternative.wrapperElement.style.left=-context.width+"px";}
break;default:context.steps=1;stepTimes[0]=baseTime;context.inc=Math.floor(context.width/context.steps);if(context.inAlternative.getId()>context.outAlternative.getId()){context.inAlternative.wrapperElement.style.left=context.width+"px";context.inc=-context.inc;}else{context.inAlternative.wrapperElement.style.left=-context.width+"px";}}
return stepTimes;};this.transitionsQueue=new StyledElements.CommandQueue(context,initFunc,stepFunc);};StyledAlternatives.prototype=new StyledElements.StyledElement();StyledAlternatives.HORIZONTAL_SLICE="HorizontalSlice";StyledAlternatives.NONE="HorizontalSlice";StyledAlternatives.prototype.repaint=function repaint(temporal){temporal=temporal!==undefined?temporal:false;var height=this._getUsableHeight();if(height==null){return;}
this.wrapperElement.style.height=(height+"px");if(this.visibleAlt!=null){this.visibleAlt.repaint();}};StyledAlternatives.prototype.createAlternative=function createAlternative(options){var defaultOptions={'containerOptions':{},'alternative_constructor':StyledElements.Alternative};options=StyledElements.Utils.merge(defaultOptions,options);var altId=this.nextAltId++;if((options.alternative_constructor!==StyledElements.Alternative)&&!(options.alternative_constructor.prototype instanceof StyledElements.Alternative)){throw new TypeError();}
var alt=new options.alternative_constructor(altId,options.containerOptions);alt.insertInto(this.contentArea);this.alternatives[altId]=alt;this.alternativeList.push(alt);if(!this.visibleAlt){this.visibleAlt=alt;alt.setVisible(true);}
return alt;};StyledAlternatives.prototype.removeAlternative=function removeAlternative(alternative){var index,id,nextAlternative=null;if(alternative instanceof StyledElements.Alternative){id=alternative.getId();if(this.alternatives[id]!==alternative){throw new TypeError('Invalid alternative');}}else{id=alternative;if(this.alternatives[id]==null){throw new TypeError('Invalid alternative');}
alternative=this.alternatives[id];}
delete this.alternatives[id];index=this.alternativeList.indexOf(alternative);this.alternativeList.splice(index,1);alternative.setVisible(false);this.contentArea.removeChild(alternative.wrapperElement);if(this.visibleAlt===alternative){if(this.alternativeList.length>0){nextAlternative=this.alternativeList[index];if(!nextAlternative){nextAlternative=this.alternativeList[index-1];}
nextAlternative.setVisible(true);this.visibleAlt=nextAlternative;}else{this.visibleAlt=null;}
this.events.postTransition.dispatch(this,alternative,nextAlternative);}};StyledAlternatives.prototype.clear=function clear(){this.alternatives={};this.alternativeList=[];this.nextAltId=0;this.visibleAlt=null;this.contentArea.innerHTML='';};StyledAlternatives.prototype.getCurrentAlternative=function getCurrentAlternative(){return this.visibleAlt;};StyledAlternatives.prototype.showAlternative=function showAlternative(alternative,options){var command={};if(options==null){options={};}
if(alternative instanceof StyledElements.Alternative){command.id=alternative.getId();if(this.alternatives[command.id]!==alternative){throw new Error('Invalid alternative');}}else{command.id=alternative;if(this.alternatives[command.id]==null){throw new Error('Invalid alternative');}}
command.onComplete=options.onComplete;this.transitionsQueue.addCommand(command);};StyledElements.StyledAlternatives=StyledAlternatives;})();(function(){"use strict";var HorizontalLayout=function HorizontalLayout(options){StyledElements.StyledElement.call(this,[]);this.options=StyledElements.Utils.merge({'class':'','autoHeight':true},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord(this.options['class'],"horizontal_layout");this.west=new StyledElements.Container({'class':'west_container'});this.center=new StyledElements.Container({'class':'center_container'});this.east=new StyledElements.Container({'class':'east_container'});this.west.insertInto(this.wrapperElement);this.center.insertInto(this.wrapperElement);this.east.insertInto(this.wrapperElement);};HorizontalLayout.prototype=new StyledElements.StyledElement();HorizontalLayout.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.repaint();};HorizontalLayout.prototype.repaint=function repaint(temporal){var usableWidth=this.wrapperElement.offsetWidth;var v1=this.west.wrapperElement.offsetWidth;var v2=usableWidth-this.east.wrapperElement.offsetWidth;var centerWidth=v2-v1;if(centerWidth<0){centerWidth=0;}
var height=Math.max(this.west.wrapperElement.offsetHeight,this.center.wrapperElement.offsetHeight,this.east.wrapperElement.offsetHeight);this.center.wrapperElement.style.width=centerWidth+'px';this.center.wrapperElement.style.left=v1+'px';this.east.wrapperElement.style.left=v2+'px';if(this.options.autoHeight){this.wrapperElement.style.height=height+'px';}
this.west.repaint(temporal);this.center.repaint(temporal);this.east.repaint(temporal);};HorizontalLayout.prototype.getWestContainer=function getWestContainer(){return this.west;};HorizontalLayout.prototype.getCenterContainer=function getCenterContainer(){return this.center;};HorizontalLayout.prototype.getEastContainer=function getEastContainer(){return this.east;};StyledElements.HorizontalLayout=HorizontalLayout;})();(function(){"use strict";var BorderLayout=function BorderLayout(options){StyledElements.StyledElement.call(this,[]);options=StyledElements.Utils.merge({'class':''},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"border_layout");this.north=new StyledElements.Container({'class':'north_container'});this.west=new StyledElements.Container({'class':'west_container'});this.center=new StyledElements.Container({'class':'center_container'});this.east=new StyledElements.Container({'class':'east_container'});this.south=new StyledElements.Container({'class':'south_container'});this.north.insertInto(this.wrapperElement);this.west.insertInto(this.wrapperElement);this.center.insertInto(this.wrapperElement);this.east.insertInto(this.wrapperElement);this.south.insertInto(this.wrapperElement);};BorderLayout.prototype=new StyledElements.StyledElement();BorderLayout.prototype.repaint=function repaint(temporal){var usableArea={'width':this.wrapperElement.offsetWidth,'height':this.wrapperElement.offsetHeight};var h1=this.north.wrapperElement.offsetHeight;var h2=usableArea.height-this.south.wrapperElement.offsetHeight;var centerHeight=h2-h1;if(centerHeight<0){centerHeight=0;}
var v1=this.west.wrapperElement.offsetWidth;var v2=usableArea.width-this.east.wrapperElement.offsetWidth;var centerWidth=v2-v1;if(centerWidth<0){centerWidth=0;}
this.west.wrapperElement.style.top=h1+'px';this.west.wrapperElement.style.height=centerHeight+'px';this.center.wrapperElement.style.top=h1+'px';this.center.wrapperElement.style.height=centerHeight+'px';this.center.wrapperElement.style.width=centerWidth+'px';this.center.wrapperElement.style.left=v1+'px';this.east.wrapperElement.style.top=h1+'px';this.east.wrapperElement.style.height=centerHeight+'px';this.east.wrapperElement.style.left=v2+'px';this.south.wrapperElement.style.top=h2+'px';this.north.repaint(temporal);this.west.repaint(temporal);this.center.repaint(temporal);this.east.repaint(temporal);this.south.repaint(temporal);};BorderLayout.prototype.getNorthContainer=function getNorthContainer(){return this.north;};BorderLayout.prototype.getWestContainer=function getWestContainer(){return this.west;};BorderLayout.prototype.getCenterContainer=function getCenterContainer(){return this.center;};BorderLayout.prototype.getEastContainer=function getEastContainer(){return this.east;};BorderLayout.prototype.getSouthContainer=function getSouthContainer(){return this.south;};StyledElements.BorderLayout=BorderLayout;})();(function(){"use strict";var buildHeader=function buildHeader(){var i,column,cell,label;this.pHeaderCells=[];for(i=0;i<this.columns.length;i+=1){column=this.columns[i];if(column.label==null){label=column.field;}else{label=column.label;}
cell=document.createElement('div');cell.className='cell';if(column.width!=null){cell.style.width=column.width;}
cell.textContent=label;if(column.sortable!==false){cell.classList.add('sortable');cell.setAttribute('title',StyledElements.Utils.interpolate(StyledElements.Utils.gettext('Sort by %(column_name)s'),{column_name:label}));cell.callback=this.pSortByColumnCallback.bind({widget:this,column:i});cell.addEventListener('click',cell.callback,true);}
this.header.appendChild(cell);this.pHeaderCells.push(cell);}};var applyWidth=function applyWidth(cell,width){var cellStyle,paddingLeft,paddingRight;cellStyle=document.defaultView.getComputedStyle(cell,null);if(cellStyle.getPropertyCSSValue('display')==null){cell.style.widht='0';return;}
paddingLeft=cellStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);paddingRight=cellStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);cell.style.width=(width-paddingLeft-paddingRight)+'px';};var highlight_selection=function highlight_selection(){if(this._selected_entry_id in this._current_elements){this._current_elements[this._selected_entry_id].row.classList.add('highlight');}};var paintTable=function paintTable(items){var i,j,item,row,cell,callback,today,cellContent,column;this.pClearTable();for(i=0;i<items.length;i+=1){item=items[i];callback=this.pRowCallback.bind({control:this,item:item});row=document.createElement('div');row.className='row';if((i%2)===1){row.classList.add('odd');}
for(j=0;j<this.columns.length;j+=1){column=this.columns[j];cell=document.createElement('div');cell.className='cell';this.columnsCells[j].push(cell);if(typeof column.width==='string'){cell.style.width=column.width;}
if(typeof column['class']==='string'){cell.classList.add(column['class']);}
if(column.contentBuilder){cellContent=column.contentBuilder(item);}else if(column.type==='date'){if(this.pGetFieldValue(item,column.field)===''){cellContent='';}else{if(!today){today=new Date();}
cellContent=this.pFormatDate(item,column.field,today,column.dateparser);}}else if(column.type==='number'){cellContent=this.pGetFieldValue(item,column.field);if(column.unit){cellContent=cellContent+" "+column.unit;}}else{cellContent=this.pGetFieldValue(item,column.field);}
if(!cellContent){cellContent='';}
if(typeof cellContent==='string'){cell.textContent=cellContent;}else if(typeof cellContent==='number'||typeof cellContent==='boolean'){cell.textContent=""+cellContent;}else if(cellContent instanceof StyledElements.StyledElement){cellContent.insertInto(cell);this.pComponents.push(cellContent);}else{cell.appendChild(cellContent);}
cell.addEventListener('click',callback,false);this.pListeners.push({element:cell,callback:callback});row.appendChild(cell);if(typeof this._extract_id==='function'){this._current_elements[this._extract_id(item)]={row:row,data:item};}}
this.tableBody.appendChild(row);}
highlight_selection.call(this);this.resizeColumns();this.resizeColumns();};var ModelTable=function ModelTable(columns,options){var i,column,sort_info,sort_id,defaultOptions;defaultOptions={'initialSortColumn':-1,'pageSize':5};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['click']);this.columns=columns;this.layout=new StyledElements.BorderLayout({'class':'model_table'});this.wrapperElement=this.layout.wrapperElement;this.header=this.layout.getNorthContainer();this.header.addClassName('headrow');buildHeader.call(this);this.pComponents=[];this.pListeners=[];this.tableBody=this.layout.getCenterContainer();this.tableBody.addClassName('tbody');this.statusBar=this.layout.getSouthContainer();this.statusBar.addClassName('statusrow');this.sortColumn=null;if(options.source!=null){this.source=options.source;}else if(options.pagination!=null){this.source=options.pagination;}else{sort_info={};for(i=0;i<columns.length;i+=1){column=columns[i];if(sort_id in column){sort_id=column.sort_id;}else{sort_id=column.field;}
sort_info[sort_id]=column;}
this.source=new StyledElements.StaticPaginatedSource({pageSize:options.pageSize,sort_info:sort_info});}
Object.defineProperty(this,'pagination',{get:function(){return this.source;}});this.paginationInterface=new StyledElements.PaginationInterface(this.source);this.pRefreshBody=this.reload.bind(this);this.source.addEventListener('requestEnd',this.pRefreshBody);this.statusBar.appendChild(this.paginationInterface);if(options.initialSortColumn===-1){for(i=0;i<this.columns.length;i+=1){if(this.columns[i].sortable!==false){options.initialSortColumn=i;break;}}
if(options.initialSortColumn===-1){options.initialSortColumn=null;}}else if(typeof options.initialSortColumn==='string'){for(i=0;i<this.columns.length;i+=1){if(this.columns[i].field===options.initialSortColumn){options.initialSortColumn=i;break;}}
if(typeof options.initialSortColumn==='string'){options.initialSortColumn=null;}}
this.pSortByColumn(options.initialSortColumn,options.initialDescendingOrder);this._current_elements={};if(typeof options.id==='string'){this._extract_id=function(data){return data[options.id];};}else if(typeof options.id==='function'){this._extract_id=options.id;}};ModelTable.prototype=new StyledElements.StyledElement();ModelTable.prototype.repaint=function repaint(){this.layout.repaint();this.resizeColumns();};ModelTable.prototype.select=function select(id){if(this._selected_entry_id!==null){if(this._selected_entry_id in this._current_elements){this._current_elements[this._selected_entry_id].row.classList.remove('highlight');}}
if(id!=null){this._selected_entry_id=id;highlight_selection.call(this);}};ModelTable.prototype.resizeColumns=function resizeColumns(){var i,j,autocells=[],extra_width,autowidth,columnCells;extra_width=this.tableBody.wrapperElement.clientWidth;for(i=0;i<this.columns.length;i+=1){if(typeof this.columns[i].width!=='string'){autocells.push(i);}else{extra_width-=this.pHeaderCells[i].offsetWidth;}}
autowidth=extra_width/autocells.length;for(i=0;i<autocells.length;i+=1){columnCells=this.columnsCells[autocells[i]];applyWidth(this.pHeaderCells[autocells[i]],autowidth);for(j=0;j<columnCells.length;j+=1){applyWidth(columnCells[j],autowidth);}}
for(i=0;i<this.pComponents.length;i+=1){this.pComponents[i].repaint();}};ModelTable.prototype.pSortByColumn=function pSortByColumn(column,descending){var sort_id,order,oldSortHeaderCell,sortHeaderCell;if(this.sortColumn!=null){oldSortHeaderCell=this.pHeaderCells[this.sortColumn];oldSortHeaderCell.classList.remove('ascending');oldSortHeaderCell.classList.remove('descending');}
this.sortInverseOrder=descending;this.sortColumn=column;if(this.sortColumn!=null){sortHeaderCell=this.pHeaderCells[this.sortColumn];if(this.sortInverseOrder){sortHeaderCell.classList.remove('ascending');sortHeaderCell.classList.add('descending');}else{sortHeaderCell.classList.remove('descending');sortHeaderCell.classList.add('ascending');}
column=this.columns[this.sortColumn];if(column.sort_id!=null){sort_id=column.sort_id;}else{sort_id=column.field;}
if(this.sortInverseOrder){sort_id='-'+sort_id;}
order=[sort_id];}else{order=null;}
this.source.changeOptions({order:order});};ModelTable.prototype.pSortByColumnCallback=function pSortByColumnCallback(){var descending=this.widget.sortColumn===this.column?!this.widget.sortInverseOrder:false;this.widget.pSortByColumn(this.column,descending);};ModelTable.prototype.pGetFieldValue=function pGetFieldValue(item,field){var fieldPath,currentNode,currentField;if(typeof field==="string"){fieldPath=[field];}else{fieldPath=field.slice();}
currentNode=item;while(currentNode!==null&&fieldPath.length>0){currentField=fieldPath.splice(0,1)[0];currentNode=currentNode[currentField];}
if(currentNode===null||fieldPath.length>0){return"";}
return currentNode;};ModelTable.prototype.pFormatDate=function pFormatDate(item,field,today,dateparser){var date,formatedDate,sameDay,shortVersion,fullVersion,element;date=this.pGetFieldValue(item,field);if(typeof dateparser==='function'){formatedDate=dateparser(date);}else{formatedDate=new Date(date);}
formatedDate.locale='es';sameDay=(formatedDate.getDate()===today.getDate())&&(formatedDate.getMonth()===today.getMonth())&&(formatedDate.getFullYear()===today.getFullYear());if(sameDay){shortVersion=formatedDate.strftime('%R');}else{shortVersion=formatedDate.strftime('%x');}
fullVersion=formatedDate.strftime('%c');element=document.createElement('span');element.textContent=shortVersion;element.setAttribute('title',fullVersion);return element;};ModelTable.prototype.pRowCallback=function pRowCallback(){this.control.events.click.dispatch(this.item);};ModelTable.prototype.pClearTable=function pClearTable(){var i,entry;for(i=0;i<this.pListeners.length;i+=1){entry=this.pListeners[i];entry.element.removeEventListener('click',entry.callback,false);}
this.pComponents=[];this.pListeners=[];this.columnsCells=[];for(i=0;i<this.columns.length;i+=1){this.columnsCells[i]=[];}
this.tableBody.clear();this._current_elements={};};ModelTable.prototype.reload=function reload(){paintTable.call(this,this.source.getCurrentPage());};ModelTable.prototype.insertInto=function insertInto(){StyledElements.StyledElement.prototype.insertInto.apply(this,arguments);this.repaint();};ModelTable.prototype.destroy=function destroy(){var i,cell;for(i=0;i<this.pHeaderCells.length;i+=1){cell=this.pHeaderCells[i];if(cell.callback){cell.removeEventListener('click',cell.callback,true);cell.callback=null;}}
this.pClearTable();this.layout.destroy();this.layout=null;this.paginationInterface.destroy();this.paginationInterface=null;this.source.destroy();this.source=null;this.pRefreshBody=null;};StyledElements.ModelTable=ModelTable;})();(function(){"use strict";var onFocus=function onFocus(e){var range=document.createRange();range.selectNodeContents(this.wrapperElement);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);document.addEventListener('mousedown',this._onBlur,false);};var onKeydown=function onKeydown(e){if(e.keyCode===13){this._onBlur();}};var onBlur=function onBlur(e){if(!this.wrapperElement.hasAttribute('contenteditable')){return;}
document.removeEventListener('mousedown',this._onBlur,false);this.events.change.dispatch(this,this.wrapperElement.textContent);this.disableEdition();};var EditableElement=function EditableElement(options){StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement('span');this.wrapperElement.textContent=options.initialContent;this._onFocus=onFocus.bind(this);this._onKeydown=onKeydown.bind(this);this._onBlur=onBlur.bind(this);this.wrapperElement.addEventListener('focus',this._onFocus,true);this.wrapperElement.addEventListener('keydown',this._onKeydown,true);this.wrapperElement.addEventListener('blur',this._onBlur,true);};EditableElement.prototype=new StyledElements.StyledElement();EditableElement.prototype.disableEdition=function disableEdition(){if(this.wrapperElement.hasAttribute('contenteditable')){this.wrapperElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeAttribute('contenteditable');this.wrapperElement.blur();this.wrapperElement.scrollLeft=0;this.wrapperElement.scrollTop=0;}};EditableElement.prototype.enableEdition=function enableEdition(){if(!this.wrapperElement.hasAttribute('contenteditable')){this.wrapperElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.setAttribute('contenteditable','true');}
this.wrapperElement.focus();};EditableElement.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('focus',this._onFocus,true);this.wrapperElement.removeEventListener('keydown',this._onKeydown,true);this.wrapperElement.removeEventListener('blur',this._onBlur,true);this._onFocus=null;this._onKeydown=null;this._onBlur=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.EditableElement=EditableElement;})();(function(){"use strict";var HiddenField=function HiddenField(options){var defaultOptions={'initialValue':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,[]);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],'styled_hidden_field');this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","hidden");if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this.wrapperElement.appendChild(this.inputElement);};HiddenField.prototype=new StyledElements.StyledInputElement();StyledElements.HiddenField=HiddenField;})();(function(){"use strict";var ButtonsGroup=function ButtonsGroup(name){StyledElements.StyledInputElement.call(this,"",['change']);Object.defineProperty(this,'name',{value:name});this.buttons=[];};ButtonsGroup.prototype=new StyledElements.StyledInputElement();ButtonsGroup.prototype.insertButton=function insertButton(button){this.buttons[this.buttons.length]=button;button.addEventListener('change',function(){this.events.change.dispatch(this);}.bind(this));return this;};ButtonsGroup.prototype.getValue=function getValue(){var i,result=[];if(this.buttons[0]instanceof StyledElements.StyledCheckBox){for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){result.push(this.buttons[i].getValue());}}}else{for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){return[this.buttons[i].getValue()];}}}
return result;};ButtonsGroup.prototype.setValue=function setValue(newValue){if(newValue==null){newValue=[];}else if(typeof newValue==='string'){newValue=[newValue];}
for(var i=0;i<this.buttons.length;i++){if(newValue.indexOf(this.buttons[i].inputElement.value)!==-1){this.buttons[i].setValue(true);}else{this.buttons[i].setValue(false);}}
return this;};ButtonsGroup.prototype.reset=function reset(){for(var i=0;i<this.buttons.length;i++){this.buttons[i].reset();}
return this;};ButtonsGroup.prototype.getSelectedButtons=function getSelectedButtons(){var i;if(this.buttons.length===0){return[];}
if(this.buttons[0]instanceof StyledElements.StyledCheckBox){var result=[];for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){result[result.length]=this.buttons[i];}}
return result;}else{for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){return[this.buttons[i]];}}
return[];}};StyledElements.ButtonsGroup=ButtonsGroup;})();(function(){"use strict";var CheckBox=function StyledCheckBox(options){var defaultOptions={'initialValue':false,'class':'','group':null,'secondInput':null,'value':true};options=StyledElements.Utils.merge(defaultOptions,options);if('initiallyChecked'in options){options.initialValue=options.initiallyChecked;}
StyledElements.StyledInputElement.call(this,options.initialValue,['change']);this.wrapperElement=document.createElement("input");this.wrapperElement.className='checkbox';this.wrapperElement.setAttribute("type","checkbox");this.inputElement=this.wrapperElement;if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.value=options.value;this.inputElement.setAttribute("value",options.value);this.secondInput=options.secondInput;this.setValue(options.initialValue);if(options.group instanceof StyledElements.ButtonsGroup){this.wrapperElement.setAttribute("name",options.group.name);options.group.insertButton(this);}else if(typeof options.group==='string'){this.wrapperElement.setAttribute("name",options.group);}
this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('change',function(){if(this.enabled){if(this.secondInput!=null){this.secondInput.setDisabled(!this.inputElement.checked);}
this.events.change.dispatch(this);}}.bind(this),true);};CheckBox.prototype=new StyledElements.StyledInputElement();CheckBox.prototype.reset=function reset(){this.setValue(this.defaultValue);};CheckBox.prototype.getValue=function getValue(){if(this.value===true&&this.secondInput==null){return this.inputElement.checked;}else if(this.secondInput==null){return this.inputElement.checked?this.value:null;}else{return this.secondInput.getValue();}};CheckBox.prototype.setValue=function setValue(newValue){this.inputElement.checked=newValue!=null&&newValue!==false;if(this.secondInput!=null){this.secondInput.setDisabled(!this.inputElement.checked);if(this.inputElement.checked){this.secondInput.setValue(newValue);}}};StyledElements.StyledCheckBox=CheckBox;})();(function(){"use strict";var StyledRadioButton=function StyledRadioButton(options){var defaultOptions={'initiallyChecked':false,'class':'','group':null,'value':null};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initiallyChecked,['change']);this.wrapperElement=document.createElement("input");this.wrapperElement.setAttribute("type","radio");if(options.value!=null){this.wrapperElement.setAttribute("value",options.value);}
this.inputElement=this.wrapperElement;if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
if(options.initiallyChecked===true){this.inputElement.setAttribute("checked",true);}
if(options.group instanceof StyledElements.ButtonsGroup){this.wrapperElement.setAttribute("name",options.group.name);options.group.insertButton(this);}else if(typeof options.group==='string'){this.wrapperElement.setAttribute("name",options.group);}
this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('change',function(){if(this.enabled){this.events.change.dispatch(this);}}.bind(this),true);};StyledRadioButton.prototype=new StyledElements.StyledInputElement();StyledRadioButton.prototype.insertInto=function insertInto(element,refElement){var checked=this.inputElement.checked;StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.inputElement.checked=checked;};StyledRadioButton.prototype.reset=function reset(){this.inputElement.checked=this.defaultValue;return this;};StyledRadioButton.prototype.setValue=function setValue(newValue){this.inputElement.checked=newValue;return this;};StyledElements.StyledRadioButton=StyledRadioButton;})();(function(){"use strict";var InputInterface=function InputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.StyledElement.call(this,[]);options.name=fieldId;this._fieldId=fieldId;this._initialValue=options.initialValue;this._defaultValue=options.defaultValue;this._label=options.label;Object.defineProperty(this,'required',{value:'required'in options?!!options.required:false});this._readOnly=!!options.readOnly;this._hidden=!!options.hidden;if(options.description){this._description=options.description;}else{this._description=options.label;}};InputInterface.prototype=new StyledElements.StyledElement();InputInterface.prototype.repaint=function repaint(){this.inputElement.repaint();};InputInterface.prototype.getValue=function getValue(){return this.inputElement.getValue();};InputInterface.prototype.setValue=function setValue(newValue){if(this.isValidValue(newValue)){this._setValue(newValue);}};InputInterface.prototype.getLabel=function getLabel(){return this._label;};InputInterface.prototype.getDescription=function getDescription(){return this._description;};InputInterface.prototype.getDefaultValue=function getDefaultValue(){return this._defaultValue;};InputInterface.prototype.isEmpty=function isEmpty(){return this._isEmptyValue(this.getValue());};InputInterface.prototype._isEmptyValue=function _isEmptyValue(value){return value===""||value==null;};InputInterface.prototype._normalize=function _normalize(value){if(value==null){return"";}else{return(""+value).trim();}};InputInterface.prototype._checkValue=function _checkValue(newValue){return InputValidationError.NO_ERROR;};InputInterface.prototype.checkValue=function checkValue(newValue){if(newValue===undefined){newValue=this.getValue();}else{newValue=this._normalize(newValue);}
if(!(this instanceof SelectInputInterface)){if(this.required&&this._isEmptyValue(newValue)){return InputValidationError.REQUIRED_ERROR;}
if(!this.required&&this._isEmptyValue(newValue)){return InputValidationError.NO_ERROR;}}
return this._checkValue(newValue);};InputInterface.prototype.isValidValue=function isValidValue(newValue){return this.checkValue(newValue)===InputValidationError.NO_ERROR;};InputInterface.prototype._setValue=function _setValue(newValue){newValue=this._normalize(newValue);this.inputElement.setValue(newValue);};InputInterface.prototype._setError=function _setError(error){if(error){this.inputElement.wrapperElement.classList.add('error');}else{this.inputElement.wrapperElement.classList.remove('error');}};InputInterface.prototype.resetToDefault=function resetToDefault(){this._setError(false);this._setValue(this._defaultValue);};InputInterface.prototype.reset=function reset(){this._setError(false);this._setValue(this._initialValue);};InputInterface.prototype.focus=function focus(){this.inputElement.focus();};InputInterface.prototype.setDisabled=function setDisabled(disable){this.inputElement.setDisabled(this._readOnly||disable);};InputInterface.prototype.enable=function enable(){this.setDisabled(false);};InputInterface.prototype.disable=function disable(){this.setDisabled(true);};InputInterface.prototype.insertInto=function insertInto(element){this.inputElement.insertInto(element);};InputInterface.prototype.assignDefaultButton=function assignDefaultButton(button){};StyledElements.InputInterface=InputInterface;})();"use strict";var ValidationErrorManager,InputValidationError={};InputValidationError.NO_ERROR=0;InputValidationError.REQUIRED_ERROR=1;InputValidationError.URL_ERROR=2;InputValidationError.EMAIL_ERROR=3;InputValidationError.ID_ERROR=4;InputValidationError.COLOR_ERROR=5;InputValidationError.BOOLEAN_ERROR=6;InputValidationError.VERSION_ERROR=7;InputValidationError.OUT_OF_RANGE_ERROR=8;var ValidationErrorManager=function ValidationErrorManager(){this.fieldsWithErrorById={};};ValidationErrorManager.prototype._addValidationError=function _addValidationError(errorCode,fieldName){if(this.fieldsWithErrorById[errorCode]===undefined){this.fieldsWithErrorById[errorCode]=[];}
this.fieldsWithErrorById[errorCode].push(fieldName);};ValidationErrorManager.prototype.validate=function validate(field){var errorCode=field.checkValue();if(errorCode!==InputValidationError.NO_ERROR){field._setError(true);this._addValidationError(errorCode,field.getLabel());}else{field._setError(false);}};ValidationErrorManager.prototype._buildErrorMsg=function _buildErrorMsg(errorCode){var msg,fields,i;errorCode=parseInt(errorCode,10);switch(errorCode){case InputValidationError.REQUIRED_ERROR:msg="The following required fields are empty: %(fields)s.";break;case InputValidationError.URL_ERROR:msg="The following fields do not contain a valid URL: %(fields)s.";break;case InputValidationError.EMAIL_ERROR:msg="The following fields do not contain a valid E-Mail address: %(fields)s.";break;case InputValidationError.VERSION_ERROR:msg="The following field do not contain a valid version number: %(fields)s.";break;case InputValidationError.ID_ERROR:msg="The following fields contain invalid characters: %(fields)s.";break;case InputValidationError.COLOR_ERROR:msg="The following fields do not contain a valid color value: %(fields)s.";break;case InputValidationError.OUT_OF_RANGE_ERROR:msg="The following fields does contain an out of range value: %(fields)s.";break;}
fields="";for(i=0;i<this.fieldsWithErrorById[errorCode].length;i+=1){fields+=", "+this.fieldsWithErrorById[errorCode][i];}
fields=fields.substring(2);return StyledElements.Utils.interpolate(msg,{'fields':fields});};ValidationErrorManager.prototype.toHTML=function toHTML(){var errorCode,errorMsgs=[];for(errorCode in this.fieldsWithErrorById){if(this.fieldsWithErrorById.hasOwnProperty(errorCode)){errorMsgs.push(this._buildErrorMsg(errorCode));}}
return errorMsgs;};function TextInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledTextField(options);}
TextInputInterface.prototype=new StyledElements.InputInterface();TextInputInterface.parse=function parse(value){return value;};TextInputInterface.stringify=function stringify(value){return value;};TextInputInterface.prototype.assignDefaultButton=function assignDefaultButton(button){this.inputElement.addEventListener('submit',function(){button.click();});};function PasswordInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledPasswordField(options);}
PasswordInputInterface.prototype=new StyledElements.InputInterface();PasswordInputInterface.parse=TextInputInterface.parse;PasswordInputInterface.stringify=TextInputInterface.stringify;function ListInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledList(options);}
ListInputInterface.prototype=new StyledElements.InputInterface();ListInputInterface.prototype.parse=function parse(value){return JSON.parse(value);};ListInputInterface.prototype.stringify=function stringify(value){return JSON.stringify(value);};ListInputInterface.prototype._normalize=function _normalize(value){if(!Array.isArray(value)){value=[];}};ListInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.cleanSelection();this.inputElement.addSelection(newValue);};ListInputInterface.prototype.getValue=function getValue(){return this.inputElement.getSelection();};ListInputInterface.prototype.isEmpty=function isEmpty(){return this.getValue().length===0;};function NumberInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledNumericField(options);}
NumberInputInterface.prototype=new StyledElements.InputInterface();NumberInputInterface.parse=function parse(value){return Number(value);};NumberInputInterface.prototype._normalize=function _normalize(value){return Number(value);};NumberInputInterface.prototype._checkValue=function _checkValue(newValue){if(!Number.isFinite(newValue)||newValue<this.inputElement.options.min||newValue>this.inputElement.options.max){return InputValidationError.OUT_OF_RANGE_ERROR;}
return InputValidationError.NO_ERROR;};function LongTextInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledTextArea(options);}
LongTextInputInterface.prototype=new StyledElements.InputInterface();LongTextInputInterface.parse=TextInputInterface.parse;LongTextInputInterface.stringify=TextInputInterface.stringify;var URLInputInterface=function URLInputInterface(fieldId,options){if(arguments.length===0){return;}
TextInputInterface.call(this,fieldId,options);};URLInputInterface.prototype=new TextInputInterface();URLInputInterface.parse=TextInputInterface.parse;URLInputInterface.stringify=TextInputInterface.stringify;URLInputInterface.prototype._URLChecker=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;URLInputInterface.prototype._checkValue=function _checkValue(newValue){return this._URLChecker.test(newValue)?InputValidationError.NO_ERROR:InputValidationError.URL_ERROR;};function EMailInputInterface(fieldId,options){TextInputInterface.call(this,fieldId,options);}
EMailInputInterface.prototype=new TextInputInterface();EMailInputInterface.prototype._EMailChecker=/[\w\d][\w\-]*@[\w\d\-]+\.[\w\d]+/;EMailInputInterface.prototype._checkValue=function _checkValue(newValue){return this._EMailChecker.test(newValue)?InputValidationError.NO_ERROR:InputValidationError.EMAIL_ERROR;};function BooleanInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);if(typeof options.initialValue==='string'){options.initiallyChecked=options.initialValue.toLowerCase()==='true';}else if(typeof options.initialValue==='boolean'){options.initiallyChecked=options.initialValue;}
this.inputElement=new StyledElements.StyledCheckBox(options);}
BooleanInputInterface.prototype=new StyledElements.InputInterface();BooleanInputInterface.parse=function parse(value){return(""+value).trim().toLowerCase()==='true';};BooleanInputInterface.stringify=function stringify(value){return""+value;};BooleanInputInterface.prototype.isEmpty=function isEmpty(){return false;};BooleanInputInterface.prototype._normalize=function _normalize(value){return!!value;};BooleanInputInterface.prototype._checkValue=function _checkValue(newValue){return(typeof newValue==='boolean')?InputValidationError.NO_ERROR:InputValidationError.BOOLEAN_ERROR;};function SelectInputInterface(fieldId,desc){if(!('required'in desc)){desc.required=true;}
StyledElements.InputInterface.call(this,fieldId,desc);if(typeof desc.entries==='function'){this._update=desc.entries;}else if(desc.initialEntries&&!this.required){var i,found=false;for(i=0;i<desc.initialEntries.length;i+=1){if(this._isEmptyValue(desc.initialEntries[i].value)){found=true;break;}}
if(!found){desc.initialEntries=[{label:'---------',value:null}].concat(desc.initialEntries);}}
this.inputElement=new StyledElements.StyledSelect(desc);}
SelectInputInterface.prototype=new StyledElements.InputInterface();SelectInputInterface.parse=function parse(value){return value;};SelectInputInterface.stringify=function stringify(value){return""+value;};SelectInputInterface.prototype._setValue=function _setValue(newValue){var entries;if(this._update){this.inputElement.clear();entries=this._update();if(!this.required){entries=[{label:'---------',value:null}].concat(entries);}
this.inputElement.addEntries(entries);}
this.inputElement.setValue(newValue);};SelectInputInterface.prototype._checkValue=function _checkValue(newValue){var newValueId;if(typeof newValue!=='string'){try{newValueId=this.inputElement.idFunc(newValue);}catch(e){}}else{newValueId=newValue;}
if(typeof newValueId!=='string'||!(newValueId in this.inputElement.optionValues)){return InputValidationError.OUT_OF_RANGE_ERROR;}else{return InputValidationError.NO_ERROR;}};function HiddenInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledHiddenField(options);}
HiddenInputInterface.prototype=new StyledElements.InputInterface();function ButtonGroupInputInterface(fieldId,fieldDesc){var ButtonClass,buttonDesc,i,button,label;if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,fieldDesc);this.inputElement=new StyledElements.ButtonsGroup(fieldId);this.wrapperElement=document.createElement('div');this.wrapperElement.className='button_group';switch(fieldDesc.kind){case'radio':ButtonClass=StyledElements.StyledRadioButton;break;case'checkbox':ButtonClass=StyledElements.StyledCheckBox;break;default:throw new Error();}
for(i=0;i<fieldDesc.buttons.length;i+=1){buttonDesc=fieldDesc.buttons[i];label=document.createElement('label');label.className=fieldDesc.kind;button=new ButtonClass({group:this.inputElement,value:buttonDesc.value,secondInput:buttonDesc.secondInput});button.insertInto(label);label.appendChild(document.createTextNode(buttonDesc.label));if(buttonDesc.secondInput){buttonDesc.secondInput.insertInto(label);}
this.wrapperElement.appendChild(label);}
if('initialValue'in fieldDesc){this.inputElement.setValue(fieldDesc.initialValue);}}
ButtonGroupInputInterface.prototype=new StyledElements.InputInterface();ButtonGroupInputInterface.prototype.insertInto=function insertInto(element){element.appendChild(this.wrapperElement);};ButtonGroupInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.setValue(newValue);};ButtonGroupInputInterface.prototype._setError=function _setError(error){};function FileInputInterface(fieldId,fieldDesc){StyledElements.InputInterface.call(this,fieldId,fieldDesc);this.inputElement=new StyledElements.StyledFileField(fieldDesc);}
FileInputInterface.prototype=new StyledElements.InputInterface();FileInputInterface.prototype.getValue=function getValue(){return this.inputElement.getValue();};FileInputInterface.prototype._setValue=function _setValue(newValue){};FileInputInterface.prototype._setError=function _setError(error){};FileInputInterface.prototype.setDisabled=function setDisabled(disable){this.inputElement.disabled=!!disable;};function MultivaluedInputInterface(fieldId,fieldDesc){this.entries=[];this.fields=fieldDesc.fields;this.wrapperElement=new StyledElements.Container();this._addEntry();}
MultivaluedInputInterface.prototype=new StyledElements.InputInterface();MultivaluedInputInterface.prototype._addEntry=function _addEntry(){var entry,fields;entry={};entry.wrapper=document.createElement('div');fields={'':{type:'lineLayout',fields:this.fields}};entry.form=new Form(fields,{useHtmlForm:false,acceptButton:false,cancelButton:false,legend:false});entry.form.wrapperElement.style.display="inline-block";entry.form.wrapperElement.style.verticalAlign="middle";entry.form.insertInto(entry.wrapper);entry.addRowButton=new StyledElements.StyledButton({text:'+'});entry.addRowButton.addEventListener('click',function(){this._addEntry();}.bind(this));entry.addRowButton.insertInto(entry.wrapper);entry.removeRowButton=new StyledElements.StyledButton({text:'-'});entry.removeRowButton.addEventListener('click',function(){this.control._removeEntry(entry);}.bind({control:this,entry:entry}));entry.removeRowButton.insertInto(entry.wrapper);this.entries.push(entry);this.wrapperElement.appendChild(entry.wrapper);return entry;};MultivaluedInputInterface.prototype._removeEntry=function _removeEntry(entry){var index;this.wrapperElement.removeChild(entry.wrapper);index=this.entries.indexOf(entry);this.entries.splice(index,1);entry.form.destroy();if(this.entries.length===0){this._addEntry();}};MultivaluedInputInterface.prototype._removeAllEntries=function _removeAllEntries(){var i,entry;for(i=0;i<this.entries.length;i+=1){entry=this.entries[i];this.wrapperElement.removeChild(entry.wrapper);entry.form.destroy();}
this.entries=[];};MultivaluedInputInterface.prototype.getValue=function getValue(){var i,data=[];for(i=0;i<this.entries.length;i+=1){data.push(this.entries[i].form.getData());}
return data;};MultivaluedInputInterface.prototype._setValue=function _setValue(newValue){var i,entry;this._removeAllEntries();if(!(newValue instanceof Array)){newValue=[];}
for(i=0;i<newValue.length;i+=1){entry=this._addEntry();entry.form.setData(newValue[i]);}
if(this.entries.length===0){this._addEntry();}};MultivaluedInputInterface.prototype._setError=function _setError(error){};var FieldSetInterface=function FieldSetInterface(fieldId,fieldDesc,factory){this.form=new Form(fieldDesc.fields,{factory:factory,useHtmlForm:false,acceptButton:false,cancelButton:false,legend:false});};FieldSetInterface.prototype=new StyledElements.InputInterface();FieldSetInterface.prototype.repaint=function repaint(){return this.form.repaint();};FieldSetInterface.prototype.insertInto=function insertInto(element){this.form.insertInto(element);};FieldSetInterface.prototype.getValue=function getValue(){return this.form.getData();};FieldSetInterface.prototype._setValue=function _setValue(newValue){return this.form.setData(newValue);};FieldSetInterface.prototype._setError=function _setError(error){};function ParametrizedTextInputInterface(fieldId,options){var i,param,option;StyledElements.InputInterface.call(this,fieldId,options);this.variable=options.variable;this.parameters=this.getAvailableParameters();this.wrapperElement=new StyledElements.Container({'class':'parametrized_text_input'});this.resetButton=new StyledElements.StyledButton({'text':StyledElements.Utils.gettext('Use current value')});this.resetButton.addEventListener('click',function(){this.inputElement.setValue(this.escapeValue(this.variable.value));}.bind(this));this.wrapperElement.appendChild(this.resetButton);this.selectorWrapperElement=new StyledElements.Container({'class':'context_selector'});this.wrapperElement.appendChild(this.selectorWrapperElement);this.mainSelect=document.createElement('select');for(i=0;i<this.parameters.length;i+=1){param=this.parameters[i];option=new Option(param.label,param.value);try{this.mainSelect.add(option,null);}catch(e){this.mainSelect.add(option);}}
this.mainSelect.addEventListener('change',this._updateSecondSelect.bind(this),true);this.selectorWrapperElement.appendChild(this.mainSelect);this.secondSelect=document.createElement('select');this.selectorWrapperElement.appendChild(this.secondSelect);this.secondSelect.addEventListener('change',this._updateDescription.bind(this),true);this.addButton=new StyledElements.StyledButton({'text':StyledElements.Utils.gettext('Add')});this.addButton.addEventListener('click',function(){var prefix,suffix,parameter,start,input;input=this.inputElement.inputElement;start=input.selectionStart;prefix=input.value.substr(0,start);suffix=input.value.substr(input.selectionEnd);parameter=this.mainSelect.value+'.'+this.secondSelect.value;this.inputElement.setValue(prefix+'%('+parameter+')'+suffix);input.selectionStart=start;input.selectionEnd=start+parameter.length+3;}.bind(this));this.selectorWrapperElement.appendChild(this.addButton);this.descriptionDiv=document.createElement('div');this.descriptionDiv.className='description';this.wrapperElement.appendChild(this.descriptionDiv);this.inputElement=new StyledElements.StyledTextArea();this.wrapperElement.appendChild(this.inputElement);this._updateSecondSelect();}
ParametrizedTextInputInterface.prototype=new StyledElements.InputInterface();ParametrizedTextInputInterface.prototype._ESCAPE_RE=new RegExp("(%+)(\\([a-zA-Z]\\w*(?:\\.[a-zA-Z]\\w*)*\\))");ParametrizedTextInputInterface.prototype._ESCAPE_FUNC=function(){var str,i;i=arguments[1].length*2;str='';while((i-=1)>=0){str+='%';}
return str+arguments[2];};ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS=null;ParametrizedTextInputInterface.prototype.getAvailableParameters=function getAvailableParameters(){var concepts,contextFields,conceptName,dashIndex,provider,concept,parameters,label;if(ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS===null){concepts=Wirecloud.activeWorkspace.contextManager._concepts;contextFields={'':[]};for(conceptName in concepts){concept=concepts[conceptName];dashIndex=conceptName.indexOf('-');provider=conceptName.substring(0,dashIndex);if(!(provider in contextFields)){contextFields[provider]=[];}
label=interpolate('%(label)s (%(concept)s)',{label:concept._label,concept:conceptName},true);contextFields[provider].push({label:label,description:concept._description,value:conceptName});}
parameters=[{label:StyledElements.Utils.gettext('User'),value:'user',fields:[{label:StyledElements.Utils.gettext('User Name'),description:'',value:'username'},{label:StyledElements.Utils.gettext('First Name'),description:'',value:'first_name'},{label:StyledElements.Utils.gettext('Last Name'),description:'',value:'last_name'}]},{label:StyledElements.Utils.gettext('Context'),value:'context',fields:contextFields['']}];delete contextFields[''];for(conceptName in contextFields){parameters.push({label:conceptName,value:'context',fields:contextFields[conceptName]});}
ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS=parameters;}
return ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS;};ParametrizedTextInputInterface.prototype.escapeValue=function escapeValue(value){switch(typeof value){case"number":case"boolean":value=value.toString();break;default:if(value==null){value="";}}
return value.replace(ParametrizedTextInputInterface.prototype._ESCAPE_RE,ParametrizedTextInputInterface.prototype._ESCAPE_FUNC);};ParametrizedTextInputInterface.prototype._updateSecondSelect=function _updateSecondSelect(){var fields,field,i;this.secondSelect.innerHTML='';fields=this.parameters[this.mainSelect.selectedIndex].fields;for(i=0;i<fields.length;i+=1){field=fields[i];try{this.secondSelect.add(new Option(field.label,field.value),null);}catch(e){this.secondSelect.add(new Option(field.label,field.value));}}
this._updateDescription();};ParametrizedTextInputInterface.prototype._updateDescription=function _updateDescription(){var fields,field;fields=this.parameters[this.mainSelect.selectedIndex].fields;field=fields[this.secondSelect.selectedIndex];this.descriptionDiv.textContent=field.description;};ParametrizedTextInputInterface.prototype._setError=function _setError(){};ParametrizedTextInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.value=newValue;if(this.update){this.update();}};ParametrizedTextInputInterface.prototype.setDisabled=function setDisabled(disabled){this.mainSelect.disabled=!!disabled;this.secondSelect.disabled=!!disabled;this.addButton.setDisabled(disabled);this.resetButton.setDisabled(disabled);this.inputElement.setDisabled(disabled);};ParametrizedTextInputInterface.prototype.insertInto=function insertInto(element){this.wrapperElement.insertInto(element);};(function(){"use strict";var VALID_SOURCE_VALUES=['current','default','custom'];var VALID_STATUS_VALUES=['normal','hidden','readonly'];var updateInputElement=function updateInputElement(){switch(this.source){case'default':this.inputElement.setValue('');break;case'current':this.inputElement.setValue(ParametrizedTextInputInterface.prototype.escapeValue(this.variable.value));break;case'custom':this.inputElement.setValue(this.value);}};var updateButton=function updateButton(){if(this.source==='default'){this.buttonElement.setLabel(gettext('Parametrize'));}else{this.buttonElement.setLabel(gettext('Modify'));}
if(this.status!=='normal'){this.readOnlyIcon.classList.add('readOnly');this.readOnlyIcon.title=gettext("This value won't be editable by the user");}else{this.readOnlyIcon.classList.remove('readOnly');this.readOnlyIcon.title=gettext("This value will be editable by the user");}
if(this.status!=='hidden'){this.visibilityIcon.classList.add('visible');this.visibilityIcon.title=gettext("This value will be visible to the user");}else{this.visibilityIcon.classList.remove('visible');this.visibilityIcon.title=gettext("This value won't be visible to the user");}};var ParametrizableValueInputInterface=function ParametrizableValueInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.parentWindow=options.parentWindow;this.variable=options.variable;this.canBeHidden=options.canBeHidden;this.wrapperElement=document.createElement('div');this.wrapperElement.className="parametrizable_input";this.readOnlyIcon=document.createElement('div');this.readOnlyIcon.className='readOnlyIcon';this.wrapperElement.appendChild(this.readOnlyIcon);this.visibilityIcon=document.createElement('div');this.visibilityIcon.className='visibilityIcon';this.wrapperElement.appendChild(this.visibilityIcon);if(!this.canBeHidden){this.visibilityIcon.style.visibility='hidden';}
this.inputElement=new StyledElements.StyledTextField();this.inputElement.disable();this.inputElement.insertInto(this.wrapperElement);this.buttonElement=new StyledElements.StyledButton({text:''});this.buttonElement.addEventListener('click',function(){var dialog=new Wirecloud.ui.ParametrizeWindowMenu(this);dialog.show(this.parentWindow);dialog.setValue(this.getValue());}.bind(this));this.buttonElement.insertInto(this.wrapperElement);};ParametrizableValueInputInterface.prototype=new StyledElements.InputInterface();ParametrizableValueInputInterface.prototype._checkValue=function _checkValue(newValue){return InputValidationError.NO_ERROR;};ParametrizableValueInputInterface.prototype.getValue=function getValue(){var value={'source':this.source,'status':this.status};if(this.source!=='default'){value.value=this.inputElement.getValue();}
return value;};ParametrizableValueInputInterface.prototype._setValue=function _setValue(newValue){if(newValue==null||VALID_SOURCE_VALUES.indexOf(newValue.source)===-1){this.source='current';}else{this.source=newValue.source;}
if(newValue==null||typeof newValue.value!=='string'){this.value='';}else{this.value=newValue.value;}
if(newValue==null||VALID_STATUS_VALUES.indexOf(newValue.status)===-1){this.status='normal';}else if(!this.canBeHidden&&newValue.status==='hidden'){this.status='readOnly';}else{this.status=newValue.status;}
updateInputElement.call(this);updateButton.call(this);};ParametrizableValueInputInterface.prototype.insertInto=function insertInto(element){element.appendChild(this.wrapperElement);};Wirecloud.ui.ParametrizableValueInputInterface=ParametrizableValueInputInterface;})();(function(){"use strict";var LAYOUT_FIELDS_MAPPING={'columnlayout':[{"name":"smart","defaultValue":true,"label":gettext("Smart"),"type":"boolean","description":gettext("Widgets will tend to be placed on the topmost position available if this option is enabled. (default: enabled)")},{"name":"columns","min":1,"max":200,"defaultValue":20,"label":gettext("Columns"),"type":"number","description":gettext("Grid columns. (default: 20 columns)")},{"name":"cellheight","min":7,"max":1024,"defaultValue":13,"label":gettext("Row Height (in pixels)"),"type":"number","description":gettext("Row/cell height. Must be specified in pixel units. (default: 13px)")},{"name":"horizontalmargin","min":0,"defaultValue":4,"label":gettext("Horizontal Margin between widgets (in pixels)"),"type":"number","description":gettext("Horizontal Margin between widgets. Must be specified in pixel units. (default: 4px)")},{"name":"verticalmargin","min":0,"defaultValue":3,"label":gettext("Vertical Margin between widgets (in pixels)"),"type":"number","description":gettext("Vertical margin between widgets. Must be specified in pixel units. (default: 3px)")}],'gridlayout':[{"name":"columns","min":1,"max":200,"defaultValue":20,"label":gettext("Columns"),"type":"number","description":gettext("Grid columns. (default: 12 columns)")},{"name":"rows","min":1,"max":200,"defaultValue":6,"label":gettext("Rows"),"type":"number","description":gettext("Grid rows (default: 6 rows)")},{"name":"horizontalmargin","min":0,"defaultValue":4,"label":gettext("Horizontal Margin between widgets (in pixels)"),"type":"number","description":gettext("Horizontal Margin between widgets. Must be specified in pixel units. (default: 4px)")},{"name":"verticalmargin","min":0,"defaultValue":3,"label":gettext("Vertical Margin between widgets (in pixels)"),"type":"number","description":gettext("Vertical Margin between widgets. Must be specified in pixel units. (default: 3px)")}]};var updateLayoutSummary=function updateLayoutSummary(){var summary='',context=Wirecloud.Utils.clone(this.layout);switch(this.layout.type){case'columnlayout':if(context.smart){context.smart=' smart';}else{context.smart='';}
summary='%(columns)s%(smart)s columns';break;case'gridlayout':summary='%(columns)s columns x %(rows)s rows';break;}
summary=Wirecloud.Utils.interpolate(summary,context);this.summary_addon.setLabel(summary);};var LayoutInputInterface=function LayoutInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.wrapperElement=new StyledElements.HorizontalLayout({'class':'se-layout-field input input-prepend input-append'});this.selectElement=new StyledElements.StyledSelect({name:options.name+'-type',initialEntries:[{"value":"columnlayout","label":gettext("Columns")},{"value":"gridlayout","label":gettext("Grid")}]});this.selectElement.addEventListener('change',function(select){this.layout=Wirecloud.Utils.clone(this.layout);this.layout.type=select.getValue();var fields=LAYOUT_FIELDS_MAPPING[this.layout.type];for(var i=0;i<fields.length;i++){if(!(fields[i].name in this.layout)){this.layout[fields[i].name]=fields[i].defaultValue;}}
updateLayoutSummary.call(this);}.bind(this));this.wrapperElement.getWestContainer().appendChild(this.selectElement);this.summary_addon=new StyledElements.Addon();this.wrapperElement.getCenterContainer().appendChild(this.summary_addon);this.buttonElement=new StyledElements.StyledButton({iconClass:'icon-cogs'});this.buttonElement.addEventListener('click',function(){var fields=LAYOUT_FIELDS_MAPPING[this.layout.type];var dialog=new Wirecloud.ui.FormWindowMenu(fields,gettext('Layout configuration'),'layout_settings');dialog.executeOperation=function(data){this.layout=Wirecloud.Utils.clone(this.layout);Wirecloud.Utils.merge(this.layout,data);updateLayoutSummary.call(this);}.bind(this);dialog.show(Wirecloud.UserInterfaceManager.currentWindowMenu);dialog.setValue(this.layout);}.bind(this));this.wrapperElement.getEastContainer().appendChild(this.buttonElement);};LayoutInputInterface.prototype=new StyledElements.InputInterface();LayoutInputInterface.parse=function parse(value){return JSON.parse(value);};LayoutInputInterface.stringify=function stringify(value){return JSON.stringify(value);};LayoutInputInterface.prototype._checkValue=function _checkValue(newValue){return InputValidationError.NO_ERROR;};LayoutInputInterface.prototype.getValue=function getValue(){return this.layout;};LayoutInputInterface.prototype.setDisabled=function setDisabled(disabled){this.selectElement.setDisabled(disabled);this.summary_addon.setDisabled(disabled);this.buttonElement.setDisabled(disabled);};LayoutInputInterface.prototype.repaint=function epaint(){this.wrapperElement.repaint();};LayoutInputInterface.prototype._setValue=function _setValue(newValue){this.layout=newValue;this.selectElement.setValue(this.layout.type);updateLayoutSummary.call(this);};LayoutInputInterface.prototype._setError=function _setError(error){};LayoutInputInterface.prototype.insertInto=function insertInto(element){this.wrapperElement.insertInto(element);this.wrapperElement.repaint();};Wirecloud.ui.LayoutInputInterface=LayoutInputInterface;})();(function(){"use strict";var VERSION_RE=/^([1-9]\d*|0)(?:\.([1-9]\d*|0))*$/;var VersionInputInterface=function VersionInputInterface(fieldId,options){if(options==null){options={};}
if(options.placeholder==null){options.placeholder='1.0';}
TextInputInterface.call(this,fieldId,options);};VersionInputInterface.prototype=new TextInputInterface();VersionInputInterface.prototype._checkValue=function _checkValue(newValue){if(newValue.match(VERSION_RE)!=null){return InputValidationError.NO_ERROR;}else{return InputValidationError.VERSION_ERROR;}};StyledElements.VersionInputInterface=VersionInputInterface;})();(function(){"use strict";var default_mapping={'boolean':BooleanInputInterface,'text':TextInputInterface,'version':StyledElements.VersionInputInterface,'password':PasswordInputInterface,'hidden':HiddenInputInterface,'list':ListInputInterface,'number':NumberInputInterface,'longtext':LongTextInputInterface,'url':URLInputInterface,'email':EMailInputInterface,'select':SelectInputInterface,'buttons':ButtonGroupInputInterface,'file':FileInputInterface,'fieldset':FieldSetInterface,'multivalued':MultivaluedInputInterface};var InputInterfaceFactory=function InputInterfaceFactory(){var mapping=StyledElements.Utils.clone(default_mapping);this.createInterface=function createInterface(fieldId,fieldDesc){var Class_=mapping[fieldDesc.type];if(Class_==null){throw new Error(fieldDesc.type);}
var instance=new Class_(fieldId,fieldDesc,this);if(fieldDesc.initiallyDisabled){instance.disable();}
return instance;};this.addFieldType=function addFieldType(type,class_){if(!class_ instanceof StyledElements.InputInterface){throw new TypeError();}
if(mapping[type]!==undefined){throw new Error();}
mapping[type]=class_;};this.parse=function parse(type,value){if(mapping[type]==null){throw new TypeError('Invalid data type');}
return mapping[type].parse(value);};this.stringify=function stringify(type,value){if(mapping[type]==null){throw new TypeError('Invalid data type');}
return mapping[type].stringify(value);};};StyledElements.InputInterfaceFactory=InputInterfaceFactory;})();(function(){"use strict";StyledElements.DefaultInputInterfaceFactory=new StyledElements.InputInterfaceFactory();})();(function(){"use strict";var Form=function Form(fields,options){var div,buttonArea,defaultOptions;defaultOptions={'readOnly':false,'buttonArea':null,'setdefaultsButton':false,'resetButton':false,'acceptButton':true,'cancelButton':true,'useHtmlForm':true,'legend':'auto','edition':false,'factory':StyledElements.DefaultInputInterfaceFactory};if(options&&options.readOnly){defaultOptions.acceptButton=false;defaultOptions.cancelButton=false;}
options=StyledElements.Utils.merge(defaultOptions,options);this.setdefaultsButton=null;if(options.setdefaultsButton instanceof StyledElements.StyledButton){this.setdefaultsButton=options.setdefaultsButton;}else if(options.setdefaultsButton===true){this.setdefaultsButton=new StyledElements.StyledButton({usedInForm:options.useHtmlForm,text:StyledElements.Utils.gettext('Set Defaults')});}
this.resetButton=null;if(options.resetButton instanceof StyledElements.StyledButton){this.resetButton=options.resetButton;}else if(options.resetButton===true){this.resetButton=new StyledElements.StyledButton({usedInForm:options.useHtmlForm,text:StyledElements.Utils.gettext('Reset')});}
this.acceptButton=null;if(options.acceptButton instanceof StyledElements.StyledButton){this.acceptButton=options.acceptButton;}else if(options.acceptButton===true){this.acceptButton=new StyledElements.StyledButton({'usedInForm':options.useHtmlForm,'class':'btn-primary','text':StyledElements.Utils.gettext('Accept')});}
this.cancelButton=null;if(options.cancelButton instanceof StyledElements.StyledButton){this.cancelButton=options.cancelButton;}else if(options.cancelButton===true){this.cancelButton=new StyledElements.StyledButton({usedInForm:options.useHtmlForm,text:StyledElements.Utils.gettext('Cancel')});}
StyledElements.StyledElement.call(this,['submit','cancel']);this.childComponents=[];this.readOnly=options.readOnly;this.fields={};this.fieldInterfaces={};this.edition=options.edition;this.factory=options.factory;div=document.createElement('div');if(options.useHtmlForm){this.wrapperElement=document.createElement('form');this.wrapperElement.addEventListener('submit',function(e){e.preventDefault();},true);this.wrapperElement.appendChild(div);}else{this.wrapperElement=div;}
div.appendChild(this.pBuildFieldTable(fields));this.wrapperElement.className="styled_form";this.msgElement=document.createElement('div');this.msgElement.className='alert alert-error';div.appendChild(this.msgElement);this.pSetMsgs([]);if(options.buttonArea!=null){buttonArea=options.buttonArea;}else if(options.acceptButton!==false||options.cancelButton!==false){buttonArea=document.createElement('div');buttonArea.className='buttons';div.appendChild(buttonArea);}
if(this.setdefaultsButton!=null){this.setdefaultsButton.addEventListener("click",this.defaults.bind(this));this.setdefaultsButton.insertInto(buttonArea);}
if(this.resetButton!=null){this.resetButton.addEventListener("click",this.reset.bind(this));this.resetButton.insertInto(buttonArea);}
if(this.acceptButton!=null){this.acceptButton.addEventListener("click",acceptHandler.bind(this));this.acceptButton.insertInto(buttonArea);}
if(this.cancelButton!=null){this.cancelButton.addEventListener("click",cancelHandler.bind(this));this.cancelButton.insertInto(buttonArea);}};Form.prototype=new StyledElements.StyledElement();Form.prototype.repaint=function repaint(temporal){var i;for(i=0;i<this.childComponents.length;i+=1){this.childComponents[i].repaint(temporal);}
for(i in this.fieldInterfaces){this.fieldInterfaces[i].repaint();}};Form.prototype.pSetMsgs=function(msgs){var i,wrapper;this.msgElement.innerHTML='';if(msgs.length>0){for(i=0;i<msgs.length;i+=1){wrapper=document.createElement('p');wrapper.textContent=msgs[i];this.msgElement.appendChild(wrapper);}
this.msgElement.style.display='';}else{this.msgElement.style.display='none';}};Form.prototype.pBuildFieldGroups=function(fields){var notebook,i,field,tab,tmp_field,tmp_input;notebook=new StyledElements.StyledNotebook();this.childComponents.push(notebook);for(i=0;i<fields.length;i+=1){field=fields[i];tab=notebook.createTab({name:field.shortTitle,closable:false});if(field.nested===true){tmp_field={'name':field.name,'type':'fieldset','fields':field.fields};tmp_input=this.factory.createInterface(field.name,tmp_field);tmp_input.assignDefaultButton(this.acceptButton);this.fieldInterfaces[field.name]=tmp_input;this.fields[field.name]=tmp_field;tab.appendChild(tmp_input);}else{tab.appendChild(this.pBuildFieldTable(field.fields));}}
return notebook.wrapperElement;};Form.prototype.pBuildFieldTable=function(fields){var table,tbody,fieldId,field,row,cell;if(fields[0]&&fields[0].type==='group'){return this.pBuildFieldGroups(fields);}
table=document.createElement('table');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');tbody=document.createElement('tbody');table.appendChild(tbody);for(fieldId in fields){if(fields.hasOwnProperty(fieldId)){field=fields[fieldId];if('name'in field){fieldId=field.name;}
row=tbody.insertRow(-1);switch(field.type){case'columnLayout':cell=row.insertCell(-1);cell.setAttribute('colspan',2);this.pInsertColumnLayout(field,cell);break;case'lineLayout':cell=row.insertCell(-1);cell.setAttribute('colspan',2);this.pInsertLineLayout(field,cell);break;case'hidden':row.className="hidden";this.pInsertField(fieldId,field,row);break;default:this.pInsertField(fieldId,field,row);}}}
return table;};Form.prototype.pInsertColumnLayout=function(desc,wrapper){var table,tbody,row,cell,i;table=document.createElement('table');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');tbody=document.createElement('tbody');table.appendChild(tbody);row=tbody.insertRow(-1);for(i=0;i<desc.columns.length;i+=1){cell=row.insertCell(-1);cell.appendChild(this.pBuildFieldTable(desc.columns[i]));}
wrapper.appendChild(table);};Form.prototype.pInsertLineLayout=function(desc,wrapper){var field,fieldId,inputInterface,wrapperElement;for(fieldId in desc.fields){if(desc.fields.hasOwnProperty(fieldId)){field=desc.fields[fieldId];inputInterface=this.factory.createInterface(fieldId,field);inputInterface.assignDefaultButton(this.acceptButton);inputInterface.insertInto(wrapper);wrapperElement=null;if(inputInterface.wrapperElement&&inputInterface.wrapperElement.wrapperElement){wrapperElement=inputInterface.wrapperElement.wrapperElement;}else if(inputInterface.inputElement&&inputInterface.inputElement.wrapperElement){wrapperElement=inputInterface.inputElement.wrapperElement;}
if(wrapperElement){wrapperElement.style.display='inline-block';wrapperElement.style.verticalAlign='middle';}
this.fieldInterfaces[fieldId]=inputInterface;this.fields[fieldId]=field;}}};Form.prototype.pInsertField=function(fieldId,field,row){var separator,hr,labelRow,labelCell,label,requiredMark,inputCell,inputInterface;if(field.type==='separator'){separator=row.insertCell(-1);separator.setAttribute('colspan','2');hr=document.createElement('hr');separator.appendChild(hr);return;}
if(field.type==='label'){labelRow=row.insertCell(-1);labelRow.setAttribute('colspan','2');labelRow.addClassName('label-row');if(field.url){label=document.createElement('a');label.setAttribute("href",field.url);label.setAttribute("target","_blank");}else{label=document.createElement('label');}
label.appendChild(document.createTextNode(field.label));labelRow.appendChild(label);return;}
labelCell=row.insertCell(-1);labelCell.classList.add('label-cell');label=document.createElement('label');label.textContent=field.label;labelCell.appendChild(label);if(field.description!=null){label.setAttribute('title',field.description);}
if(field.required&&!this.readOnly){requiredMark=document.createElement('span');requiredMark.appendChild(document.createTextNode('*'));requiredMark.className='required_mark';labelCell.appendChild(requiredMark);}
inputCell=document.createElement('td');row.appendChild(inputCell);inputInterface=this.factory.createInterface(fieldId,field);inputInterface.assignDefaultButton(this.acceptButton);inputInterface.insertInto(inputCell);if(this.readOnly||inputInterface._readOnly){inputInterface.setDisabled(true);}
this.fieldInterfaces[fieldId]=inputInterface;this.fields[fieldId]=field;};Form.prototype.extraValidation=function(fields){return[];};Form.prototype.getData=function getData(){var data,fieldId,field;data={};for(fieldId in this.fieldInterfaces){if(this.fieldInterfaces.hasOwnProperty(fieldId)){field=this.fieldInterfaces[fieldId];data[fieldId]=field.getValue();}}
return data;};Form.prototype.setData=function setData(data){var field,fieldId;if(typeof data!=='object'&&typeof data!=='undefined'){throw new TypeError();}
this.pSetMsgs([]);if(data!=null){for(fieldId in this.fieldInterfaces){field=this.fieldInterfaces[fieldId];field._setValue(data[fieldId]);}}else{for(fieldId in this.fields){field=this.fieldInterfaces[fieldId];field.reset();}}};Form.prototype.is_valid=function(){var fieldId,extraErrorMsgs,errorMsgs,validationManager=new ValidationErrorManager();for(fieldId in this.fieldInterfaces){if(this.fieldInterfaces.hasOwnProperty(fieldId)){validationManager.validate(this.fieldInterfaces[fieldId]);}}
extraErrorMsgs=this.extraValidation(this.fields);errorMsgs=validationManager.toHTML();if(extraErrorMsgs!==null){errorMsgs=errorMsgs.concat(extraErrorMsgs);}
this.pSetMsgs(errorMsgs);return errorMsgs.length===0;};var acceptHandler=function acceptHandler(){if(this.is_valid()){var data=this.getData();this.events.submit.dispatch(this,data);}};var cancelHandler=function cancelHandler(){this.events.cancel.dispatch(this);};Form.prototype.reset=function reset(){this.setData();return this;};Form.prototype.defaults=function defaults(){var field,fieldId;this.pSetMsgs([]);for(fieldId in this.fields){field=this.fieldInterfaces[fieldId];field.setValue(field._defaultValue);}
return this;};Form.prototype.normalSubmit=function(method,url,options){options=options?options:{};this.wrapperElement.method=method;this.wrapperElement.action=url;if(options.enctype){this.wrapperElement.setAttribute('enctype',options.enctype);}else{this.wrapperElement.removeAttribute('enctype');}
if(options.target){this.wrapperElement.setAttribute('target',options.target);}else{this.wrapperElement.removeAttribute('target');}
this.wrapperElement.submit();};Form.prototype.destroy=function destroy(){var i=0;for(i=0;i<this.childComponents.length;i+=1){this.childComponents[i].destroy();}
this.childComponents=null;if(this.setdefaultsButton){this.setdefaultsButton.destroy();this.setdefaultsButton=null;}
if(this.resetButton){this.resetButton.destroy();this.resetButton=null;}
if(this.acceptButton){this.acceptButton.destroy();this.acceptButton=null;}
if(this.cancelButton){this.cancelButton.destroy();this.cancelButton=null;}};Form.prototype.setDisabled=function setDisabled(disabled){var fieldId,inputInterface;if(this.enabled!=disabled){return;}
if(disabled){this.wrapperElement.classList.add('disabled');}else{this.wrapperElement.classList.remove('disabled');}
for(fieldId in this.fieldInterfaces){inputInterface=this.fieldInterfaces[fieldId];inputInterface.setDisabled(disabled||this.readOnly||inputInterface._readOnly);}
if(this.acceptButton!=null){this.acceptButton.setDisabled(disabled);}
if(this.cancelButton!=null){this.cancelButton.setDisabled(disabled);}
this.enabled=!disabled;};Form.prototype.enable=function enable(){this.setDisabled(false);};Form.prototype.disable=function disable(){this.setDisabled(true);};Form.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.repaint();};window.Form=Form;})();(function(){"use strict";var builder,onPaginationChanged,onPageChange,updateButtons,updateLayout,PaginationInterface;builder=new StyledElements.GUIBuilder();onPaginationChanged=function onPaginationChanged(pagination){if(this.autoHide&&this.pagination.totalPages===1){this.wrapperElement.style.display='none';}else{this.wrapperElement.style.display='';}
this.totalPagesLabel.textContent=this.pagination.totalPages;this.currentPageLabel.textContent=this.pagination.currentPage;updateButtons.call(this);};onPageChange=function onPageChange(){this.currentPageLabel.textContent=this.currentPage+1;updateButtons.call(this);};updateButtons=function updateButton(){if(this.pagination.currentPage<=1){this.prevBtn.disable();this.firstBtn.disable();}else{this.prevBtn.enable();this.firstBtn.enable();}
if(this.pagination.currentPage>=this.pagination.totalPages){this.nextBtn.disable();this.lastBtn.disable();}else{this.nextBtn.enable();this.lastBtn.enable();}};updateLayout=function updateLayout(pattern){var elements={'firstBtn':this.firstBtn,'prevBtn':this.prevBtn,'nextBtn':this.nextBtn,'lastBtn':this.lastBtn,'currentPage':this.currentPageLabel,'totalPages':this.totalPagesLabel};var contents=builder.parse(pattern,elements);this.wrapperContainer.appendChild(contents);};PaginationInterface=function PaginationInterface(pagination,options){var defaultOptions={'layout':'<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><t:firstBtn/><t:prevBtn/><div class="box">Page: <t:currentPage/>/<t:totalPages/></div><t:nextBtn/><t:lastBtn/></s:styledgui>','autoHide':false};options=StyledElements.Utils.merge(defaultOptions,options);this.autoHide=options.autoHide;StyledElements.StyledElement.call(this,[]);this.pagination=pagination;this.wrapperContainer=new StyledElements.Container();this.wrapperContainer.addClassName('pagination');this.wrapperElement=this.wrapperContainer.wrapperElement;this.firstBtn=new StyledElements.StyledButton({'iconClass':'icon-first-page'});this.firstBtn.addEventListener('click',pagination.goToFirst.bind(pagination));this.prevBtn=new StyledElements.StyledButton({'iconClass':'icon-prev-page'});this.prevBtn.addEventListener('click',pagination.goToPrevious.bind(pagination));this.nextBtn=new StyledElements.StyledButton({'iconClass':'icon-next-page'});this.nextBtn.addEventListener('click',pagination.goToNext.bind(pagination));this.lastBtn=new StyledElements.StyledButton({'iconClass':'icon-last-page'});this.lastBtn.addEventListener('click',pagination.goToLast.bind(pagination));this.currentPageLabel=document.createElement('span');this.currentPageLabel.classList.add('current-page');this.totalPagesLabel=document.createElement('span');this.totalPagesLabel.classList.add('total-pages');updateLayout.call(this,options.layout);this.currentPageLabel.textContent=this.currentPage+1;this.totalPagesLabel.textContent=this.totalPages;updateButtons.call(this);this.pagination.addEventListener('requestEnd',onPaginationChanged.bind(this));};PaginationInterface.prototype=new StyledElements.StyledElement();PaginationInterface.prototype.changeLayout=function changeLayout(newLayout){updateLayout.call(this,newLayout);};StyledElements.PaginationInterface=PaginationInterface;})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="popover fade"><div class="arrow"/><h3 class="popover-title"><t:title/></h3><div class="popover-content"><t:content/></div></div></s:styledgui>';var disableCallback=function disableCallback(e){if(e.button!==0){return;}
setTimeout(this.hide.bind(this),0);};var setPosition=function setPosition(refPosition,position){this.element.classList.remove('top','right','bottom','left');switch(position){case'top':this.element.classList.add('top');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=(refPosition.top-this.element.offsetHeight)+"px";break;case'right':this.element.classList.add('right');this.element.style.left=refPosition.right+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;case'bottom':this.element.classList.add('bottom');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=refPosition.bottom+"px";break;case'left':this.element.classList.add('left');this.element.style.left=(refPosition.left-this.element.offsetWidth)+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;}};var standsOut=function standsOut(){var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setPosition.call(this,refPosition,position);var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.element.style.top="";this.element.style.bottom="10px";element_box=this.element.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.element.style.top="10px";}};var searchBestPosition=function(refPosition,positions){var i=0,weights=[];do{setPosition.call(this,refPosition,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,positions);}};var _show=function _show(refPosition){Wirecloud.UserInterfaceManager._registerPopup(this);if(this.visible){this.repaint();return;}
if('getBoundingClientRect'in refPosition){refPosition=refPosition.getBoundingClientRect();}
this.element=builder.parse(template,{title:this.options.title,content:this.options.content}).elements[0];document.body.appendChild(this.element);document.addEventListener("click",this._disableCallback,true);searchBestPosition.call(this,refPosition,this.options.placement);this.element.classList.add('in');};var Popover=function Popover(options){var defaultOptions={'content':'','title':'','class':'','html':false,'placement':['right','bottom','left','top']};Object.defineProperty(this,'options',{value:StyledElements.Utils.merge(defaultOptions,options)});StyledElements.StyledElement.call(this,[]);Object.defineProperties(this,{visible:{get:function(){return this.element!=null;}},_disableCallback:{value:disableCallback.bind(this),enumerable:false},_show:{value:_show.bind(this),enumerable:false}});};Popover.prototype=new StyledElements.StyledElement();Popover.prototype.bind=function bind(element,mode){switch(mode){case"click":element.addEventListener('click',this.toggle.bind(this),true);break;case"hover":break;default:throw new TypeError('Invalid mode: '+mode);}};Popover.prototype.toggle=function toggle(refElement){if(this.visible){this.hide();}else{this._show(refElement);}};Popover.prototype.show=function show(refElement){this._show(refElement);};var _hide=function _hide(){if(this.element!=null){document.body.removeChild(this.element);this.element=null;Wirecloud.UserInterfaceManager._unregisterPopup(this);}};Popover.prototype.hide=function hide(){if(!this.visible){return;}
document.removeEventListener('click',this._disableCallback,true);if(this.element.classList.contains('in')){this.element.addEventListener('transitionend',_hide.bind(this));this.element.classList.remove('in');}else{_hide.call(this);}};StyledElements.Popover=Popover;})();(function(){"use strict";var onSuccessSavePreferences=function onSuccessSavePreferences(){this.preferences.events['post-commit'].dispatch(this.preferences,this.modifiedValues);};var onErrorSavePreferences=function onErrorSavePreferences(){};var persist=function persist(modifiedValues){var context={preferences:this,modifiedValues:modifiedValues};Wirecloud.io.makeRequest(this._build_save_url(),{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(modifiedValues),onSuccess:onSuccessSavePreferences.bind(context),onFailure:onErrorSavePreferences.bind(context)});};var Preferences=function Preferences(preferencesDef,values){if(arguments.length===0){return;}
Object.defineProperty(this,'meta',{value:preferencesDef});Object.defineProperty(this,'preferences',{value:{}});var inherit,value,definition;for(var key in preferencesDef.preferences){definition=preferencesDef.preferences[key];if(key in values){inherit=values[definition.name].inherit;value=values[key].value;}else{value=null;inherit=definition.inheritByDefault;}
this.preferences[definition.name]=new Wirecloud.PlatformPref(this,definition,inherit,value);}
this._handleParentChanges=this._handleParentChanges.bind(this);StyledElements.ObjectWithEvents.call(this,['pre-commit','post-commit']);};Preferences.prototype=new StyledElements.ObjectWithEvents();Preferences.prototype.get=function get(name){return this.preferences[name].getEffectiveValue();};Preferences.prototype.set=function set(newValues){var newEffectiveValues={};var modifiedValues={};for(var name in newValues){var preference=this.preferences[name];var changes=newValues[name];if('inherit'in changes){preference.inherit=changes.inherit;}
if('value'in changes){preference.value=changes.value;changes.value=Wirecloud.ui.InputInterfaceFactory.stringify(preference.meta.options.type,preference.value);}
modifiedValues[name]=changes;newEffectiveValues[name]=preference.getEffectiveValue();}
this.events['pre-commit'].dispatch(this,newEffectiveValues);persist.call(this,modifiedValues);};Preferences.prototype._handleParentChanges=function _handleParentChanges(parentPreferences,modifiedValues){var valuesToPropagate={};var propagate=false;for(var preferenceName in modifiedValues){if(preferenceName in this.preferences&&this.preferences[preferenceName].inherit){propagate=true;valuesToPropagate[preferenceName]=modifiedValues[preferenceName];}}
if(propagate){this.events['pre-commit'].dispatch(this,valuesToPropagate);}};Preferences.prototype.destroy=function destroy(){};Wirecloud.Preferences=Preferences;})();(function(){"use strict";var PlatformPreferences=function PlatformPreferences(definitions,values){Wirecloud.Preferences.call(this,definitions,values);};PlatformPreferences.prototype=new Wirecloud.Preferences();PlatformPreferences.prototype.buildTitle=function buildTitle(){return gettext("Platform Preferences");};PlatformPreferences.prototype._build_save_url=function _build_save_url(){return Wirecloud.URLs.PLATFORM_PREFERENCES;};Wirecloud.PlatformPreferences=PlatformPreferences;})();(function(){"use strict";var PreferenceManager=function PreferenceManager(){this.preferencesDef={};var definitions,i;var platformPreferences=[{"name":"language","label":gettext('Language'),"type":"select","initialEntries":[{value:'default',label:gettext('Default setting')},{value:'browser',label:gettext('Browser detect')}]}];for(i=0;i<Wirecloud.constants.AVAILABLE_LANGUAGES.length;i+=1){platformPreferences[0].initialEntries.push(Wirecloud.constants.AVAILABLE_LANGUAGES[i]);}
definitions=this.processDefinitions(platformPreferences);this.preferencesDef.platform=[Wirecloud.PlatformPreferencesDef,definitions];definitions=this.processDefinitions(Wirecloud.constants.WORKSPACE_PREFERENCES);this.preferencesDef.workspace=[Wirecloud.WorkspacePreferencesDef,definitions];definitions=this.processDefinitions(Wirecloud.constants.TAB_PREFERENCES);this.preferencesDef.tab=[Wirecloud.TabPreferencesDef,definitions];};PreferenceManager.prototype.processDefinitions=function processDefinitions(preferences){var i,preference_data,preferenceDef,definitions={};for(i=0;i<preferences.length;i++){preference_data=preferences[i];preferenceDef=new Wirecloud.PreferenceDef(preference_data.name,preference_data.inheritable,preference_data.inheritByDefault,preference_data.hidden,preference_data);definitions[preference_data.name]=preferenceDef;}
return definitions;};PreferenceManager.prototype.buildPreferences=function buildPreferences(scope,values){var args=Array.prototype.slice.call(arguments,1);if(!(scope in this.preferencesDef)){throw new TypeError();}
var manager=new(this.preferencesDef[scope][0])(this.preferencesDef[scope][1],args);return manager.buildPreferences.apply(manager,args);};Wirecloud.PreferenceManager=new PreferenceManager();})();(function(){"use strict";var WorkspacePreferences=function WorkspacePreferences(definitions,workspace,values){Wirecloud.Preferences.call(this,definitions,values);this._workspace=workspace;Wirecloud.preferences.addEventListener('pre-commit',this._handleParentChanges);};WorkspacePreferences.prototype=new Wirecloud.Preferences();WorkspacePreferences.prototype.buildTitle=function buildTitle(){var msg=gettext("Workspace preferences (%(workspaceName)s)");return interpolate(msg,{workspaceName:this._workspace.workspaceState.name},true);};WorkspacePreferences.prototype.getParentValue=function getParentValue(name){return Wirecloud.preferences.get(name);};WorkspacePreferences.prototype._build_save_url=function _build_save_url(){return Wirecloud.URLs.WORKSPACE_PREFERENCES.evaluate({workspace_id:this._workspace.workspaceState.id});};WorkspacePreferences.prototype.destroy=function destroy(){Wirecloud.preferences.removeEventListener('pre-commit',this._handleParentChanges);Wirecloud.Preferences.prototype.destroy.call(this);this._workspace=null;};Wirecloud.WorkspacePreferences=WorkspacePreferences;})();(function(){"use strict";var TabPreferences=function TabPreferences(definitions,tab,values){Wirecloud.Preferences.call(this,definitions,values);this._tab=tab;this._workspace=this._tab.workspace;this._workspace.preferences.addEventListener('pre-commit',this._handleParentChanges);};TabPreferences.prototype=new Wirecloud.Preferences();TabPreferences.prototype.buildTitle=function buildTitle(){var msg=gettext("Tab preferences (%(tabName)s)");return interpolate(msg,{tabName:this._tab.tabInfo.name},true);};TabPreferences.prototype.getParentValue=function getParentValue(name){return this._workspace.preferences.get(name);};TabPreferences.prototype._build_save_url=function _build_save_url(modifiedValues){return Wirecloud.URLs.TAB_PREFERENCES.evaluate({workspace_id:this._workspace.workspaceState.id,tab_id:this._tab.tabInfo.id});};TabPreferences.prototype.destroy=function destroy(){this._workspace.preferences.removeEventListener('pre-commit',this._handleParentChanges);Wirecloud.Preferences.prototype.destroy.call(this);this._workspace=null;this._tab=null;};Wirecloud.TabPreferences=TabPreferences;})();(function(){"use strict";var SubtaskMonitorModel=function SubtaskMonitorModel(title){this.title=title;this.progress=0;StyledElements.ObjectWithEvents.call(this,['progress']);};SubtaskMonitorModel.prototype=new StyledElements.ObjectWithEvents();SubtaskMonitorModel.prototype.updateTaskProgress=function updateTaskProgress(progress){if(progress<0){this.progress=0;}else if(progress>100){this.progress=100;}else{this.progress=progress;}
this.events.progress.dispatch(this,this.progress);};var updateGlobalTaskProgress=function updateGlobalTaskProgress(){var accumulated_progress=0;if(this.subtasks.length!==0){for(var i=0;i<this.subtasks.length;i+=1){accumulated_progress+=this.subtasks[i].progress;}
this.progress=accumulated_progress/this.subtasks.length;}else{this.progress=0;}
this.events.progress.dispatch(this,this.progress);};var TaskMonitorModel=function TaskMonitorModel(title,nsubtasks){this.title=title;this.subtasks=[];this.nsubtasks=nsubtasks;this.currentsubtask=-1;StyledElements.ObjectWithEvents.call(this,['progress']);};TaskMonitorModel.prototype=new StyledElements.ObjectWithEvents();TaskMonitorModel.prototype.nextSubtask=function nextSubtask(title){if(title){Wirecloud.GlobalLogManager.log(title,Wirecloud.constants.LOGGING.INFO_MSG);}
this.currentsubtask++;if(this.currentsubtask>=this.nsubtasks){this.nsubtasks=this.currentsubtask+1;}
var subtask=new SubtaskMonitorModel(title);this.subtasks.push(subtask);subtask.addEventListener('progress',updateGlobalTaskProgress.bind(this));updateGlobalTaskProgress.call(this);return subtask;};Wirecloud.TaskMonitorModel=TaskMonitorModel;})();(function(){"use strict";var PropertyCommiter=function PropertyCommiter(iwidget){Object.defineProperty(this,'iwidget',{value:iwidget});this.values={};this.pending_values=null;this.timeout=null;};PropertyCommiter.prototype.add=function add(name,value){if(this.pending_values==null){this.values[name]=value;if(this.timeout!=null){clearTimeout(this.timeout);}
this.timeout=setTimeout(this.commit.bind(this),1000);}else{this.pending_values[name]=value;}};PropertyCommiter.prototype.commit=function commit(){if(this.timeout!=null){clearTimeout(this.timeout);}
if(Object.keys(this.values).length===0){return;}
this.timeout=null;this.pending_values={};var url=Wirecloud.URLs.IWIDGET_PROPERTIES.evaluate({workspace_id:this.iwidget.workspace.id,tab_id:this.iwidget.tab.id,iwidget_id:this.iwidget.id});Wirecloud.io.makeRequest(url,{contentType:'application/json',postBody:JSON.stringify(this.values),onSuccess:function(){this.values=this.pending_values;if(Object.keys(this.values).length>0){this.timeout=setTimeout(this.commit.bind(this),1000);}
this.pending_values=null;}.bind(this),onFailure:function(){this.values=Wirecloud.Utils.merge(this.values,this.pending_values);this.timeout=setTimeout(this.commit.bind(this),30000);}.bind(this)});};Wirecloud.PropertyCommiter=PropertyCommiter;})();(function(){"use strict";var renameSuccess=function renameSuccess(options,old_name,new_name,response){this.name=new_name;this.contextManager.modify({title:new_name});var msg=gettext("Name changed from \"%(oldName)s\" to \"%(newName)s\" succesfully");msg=interpolate(msg,{oldName:old_name,newName:new_name},true);this.logManager.log(msg,Wirecloud.constants.LOGGING.INFO_MSG);this.events.name_changed.dispatch(new_name);if(options.onSuccess==='function'){try{options.onSuccess();}catch(e){}}};var renameFailure=function renameFailure(options,response){var msg=gettext("Error renaming iwidget from persistence: %(errorMsg)s.");msg=this.logManager.formatError(msg,response);this.log(msg);if(options.onFailure==='function'){try{options.onFailure(msg);}catch(e){}}};var removeSuccess=function removeSuccess(options,response){var msg=gettext("IWidget \"%(name)s\" removed from workspace succesfully");msg=interpolate(msg,{name:this.name},true);this.logManager.log(msg,Wirecloud.constants.LOGGING.INFO_MSG);this.events.removed.dispatch(this);if(options.onSuccess==='function'){try{options.onSuccess();}catch(e){}}
this.destroy();};var removeFailure=function removeFailure(options,response){var msg=gettext("Error removing iwidget from persistence: %(errorMsg)s.");msg=this.logManager.formatError(msg,response);this.logManager.log(msg);if(options.onFailure==='function'){try{options.onFailure(msg);}catch(e){}}};var IWidget=function IWidget(widget,tab,options){var key,i,preferences,iwidget_pref_info,properties,iwidget_prop_info;if(typeof options!=='object'||!(widget instanceof Wirecloud.Widget)){throw new TypeError();}
if(!(tab instanceof Tab)){throw new TypeError();}
Object.defineProperty(this,'widget',{value:widget});Object.defineProperty(this,'meta',{value:widget});Object.defineProperty(this,'tab',{value:tab});Object.defineProperty(this,'workspace',{value:tab.workspace});this.id=options.id;this.loaded=false;this.name=options.name;this.readOnly=options.readOnly;this.pending_events=[];this.inputs={};for(key in this.meta.inputs){this.inputs[key]=new Wirecloud.wiring.WidgetTargetEndpoint(this,this.meta.inputs[key]);}
this.outputs={};for(key in this.meta.outputs){this.outputs[key]=new Wirecloud.wiring.WidgetSourceEndpoint(this,this.meta.outputs[key]);}
preferences=this.meta.preferenceList;this.preferenceList=[];this.preferences={};for(i=0;i<preferences.length;i++){iwidget_pref_info=options.preferences[preferences[i].name];if(iwidget_pref_info!=null){this.preferenceList[i]=new Wirecloud.UserPref(preferences[i],iwidget_pref_info.readonly,iwidget_pref_info.hidden,iwidget_pref_info.value);}else{this.preferenceList[i]=new Wirecloud.UserPref(preferences[i],false,false,preferences[i].default);}
this.preferences[preferences[i].name]=this.preferenceList[i];}
properties=this.meta.propertyList;this.propertyList=[];this.properties={};this.propertyCommiter=new Wirecloud.PropertyCommiter(this);for(i=0;i<properties.length;i++){iwidget_prop_info=options.properties[properties[i].name];if(iwidget_prop_info!=null){this.propertyList[i]=new Wirecloud.PersistentVariable(properties[i],this.propertyCommiter,iwidget_prop_info.readonly,iwidget_prop_info.value);}else{this.propertyList[i]=new Wirecloud.PersistentVariable(properties[i],this.propertyCommiter,false,properties[i].meta.default);}
this.properties[properties[i].name]=this.propertyList[i];}
this.callbacks={'iwidget':[],'mashup':[],'platform':[]};this.contextManager=new Wirecloud.ContextManager(this,{'title':{label:gettext("Title"),description:gettext("Widget's title"),value:options.name},'xPosition':{label:gettext("X-Position"),description:gettext("Specifies the x-coordinate at which the widget is placed"),value:0},'yPosition':{label:gettext("Y-Position"),description:gettext("Specifies the y-coordinate at which the widget is placed"),value:0},'height':{label:gettext("Height"),description:gettext("Widget's height in layout cells"),value:0},'width':{label:gettext("Width"),description:gettext("Widget's width in layout cells"),value:0},'heightInPixels':{label:gettext("Height in pixels"),description:gettext("Widget's height in pixels"),value:0},'widthInPixels':{label:gettext("Width in pixels"),description:gettext("Widget's width in pixels"),value:0}});Object.defineProperty(this,'logManager',{value:new Wirecloud.Widget.LogManager(this)});this.prefCallback=null;StyledElements.ObjectWithEvents.call(this,['load','unload','removed','name_changed']);};IWidget.prototype=new StyledElements.ObjectWithEvents();IWidget.prototype.isAllowed=function isAllowed(action){if(this.workspace.restricted){return false;}
switch(action){case"close":return!this.readOnly&&this.workspace.isAllowed('add_remove_iwidgets');case"move":case"resize":return!this.tab.readOnly&&this.workspace.isAllowed('edit_layout');case"minimize":return this.workspace.isAllowed('edit_layout');case"rename":case"configure":return true;default:return false;}};IWidget.prototype.registerPrefCallback=function registerPrefCallback(prefCallback){this.prefCallback=prefCallback;};IWidget.prototype.registerContextAPICallback=function registerContextAPICallback(scope,callback){switch(scope){case'iwidget':this.contextManager.addCallback(callback);break;case'mashup':this.workspace.contextManager.addCallback(callback);break;case'platform':Wirecloud.contextManager.addCallback(callback);break;default:throw new TypeError('invalid scope');}
this.callbacks[scope].push(callback);};IWidget.prototype._notifyLoaded=function _notifyLoaded(element){if(this.loaded||!element.hasAttribute('src')){return;}
this.logManager.log(gettext('iWidget loaded'),Wirecloud.constants.LOGGING.INFO_MSG);this.loaded=true;element.contentDocument.defaultView.addEventListener('unload',this._notifyUnloaded.bind(this),true);element.contentDocument.defaultView.addEventListener('keydown',function(event){if(event.keyCode===27){Wirecloud.UserInterfaceManager.handleEscapeEvent();}},true);for(var i=0;i<this.pending_events.length;i+=1){this.inputs[this.pending_events[i].endpoint].propagate(this.pending_events[i].value);}
this.pending_events=[];this.events.load.dispatch(this);};IWidget.prototype._notifyUnloaded=function _notifyUnloaded(){var i;if(!this.loaded){return;}
this.logManager.log(gettext('iWidget unloaded'),Wirecloud.constants.LOGGING.INFO_MSG);this.logManager.newCycle();for(i=0;i<this.callbacks.iwidget.length;i+=1){this.contextManager.removeCallback(this.callbacks.iwidget[i]);}
for(i=0;i<this.callbacks.mashup.length;i+=1){this.workspace.contextManager.removeCallback(this.callbacks.mashup[i]);}
for(i=0;i<this.callbacks.platform.length;i+=1){Wirecloud.contextManager.removeCallback(this.callbacks.platform[i]);}
this.callbacks={'iwidget':[],'mashup':[],'platform':[]};this.propertyCommiter.commit();this.prefCallback=null;this.loaded=false;this.events.unload.dispatch(this);};IWidget.prototype.buildInterface=function buildInterface(template,view){return new Wirecloud.ui.IWidgetView(this,template,view);};IWidget.prototype.fullDisconnect=function fullDisconnect(){var key,connectables;connectables=this.inputs;for(key in connectables){connectables[key].fullDisconnect();}
connectables=this.outputs;for(key in connectables){connectables[key].fullDisconnect();}};IWidget.prototype.setName=function setName(new_name,options){var old_name=this.name;if(options==null){options={};}
if(new_name!==null&&new_name.length>0){var iwidgetUrl=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});Wirecloud.io.makeRequest(iwidgetUrl,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({name:new_name}),onSuccess:renameSuccess.bind(this,options,old_name,new_name),onFailure:renameFailure.bind(this,options)});}};IWidget.prototype.remove=function remove(options){var url;if(options==null){options={};}
url=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:removeSuccess.bind(this,options),onFailure:removeFailure.bind(this,options)});};IWidget.prototype.destroy=function destroy(){if(this.loaded){this.events.unload.dispatch(this);this.loaded=false;}
this.contextManager=null;this.logManager.close();};Wirecloud.IWidget=IWidget;})();(function(){"use strict";var Wiring,findEntity,unload,addIWidget,removeIWidget,iwidget_added_listener,iwidget_removed_listener,iwidget_unload_listener,restore_connections,unload_operators;findEntity=function findEntity(desc){switch(desc.type){case'iwidget':return this.iwidgets[desc.id];case'ioperator':return this.ioperators[desc.id];}};var findEndpoint=function findEndpoint(entity,desc,type){if(entity instanceof Wirecloud.wiring.GhostEntity){if(!(desc.endpoint in entity[type])){if(type==='outputs'){entity[type][desc.endpoint]=new Wirecloud.wiring.GhostSourceEndpoint(entity,desc.endpoint);}else{entity[type][desc.endpoint]=new Wirecloud.wiring.GhostTargetEndpoint(entity,desc.endpoint);}}}
return entity[type][desc.endpoint];};restore_connections=function restore_connections(entity){var i,connection,sourceEntity,sourceEndpoint,targetEntity,targetEndpoint,msg;for(i=0;i<this.status.connections.length;i+=1){connection=this.status.connections[i];sourceEntity=findEntity.call(this,connection.source);targetEntity=findEntity.call(this,connection.target);if(entity!=null&&sourceEntity!=entity&&targetEntity!=entity){continue;}
if(sourceEntity==null||targetEntity==null){msg=gettext('The connection between %(source)s and %(target)s could not be established');msg=interpolate(msg,{source:JSON.stringify(connection.source),target:JSON.stringify(connection.target)},true);this.logManager.log(msg);continue;}
sourceEndpoint=findEndpoint(sourceEntity,connection.source,'outputs');targetEndpoint=findEndpoint(targetEntity,connection.target,'inputs');if(sourceEndpoint!=null&&targetEndpoint!=null){sourceEndpoint.connect(targetEndpoint);}else{msg=gettext('The connection between %(source)s and %(target)s could not be established');msg=interpolate(msg,{source:JSON.stringify(connection.source),target:JSON.stringify(connection.target)},true);this.logManager.log(msg);}}};unload=function unload(){var widgets,key,i;if(this.status==null){return;}
this.events.unload.dispatch();widgets=this.workspace.getIWidgets();for(i=0;i<widgets.length;i++){this.iwidgets[widgets[i].id].fullDisconnect();}
for(key in this.ioperators){this.ioperators[key].fullDisconnect();}
this.events.unloaded.dispatch();this.logManager.newCycle();this.status=null;};addIWidget=function addIWidget(iwidget){if(iwidget.id in this.iwidgets){var msg=gettext("Error adding iWidget into the wiring module of the workspace: Widget instance already exists.");this.logManager.log(msg);return;}
iwidget.addEventListener('unload',this._iwidget_unload_listener);this.iwidgets[iwidget.id]=iwidget;};removeIWidget=function removeIWidget(iwidget){var widgetEntry,i,connection;if(!(iwidget.id in this.iwidgets)){var msg=gettext("Error: trying to remove an inexistant iWidget from the wiring module.");this.logManager.log(msg);return;}
iwidget.fullDisconnect();if(this.status.views!=null&&this.status.views[0].iwidgets[iwidget.id]){delete this.status.views[0].iwidgets[iwidget.id];}
for(i=this.status.connections.length-1;i>=0;i-=1){connection=this.status.connections[i];if(connection.source.type==='iwidget'&&connection.source.id===iwidget.id){this.status.connections.splice(i,1);this.status.views[0].connections.splice(i,1);}else if(connection.target.type==='iwidget'&&connection.target.id===iwidget.id){this.status.connections.splice(i,1);this.status.views[0].connections.splice(i,1);}}
iwidget.removeEventListener('unload',this._iwidget_unload_listener);delete this.iwidgets[iwidget.id];};iwidget_added_listener=function iwidget_added_listener(workspace,iwidget){addIWidget.call(this,iwidget);};iwidget_removed_listener=function iwidget_removed_listener(workspace,iwidget){removeIWidget.call(this,iwidget);};iwidget_unload_listener=function iwidget_unload_listener(iWidget){var key,entry=this.iwidgets[iWidget.id];for(key in entry.inputs){entry.inputs[key].callback=null;}};unload_operators=function unload_operators(resource_details,version){var id,operator,msg,ghost_operator,i,endpoint,key,uri;uri=resource_details.vendor+'/'+resource_details.name+'/'+version;for(id in this.ioperators){if(this.ioperators[id].meta.uri===uri){operator=this.ioperators[id];this.ioperators[id].destroy();ghost_operator=new Wirecloud.wiring.GhostOperator(id,this.status.operators[id]);this.ioperators[id]=ghost_operator;ghost_operator.preferences={};for(key in operator.preferences){ghost_operator.preferences[key]={"readOnly":operator.preferences[key].readOnly,"hidden":operator.preferences[key].hidden,"value":operator.preferences[key].value};}
for(i=0;i<operator.meta.inputs.length;i++){endpoint=new Wirecloud.wiring.GhostTargetEndpoint(ghost_operator,operator.meta.inputs[i].name);ghost_operator.inputs[endpoint.name]=endpoint;}
for(i=0;i<operator.meta.outputs.length;i++){endpoint=new Wirecloud.wiring.GhostSourceEndpoint(ghost_operator,operator.meta.outputs[i].name);ghost_operator.outputs[endpoint.name]=endpoint;}
msg=gettext('operator instance %(ioperator_id)s was unloaded as %(operator)s operator has been uninstalled');msg=interpolate(msg,{ioperator_id:id,operator:operator.meta.uri},true);this.logManager.log(msg);}}};Wiring=function Wiring(workspace){this.status=null;this.workspace=workspace;this.iwidgets={};this.ioperators={};Object.defineProperty(this,'logManager',{value:new Wirecloud.wiring.LogManager(this)});this._iwidget_unload_listener=iwidget_unload_listener.bind(this);this._iwidget_added_listener=iwidget_added_listener.bind(this);this._iwidget_removed_listener=iwidget_removed_listener.bind(this);this.workspace.addEventListener('iwidgetadded',this._iwidget_added_listener);this.workspace.addEventListener('iwidgetremoved',this._iwidget_removed_listener);StyledElements.ObjectWithEvents.call(this,['load','loaded','unload','unloaded']);};Wiring.prototype=new StyledElements.ObjectWithEvents();Wiring.prototype.load=function load(status){var operators,id,operator_info,old_operators,msg;if(status==null||status===''){unload.call(this);return;}
if(typeof status==='string'){status=JSON.parse(status);}
unload.call(this);this.events.load.dispatch();if(!('views'in status)||!Array.isArray(status.views)){status.views=[];}
if(status.views.length===0){status.views.push({label:'default',iwidgets:{},operators:{},multiconnectors:{},connections:[]});}
if(this.workspace.owned){operators=Wirecloud.wiring.OperatorFactory.getAvailableOperators();}else{operators=this.workspace.resources.getAvailableResourcesByType('operator');}
old_operators=this.ioperators;this.ioperators={};for(id in status.operators){operator_info=status.operators[id];if(id in old_operators){this.ioperators[id]=old_operators[id];delete old_operators[id];if(this.ioperators[id]instanceof Wirecloud.wiring.GhostOperator){msg=gettext('%(operator)s operator is not available for this account');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);}}else{if(operator_info.name in operators){try{this.ioperators[id]=operators[operator_info.name].instantiate(id,operator_info,this);}catch(e){msg=gettext('Error instantiating the %(operator)s operator');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);this.ioperators[id]=new Wirecloud.wiring.GhostOperator(id,operator_info);if(id in status.views[0].operators){this.ioperators[id].fillFromViewInfo(status.views[0].operators[id]);}}}else{msg=gettext('%(operator)s operator is not available for this account');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);this.ioperators[id]=new Wirecloud.wiring.GhostOperator(id,operator_info);if(id in status.views[0].operators){this.ioperators[id].fillFromViewInfo(status.views[0].operators[id]);}}}}
for(id in old_operators){old_operators[id].destroy();}
this.status=status;restore_connections.call(this);this.events.loaded.dispatch();};Wiring.prototype.save=function save(){Wirecloud.io.makeRequest(Wirecloud.URLs.WIRING_ENTRY.evaluate({workspace_id:this.workspace.id}),{method:'PUT',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(this.status)});};Wiring.prototype.destroy=function destroy(){var key,i;for(key in this.iwidgets){this.iwidgets[key].fullDisconnect();}
this.iwidgets=null;for(key in this.ioperators){this.ioperators[key].destroy();}
this.ioperators=null;this.workspace.removeEventListener('iwidgetadded',this._iwidget_added_listener);this.workspace.removeEventListener('iwidgetremoved',this._iwidget_removed_listener);this.workspace=null;};Wiring.prototype._notifyOperatorInstall=function _notifyOperatorInstall(operator){var id,operator_info,ioperator,msg;for(id in this.status.operators){operator_info=this.status.operators[id];if(operator_info.name===operator.uri){this.ioperators[id].fullDisconnect();try{ioperator=operator.instantiate(id,operator_info,this);this.ioperators[id]=ioperator;this.logManager.errorCount-=1;}catch(e){msg=gettext('Error instantiating the %(operator)s operator');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);}
restore_connections.call(this,ioperator);}}};Wiring.prototype._notifyOperatorUninstall=function _notifyOperatorUninstall(resource_details,versions){var i;for(i=0;i<versions.length;i++){unload_operators.call(this,resource_details,versions[i]);}};Wirecloud.Wiring=Wiring;Wirecloud.wiring={};})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var LogManager=function LogManager(parentLogger){Object.defineProperties(this,{wrapperElement:{value:document.createElement('div')},parentLogger:{value:parentLogger}});this.errorCount=0;this.totalCount=0;this.entries=[];this.childManagers=[];this.closed=false;StyledElements.ObjectWithEvents.call(this,['newentry']);if(parentLogger){parentLogger.childManagers.push(this);}};LogManager.prototype=new StyledElements.ObjectWithEvents();LogManager.prototype._addEntry=function _addEntry(entry){Object.freeze(entry);this.entries.push(entry);if(entry.level===Wirecloud.constants.LOGGING.ERROR_MSG){this.errorCount+=1;}
this.totalCount+=1;if(this.parentLogger){this.parentLogger._addEntry(entry);}
this.events.newentry.dispatch(this,entry);};LogManager.prototype.newCycle=function newCycle(){this.wrapperElement.insertBefore(document.createElement('hr'),this.wrapperElement.firstChild);this.resetCounters();};LogManager.prototype.log=function log(msg,options){var date,index,entry,level,expander;if(typeof options==='number'){level=options;options={};}else if(options==null){options={};}
date=new Date();switch(level){default:level=Wirecloud.constants.LOGGING.ERROR_MSG;case Wirecloud.constants.LOGGING.ERROR_MSG:if('console'in window&&typeof console.error==='function'){console.error(msg);}
break;case Wirecloud.constants.LOGGING.WARN_MSG:if('console'in window&&typeof console.warn==='function'){console.warn(msg);}
break;case Wirecloud.constants.LOGGING.INFO_MSG:if('console'in window&&typeof console.info==='function'){console.info(msg);}
break;}
entry={"level":level,"msg":msg,"date":date,"logManager":this};if(options.details!=null){entry.details=options.details;}
this._addEntry(entry);};LogManager.prototype.formatException=function formatException(exception){return builder.parse(Wirecloud.currentTheme.templates.exception_log_details,{message:exception.toString(),stacktrace:exception.stack});};LogManager.prototype.formatError=function formatError(format,transport,e){var msg,errorDesc;if(e){var context;if(e.lineNumber!==undefined){context={errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e.message};}else if(e.line!==undefined){context={errorFile:e.sourceURL,errorLine:e.line,errorDesc:e.message};}else{var text=gettext("unknown");context={errorFile:text,errorLine:text,errorDesc:e.message};}
msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),context,true);}else{try{var errorInfo=JSON.parse(transport.responseText);msg=errorInfo.description;}catch(error){msg=gettext("HTTP Error %(errorCode)s - %(errorDesc)s");if(transport.status!==0&&transport.statusText!==''){errorDesc=gettext(transport.statusText);}else{errorDesc=Wirecloud.constants.HTTP_STATUS_DESCRIPTIONS[transport.status];if(errorDesc==null){errorDesc=Wirecloud.constants.UNKNOWN_STATUS_CODE_DESCRIPTION;}}
msg=interpolate(msg,{errorCode:transport.status,errorDesc:errorDesc},true);}}
msg=interpolate(format,{errorMsg:msg},true);return msg;};LogManager.prototype.formatAndLog=function formatAndLog(format,transport,e,level){var msg=this.formatError(format,transport,e);this.log(msg,level);return msg;};LogManager.prototype.reset=function reset(){var i;this.wrapperElement.innerHTML='';this.resetCounters();this.entries=[];for(i=this.childManagers.length-1;i>=0;i-=1){if(this.childManagers[i].isClosed()){this.childManagers.splice(i,1);}else{this.childManagers[i].reset();}}};LogManager.prototype.resetCounters=function resetCounters(){this.errorCount=0;this.totalCount=0;};LogManager.prototype.getErrorCount=function getErrorCount(){return this.errorCount;};LogManager.prototype.close=function close(){this.closed=true;};LogManager.prototype.isClosed=function isClosed(){return this.closed;};Wirecloud.LogManager=LogManager;Wirecloud.GlobalLogManager=new LogManager();})();(function(){"use strict";var LogManager=function LogManager(iWidget){Wirecloud.LogManager.call(this,Wirecloud.GlobalLogManager);this.iWidget=iWidget;};LogManager.prototype=new Wirecloud.LogManager();LogManager.prototype.buildExtraInfo=function buildExtraInfo(){var extraInfo=document.createElement('div'),extraInfoIcon=document.createElement('div'),extraInfoText=document.createElement('span');extraInfo.className+=" iwidget_info_container";extraInfo.appendChild(extraInfoIcon);extraInfo.appendChild(extraInfoText);extraInfoIcon.className="iwidget_info";extraInfoText.innerHTML=this.iWidget.id;extraInfoText.setAttribute('title',this.iWidget.name+"\n "+this.iWidget.widget.getInfoString());extraInfo.style.cursor="pointer";return extraInfo;};LogManager.prototype.buildTitle=function buildTitle(){var title;if(this.iWidget){title=gettext('%(iwidget_name)s\'s logs');title=interpolate(title,{iwidget_name:this.iWidget.name},true);return title;}else{return this.title;}};LogManager.prototype.close=function close(){this.title=this.buildTitle();this.iWidget=null;};Wirecloud.Widget.LogManager=LogManager;})();(function(){"use strict";var MACField,onclick,onfocus,onblur;onclick=function onclick(e){if('target'in e&&e.target===this.wrapperElement){e.stopPropagation();e.preventDefault();}
var dialog=new Wirecloud.ui.MACSelectionWindowMenu(this.dialog_title,{scope:this.scope,});dialog.show(this.parent_dialog);dialog.addEventListener('select',function(selected_mashup){this.setValue(selected_mashup);}.bind(this));};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};MACField=function MACField(options){var defaultOptions={'class':'','scope':'','dialog':null};options=Wirecloud.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.layout=new StyledElements.HorizontalLayout({'class':'se-mac-field input input-prepend input-append'});this.wrapperElement=this.layout.wrapperElement;if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","hidden");this.wrapperElement.appendChild(this.inputElement);this.resource_details=null;if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.name_preview=document.createElement('div');this.name_preview.className='add-on';this.layout.getCenterContainer().appendChild(this.name_preview);var close_button=new StyledElements.StyledButton({iconClass:'icon-remove',title:gettext('Clear current selection')});this.layout.getWestContainer().appendChild(close_button);close_button.disable();close_button.addEventListener('click',function(){this.setValue('');}.bind(this));var button=new StyledElements.StyledButton({iconClass:'icon-search',title:gettext('Search')});this.layout.getEastContainer().appendChild(button);Object.defineProperties(this,{'close_button':{value:close_button},'scope':{value:options.scope},'parent_dialog':{value:options.parent_dialog},'dialog_title':{value:options.dialog_title}});this.wrapperElement.addEventListener('click',onclick.bind(this),false);button.addEventListener('click',onclick.bind(this),true);close_button.addEventListener('focus',onfocus.bind(this));close_button.addEventListener('blur',onblur.bind(this));button.addEventListener('focus',onfocus.bind(this));button.addEventListener('blur',onblur.bind(this));};MACField.prototype=new StyledElements.StyledInputElement();MACField.prototype.repaint=function repaint(){this.layout.repaint();};MACField.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledInputElement.prototype.insertInto.call(this,element,refElement);this.repaint();};MACField.prototype.setValue=function setValue(new_value){var mac_id,mac_title;if(typeof new_value!=='string'){mac_id=new_value.uri;mac_title=new_value.title;this.resource_details;}else{mac_id=new_value;mac_title=new_value;this.resource_details=null;}
this.inputElement.value=mac_id;this.name_preview.textContent=mac_title;this.close_button.setDisabled(new_value==='');this.events.change.dispatch(this);};MACField.prototype.getValue=function getValue(){return this.inputElement.value;};Wirecloud.ui.MACField=MACField;var MACInputInterface=function MACInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new Wirecloud.ui.MACField(options);};MACInputInterface.prototype=new StyledElements.InputInterface();Wirecloud.ui.MACInputInterface=MACInputInterface;})();(function(){"use strict";var InputInterfaceFactory=new StyledElements.InputInterfaceFactory();InputInterfaceFactory.addFieldType('layout',Wirecloud.ui.LayoutInputInterface);InputInterfaceFactory.addFieldType('parametrizableValue',Wirecloud.ui.ParametrizableValueInputInterface);InputInterfaceFactory.addFieldType('parametrizedText',ParametrizedTextInputInterface);InputInterfaceFactory.addFieldType('mac',Wirecloud.ui.MACInputInterface);Wirecloud.ui.InputInterfaceFactory=InputInterfaceFactory;})();(function(){"use strict";var IWidgetMenuItems=function IWidgetMenuItems(iWidget){StyledElements.DynamicMenuItems.call(this);this.iWidget=iWidget;this.has_prefs=iWidget.widget.preferenceList.length>0;};IWidgetMenuItems.prototype=new StyledElements.DynamicMenuItems();IWidgetMenuItems.prototype.build=function(){var items,item,fulldragboard_label,layout_label;items=[];item=new StyledElements.MenuItem(gettext('Rename'),function(){this.titleelement.enableEdition();}.bind(this.iWidget));item.setDisabled(!this.iWidget.isAllowed('rename'));items.push(item);item=new StyledElements.MenuItem(gettext("Settings"),function(){var dialog=new Wirecloud.Widget.PreferencesWindowMenu();dialog.show(this);}.bind(this.iWidget.internal_iwidget));item.setDisabled(!this.has_prefs||!this.iWidget.isAllowed('configure'));items.push(item);items.push(new StyledElements.MenuItem(gettext("Logs"),function(){var dialog=new Wirecloud.ui.LogWindowMenu(this.logManager);dialog.show();}.bind(this.iWidget.internal_iwidget)));items.push(new StyledElements.MenuItem(gettext("Reload"),function(){try{var prev=this.content.src;this.content.src=this.codeURL;if(this.content.src===prev){this.content.contentDocument.location.reload();}}catch(e){}}.bind(this.iWidget)));item=new StyledElements.MenuItem(gettext("User's Manual"),function(){var myresources_view=LayoutManagerFactory.getInstance().viewsByName.myresources;myresources_view.createUserCommand('showDetails',this.widget,{version:this.widget.version,tab:'Documentation'})();}.bind(this.iWidget));item.setDisabled(this.iWidget.widget.doc==='');items.push(item);if(this.iWidget.isInFullDragboardMode()){fulldragboard_label=gettext("Exit Full Dragboard");}else{fulldragboard_label=gettext("Full Dragboard");}
item=new StyledElements.MenuItem(fulldragboard_label,function(){this.setFullDragboardMode(!this.isInFullDragboardMode());}.bind(this.iWidget));item.setDisabled(!this.iWidget.isAllowed('move'));items.push(item);if(!this.iWidget.isInFullDragboardMode()){if(this.iWidget.onFreeLayout()){layout_label=gettext("Snap to grid");}else{layout_label=gettext("Extract from grid");}
item=new StyledElements.MenuItem(layout_label,this.iWidget.toggleLayout.bind(this.iWidget));item.setDisabled(!this.iWidget.isAllowed('move'));items.push(item);}
return items;};Wirecloud.ui.IWidgetMenuItems=IWidgetMenuItems;})();(function(){"use strict";var returnTrue=function returnTrue(){return true;};var ResizeHandle=function ResizeHandle(resizableElement,handleElement,data,onStart,onResize,onFinish,canBeResized){var xDelta=0,yDelta=0;var xStart=0,yStart=0;var scrollDelta,scrollStart=0;var dragboardCover;var x,y;var endresize,resize,startresize,scroll;canBeResized=canBeResized?canBeResized:returnTrue;endresize=function endresize(e){if(e.type==='mouseup'&&e.button!==0){return;}else if(e.type==='touchend'&&e.touches.length>0){return;}
document.removeEventListener("mouseup",endresize,false);document.removeEventListener("touchend",endresize,false);document.removeEventListener("mousemove",resize,false);document.removeEventListener("touchmove",resize,false);dragboardCover.parentNode.removeEventListener("scroll",scroll,true);dragboardCover.parentNode.removeChild(dragboardCover);dragboardCover=null;handleElement.removeEventListener("mouseup",endresize,false);handleElement.removeEventListener("touchend",endresize,false);handleElement.removeEventListener("mousemove",resize,false);handleElement.removeEventListener("touchmove",resize,false);onFinish(resizableElement,handleElement,data);handleElement.addEventListener("mousedown",startresize,false);handleElement.addEventListener("touchstart",startresize,false);document.removeEventListener('mousedown',Wirecloud.Utils.preventDefaultListener,false);document.removeEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener,false);};resize=function resize(e){var clientX,clientY;if('touches'in e){clientX=e.touches[0].clientX;clientY=e.touches[0].clientY;e.preventDefault();}else{clientX=e.clientX;clientY=e.clientY;}
xDelta=clientX-xStart;yDelta=clientY-yStart;onResize(resizableElement,handleElement,data,x+xDelta,y+yDelta-scrollDelta);};scroll=function scroll(){var dragboard=dragboardCover.parentNode;dragboardCover.style.height=dragboard.scrollHeight+"px";var scrollTop=parseInt(dragboard.scrollTop,10);scrollDelta=scrollStart-scrollTop;onResize(resizableElement,handleElement,data,x+xDelta,y+yDelta-scrollDelta);};startresize=function startresize(e){if(e.type==='mousedown'&&e.button!==0){return;}
if(!canBeResized(resizableElement,data)){return false;}
document.addEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener,false);document.addEventListener('mousedown',Wirecloud.Utils.preventDefaultListener,false);handleElement.removeEventListener("mousedown",startresize,false);handleElement.removeEventListener("touchstart",startresize,false);if('touches'in e){xStart=e.touches[0].clientX;yStart=e.touches[0].clientY;}else{xStart=e.clientX;yStart=e.clientY;}
x=resizableElement.offsetLeft+handleElement.offsetLeft+(handleElement.offsetWidth/2);y=resizableElement.offsetTop+handleElement.offsetTop+(handleElement.offsetHeight/2);document.addEventListener("mouseup",endresize,false);document.addEventListener("touchend",endresize,false);document.addEventListener("mousemove",resize,false);document.addEventListener("touchmove",resize,false);var dragboard=EzWebEffectBase.findDragboardElement(resizableElement);dragboardCover=document.createElement("div");dragboardCover.className="cover";dragboardCover.addEventListener("mouseup",endresize,true);dragboardCover.addEventListener("mousemove",resize,true);dragboardCover.style.zIndex="1000000";dragboardCover.style.position="absolute";dragboardCover.style.top="0";dragboardCover.style.left="0";dragboardCover.style.width="100%";dragboardCover.style.height=dragboard.scrollHeight+"px";scrollStart=dragboard.scrollTop;scrollDelta=0;dragboard.addEventListener("scroll",scroll,true);dragboard.insertBefore(dragboardCover,dragboard.firstChild);handleElement.addEventListener("mouseup",endresize,false);handleElement.addEventListener("touchend",endresize,false);handleElement.addEventListener("mousemove",resize,false);handleElement.addEventListener("touchmove",resize,false);onStart(resizableElement,handleElement,data);return false;};handleElement.addEventListener("mousedown",startresize,false);handleElement.addEventListener("touchstart",startresize,false);this.setResizableElement=function(element){resizableElement=element;};this.destroy=function(){handleElement.removeEventListener("mousedown",startresize,true);startresize=null;resize=null;scroll=null;endresize=null;data=null;handleElement=null;};};Wirecloud.ui.ResizeHandle=ResizeHandle;})();(function(){"use strict";var IWidgetResizeHandle=function IWidgetResizeHandle(iWidget,options){if(options==null){options={};}
options.resizeLeftSide=!!options.resizeLeftSide;options.resizeTopSide=!!options.resizeTopSide;options.fixHeight=!!options.fixHeight;options.fixWidth=!!options.fixWidth;options.iWidget=iWidget;if(options.fixWidth&&options.fixHeight){throw new Exception('fixWidth and fixHeight cannot be true at the same time');}
StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement('div');Wirecloud.ui.ResizeHandle.call(this,iWidget.element,this.wrapperElement,options,IWidgetResizeHandle.prototype.startFunc,IWidgetResizeHandle.prototype.updateFunc,IWidgetResizeHandle.prototype.finishFunc,IWidgetResizeHandle.prototype.canBeResizedFunc);};IWidgetResizeHandle.prototype=new StyledElements.StyledElement();IWidgetResizeHandle.prototype.canBeResizedFunc=function canBeResizedFunc(resizableElement,data){return data.iWidget.isAllowed('resize');};IWidgetResizeHandle.prototype.startFunc=function startFunc(resizableElement,handleElement,data){handleElement.classList.add("inUse");data.iWidget.element.classList.add('draganddrop');data.minWidth=Math.ceil(data.iWidget.layout.fromPixelsToHCells(80));data.minHeight=Math.ceil(data.iWidget.layout.fromPixelsToVCells(50));data.innitialWidth=data.iWidget.getWidth();data.innitialHeight=data.iWidget.getHeight();data.oldZIndex=data.iWidget.getZPosition();data.iWidget.setZPosition("999999");data.dragboard=data.iWidget.layout.dragboard;};IWidgetResizeHandle.prototype.updateFunc=function updateFunc(resizableElement,handleElement,data,x,y){var iWidget=data.iWidget;if(iWidget.layout.isInside(x,y)){var position=iWidget.layout.getCellAt(x,y);var currentPosition=iWidget.getPosition();var width,height;if(!data.fixWidth){if(data.resizeLeftSide){width=currentPosition.x+iWidget.getWidth()-position.x;}else{width=position.x-currentPosition.x+1;}}else{width=iWidget.getWidth();}
if(!data.fixHeight){height=position.y-currentPosition.y+1;}else{height=iWidget.getHeight();}
if(width<data.minWidth){width=data.minWidth;}
if(height<data.minHeight){height=data.minHeight;}
if(width!==iWidget.getWidth()||height!==iWidget.getHeight()){iWidget.setSize(width,height,data.resizeLeftSide,false);}}};IWidgetResizeHandle.prototype.finishFunc=function finishFunc(resizableElement,handleElement,data){var iWidget=data.iWidget;data.iWidget.element.classList.remove('draganddrop');data.iWidget.setZPosition(data.oldZIndex);if(data.innitialWidth!==data.iWidget.getWidth()||data.innitialHeight!==data.iWidget.getHeight()){iWidget.setSize(iWidget.getWidth(),iWidget.getHeight(),data.resizeLeftSide,true);}
handleElement.classList.remove("inUse");data.dragboard._notifyWindowResizeEvent();};window.IWidgetResizeHandle=IWidgetResizeHandle;})();(function(){var builder=new StyledElements.GUIBuilder();var IWidgetView=function IWidgetView(iwidget,template,view){var tmp={};var ui_fragment=builder.parse(template,{'closebutton':function(){var button=new StyledElements.StyledButton({'plain':true,'class':'icon-remove','title':gettext('Close')});button.addEventListener("click",function(){iwidget.remove();});tmp.closebutton=button;return button;},'errorbutton':function(){var button=new StyledElements.StyledButton({'plain':true,'class':'errorbutton icon-warning-sign'});button.addEventListener("click",function(button){var dialog=new Wirecloud.ui.LogWindowMenu(this.logManager);dialog.show();}.bind(this));button.disable();tmp.errorbutton=button;return button;}.bind(iwidget),'menubutton':function(){var button=new StyledElements.StyledButton({'plain':true,'class':'icon-cogs','title':gettext('Menu')});button.addEventListener("click",function(button){view.menu.show(button.getBoundingClientRect());});tmp.menubutton=button;return button;},'minimizebutton':function(){var button=new StyledElements.StyledButton({'plain':true});button.addEventListener("click",function(button){view.toggleMinimizeStatus(true);});tmp.minimizebutton=button;return button;},'title':function(){var element=new StyledElements.EditableElement({initialContent:view.name});element.addEventListener('change',function(element,new_name){iwidget.setName(new_name);});tmp.titleelement=element;return element;},'bottomresizehandle':function(){var handle=new IWidgetResizeHandle(view,{resizeLeftSide:true,fixWidth:true});tmp.bottomresizehandle=handle;handle.addClassName("bottomResizeHandle");return handle;},'leftresizehandle':function(){var handle=new IWidgetResizeHandle(view,{resizeLeftSide:true});tmp.leftresizehandle=handle;handle.addClassName("leftResizeHandle");return handle;},'rightresizehandle':function(){var handle=new IWidgetResizeHandle(view,{resizeLeftSide:false});tmp.rightresizehandle=handle;handle.addClassName("rightResizeHandle");return handle;},'iframe':function(){var content=document.createElement("iframe");content.classList.add("widget_object");content.setAttribute("type",this.widget.code_content_type);content.setAttribute("frameBorder","0");content.addEventListener("load",iwidget._notifyLoaded.bind(iwidget,content),true);return content;}.bind(iwidget)});if('bottomresizehandle'in tmp){tmp.bottomresizehandle.setResizableElement(ui_fragment.elements[1]);}
if('leftresizehandle'in tmp){tmp.leftresizehandle.setResizableElement(ui_fragment.elements[1]);}
if('rightresizehandle'in tmp){tmp.rightresizehandle.setResizableElement(ui_fragment.elements[1]);}
this.element=ui_fragment.elements[1];this.element.classList.add('iwidget');this.tmp=tmp;};Wirecloud.ui.IWidgetView=IWidgetView;})();(function(){"use strict";var _canBeDragged=function(){return true;};var _cancel=function(){return false;};var Draggable=function Draggable(handler,data,onStart,onDrag,onFinish,canBeDragged,onScroll){var xStart=0,yStart=0,xScrollStart=0,yScrollStart=0;var xScrollDelta,yScrollDelta;var dragboardCover;var draggable=this;var enddrag,drag,startdrag,scroll;canBeDragged=canBeDragged?canBeDragged:_canBeDragged;enddrag=function enddrag(e){if(e.type==='mouseup'&&e.button!==0){return;}else if(e.type==='touchend'&&e.touches.length>0){return;}
document.removeEventListener("mouseup",enddrag,false);document.removeEventListener("touchend",enddrag,false);document.removeEventListener("mousemove",drag,false);document.removeEventListener("touchmove",drag,false);if(dragboardCover!=null){dragboardCover.parentNode.removeEventListener("scroll",scroll,true);dragboardCover.parentNode.removeChild(dragboardCover);dragboardCover=null;}
onFinish(draggable,data,e);handler.addEventListener("mousedown",startdrag,false);handler.addEventListener("touchstart",startdrag,false);document.removeEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener);document.removeEventListener('mousedown',Wirecloud.Utils.preventDefaultListener);};drag=function drag(e){var clientX,clientY;if('touches'in e){clientX=e.touches[0].clientX;clientY=e.touches[0].clientY;e.preventDefault();}else{clientX=e.clientX;clientY=e.clientY;}
var xDelta=clientX-xStart-xScrollDelta;var yDelta=clientY-yStart-yScrollDelta;onDrag(e,draggable,data,xDelta,yDelta);};startdrag=function startdrag(e){if(e.type==='mousedown'&&e.button!==0){return;}
if(!canBeDragged(draggable,data)){return false;}
e.preventDefault();document.addEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener);document.addEventListener('mousedown',Wirecloud.Utils.preventDefaultListener);handler.removeEventListener("mousedown",startdrag,false);handler.removeEventListener("touchstart",startdrag,false);if('touches'in e){xStart=e.touches[0].clientX;yStart=e.touches[0].clientY;}else{xStart=e.clientX;yStart=e.clientY;}
document.addEventListener("mouseup",enddrag,false);document.addEventListener("touchend",enddrag,false);document.addEventListener("mousemove",drag,false);document.addEventListener("touchmove",drag,false);yScrollDelta=0;xScrollDelta=0;var options=onStart(draggable,data,e);if(options!=null&&options.dragboard){var dragboard=options.dragboard;dragboardCover=document.createElement("div");dragboardCover.className="cover";dragboardCover.addEventListener("mouseup",enddrag,true);dragboardCover.addEventListener("touchend",enddrag,true);dragboardCover.addEventListener("mousemove",drag,true);dragboardCover.addEventListener("touchmove",drag,true);dragboardCover.style.zIndex="1000000";dragboardCover.style.position="absolute";dragboardCover.style.top="0";dragboardCover.style.left="0";dragboardCover.style.width="100%";dragboardCover.style.height=dragboard.scrollHeight+"px";yScrollStart=parseInt(dragboard.scrollTop,10);xScrollStart=parseInt(dragboard.scrollLeft,10);dragboardCover.addEventListener("scroll",scroll,true);dragboard.insertBefore(dragboardCover,dragboard.firstChild);}
e.stopPropagation();};scroll=function scroll(e){var dragboard=dragboardCover.parentNode;dragboardCover.style.height=dragboard.scrollHeight+"px";var scrollTop=parseInt(dragboard.scrollTop,10);var oldYDelta=yScrollDelta;yScrollDelta=yScrollStart-scrollTop;var yScrollDeltaDiff=yScrollDelta-oldYDelta;var scrollLeft=parseInt(dragboard.scrollLeft,10);var oldXDelta=xScrollDelta;xScrollDelta=xScrollStart-scrollLeft;var xScrollDeltaDiff=xScrollDelta-oldXDelta;onScroll(e,draggable,data,xScrollDeltaDiff,yScrollDeltaDiff);};handler.addEventListener("mousedown",startdrag,false);handler.addEventListener("touchstart",startdrag,false);this.destroy=function destroy(){handler.removeEventListener("mousedown",startdrag,false);handler.removeEventListener("touchstart",startdrag,false);startdrag=null;enddrag=null;drag=null;scroll=null;draggable=null;data=null;handler=null;};};Wirecloud.ui.Draggable=Draggable;})();(function(){"use strict";var Theme=function Theme(desc){Object.defineProperty(this,'templates',{value:desc});};Wirecloud.ui.Theme=Theme;})();(function(){"use strict";var WirecloudCatalogue,_onSearchSuccess,_onSearchFailure,deleteSuccessCallback,deleteErrorCallback;_onSearchSuccess=function _onSearchSuccess(response){var i,data,raw_data;raw_data=JSON.parse(response.responseText);data={'resources':raw_data.results,'current_page':parseInt(raw_data.pagenum,10),'total_count':parseInt(raw_data.total,10)};if('corrected_q'in raw_data){data.corrected_query=raw_data.corrected_q;}
this.onSuccess(data.resources,data);};_onSearchFailure=function _onSearchFailure(reponse){this.onFailure();};deleteSuccessCallback=function deleteSuccessCallback(response){var result;if(typeof this.onSuccess==='function'){result=JSON.parse(response.responseText);this.onSuccess(result);}};deleteErrorCallback=function deleteErrorCallback(response,e){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error deleting resource: %(errorMsg)s."),response,e);if(typeof this.onFailure==='function'){this.onFailure(msg);}};WirecloudCatalogue=function WirecloudCatalogue(options){Object.defineProperty(this,'name',{'value':options.name});Object.defineProperty(this,'permissions',{'value':options.permissions});if(options.url==null){options.url=Wirecloud.URLs.LOCAL_REPOSITORY;}else if(options.url[options.url.length-1]!=='/'){options.url+='/';}
Object.defineProperties(this,{'RESOURCE_CHANGELOG_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s/changelog')},'RESOURCE_USERGUIDE_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s/userguide')},'RESOURCE_COLLECTION':{value:options.url+'catalogue/resources'},'RESOURCE_UNVERSIONED_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s')},'RESOURCE_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s')},});};WirecloudCatalogue.prototype.isAllow=function isAllow(action){if(action in this.permissions){return this.permissions[action];}else{return false;}};WirecloudCatalogue.prototype.search=function search(options){var params,url;if(options==null){throw new TypeError();}
params={};if(options.search_criteria!=null&&options.search_criteria!==''){params.q=options.search_criteria;}
if(options.scope!=null&&options.scope!==''&&options.scope!=='all'){if(['widget','operator','mashup'].indexOf(options.scope)===-1){throw new TypeError('invalid scope value');}
params.scope=options.scope;}
if(options.order_by!=null&&options.order_by!==''){params.orderby=options.order_by;}
if(options.maxresults!=null){if(typeof options.maxresults!=='number'||options.maxresults<20){throw new TypeError('invalid maxresults value');}
params.maxresults=options.maxresults;}
if(options.pagenum!=null){if(typeof options.pagenum!=='number'||options.pagenum<0){throw new TypeError('invalid pagenum value');}
params.pagenum=options.pagenum;}
Wirecloud.io.makeRequest(this.RESOURCE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},parameters:params,onSuccess:_onSearchSuccess.bind(options),onFailure:_onSearchFailure.bind(options),onComplete:options.onComplete});};WirecloudCatalogue.prototype.getResourceDetails=function getResourceDetails(vendor,name,options){if(options==null){options={};}
var url=this.RESOURCE_UNVERSIONED_ENTRY.evaluate({vendor:vendor,name:name});Wirecloud.io.makeRequest(url,{method:'GET',onSuccess:function(response){var resource_details=new Wirecloud.WirecloudCatalogue.ResourceDetails(JSON.parse(response.responseText),this);try{options.onSuccess(resource_details);}catch(e){}}.bind(this),onFailure:options.onFailure,onComplete:options.onComplete});};WirecloudCatalogue.prototype.is_purchased=function is_purchased(){return true;};WirecloudCatalogue.prototype.addPackagedResource=function addPackagedResource(data,options){var url,requestHeaders,task,onUploadProgress;requestHeaders={'Accept':'application/json'};if(typeof options!='object'){options={};}
if(this.name==='local'){url=Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION;}else{url=this.RESOURCE_COLLECTION;if(this.accesstoken!=null){requestHeaders['Authorization']='Bearer '+this.accesstoken;}}
data.append('install_embedded_resources','true');if(options.monitor){task=options.monitor.nextSubtask(gettext('Uploading packaged resource'));onUploadProgress=function(event){task.updateTaskProgress(Math.round(event.loaded*100/event.total));};}
Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:requestHeaders,postBody:data,onSuccess:function(transport){var response_data=JSON.parse(transport.responseText);if(typeof options.onSuccess==='function'){try{options.onSuccess(response_data.resource_details,response_data.extra_resources);}catch(e){}}}.bind(this),onFailure:function(transport){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding packaged resource: %(errorMsg)s."),transport);if(typeof options.onFailure==='function'){try{options.onFailure(msg);}catch(e){}}},onComplete:function(){if(typeof options.onComplete==='function'){try{options.onComplete();}catch(e){}}},onUploadProgress:onUploadProgress});};WirecloudCatalogue.prototype.addResourceFromURL=function addResourceFromURL(url,options){if(typeof options!='object'){options={};}
Wirecloud.io.makeRequest(this.RESOURCE_COLLECTION,{method:'POST',requestHeaders:{'Accept':'application/json'},parameters:{'template_uri':url,force_create:!!options.forceCreate},onSuccess:function(){if(typeof options.onSuccess==='function'){options.onSuccess();}}.bind(this),onFailure:function(transport){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding resource from URL: %(errorMsg)s."),transport);if(typeof options.onFailure==='function'){options.onFailure(msg);}},onComplete:function(){if(typeof options.onComplete==='function'){options.onComplete();}}});};WirecloudCatalogue.prototype.deleteResource=function deleteResource(resource,options){var url;options=Wirecloud.Utils.merge({'allversions':false},options);if(options.allversions){url=this.RESOURCE_UNVERSIONED_ENTRY.evaluate({vendor:resource.vendor,name:resource.name});}else{url=this.RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name,version:resource.version.text});}
Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:deleteSuccessCallback.bind(options),onFailure:deleteErrorCallback.bind(options),onException:deleteErrorCallback.bind(options)});};Wirecloud.WirecloudCatalogue=WirecloudCatalogue;})();(function(){"use strict";var ResourceDetails=function ResourceDetails(data,catalogue){var currentVersion=null,allVersions=[],data_by_version={};this.getLastVersion=function(){return allVersions[0];};this.getAllVersions=function(){return allVersions;};this.isAllow=function isAllow(action){switch(action){case'uninstall':case'uninstall-all':return currentVersion.permissions.uninstall;case'delete':case'delete-all':return currentVersion.permissions.delete;}};Object.defineProperties(this,{'catalogue':{value:catalogue},'vendor':{value:data.vendor},'name':{value:data.name},'version':{get:function(){return currentVersion.version;}},'authors':{get:function(){return currentVersion.authors;}},'contributors':{get:function(){return currentVersion.contributors;}},'uri':{get:function(){return[this.vendor,this.name,currentVersion.version.text].join('/');}},'type':{value:data.type},'image':{get:function(){return currentVersion.image;}},'description_url':{get:function(){return currentVersion.uriTemplate;}},'description':{get:function(){return currentVersion.description;}},'longdescription':{get:function(){return currentVersion.longdescription;}},'homepage':{get:function(){return currentVersion.homepage;}},'doc':{get:function(){return currentVersion.doc;}},'changelog':{get:function(){return currentVersion.changelog;}},'size':{get:function(){return currentVersion.size;}},'title':{get:function(){return currentVersion.title;}},'tags':{get:function(){return[];}},'rating':{get:function(){return 0;}},'date':{get:function(){return currentVersion.date;}},'license':{get:function(){return currentVersion.license;}},'licenseurl':{get:function(){return currentVersion.licenseurl;}}});this.changeVersion=function changeVersion(version){if(version instanceof Wirecloud.Version){version=version.text;}
if(version in data_by_version){currentVersion=data_by_version[version];}else{currentVersion=data_by_version[allVersions[0].text];}
return this;};var i,version_data;for(i=0;i<data.versions.length;i+=1){version_data=data.versions[i];version_data.version=new Wirecloud.Version(version_data.version,'catalogue');version_data.date=new Date(version_data.date);allVersions.push(version_data.version);data_by_version[version_data.version.text]=version_data;}
allVersions=allVersions.sort(function(version1,version2){return-version1.compareTo(version2);});this.changeVersion(allVersions[0]);Object.freeze(this);};Wirecloud.WirecloudCatalogue.ResourceDetails=ResourceDetails;})();(function(){"use strict";var uninstallOrDeleteSuccessCallback=function uninstallOrDeleteSuccessCallback(resource,next,result){var layoutManager,result,i,iwidget,uri;if(result.affectedVersions==null){result.affectedVersions=[resource.version];}
switch(resource.type){case'widget':layoutManager=LayoutManagerFactory.getInstance();layoutManager.logSubTask(gettext('Removing affected iWidgets'));for(i=0;i<result.removedIWidgets.length;i+=1){iwidget=Wirecloud.activeWorkspace.getIWidget(result.removedIWidgets[i]);if(iwidget!=null){iwidget.remove(true);}}
layoutManager.logSubTask(gettext('Purging widget info'));break;case'operator':layoutManager=LayoutManagerFactory.getInstance();layoutManager.logSubTask(gettext('Uninstantiating affected operators'));Wirecloud.activeWorkspace.wiring._notifyOperatorUninstall(resource,result.affectedVersions);layoutManager.logSubTask(gettext('Purging operator info'));break;}
for(i=0;i<result.affectedVersions.length;i++){try{uri=resource.vendor+'/'+resource.name+'/'+result.affectedVersions[i];delete this.resources[uri];delete this.resourcesByType[resource.type][uri];}catch(e){}}
if(typeof next==='function'){next();}};var uninstallSuccessCallback=function uninstallSuccessCallback(resource,next,response){var result=JSON.parse(response.responseText);uninstallOrDeleteSuccessCallback.call(this,resource,next,result);};var uninstallErrorCallback=function uninstallErrorCallback(options,response){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error uninstalling resource: %(errorMsg)s."),response);if(typeof options.onFailure==='function'){options.onFailure(msg);}};var loadSuccessCallback=function loadFailureCallback(context,transport){var resources,resource_id;resources=JSON.parse(transport.responseText);this.resources={};this.resourceVersions={};this.resourcesByType={};for(resource_id in resources){this._includeResource.call(this,resources[resource_id]);}
if(typeof context.onSuccess==='function'){context.onSuccess();}};var loadFailureCallback=function loadFailureCallback(context,transport){if(typeof context.onError==='function'){context.onError();}};var process_upload_response=function process_upload_response(response_data){var i,id,resource_data;if(!Array.isArray(response_data)){response_data=[response_data];}
for(i=0;i<response_data.length;i+=1){resource_data=response_data[i];id=[resource_data.vendor,resource_data.name,resource_data.version].join('/');if(this.resourceExistsId(id)){continue;}
this._includeResource.call(this,resource_data);}};var process_packaged_upload_response=function process_packaged_upload_response(next,response_data){process_upload_response.call(this,response_data);if(typeof next==='function'){try{next();}catch(e){}}};var LocalCatalogue=new Wirecloud.WirecloudCatalogue({name:'local',permissions:{'delete':false}});LocalCatalogue.reload=function reload(options){if(typeof options!=='object'){options={};}
var context={'onSuccess':options.onSuccess,'onError':options.onError};if(Wirecloud.contextManager.get('username')!=='anonymous'){Wirecloud.io.makeRequest(Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:loadSuccessCallback.bind(this,context),onFailure:loadFailureCallback.bind(this,context)});}else{loadSuccessCallback.call(this,context,{responseText:"{}"});}};LocalCatalogue.uninstallResource=function uninstallResource(resource,options){var url;options=Wirecloud.Utils.merge({'allversions':false},options);if(options.allversions){url=Wirecloud.URLs.LOCAL_UNVERSIONED_RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name});}else{url=Wirecloud.URLs.LOCAL_RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name,version:resource.version.text});}
Wirecloud.io.makeRequest(url+'?affected=true',{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:uninstallSuccessCallback.bind(this,resource,options.onSuccess),onFailure:uninstallErrorCallback.bind(this,options),onComplete:options.onComplete});};LocalCatalogue.deleteResource=function deleteResource(resource,options){if(options==null){options={};}
options.onSuccess=uninstallOrDeleteSuccessCallback.bind(this,resource,options.onSuccess);Wirecloud.WirecloudCatalogue.prototype.deleteResource.call(this,resource,options);};LocalCatalogue.addPackagedResource=function addPackagedResource(data,options){if(options==null){options={};}
options.onSuccess=function(next,main_resource,extra_resources){process_packaged_upload_response.call(this,next,[main_resource].concat(extra_resources));}.bind(this,options.onSuccess);Wirecloud.WirecloudCatalogue.prototype.addPackagedResource.call(this,data,options);};LocalCatalogue.addResourceFromURL=function addResourceFromURL(url,options){if(typeof options!='object'){options={};}
Wirecloud.io.makeRequest(Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({template_uri:url,force_create:!!options.forceCreate,install_embedded_resources:true,market_endpoint:options.market_info}),onSuccess:function(response){var i,id,response_data,resource_data;response_data=JSON.parse(response.responseText);process_upload_response.call(this,[response_data.resource_details].concat(response_data.extra_resources));if(typeof options.onSuccess==='function'){options.onSuccess();}}.bind(this),onFailure:function(response){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding resource from URL: %(errorMsg)s."),response);if(typeof options.onFailure==='function'){options.onFailure(msg);}},onComplete:function(){if(typeof options.onComplete==='function'){options.onComplete();}}});};LocalCatalogue.getAvailableResourcesByType=function getAvailableResourcesByType(type){if(type in this.resourcesByType){return this.resourcesByType[type];}else{return{};}};LocalCatalogue._includeResource=function _includeResource(resource_data){var resource,resource_id,resource_full_id;resource_id=resource_data.vendor+'/'+resource_data.name;resource_full_id=resource_id+'/'+resource_data.version;switch(resource_data.type){case'widget':resource=new Wirecloud.Widget(resource_data);break;case'operator':resource=new Wirecloud.wiring.OperatorMeta(resource_data);if(Wirecloud.activeWorkspace!=null&&Wirecloud.activeWorkspace.wiring!=null){try{Wirecloud.activeWorkspace.wiring._notifyOperatorInstall(resource);}catch(error){}}
break;default:resource=resource_data;}
if(!(resource_id in this.resourceVersions)){this.resourceVersions[resource_id]=[];}
this.resourceVersions[resource_id].push(resource);this.resources[resource_full_id]=resource;if(!(resource_data.type in this.resourcesByType)){this.resourcesByType[resource_data.type]={};}
this.resourcesByType[resource_data.type][resource_full_id]=resource;};LocalCatalogue.getResourceId=function getResourceId(id){return this.resources[id];};LocalCatalogue.getResource=function getResource(vendor,name,version){var id=[vendor,name,version].join('/');return this.getResourceId(id);};LocalCatalogue.resourceExistsId=function resourceExistsId(id){return this.getResourceId(id)!=null;};LocalCatalogue.resourceExists=function resourceExists(resource){var id=[resource.vendor,resource.name,resource.version].join('/');return this.resourceExistsId(id);};Wirecloud.LocalCatalogue=LocalCatalogue;})();(function(){"use strict";var includeResource=function includeResource(resource_data){var resource,resource_id,resource_full_id;resource_id=resource_data.vendor+'/'+resource_data.name;resource_full_id=resource_id+'/'+resource_data.version;switch(resource_data.type){case'widget':resource=new Wirecloud.Widget(resource_data);break;case'operator':resource=new Wirecloud.wiring.OperatorMeta(resource_data);break;default:resource=resource_data;}
if(!(resource_id in this.resourceVersions)){this.resourceVersions[resource_id]=[];}
this.resourceVersions[resource_id].push(resource);this.resources[resource_full_id]=resource;if(!(resource_data.type in this.resourcesByType)){this.resourcesByType[resource_data.type]={};}
this.resourcesByType[resource_data.type][resource_full_id]=resource;};var loadSuccessCallback=function loadFailureCallback(context,transport){var resources,resource_id;resources=JSON.parse(transport.responseText);this.resources={};this.resourceVersions={};this.resourcesByType={};for(resource_id in resources){includeResource.call(this,resources[resource_id]);}
if(typeof context.onSuccess==='function'){context.onSuccess(this);}};var loadFailureCallback=function loadFailureCallback(context,transport){if(typeof context.onError==='function'){context.onError(this);}};var WorkspaceCatalogue=function WorkspaceCatalogue(workspace_id,options){Object.defineProperty(this,'workspace_id',{value:workspace_id});this.reload(options);};WorkspaceCatalogue.prototype.reload=function reload(options){if(typeof options!=='object'){options={};}
var context={'onSuccess':options.onSuccess,'onError':options.onError};var url=Wirecloud.URLs.WORKSPACE_RESOURCE_COLLECTION.evaluate({workspace_id:this.workspace_id});Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:loadSuccessCallback.bind(this,context),onFailure:loadFailureCallback.bind(this,context)});};WorkspaceCatalogue.prototype.getAvailableResourcesByType=function getAvailableResourcesByType(type){if(type in this.resourcesByType){return this.resourcesByType[type];}else{return{};}};WorkspaceCatalogue.prototype.getResourceId=function getResourceId(id){return this.resources[id];};WorkspaceCatalogue.prototype.getResource=function getResource(vendor,name,version){var id=[vendor,name,version].join('/');return this.getResourceId(id);};WorkspaceCatalogue.prototype.resourceExistsId=function resourceExistsId(id){return this.getResourceId(id)!=null;};WorkspaceCatalogue.prototype.resourceExists=function resourceExists(resource){var id=[resource.vendor,resource.name,resource.version.text].join('/');return this.resourceExistsId(id);};Wirecloud.WorkspaceCatalogue=WorkspaceCatalogue;})();(function(){"use strict";var LogManager=function LogManager(wiring){Wirecloud.LogManager.call(this,Wirecloud.GlobalLogManager);Object.defineProperty(this,'wiring',{value:wiring});};LogManager.prototype=new Wirecloud.LogManager();LogManager.prototype.buildExtraInfo=function buildExtraInfo(){var extraInfo=document.createElement('div');return extraInfo;};LogManager.prototype.buildTitle=function buildTitle(){return gettext('Wiring\'s logs');};LogManager.prototype.close=function close(){};Wirecloud.wiring.LogManager=LogManager;})();(function(){"use strict";var Endpoint=function Endpoint(name,type,friendCode,id){this.id=id;};Endpoint.prototype.getId=function getId(){return this.id;};Endpoint.prototype.getFinalSlots=function getFinalSlots(){return null;};Endpoint.prototype.fullDisconnect=function fullDisconnect(){var funcName='fullDisconnect';var msg=gettext("Unimplemented function: %(funcName)s");msg=interpolate(msg,{funcName:funcName},true);Wirecloud.GlobalLogManager.log(msg);return;};Endpoint.prototype.destroy=function destroy(){this.fullDisconnect();};Wirecloud.wiring.Endpoint=Endpoint;})();(function(){"use strict";var EndpointError=function EndpointError(message){this.name="EndpointError";this.message=message||"";};EndpointError.prototype=new Error();EndpointError.prototype.constructor=EndpointError;Object.freeze(EndpointError.prototype);Object.freeze(EndpointError);Wirecloud.wiring.EndpointError=EndpointError;})();(function(){"use strict";var SourceEndpoint=function SourceEndpoint(name,type,friendCode,id){Wirecloud.wiring.Endpoint.call(this,name,type,friendCode,id);this.outputs=[];};SourceEndpoint.prototype=new Wirecloud.wiring.Endpoint();SourceEndpoint.prototype.connect=function connect(out){if(!(out instanceof Wirecloud.wiring.TargetEndpoint)){throw new TypeError('Invalid target endpoint');}
this.outputs.push(out);out._addInput(this);};SourceEndpoint.prototype.disconnect=function disconnect(out){var index=this.outputs.indexOf(out);if(index!=-1){this.outputs.splice(index,1);out._removeInput(this);}};SourceEndpoint.prototype.fullDisconnect=function fullDisconnect(){var outputs=Wirecloud.Utils.clone(this.outputs);for(var i=0;i<outputs.length;++i){this.disconnect(outputs[i]);}};SourceEndpoint.prototype.propagate=function propagate(value,options){var i;options=Wirecloud.Utils.merge({initial:false},options);for(i=0;i<this.outputs.length;++i){this.outputs[i].propagate(value,options);}};SourceEndpoint.prototype.getFinalSlots=function getFinalSlots(){var slots=[];for(var i=0;i<this.outputs.length;++i){var currentSlots=this.outputs[i].getFinalSlots();if(currentSlots&&currentSlots.length>0){slots=slots.concat(currentSlots);}}
return slots;};Wirecloud.wiring.SourceEndpoint=SourceEndpoint;})();(function(){"use strict";var TargetEndpoint=function TargetEndpoint(name,type,friendCode,id){Wirecloud.wiring.Endpoint.call(this,name,type,friendCode,id);this.inputs=[];};TargetEndpoint.prototype=new Wirecloud.wiring.Endpoint();TargetEndpoint.prototype._addInput=function _addInput(input){this.inputs.push(input);};TargetEndpoint.prototype._removeInput=function _removeInput(input){var index=this.inputs.indexOf(input);if(index!=-1){this.inputs.splice(index,input);}};TargetEndpoint.prototype.fullDisconnect=function fullDisconnect(){var inputs=this.inputs.slice(0);for(var i=0;i<inputs.length;++i){inputs[i].disconnect(this);}};Wirecloud.wiring.TargetEndpoint=TargetEndpoint;})();(function(){"use strict";var GhostEntity=function GhostEntity(id,info){if(arguments.length===0){return;}
if(info.preferences==null){info.preferences={};}
Object.defineProperties(this,{'id':{value:id},'meta':{value:{uri:info.name,preferenceList:[]}},'name':{value:info.name},'title':{value:info.name},'preferences':{value:info.preferences,writable:true}});this.inputs={};this.outputs={};};GhostEntity.prototype.fillFromViewInfo=function fillFromViewInfo(data){var i,endpoint;if(!('endPointsInOuts'in data)){return;}
if('sources'in data.endPointsInOuts){for(i=0;i<data.endPointsInOuts.sources.length;i++){endpoint=new Wirecloud.wiring.GhostSourceEndpoint(this,data.endPointsInOuts.sources[i]);this.outputs[endpoint.name]=endpoint;}}
if('targets'in data.endPointsInOuts){for(i=0;i<data.endPointsInOuts.targets.length;i++){endpoint=new Wirecloud.wiring.GhostTargetEndpoint(this,data.endPointsInOuts.targets[i]);this.inputs[endpoint.name]=endpoint;}}};GhostEntity.prototype.destroy=function destroy(){};GhostEntity.prototype.fullDisconnect=function fullDisconnect(){var key,connectables;connectables=this.inputs;for(key in connectables){connectables[key].fullDisconnect();}
connectables=this.outputs;for(key in connectables){connectables[key].fullDisconnect();}};Wirecloud.wiring.GhostEntity=GhostEntity;var GhostOperator=function GhostOperator(id,info){GhostEntity.call(this,id,info);};GhostOperator.prototype=new GhostEntity();Wirecloud.wiring.GhostOperator=GhostOperator;var GhostSourceEndpoint=function GhostSourceEndpoint(entity,endpoint){Object.defineProperties(this,{'entity':{value:entity},'name':{value:endpoint},'label':{value:endpoint},'type':{value:'ioperator'},'friendcode':{value:'ghost_null'}});};GhostSourceEndpoint.prototype=new Wirecloud.wiring.SourceEndpoint();GhostSourceEndpoint.prototype.serialize=function serialize(){return{'type':this.type,'id':this.entity.id,'endpoint':this.name};};Wirecloud.wiring.GhostSourceEndpoint=GhostSourceEndpoint;var GhostTargetEndpoint=function GhostTargetEndpoint(entity,endpoint){Object.defineProperties(this,{'entity':{value:entity},'name':{value:endpoint},'label':{value:endpoint},'type':{value:'ioperator'},'friendcode':{value:'ghost_null'}});};GhostTargetEndpoint.prototype=new Wirecloud.wiring.TargetEndpoint();GhostTargetEndpoint.prototype.propagate=function propagate(newValue,options){};GhostTargetEndpoint.prototype.serialize=function serialize(){return{'type':this.type,'id':this.entity.id,'endpoint':this.name};};Wirecloud.wiring.GhostTargetEndpoint=GhostTargetEndpoint;})();(function(){"use strict";var OperatorFactory={};OperatorFactory.getAvailableOperators=function getAvailableOperators(){return Wirecloud.LocalCatalogue.getAvailableResourcesByType('operator');};OperatorFactory.getOperatorMeta=function getOperatorMeta(name){return Wirecloud.LocalCatalogue.getResourceId(name);};Wirecloud.wiring.OperatorFactory=OperatorFactory;})();(function(){"use strict";var OperatorLogManager=function OperatorLogManager(ioperator){Wirecloud.LogManager.call(this,ioperator.wiring.logManager);this.ioperator=ioperator;};OperatorLogManager.prototype=new Wirecloud.LogManager();OperatorLogManager.prototype.buildTitle=function buildTitle(){var title;if(this.ioperator){title=gettext('%(ioperator_title)s\'s logs');title=interpolate(title,{ioperator_title:this.ioperator.name},true);return title;}else{return this.title;}};OperatorLogManager.prototype.close=function close(){this.title=this.buildTitle();this.ioperator=null;};Wirecloud.wiring.OperatorLogManager=OperatorLogManager;})();(function(){"use strict";var Operator=function Operator(operator_meta,id,operator_status,wiring){var i,inputs,outputs,data_uri,preferenceList,preferences,readonly,hidden,key,value;if(["object","undefined"].indexOf(typeof operator_status)===-1){throw new TypeError('invalid operator status');}
if(operator_status==null){operator_status={};}
if(operator_status.preferences==null){operator_status.preferences={};}
StyledElements.ObjectWithEvents.call(this,['load','unload']);Object.defineProperties(this,{meta:{value:operator_meta},name:{value:operator_meta.name},title:{value:operator_meta.title},id:{value:""+id},wiring:{value:wiring}});Object.defineProperty(this,'logManager',{value:new Wirecloud.wiring.OperatorLogManager(this)});this.loaded=false;inputs=this.meta.inputs;this.inputs={};for(i=0;i<inputs.length;i++){this.inputs[inputs[i].name]=new Wirecloud.wiring.OperatorTargetEndpoint(this,inputs[i]);}
outputs=this.meta.outputs;this.outputs={};for(i=0;i<outputs.length;i++){this.outputs[outputs[i].name]=new Wirecloud.wiring.OperatorSourceEndpoint(this,outputs[i]);}
this.pending_events=[];preferenceList=[];preferences={};for(i=0;i<this.meta.preferenceList.length;i++){key=this.meta.preferenceList[i].name;if(key in operator_status.preferences){value=operator_status.preferences[key].value;readonly=operator_status.preferences[key].readonly;hidden=operator_status.preferences[key].hidden;}else{value=this.meta.preferenceList[i].default;readonly=hidden=false;}
preferences[key]=new Wirecloud.UserPref(this.meta.preferenceList[i],readonly,hidden,value);preferenceList.push(preferences[key]);}
Object.freeze(preferenceList);Object.defineProperty(this,'preferenceList',{value:preferenceList});Object.freeze(preferences);Object.defineProperty(this,'preferences',{value:preferences});if(wiring instanceof Wirecloud.Wiring){this.element=document.createElement('iframe');this.element.className='ioperator';data_uri=Wirecloud.URLs.OPERATOR_ENTRY.evaluate({vendor:operator_meta.vendor,name:operator_meta.name,version:operator_meta.version.text})+'#id='+id;this.element.addEventListener('load',function(){this.logManager.log('Operator loaded',Wirecloud.constants.LOGGING.INFO_MSG);this.loaded=true;this.events.load.dispatch(this);for(var i=0;i<this.pending_events.length;i+=1){this.inputs[this.pending_events[i].endpoint].propagate(this.pending_events[i].value);}
this.pending_events=[];}.bind(this),true);this.element.addEventListener('unload',function(){this.logManager.log('Operator unloaded',Wirecloud.constants.LOGGING.INFO_MSG);this.loaded=false;this.events.unload.dispatch(this);}.bind(this),true);this.element.setAttribute('type','text/html');this.element.setAttribute('src',data_uri);document.getElementById('workspace').appendChild(this.element);}};Operator.prototype=new StyledElements.ObjectWithEvents();Operator.prototype.registerPrefCallback=function registerPrefCallback(prefCallback){this.prefCallback=prefCallback;};Operator.prototype.fullDisconnect=function fullDisconnect(){var key,connectables;connectables=this.inputs;for(key in connectables){connectables[key].fullDisconnect();}
connectables=this.outputs;for(key in connectables){connectables[key].fullDisconnect();}};Operator.prototype.destroy=function destroy(){this.fullDisconnect();if(this.loaded){this.events.unload.dispatch(this);}
if(this.element.parentNode){this.element.parentNode.removeChild(this.element);}};Wirecloud.Operator=Operator;})();(function(){"use strict";var OperatorMeta=function OperatorMeta(desc){var inputs,outputs,prefList,prefs,pref,i;Wirecloud.MashableApplicationComponent.call(this,desc);prefList=desc.preferences;if(!Array.isArray(prefList)){prefList=[];}
prefs={};for(i=0;i<prefList.length;i+=1){pref=prefList[i]=new Wirecloud.UserPrefDef(prefList[i].name,prefList[i].type,prefList[i]);prefs[pref.name]=pref;}
Object.defineProperty(this,'preferences',{value:prefs});Object.defineProperty(this,'preferenceList',{value:prefList});inputs=desc.wiring.inputs;if(inputs==null){inputs={};}
Object.defineProperty(this,'inputs',{value:inputs});outputs=desc.wiring.outputs;if(outputs==null){outputs={};}
Object.defineProperty(this,'outputs',{value:outputs});};OperatorMeta.prototype.instantiate=function instantiate(id,operator_status,wiring){return new Wirecloud.Operator(this,id,operator_status,wiring);};Wirecloud.wiring.OperatorMeta=OperatorMeta;})();(function(){"use strict";var OperatorSourceEndpoint=function OperatorSourceEndpoint(operator,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'operator',{value:operator});Wirecloud.wiring.SourceEndpoint.call(this,this.meta.name,this.meta.type,this.friendcode,'ioperator_'+this.operator.id+'_'+this.meta.name);};OperatorSourceEndpoint.prototype=new Wirecloud.wiring.SourceEndpoint();OperatorSourceEndpoint.prototype.serialize=function serialize(){return{'type':'ioperator','id':this.operator.id,'endpoint':this.meta.name};};Wirecloud.wiring.OperatorSourceEndpoint=OperatorSourceEndpoint;})();(function(){"use strict";var OperatorTargetEndpoint=function OperatorTargetEndpoint(operator,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'operator',{value:operator});Wirecloud.wiring.TargetEndpoint.call(this,this.meta.name,this.meta.type,this.meta.friendcode,'ioperator_'+this.operator.id+'_'+this.meta.name);};OperatorTargetEndpoint.prototype=new Wirecloud.wiring.TargetEndpoint();OperatorTargetEndpoint.prototype.serialize=function serialize(){return{'type':'ioperator','id':this.operator.id,'endpoint':this.meta.name};};OperatorTargetEndpoint.prototype._is_target_slot=function _is_target_slot(list){var i,target;if(list==null){return true;}
for(i=0;i<list.length;i+=1){target=list[i];if((target.type==='ioperator')&&(target.id==this.operator.id)&&(target.endpoint==this.meta.name)){return true;}}
return false;};OperatorTargetEndpoint.prototype.getFinalSlots=function getFinalSlots(){var action_label=this.meta.action_label,result;if(!action_label||action_label===''){action_label=gettext('Use in %(slotName)s');action_label=interpolate(action_label,{slotName:this.meta.label},true);}
result=this.serialize();result.action_label=action_label;return[result];};OperatorTargetEndpoint.prototype.propagate=function propagate(newValue,options){var msg,details;if(!options||this._is_target_slot(options.targetEndpoints)){if(this.operator.loaded){if(this.callback==null){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=gettext('Operator has not registered a callback for this input endpoint');this.operator.logManager.log(msg,{details:details});return;}
try{this.callback.call(this.operator,newValue);}catch(error){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=this.operator.logManager.formatException(error);this.operator.logManager.log(msg,{details:details});}}else{this.operator.pending_events.push({'endpoint':this.meta.name,'value':newValue});}}};Wirecloud.wiring.OperatorTargetEndpoint=OperatorTargetEndpoint;})();(function(){"use strict";var WidgetSourceEndpoint=function WidgetSourceEndpoint(iwidget,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'iwidget',{value:iwidget});Wirecloud.wiring.SourceEndpoint.call(this,this.meta.name,this.meta.type,this.friendcode,'iwidget_'+iwidget.id+'_'+this.meta.name);};WidgetSourceEndpoint.prototype=new Wirecloud.wiring.SourceEndpoint();WidgetSourceEndpoint.prototype.serialize=function serialize(){return{'type':'iwidget','id':this.iwidget.id,'endpoint':this.meta.name};};Wirecloud.wiring.WidgetSourceEndpoint=WidgetSourceEndpoint;})();(function(){"use strict";var is_target_endpoint=function is_target_endpoint(list){var i,target;if(list==null){return true;}
for(i=0;i<list.length;i+=1){target=list[i];if(target.type==='iwidget'&&(target.id==this.widget.id)&&(target.endpoint==this.meta.name)){return true;}}
return false;};var WidgetTargetEndpoint=function WidgetTargetEndpoint(iwidget,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'iwidget',{value:iwidget});Wirecloud.wiring.TargetEndpoint.call(this,this.meta.name,this.meta.type,this.meta.friendcode,'iwidget_'+iwidget.id+'_'+this.meta.name);};WidgetTargetEndpoint.prototype=new Wirecloud.wiring.TargetEndpoint();WidgetTargetEndpoint.prototype.serialize=function serialize(){return{'type':'iwidget','id':this.iwidget.id,'endpoint':this.meta.name};};WidgetTargetEndpoint.prototype.getFinalSlots=function getFinalSlots(){var result,action_label=this.meta.action_label;if(!action_label||action_label===''){action_label=gettext('Use in %(slotName)s');action_label=interpolate(action_label,{slotName:this.meta.label},true);}
result=this.serialize();result.action_label=action_label;result.iWidgetName=this.iwidget.name;return[result];};WidgetTargetEndpoint.prototype.propagate=function propagate(newValue,options){var msg,details;if(!options||is_target_endpoint.call(this,options.targetEndpoints)){if(this.iwidget.loaded){if(this.callback==null){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=gettext('Widget has not registered a callback for this input endpoint');this.iwidget.logManager.log(msg,{details:details});return;}
try{this.callback.call(this.iwidget,newValue);}catch(error){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=this.iwidget.logManager.formatException(error);this.iwidget.logManager.log(msg,{details:details});}}else{this.iwidget.pending_events.push({'endpoint':this.meta.name,'value':newValue});Wirecloud.activeWorkspace.getIWidget(this.iwidget.id).load();}}};Wirecloud.wiring.WidgetTargetEndpoint=WidgetTargetEndpoint;})();StyledElements.NavigationHeader=function(options){var defaultOptions={'backButton':'Back','class':'','title':'','extraButton':null};options=Wirecloud.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['back']);this.wrapperElement=document.createElement('div');this.wrapperElement.className=Wirecloud.Utils.appendWord(options['class'],"toolbar");this.backButton=document.createElement('div');this.backButton.setAttribute('class','back_button');this.backButton.addEventListener('click',function(){this.events['back'].dispatch();}.bind(this));buttonSpan=document.createElement('span');buttonSpan.className='menu_text';buttonSpan.textContent=options.backButton;this.backButton.appendChild(buttonSpan);this.wrapperElement.appendChild(this.backButton);this.titleElement=document.createElement('h1');this.titleElement.textContent=options.title;this.wrapperElement.appendChild(this.titleElement);if(options.extraButton){this.wrapperElement.appendChild(options.extraButton);}}
StyledElements.NavigationHeader.prototype=new StyledElements.StyledElement();StyledElements.NavigationHeader.prototype.setTitle=function(title){this.titleElement.textContent=title;};var MobileDragboard=function(){this.layout=new StyledElements.BorderLayout({'class':'dragboard'});this.toolbar=new StyledElements.NavigationHeader();this.alternatives=new StyledElements.StyledAlternatives();this.layout.getNorthContainer().appendChild(this.toolbar);this.layout.getCenterContainer().appendChild(this.alternatives);this.toolbar.addEventListener('back',function(){OpManagerFactory.getInstance().showWidgetsMenu();});this.clear();this.wrapperElement=this.layout.wrapperElement;};MobileDragboard.prototype=new StyledElements.StyledElement();MobileDragboard.prototype.clear=function(){this.alternatives.clear();this.emptyAlternative=this.alternatives.createAlternative();};MobileDragboard.prototype.repaint=function(temporal){this.layout.repaint(temporal);};MobileDragboard.prototype.newIWidgetContainer=function(){return this.alternatives.createAlternative();};MobileDragboard.prototype.show=function(iwidget_alternative){this.alternatives.showAlternative(iwidget_alternative);};MobileDragboard.prototype._updateIWidgetInfo=function(iwidget){this.toolbar.setTitle(iwidget.name);};"use strict";function Workspace(workspaceState,resources){Workspace.prototype._buildInterface=function(){var loginButton;this.tabsContainerElement=OpManagerFactory.getInstance().workspaceTabsAlternative;this.tabsContainerElement.clear();this.layout=new StyledElements.BorderLayout();loginButton=document.createElement('a');loginButton.setAttribute('class','logout');loginButton.setAttribute('href',Wirecloud.URLs.LOGOUT_VIEW)
loginButton.textContent=gettext('Sign out');this.toolbar=new StyledElements.NavigationHeader({backButton:gettext('Menu'),title:'',extraButton:loginButton});this.toolbar.addEventListener('back',function(){OpManagerFactory.getInstance().showWorkspaceMenu();});this.layout.getNorthContainer().appendChild(this.toolbar);this.layout.getCenterContainer().wrapperElement.setAttribute('id','workspace');new MobileScrollManager(this.layout.getCenterContainer().wrapperElement,{'capture':true,'propagate':true,'onend':checkTab});this.layout.getSouthContainer().addClassName('navbar');this.tabsContainerElement.appendChild(this.layout);this.layout.repaint();};Workspace.prototype._scroll=function(index){this.layout.getCenterContainer().wrapperElement.scrollLeft=index*window.innerWidth;};Workspace.prototype.unload=function(){for(var i=0;i<this.tabInstances.length;i+=1){this.unloadTab(i);}
if(this.alternatives!==null){this.alternatives.destroy();this.alternatives=null;}
this.tabInstances=[];if(this.wiring!=null){this.wiring.destroy();this.wiring=null;}
OpManagerFactory.getInstance().globalDragboard.clear();this.tabsContainerElement=null;this.layout.destroy();};Workspace.prototype.unloadTab=function(tabId){var tab=this.tabInstances[tabId];tab.destroy();this.visibleTab=null;};Workspace.prototype.getName=function(){return this.workspaceState.name;};Workspace.prototype.getActiveDragboard=function(){return this.visibleTab.getDragboard();};Workspace.prototype.getIWidget=function(iwidgetId){var i,iwidget;for(i=0;i<this.tabInstances.length;i+=1){iwidget=this.tabInstances[i].getDragboard().getIWidget(iwidgetId);if(iwidget){return iwidget;}}};Workspace.prototype.getIWidgets=function(){var iWidgets=[],i;for(i=0;i<this.tabInstances.length;i+=1){iWidgets=iWidgets.concat(this.tabInstances[i].getDragboard().getIWidgets());}
return iWidgets;};Workspace.prototype.init=function(){var layoutManager=LayoutManagerFactory.getInstance();layoutManager.logStep('');layoutManager.logSubTask(gettext('Processing workspace data'));var scrolling=0,step=window.innerWidth,i,tabs,tab,iwidgets;tabs=this.workspaceState.tabs;if(tabs.length>0){for(i=0;i<tabs.length;i+=1){tab=tabs[i];this.tabInstances.push(new Tab(tab,this,i));if(tab.visible){this.visibleTabIndex=i;}}}
this.visibleTab=this.tabInstances[this.visibleTabIndex];this.contextManager=new Wirecloud.ContextManager(this,this.workspaceState.context);this.wiring=new Wirecloud.Wiring(this);iwidgets=this.getIWidgets();for(i=0;i<iwidgets.length;i+=1){this.events.iwidgetadded.dispatch(this,iwidgets[i].internal_iwidget);}
this._buildInterface();this.wiring.load(this.workspaceState.wiring);for(i=0;i<this.tabInstances.length;i+=1){this.tabInstances[i].paint(this.layout.getCenterContainer(),scrolling,i);scrolling+=step;}
var opManager=OpManagerFactory.getInstance();opManager.alternatives.showAlternative(this.tabsContainerElement);this.updateVisibleTab(this.visibleTabIndex);Wirecloud.GlobalLogManager.log(gettext('Workspace loaded'),Wirecloud.constants.LOGGING.INFO_MSG);};Workspace.prototype.show=function(){var step=window.innerWidth;window.scrollTo(this.visibleTabIndex*step,1);};Workspace.prototype.getTab=function(tabId){var i;for(i=0;i<this.tabInstances.length;i+=1){if(this.tabInstances[i].id===tabId){return this.tabInstances[i];}}
return null;};Workspace.prototype.getVisibleTab=function(){return this.visibleTab;};Workspace.prototype.getNumberOfTabs=function(){return this.tabInstances.length;};Workspace.prototype.updateVisibleTab=function(index){var i,mark,tabsLength=this.getNumberOfTabs();if(this.visibleTabIndex!==index){this.visibleTabIndex=index;this.visibleTab=this.tabInstances[this.visibleTabIndex];}
this.toolbar.setTitle(this.visibleTab.tabInfo.name);this.layout.getSouthContainer().clear();for(i=0;i<tabsLength;i+=1){mark=document.createElement('div');if(i===index){mark.className="current";}
this.layout.getSouthContainer().appendChild(mark);}
this._scroll(index);};Workspace.prototype.updateLayout=function(orientation){var step=window.innerWidth,scrolling=0,iWidgets,contextManager,i;Wirecloud.contextManager.modify({'orientation':orientation});for(i=0;i<this.tabInstances.length;i+=1){this.tabInstances[i].updateLayout(scrolling);scrolling+=step;}
iWidgets=this.getIWidgets();for(i=0;i<iWidgets.length;i+=1){if(iWidgets[i].element!=null){iWidgets[i].internal_iwidget.contextManager.modify({'widthInPixels':step,'heightInPixels':iWidgets[i].element.offsetHeight});}}
if(OpManagerFactory.getInstance().visibleLayer==="tabs_container"){this._scroll(this.visibleTabIndex);}};Workspace.prototype.tabExists=function(tabName){for(var i=0;i<this.tabInstances.length;i+=1){if(this.tabInstances[i].tabInfo.name===tabName){return true;}}
return false;};Workspace.prototype.drawAttention=function drawAttention(iwidget){};Object.defineProperty(this,'id',{value:workspaceState.id});Object.defineProperty(this,'resources',{value:resources});Object.defineProperty(this,'owned',{value:workspaceState.owned});this.workspaceState=workspaceState;this.tabInstances=[];this.wiring=null;this.visibleTab=null;this.visibleTabIndex=0;this.alternatives=null;this.tabsContainerElement=null;this.layout=null;StyledElements.ObjectWithEvents.call(this,['iwidgetadded','iwidgetremoved','removed']);this.init();OpManagerFactory.getInstance().visibleLayer="tabs_container";}
Workspace.prototype=new StyledElements.ObjectWithEvents();"use strict";function Tab(tabInfo,workspace,index){Tab.prototype.destroy=function(){this.dragboard.destroy();};Tab.prototype.paint=function(container,scrollLeft,index){var iWidgets=this.dragboard.getIWidgets(),i,tabsLength,opManager,tabContent,iWidgetElement,icon,navBarElement;this.tabElement=document.createElement('div');this.tabElement.setAttribute('class',"wirecloud_tab");this.tabElement.style.left=scrollLeft+'px';opManager=OpManagerFactory.getInstance();tabContent=document.createElement('div');tabContent.setAttribute('class','tab_content');for(i=0;i<iWidgets.length;i+=1){iWidgetElement=document.createElement('div');iWidgetElement.setAttribute('class','iwidget_item');icon=document.createElement('img');icon.setAttribute('class',"iwidget_icon");icon.setAttribute('src',iWidgets[i].widget.getIPhoneImageURI());iWidgetElement.appendChild(icon);iWidgetElement.appendChild(document.createTextNode(iWidgets[i].name));iWidgetElement.addEventListener('click',opManager.showDragboard.bind(opManager,iWidgets[i].id),false);tabContent.appendChild(iWidgetElement);}
this.tabElement.appendChild(tabContent);container.appendChild(this.tabElement);};Tab.prototype.updateLayout=function(scrollLeft){if(this.tabElement){this.tabElement.style.left=scrollLeft+"px";}};Tab.prototype.getDragboard=function(){return this.dragboard;};Object.defineProperty(this,'id',{value:tabInfo.id});this.workspace=workspace;this.tabInfo=tabInfo;this.index=index;this.dragboard=new Dragboard(this,this.workspace,this.dragboardElement);this.tabElement=null;}
(function(){"use strict";var NGSI;if((typeof require=='function')&&typeof exports!=null){NGSI=exports;}else{NGSI={};}
NGSI.endpoints={REGISTER_CONTEXT:'ngsi9/registerContext',DISCOVER_CONTEXT_AVAILABILITY:'ngsi9/discoverContextAvailability',SUBSCRIBE_CONTEXT_AVAILABILITY:'ngsi9/subscribeContextAvailability',UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION:'ngsi9/updateContextAvailabilitySubscription',UNSUBSCRIBE_CONTEXT_AVAILABILITY:'ngsi9/unsubscribeContextAvailability',QUERY_CONTEXT:'ngsi10/queryContext',UPDATE_CONTEXT:'ngsi10/updateContext',SUBSCRIBE_CONTEXT:'ngsi10/subscribeContext',UPDATE_CONTEXT_SUBSCRIPTION:'ngsi10/updateContextSubscription',UNSUBSCRIBE_CONTEXT:'ngsi10/unsubscribeContext'};NGSI.proxy_endpoints={EVENTSOURCE_COLLECTION:'eventsource',CALLBACK_COLLECTION:'callbacks'};NGSI.XML={};if(typeof document==='object'&&document!=null&&typeof document.implementation=='object'&&document.implementation.createDocument){NGSI.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){return document.implementation.createDocument(namespaceURL,rootTagName,null);};}else if(typeof DOMImplementation!=='undefined'){NGSI.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){var implementation=new DOMImplementation();return implementation.createDocument(namespaceURL,rootTagName,null);};}else if(typeof window==='object'&&window!=null&&window.ActiveXObject){NGSI.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){var doc=new ActiveXObject("MSXML2.DOMDocument");doc.appendChild(NGSI.XML.createElementNS(doc,namespaceURL,rootTagName));return doc;};}else{throw new Error('NGSI.js is not able to create DOM documents in this enviroment');}
if(typeof DOMParser!=='undefined'){NGSI.XML.parseFromString=function parseFromString(text,type,fromAjax){var result,new_header,parser=new DOMParser();fromAjax=fromAjax!==undefined?fromAjax:true;if(fromAjax){result=text.match(new RegExp('<?xml(?:[^\/]|\/[^>])*standalone="([^"]+)"(?:[^\/]|\/[^>])*?>'));if(result&&(result[1]==='yes'||result[1]==='no')){new_header='<?xml version="1.0" standalone="'+result[1]+'" ?>';}else{new_header='<?xml version="1.0" ?>';}
text=text.replace(/<\?xml([^\/]|\/[^>])*\?>/g,new_header);}
return parser.parseFromString(text,type);};}else if(window.ActiveXObject){NGSI.XML.parseFromString=function parseFromString(text,type,fromAjax){var xml=new ActiveXObject("Microsoft.XMLDOM");xml.async=false;xml.loadXML(text);return xml;};}else{NGSI.XML.parseFromString=function parseFromString(text,type,fromAjax){var req=new XMLHttpRequest();req.open('GET','data:'+(type||"application/xml")+';charset=utf-8,'+encodeURIComponent(text),false);if(req.overrideMimeType){req.overrideMimeType(type);}
req.send(null);return req.responseXML;};}
NGSI.XML.getTextContent=function getTextContent(element){if("textContent"in element){return element.textContent;}else if("innerText"in element){return element.innerText;}else if("nodeValue"in element){return element.nodeValue;}
return"";};NGSI.XML.setTextContent=function setTextContent(element,text){if("textContent"in element){element.textContent=text;}else if("innerText"in element){element.innerText=text;}else if("text"in element){element.text=text;}else if("nodeValue"in element){element.nodeValue=text;}};if(typeof XMLSerializer!=='undefined'){NGSI.XML.serialize=function serialize(node){return(new XMLSerializer()).serializeToString(node);};}else{NGSI.XML.serialize=function serialize(node){if(node.xml){return node.xml;}else{throw new Error("Error serializating xml");}};}
if(typeof XPathResult!=='undefined'){NGSI.XML.getChildElementByTagName=function getChildElementByTagName(element,tagName){var xpathResult=element.ownerDocument.evaluate(tagName,element,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return xpathResult.singleNodeValue;};NGSI.XML.getChildElementsByTagName=function getChildElementsByTagName(element,tagName){var xpathResult,result,i;xpathResult=element.ownerDocument.evaluate(tagName,element,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);result=[];for(i=0;i<xpathResult.snapshotLength;i+=1){result.push(xpathResult.snapshotItem(i));}
return result;};}else{NGSI.XML.getChildElementByTagName=function getChildElementByTagName(element,tagName){var i,child;for(i=0;i<element.childNodes.length;i+=1){child=element.childNodes[i];if(child.nodeType===Node.ELEMENT_TYPE||child.localName===tagName){return element.childNodes[i];}}
return null;};NGSI.XML.getChildElementsByTagName=function getChildElementsByTagName(element,tagName){var i,child,result=[];for(i=0;i<element.childNodes.length;i+=1){child=element.childNodes[i];if(child.nodeType===Node.ELEMENT_TYPE||child.localName===tagName){result.push(element.childNodes[i]);}}
return result;};}
var makeXMLRequest=function makeXMLRequest(url,payload,parse_func,callbacks,parameters){this.makeRequest(url,{method:'POST',contentType:'application/xml',requestHeaders:this.request_headers,parameters:parameters,postBody:NGSI.XML.serialize(payload),onSuccess:function(response){if(typeof callbacks.onSuccess==='function'){var doc,data;if(response.responseXML==null){doc=NGSI.XML.parseFromString(response.responseText,'application/xml');}else{doc=response.responseXML;}
try{if(doc.getElementsByTagName('parsererror').length>0){throw new NGSI.InvalidResponseError('Server returned invalid xml content');}
data=parse_func(doc,callbacks);}catch(e){if(typeof callbacks.onFailure==='function'){callbacks.onFailure(e);}
return;}
callbacks.onSuccess.apply(null,data);}},onFailure:function(response){var error;if(typeof callbacks.onFailure==='function'){if([0,502,504].indexOf(response.status)!==-1){error=new NGSI.ConnectionError('Connection Error');}else{error=new NGSI.InvalidResponseError('Unexpected error code: '+response.status);}
callbacks.onFailure(error);}},onComplete:function(response){if(typeof callbacks.onComplete==='function'){callbacks.onComplete();}}});};var assert_root_element=function assert_root_element(doc,expected_root_element){if(doc.documentElement.tagName!==expected_root_element){throw new NGSI.InvalidResponseError('Unexpected root element in response: '+doc.documentElement.tagName);}};var ngsi_build_entity_id_element=function ngsi_build_entity_id_element(doc,entity){var entityId,id;entityId=doc.createElement('entityId');if(entity.type!=null){entityId.setAttribute('type',entity.type);}
entityId.setAttribute('isPattern',(typeof entity.isPattern==='string'&&entity.isPattern.trim().toLowerCase()==='true')||(entity.isPattern===true));id=doc.createElement('id');NGSI.XML.setTextContent(id,entity.id);entityId.appendChild(id);return entityId;};var ngsi_build_scope_restriction_element=function ngsi_build_scope_restriction_element(doc,scope){var restrictionValueElement,vertexListElement,i,vertice,vertexElement,latitudeElement,longitudeElement,invertedElement,centerLatitudeElement,centerLongitudeElement,radiusElement;if('polygon'in scope.value){restrictionValueElement=doc.createElement('polygon');vertexListElement=doc.createElement('vertexList');restrictionValueElement.appendChild(vertexListElement);for(i=0;i<scope.value.polygon.vertices.length;i++){vertice=scope.value.polygon.vertices[i];vertexElement=doc.createElement('vertex');vertexListElement.appendChild(vertexElement);latitudeElement=doc.createElement('latitude');NGSI.XML.setTextContent(latitudeElement,vertice.latitude);vertexElement.appendChild(latitudeElement);longitudeElement=doc.createElement('longuitude');NGSI.XML.setTextContent(longitudeElement,vertice.longitude);vertexElement.appendChild(longitudeElement);}
if(scope.value.polygon.inverted){invertedElement=doc.createElement('inverted');NGSI.XML.setTextContent(invertedElement,'true');restrictionValueElement.appendChild(invertedElement);}}else if('circle'in scope.value){restrictionValueElement=doc.createElement('circle');centerLatitudeElement=doc.createElement('centerLatitude');NGSI.XML.setTextContent(centerLatitudeElement,scope.value.circle.centerLatitude);restrictionValueElement.appendChild(centerLatitudeElement);centerLongitudeElement=doc.createElement('centerLongitude');NGSI.XML.setTextContent(centerLongitudeElement,scope.value.circle.centerLongitude);restrictionValueElement.appendChild(centerLongitudeElement);radiusElement=doc.createElement('radius');NGSI.XML.setTextContent(radiusElement,scope.value.circle.radius);restrictionValueElement.appendChild(radiusElement);if(scope.value.circle.inverted){invertedElement=doc.createElement('inverted');NGSI.XML.setTextContent(invertedElement,'true');restrictionValueElement.appendChild(invertedElement);}}
return restrictionValueElement;};var ngsi_build_restriction_element=function ngsi_build_restriction_element(doc,restriction){var restrictionElement,attributeExpressionElement,scopeElement,operationScopeElement,scopeTypeElement,scopeValueElement,i;restrictionElement=doc.createElement('restriction');if(restriction.attributeExpression!=null){attributeExpressionElement=doc.createElement('attributeExpression');NGSI.XML.setTextContent(attributeExpressionElement,restriction.attributeExpression);restrictionElement.appendChild(attributeExpressionElement);}
if(Array.isArray(restriction.scopes)){scopeElement=doc.createElement('scope');restrictionElement.appendChild(scopeElement);for(i=0;i<restriction.scopes.length;i++){operationScopeElement=doc.createElement('operationScope');scopeTypeElement=doc.createElement('scopeType');NGSI.XML.setTextContent(scopeTypeElement,restriction.scopes[i].type);operationScopeElement.appendChild(scopeTypeElement);scopeValueElement=doc.createElement('scopeValue');scopeValueElement.appendChild(ngsi_build_scope_restriction_element(doc,restriction.scopes[i]));operationScopeElement.appendChild(scopeValueElement);scopeElement.appendChild(operationScopeElement);}}
return restrictionElement;};var ngsi_build_attribute_metadata_element=function ngsi_build_attribute_metadata_element(doc,metadata){var metadataElement,i,contextMetadataElement,nameElement,typeElement,valueElement;metadataElement=doc.createElement('metadata');for(i=0;i<metadata.length;i++){contextMetadataElement=doc.createElement('contextMetadata');nameElement=doc.createElement('name');NGSI.XML.setTextContent(nameElement,metadata[i].name);contextMetadataElement.appendChild(nameElement);typeElement=doc.createElement('type');NGSI.XML.setTextContent(typeElement,metadata[i].type);contextMetadataElement.appendChild(typeElement);valueElement=doc.createElement('value');NGSI.XML.setTextContent(valueElement,metadata[i].value);contextMetadataElement.appendChild(valueElement);metadataElement.appendChild(contextMetadataElement);}
return metadataElement;};var ngsi_build_register_context_request=function ngsi_build_register_context_request(e,attr,duration,providingApplication,regId){var doc,list,registration,entityIdList,i,attributeList,attribute,attributeElement,name,type,isDomain,durationElement,registrationIdElement,providingApplicationElement;doc=NGSI.XML.createDocument(null,'registerContextRequest');list=doc.createElement('contextRegistrationList');doc.documentElement.appendChild(list);registration=doc.createElement('contextRegistration');list.appendChild(registration);entityIdList=doc.createElement('entityIdList');registration.appendChild(entityIdList);for(i=0;i<e.length;i+=1){entityIdList.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
attributeList=doc.createElement('contextRegistrationAttributeList');registration.appendChild(attributeList);for(i=0;i<attr.length;i+=1){attribute=attr[i];attributeElement=doc.createElement('contextRegistrationAttribute');name=doc.createElement('name');NGSI.XML.setTextContent(name,attribute.name);attributeElement.appendChild(name);isDomain=doc.createElement('isDomain');NGSI.XML.setTextContent(isDomain,'false');attributeElement.appendChild(isDomain);if(attribute.type!=null){type=doc.createElement('type');NGSI.XML.setTextContent(type,attribute.type);attributeElement.appendChild(type);}
attributeList.appendChild(attributeElement);}
providingApplicationElement=doc.createElement('providingApplication');NGSI.XML.setTextContent(providingApplicationElement,providingApplication);registration.appendChild(providingApplicationElement);durationElement=doc.createElement('duration');NGSI.XML.setTextContent(durationElement,duration);doc.documentElement.appendChild(durationElement);if(regId!=null){registrationIdElement=doc.createElement('registrationId');NGSI.XML.setTextContent(registrationIdElement,regId);doc.documentElement.appendChild(registrationIdElement);}
return doc;};var ngsi_build_query_context_request=function ngsi_build_query_context_request(e,attrNames,restriction){var doc,entityIdList,i,attributeList,attribute,attributeElement;doc=NGSI.XML.createDocument(null,'queryContextRequest');entityIdList=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdList);for(i=0;i<e.length;i+=1){entityIdList.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
if(Array.isArray(attrNames)){attributeList=doc.createElement('attributeList');doc.documentElement.appendChild(attributeList);for(i=0;i<attrNames.length;i+=1){attribute=attrNames[i];attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attribute);attributeList.appendChild(attributeElement);}}
if(restriction!=null){doc.documentElement.appendChild(ngsi_build_restriction_element(doc,restriction));}
return doc;};var ngsi_build_update_context_request=function ngsi_build_update_context_request(updateAction,update){var doc,list,i,j,contextElement,attributeListElement,attributes,attribute,attributeElement,name,type,contextValueElement,contextValue,updateActionElement;doc=NGSI.XML.createDocument(null,'updateContextRequest');list=doc.createElement('contextElementList');doc.documentElement.appendChild(list);for(i=0;i<update.length;i+=1){contextElement=doc.createElement('contextElement');contextElement.appendChild(ngsi_build_entity_id_element(doc,update[i].entity));attributes=update[i].attributes;attributeListElement=doc.createElement('contextAttributeList');for(j=0;j<attributes.length;j+=1){attribute=attributes[j];attributeElement=doc.createElement('contextAttribute');name=doc.createElement('name');NGSI.XML.setTextContent(name,attribute.name);attributeElement.appendChild(name);if(attribute.type!=null){type=doc.createElement('type');NGSI.XML.setTextContent(type,attribute.type);attributeElement.appendChild(type);}
contextValueElement=doc.createElement('contextValue');if(attribute.contextValue==null){contextValue='emptycontent';}else{contextValue=""+attribute.contextValue;if(contextValue.trim()===''){contextValue='emptycontent';}}
NGSI.XML.setTextContent(contextValueElement,contextValue);attributeElement.appendChild(contextValueElement);if(Array.isArray(attribute.metadata)&&attribute.metadata.length>0){attributeElement.appendChild(ngsi_build_attribute_metadata_element(doc,attribute.metadata));}
attributeListElement.appendChild(attributeElement);}
contextElement.appendChild(attributeListElement);list.appendChild(contextElement);}
updateActionElement=doc.createElement('updateAction');NGSI.XML.setTextContent(updateActionElement,updateAction);doc.documentElement.appendChild(updateActionElement);return doc;};var ngsi_build_discover_context_availability_request=function ngsi_build_discover_context_availability_request(e,attr){var doc,entityIdList,i,attributeList,attribute,attributeElement;doc=NGSI.XML.createDocument(null,'discoverContextAvailabilityRequest');entityIdList=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdList);for(i=0;i<e.length;i+=1){entityIdList.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
attributeList=doc.createElement('attributeList');doc.documentElement.appendChild(attributeList);for(i=0;i<attr.length;i+=1){attribute=attr[i];attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attribute);attributeList.appendChild(attributeElement);}
return doc;};var ngsi_build_subscribe_update_context_availability_request=function ngsi_build_subscribe_update_context_availability_request(rootElement,e,attr,duration,restriction,subscriptionId,onNotify){var doc,entityIdListElement,i,attributeListElement,attributeElement,referenceElement,durationElement,subscriptionIdElement;doc=NGSI.XML.createDocument(null,rootElement);entityIdListElement=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdListElement);for(i=0;i<e.length;i+=1){entityIdListElement.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
if(Array.isArray(attr)&&attr.length>0){attributeListElement=doc.createElement('attributeList');doc.documentElement.appendChild(attributeListElement);for(i=0;i<attr.length;i+=1){attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attr[i]);attributeListElement.appendChild(attributeElement);}}
referenceElement=doc.createElement('reference');NGSI.XML.setTextContent(referenceElement,onNotify);doc.documentElement.appendChild(referenceElement);if(duration!=null){durationElement=doc.createElement('duration');NGSI.XML.setTextContent(durationElement,duration);doc.documentElement.appendChild(durationElement);}
if(restriction!=null){doc.documentElement.appendChild(ngsi_build_restriction_element(doc,restriction));}
if(subscriptionId!=null){subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionId,subscriptionId);doc.documentElement.appendChild(subscriptionIdElement);}
return doc;};var ngsi_build_unsubscribe_context_availability_request=function ngsi_build_unsubscribe_context_availability_request(subId){var doc,subscriptionIdElement;doc=NGSI.XML.createDocument(null,'unsubscribeContextAvailabilityRequest');subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionIdElement,subId);doc.documentElement.appendChild(subscriptionIdElement);return doc;};var ngsi_build_subscribe_update_context_request=function ngsi_build_subscribe_update_context_request(subscriptionId,e,attr,duration,throttling,conditions,onNotify){var doc,entityIdListElement,i,j,attributeListElement,attributeElement,referenceElement,durationElement,notifyConditionsElement,condition,notifyConditionElement,typeElement,condValueListElement,condValueElement,throttlingElement,subscriptionIdElement;if(subscriptionId){doc=NGSI.XML.createDocument(null,'updateContextSubscriptionRequest');}else{doc=NGSI.XML.createDocument(null,'subscribeContextRequest');entityIdListElement=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdListElement);for(i=0;i<e.length;i+=1){entityIdListElement.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
if(Array.isArray(attr)){attributeListElement=doc.createElement('attributeList');doc.documentElement.appendChild(attributeListElement);for(i=0;i<attr.length;i+=1){attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attr[i]);attributeListElement.appendChild(attributeElement);}}}
if(subscriptionId==null){referenceElement=doc.createElement('reference');NGSI.XML.setTextContent(referenceElement,onNotify);doc.documentElement.appendChild(referenceElement);}else{subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionIdElement,subscriptionId);doc.documentElement.appendChild(subscriptionIdElement);}
if(duration!=null){durationElement=doc.createElement('duration');NGSI.XML.setTextContent(durationElement,duration);doc.documentElement.appendChild(durationElement);}
if(Array.isArray(conditions)){notifyConditionsElement=doc.createElement('notifyConditions');doc.documentElement.appendChild(notifyConditionsElement);for(i=0;i<conditions.length;i+=1){condition=conditions[i];notifyConditionElement=doc.createElement('notifyCondition');notifyConditionsElement.appendChild(notifyConditionElement);typeElement=doc.createElement('type');NGSI.XML.setTextContent(typeElement,condition.type);notifyConditionElement.appendChild(typeElement);if(Array.isArray(condition.condValues)){condValueListElement=doc.createElement('condValueList');notifyConditionElement.appendChild(condValueListElement);for(j=0;j<condition.condValues.length;j+=1){condValueElement=doc.createElement('condValue');NGSI.XML.setTextContent(condValueElement,condition.condValues[j]);condValueListElement.appendChild(condValueElement);}}}}
if(throttling!=null){throttlingElement=doc.createElement('throttling');NGSI.XML.setTextContent(throttlingElement,throttling);doc.documentElement.appendChild(throttlingElement);}
return doc;};var ngsi_build_unsubscribe_context_request=function ngsi_build_unsubscribe_context_request(subId){var doc,subscriptionIdElement;doc=NGSI.XML.createDocument(null,'unsubscribeContextRequest');subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionIdElement,subId);doc.documentElement.appendChild(subscriptionIdElement);return doc;};var parse_metadata_element=function parse_metadata_element(metadataElement){var metadata,metadataElements,i,nameElement,typeElement,valueElement;metadata=[];if(metadataElement==null){return metadata;}
metadataElements=NGSI.XML.getChildElementsByTagName(metadataElement,'contextMetadata');for(i=0;i<metadataElements.length;i++){nameElement=NGSI.XML.getChildElementByTagName(metadataElements[i],'name');typeElement=NGSI.XML.getChildElementByTagName(metadataElements[i],'type');valueElement=NGSI.XML.getChildElementByTagName(metadataElements[i],'value');metadata.push({name:NGSI.XML.getTextContent(nameElement),type:NGSI.XML.getTextContent(typeElement),value:NGSI.XML.getTextContent(valueElement)});}
return metadata;};var parse_register_context_response=function parse_register_context_response(doc){assert_root_element(doc,'registerContextResponse');return[{duration:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'duration')),registrationId:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'registrationId'))}];};var parse_context_registration_response_list=function parse_context_registration_response_list(list){var registrationResponses,registrationResponse,registration,contextRegistrationElement,entityIdListElement,entityIdList,entityIdElement,nameElement,typeElement,entity,idElement,i,j,contextRegistrationAttributeListElement,attributeList,attribute,providingApplicationElement,data=[];registrationResponses=NGSI.XML.getChildElementsByTagName(list,'contextRegistrationResponse');for(i=0;i<registrationResponses.length;i+=1){registrationResponse=registrationResponses[i];registration={entities:[],attributes:[]};contextRegistrationElement=NGSI.XML.getChildElementByTagName(registrationResponse,'contextRegistration');entityIdListElement=NGSI.XML.getChildElementByTagName(contextRegistrationElement,'entityIdList');if(entityIdListElement!=null){entityIdList=NGSI.XML.getChildElementsByTagName(entityIdListElement,'entityId');for(j=0;j<entityIdList.length;j+=1){entityIdElement=entityIdList[j];idElement=NGSI.XML.getChildElementByTagName(entityIdElement,'id');entity={id:NGSI.XML.getTextContent(idElement),type:entityIdElement.getAttribute('type')};registration.entities.push(entity);}}
contextRegistrationAttributeListElement=NGSI.XML.getChildElementByTagName(contextRegistrationElement,'contextRegistrationAttributeList');if(contextRegistrationAttributeListElement!=null){attributeList=NGSI.XML.getChildElementsByTagName(contextRegistrationAttributeListElement,'contextRegistrationAttribute');for(j=0;j<attributeList.length;j+=1){nameElement=NGSI.XML.getChildElementByTagName(attributeList[j],'name');typeElement=NGSI.XML.getChildElementByTagName(attributeList[j],'type');attribute={name:NGSI.XML.getTextContent(nameElement),type:NGSI.XML.getTextContent(typeElement)};registration.attributes.push(attribute);}}
providingApplicationElement=NGSI.XML.getChildElementByTagName(contextRegistrationElement,'providingApplication');registration.providingApplication=NGSI.XML.getTextContent(providingApplicationElement);data.push(registration);}
return data;};var parse_discover_context_availability_response=function parse_discover_context_availability_response(doc){assert_root_element(doc,'discoverContextAvailabilityResponse');var list=NGSI.XML.getChildElementByTagName(doc.documentElement,'contextRegistrationResponseList');return[parse_context_registration_response_list(list)];};var parse_subscribe_update_context_availability_response=function parse_subscribe_update_context_availability_response(doc){var data,durationElement,errorCodeElement;data={subscriptionId:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId'))};durationElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'duration');if(durationElement!==null){data.duration=NGSI.XML.getTextContent(durationElement);}
errorCodeElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'errorCode');if(errorCodeElement!==null){data.errorCode=NGSI.XML.getTextContent(errorCodeElement);}
return[data];};var parse_unsubscribe_context_availability_response=function parse_unsubscribe_context_availability_response(doc){assert_root_element(doc,'unsubscribeContextAvailabilityResponse');return[{subscriptionId:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId')),statusCode:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'statusCode'))}];};var parse_context_response_list=function parse_context_response_list(element,update_response,options){var contextResponses,contextResponse,entry,entityIdElement,nameElement,flat,typeElement,attributeName,contextValueElement,entityId,idElement,i,j,contextAttributeListElement,attributeList,contextValue,data,metadataElement,status_info,error_data;flat=!!options.flat;if(flat){data={};}else{data=[];}
error_data=[];if(update_response){contextValue="";}
contextResponses=NGSI.XML.getChildElementsByTagName(element,'contextElementResponse');for(i=0;i<contextResponses.length;i+=1){contextResponse=NGSI.XML.getChildElementByTagName(contextResponses[i],'contextElement');status_info=process_status_info(contextResponses[i]);if(flat){entry={};}else{entry={entity:null,attributes:[]};}
entityIdElement=NGSI.XML.getChildElementByTagName(contextResponse,'entityId');idElement=NGSI.XML.getChildElementByTagName(entityIdElement,'id');entityId=NGSI.XML.getTextContent(idElement);if(status_info.code===200&&flat){entry.id=entityId;entry.type=entityIdElement.getAttribute('type');}else{entry.entity={id:NGSI.XML.getTextContent(idElement),type:entityIdElement.getAttribute('type')};}
contextAttributeListElement=NGSI.XML.getChildElementByTagName(contextResponse,'contextAttributeList');if(contextAttributeListElement!=null){attributeList=NGSI.XML.getChildElementsByTagName(contextAttributeListElement,'contextAttribute');for(j=0;j<attributeList.length;j+=1){nameElement=NGSI.XML.getChildElementByTagName(attributeList[j],'name');attributeName=NGSI.XML.getTextContent(nameElement);if(!update_response){contextValueElement=NGSI.XML.getChildElementByTagName(attributeList[j],'contextValue');contextValue=NGSI.XML.getTextContent(contextValueElement);if(contextValue==='emptycontent'){contextValue='';}}
if(flat){entry[attributeName]=contextValue;}else{typeElement=NGSI.XML.getChildElementByTagName(attributeList[j],'type');metadataElement=NGSI.XML.getChildElementByTagName(attributeList[j],'metadata');if(update_response){entry.attributes.push({name:attributeName,type:NGSI.XML.getTextContent(typeElement)});if(metadataElement!=null){entry.attributes[entry.attributes.length-1].metadata=parse_metadata_element(metadataElement);}}else{entry.attributes.push({name:attributeName,type:NGSI.XML.getTextContent(typeElement),contextValue:contextValue,metadata:parse_metadata_element(metadataElement)});}}}}
if(status_info.code===200){if(flat){data[entityId]=entry;}else{data.push(entry);}}else{if(update_response){entry.statusCode=status_info;}
error_data.push(entry);}}
return[data,error_data];};var process_status_info=function process_status_info(element){var statusCodeElement,status_info,detailsElement;statusCodeElement=NGSI.XML.getChildElementByTagName(element,'statusCode');status_info={code:parseInt(NGSI.XML.getChildElementByTagName(statusCodeElement,'code').textContent,10),reasonPhrase:NGSI.XML.getChildElementByTagName(statusCodeElement,'reasonPhrase').textContent};detailsElement=NGSI.XML.getChildElementByTagName(statusCodeElement,'details');if(detailsElement!=null){status_info.details=detailsElement.textContent;}
return status_info;};var process_error_code=function process_error_code(element){var errorCodeElement,codeElement,reasonPhraseElement,detailsElement,details;errorCodeElement=NGSI.XML.getChildElementByTagName(element,'errorCode');if(errorCodeElement!=null){codeElement=NGSI.XML.getChildElementByTagName(errorCodeElement,'code');reasonPhraseElement=NGSI.XML.getChildElementByTagName(errorCodeElement,'reasonPhrase');detailsElement=NGSI.XML.getChildElementByTagName(errorCodeElement,'details');if(detailsElement!=null){details=detailsElement.textContent;}
throw new NGSI.InvalidRequestError(parseInt(codeElement.textContent,10),reasonPhraseElement.textContent,details);}};var NGSI_QUERY_COUNT_RE=new RegExp('Count: (\\d+)');var NGSI_INVALID_OFFSET_RE=new RegExp('Number of matching entities: (\\d+). Offset is (\\d+)');var parse_query_context_response=function parse_query_context_response(doc,options){var details,parsed_details,data;assert_root_element(doc,'queryContextResponse');try{process_error_code(doc.documentElement);}catch(e){switch(e.code){case 200:parsed_details=e.details.match(NGSI_QUERY_COUNT_RE);if(parsed_details){details={"count":parseInt(parsed_details[1],10)};}
break;case 404:data=options.flat?{}:[];parsed_details=e.details.match(NGSI_INVALID_OFFSET_RE);if(parsed_details){details=e.details={"text":e.details,"matches":parseInt(parsed_details[1]),"offset":parseInt(parsed_details[2])};}
if(options.offset!=null&&options.offset!==0){throw e;}else{return[data,details];}
break;default:throw e;}}
return[parse_context_response_list(NGSI.XML.getChildElementByTagName(doc.documentElement,'contextResponseList'),false,options)[0],details];};var parse_update_context_response=function parse_update_context_response(doc,options){assert_root_element(doc,'updateContextResponse');process_error_code(doc.documentElement);return parse_context_response_list(NGSI.XML.getChildElementByTagName(doc.documentElement,'contextResponseList'),true,options);};var parse_subscribe_response_element=function parse_subscribe_response_element(element){var data,durationElement,throttlingElement;var subIdElement=NGSI.XML.getChildElementByTagName(element,'subscriptionId');data={subscriptionId:NGSI.XML.getTextContent(subIdElement)};durationElement=NGSI.XML.getChildElementByTagName(element,'duration');if(durationElement!=null){data.duration=NGSI.XML.getTextContent(durationElement);}
throttlingElement=NGSI.XML.getChildElementByTagName(element,'throttling');if(throttlingElement!=null){data.throttling=NGSI.XML.getTextContent(throttlingElement);}
return data;};var parse_subscribe_context_response=function parse_subscribe_context_response(doc){assert_root_element(doc,'subscribeContextResponse');var subscribeResponse=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscribeResponse');return[parse_subscribe_response_element(subscribeResponse)];};var parse_update_context_subscription_response=function parse_update_context_subscription_response(doc){assert_root_element(doc,'updateContextSubscriptionResponse');var subscribeResponse=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscribeResponse');return[parse_subscribe_response_element(subscribeResponse)];};var parse_unsubscribe_context_response=function parse_unsubscribe_context_response(doc){assert_root_element(doc,'unsubscribeContextResponse');var subIdElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId');return[{subscriptionId:NGSI.XML.getTextContent(subIdElement)}];};var parse_notify_context_availability_request=function parse_notify_context_availability_request(doc,options){assert_root_element(doc,'notifyContextAvailabilityRequest');var list=NGSI.XML.getChildElementByTagName(doc.documentElement,'contextRegistrationResponseList');return[parse_context_registration_response_list(list)];};NGSI.parseNotifyContextRequest=function parseNotifyContextRequest(doc,options){var subscriptionIdElement,originatorElement,data;assert_root_element(doc,'notifyContextRequest');data=parse_context_response_list(NGSI.XML.getChildElementByTagName(doc.documentElement,'contextResponseList'),false,options)[0];data={elements:data};subscriptionIdElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId');originatorElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'originator');data.subscriptionId=NGSI.XML.getTextContent(subscriptionIdElement);data.originator=NGSI.XML.getTextContent(originatorElement);return data;};var onInitFailure=function(response,error){var i;this.connected=false;this.connecting=false;if(error==null){if([0,502,504].indexOf(response.status)!==-1){error=new NGSI.ConnectionError();}else{error=new NGSI.InvalidResponseError('Unexpected error code: '+response.status);}}
for(i=0;i<this.onerror_callbacks.length;i+=1){try{this.onerror_callbacks[i](error);}catch(e){}}
this.onload_callbacks=[];this.onerror_callbacks=[];};var init=function init(){this.connecting=true;this.makeRequest(this.url+NGSI.proxy_endpoints.EVENTSOURCE_COLLECTION,{method:'POST',onSuccess:function(response){if(response.status!==201){onInitFailure.call(this,response);}else{this.source_url=response.getHeader('Location');if(this.source_url==null){onInitFailure.call(this,response,new NGSI.InvalidResponseError('Missing Location Header'));}else{connect_to_eventsource.call(this);}}}.bind(this),onFailure:onInitFailure.bind(this)});};var connect_to_eventsource=function connect_to_eventsource(){var source,closeTimeout;var _wait_event_source_init=null;var wait_event_source_init=function wait_event_source_init(e){var data,i;data=JSON.parse(e.data);clearTimeout(closeTimeout);source.removeEventListener('init',_wait_event_source_init,true);this.connected=true;this.connecting=false;this.connection_id=data.id;for(i=0;i<this.onload_callbacks.length;i+=1){try{this.onload_callbacks[i]();}catch(exception){}}
this.onload_callbacks=[];this.onerror_callbacks=[];source.addEventListener('close',function(){this.connected=false;}.bind(this),true);source.addEventListener('notification',function(e){var data;data=JSON.parse(e.data);this.callbacks[data.callback_id].method(data.payload);}.bind(this),true);};_wait_event_source_init=wait_event_source_init.bind(this);source=new EventSource(this.source_url);source.addEventListener('init',_wait_event_source_init,true);closeTimeout=setTimeout(function(){var i,error=new NGSI.ConnectionError("Connection timeout");for(i=0;i<this.onerror_callbacks.length;i+=1){try{this.onerror_callbacks[i](error);}catch(e){}}
this.onload_callbacks=[];this.onerror_callbacks=[];source.close();}.bind(this),30000);};NGSI.ProxyConnection=function ProxyConnection(url,makeRequest){this.url=""+url;if(this.url[this.url.length-1]!=='/'){this.url+='/';}
this.connected=false;this.connecting=false;this.makeRequest=makeRequest;this.callbacks={};this.callbacks_by_subscriptionId={};this.onload_callbacks=[];this.onerror_callbacks=[];};NGSI.ProxyConnection.prototype.connect=function connect(options){if(options==null){options={};}
if(this.connected===false){if(typeof options.onSuccess==='function'){this.onload_callbacks.push(options.onSuccess);}
if(typeof options.onFailure==='function'){this.onerror_callbacks.push(options.onFailure);}}
if(this.connected===false&&this.connecting===false){init.call(this);}else if(this.connected===true&&typeof options.onSuccess==='function'){options.onSuccess();}};NGSI.ProxyConnection.prototype.request_callback=function request_callback(callback,onSuccess,onFailure){if(typeof callback!=='function'){throw new TypeError('callback parameter must be a function');}
var wrappedOnSuccess=function(){this.makeRequest(this.url+NGSI.proxy_endpoints.CALLBACK_COLLECTION,{contentType:'application/json',postBody:JSON.stringify({connection_id:this.connection_id}),onSuccess:function(response){var data=JSON.parse(response.responseText);this.callbacks[data.callback_id]={callback_id:data.callback_id,method:callback,subscription_id:null};onSuccess(data);}.bind(this),onFailure:function(response){var error;if(response.status===0){error=new NGSI.ConnectionError();}else{error=new NGSI.InvalidResponseError('Unexpected error code: '+response.status);}
if(typeof onFailure==='function'){onFailure(error);}}});}.bind(this);if(this.connected===false){this.connect({onSuccess:wrappedOnSuccess,onFailure:function(e){if(typeof onFailure==='function'){onFailure(e);}}});}else{wrappedOnSuccess();}};NGSI.ProxyConnection.prototype.close_callback=function close_callback(callback_id,onSuccess,onFailure){this.makeRequest(this.url+NGSI.proxy_endpoints.CALLBACK_COLLECTION+'/'+callback_id,{method:'DELETE',onSuccess:function(response){this.purge_callback(callback_id);if(typeof onSuccess==='function'){onSuccess();}}.bind(this),onFailure:function(response){if(typeof onFailure==='function'){onFailure();}}});};NGSI.ProxyConnection.prototype.associate_subscription_id_to_callback=function associate_subscription_id_to_callback(callback_id,subscription_id){if(callback_id in this.callbacks&&this.callbacks[callback_id].subscription_id===null){this.callbacks_by_subscriptionId[subscription_id]=this.callbacks[callback_id];this.callbacks[callback_id].subscription_id=subscription_id;}};NGSI.ProxyConnection.prototype.close_callback_by_subscriptionId=function close_callback_by_subscriptionId(subscription_id,onSuccess,onFailure){if(subscription_id in this.callbacks_by_subscriptionId){this.close_callback(this.callbacks_by_subscriptionId[subscription_id].callback_id,onSuccess,onFailure);}else{if(typeof onSuccess==='function'){onSuccess();}}};NGSI.ProxyConnection.prototype.purge_callback=function purge_callback(callback_id){if(this.callbacks[callback_id].subscription_id!=null){delete this.callbacks_by_subscriptionId[this.callbacks[callback_id].subscription_id];}
delete this.callbacks[callback_id];};NGSI.ConnectionError=function ConnectionError(message){this.name='ConnectionError';this.message=message||'Connection Error';};NGSI.ConnectionError.prototype=new Error();NGSI.ConnectionError.prototype.constructor=NGSI.ConnectionError;NGSI.InvalidRequestError=function InvalidRequestError(code,message,details){this.name='InvalidRequest';this.code=code;this.message=message||'';this.details=details||'';};NGSI.InvalidRequestError.prototype=new Error();NGSI.InvalidRequestError.prototype.constructor=NGSI.InvalidRequestError;NGSI.InvalidResponseError=function InvalidResponseError(message){this.name='InvalidResponse';this.message=message||'';};NGSI.InvalidResponseError.prototype=new Error();NGSI.InvalidResponseError.prototype.constructor=NGSI.InvalidResponseError;NGSI.ProxyConnectionError=function ProxyConnectionError(cause){this.name='ProxyConnectionError';this.cause=cause;};NGSI.ProxyConnectionError.prototype=new Error();NGSI.ProxyConnectionError.prototype.constructor=NGSI.ProxyConnectionError;NGSI.Connection=function NGSIConnection(url,options){this.url=""+url;if(this.url[this.url.length-1]!=='/'){this.url+='/';}
if(options==null){options={};}
this.request_headers=options.request_headers;if(typeof options.requestFunction==='function'){this.makeRequest=options.requestFunction;}
if(options.ngsi_proxy_connection instanceof NGSI.ProxyConnection){this.ngsi_proxy=options.ngsi_proxy_connection;}else if(typeof options.ngsi_proxy_url==='string'){this.ngsi_proxy=new NGSI.ProxyConnection(options.ngsi_proxy_url,this.makeRequest);}};NGSI.Connection.prototype.createRegistration=function createRegistration(entities,attributes,duration,providingApplication,callbacks){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributes!=null&&!Array.isArray(attributes)){throw new TypeError('attributes parameter must be an array or null');}else if(attributes==null){attributes=[];}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_register_context_request(entities,attributes,duration,providingApplication);var url=this.url+NGSI.endpoints.REGISTER_CONTEXT;makeXMLRequest.call(this,url,payload,parse_register_context_response,callbacks);};NGSI.Connection.prototype.updateRegistration=function updateRegistration(regId,entities,attributes,duration,providingApplication,callbacks){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributes!=null&&!Array.isArray(attributes)){throw new TypeError('attributes parameter must be an array or null');}else if(attributes==null){attributes=[];}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_register_context_request(entities,attributes,duration,providingApplication,regId);var url=this.url+NGSI.endpoints.REGISTER_CONTEXT;makeXMLRequest.call(this,url,payload,parse_register_context_response,callbacks);};NGSI.Connection.prototype.cancelRegistration=function cancelRegistration(regId,callbacks){this.updateRegistration(regId,[{id:'canceled registration'}],[],'PT0H','http://canceled.registration.com',callbacks);};NGSI.Connection.prototype.discoverAvailability=function discoverAvailability(entities,attributeNames,callbacks){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}else if(attributeNames==null){attributeNames=[];}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_discover_context_availability_request(entities,attributeNames);var url=this.url+NGSI.endpoints.DISCOVER_CONTEXT_AVAILABILITY;makeXMLRequest.call(this,url,payload,parse_discover_context_availability_response,callbacks);};NGSI.Connection.prototype.createAvailabilitySubscription=function createAvailabilitySubscription(entities,attributeNames,duration,restriction,options){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}
if(options==null){throw new TypeError('Missing options parameter');}
if(typeof options.onNotify!='string'&&typeof options.onNotify!='function'){throw new TypeError('Invalid onNotify callback');}
if(typeof options.onNotify==='function'&&this.ngsi_proxy==null){throw new Error('A ngsi-proxy is needed for using local onNotify callbacks');}
var url=this.url+NGSI.endpoints.SUBSCRIBE_CONTEXT_AVAILABILITY;if(typeof options.onNotify==='function'&&this.ngsi_proxy!=null){var onNotify=function onNotify(payload){var doc=NGSI.XML.parseFromString(payload,'application/xml');var data=parse_notify_context_availability_request(doc,options);options.onNotify(data);};this.ngsi_proxy.request_callback(onNotify,function(proxy_callback){var payload=ngsi_build_subscribe_update_context_availability_request('subscribeContextAvailabilityRequest',entities,attributeNames,duration,restriction,null,proxy_callback.url);var oldOnFailure=options.onFailure;options.onFailure=function(){this.ngsi_proxy.close_callback(proxy_callback.callback_id);if(typeof oldOnFailure==='function'){oldOnFailure();}}.bind(this);var oldOnSuccess=options.onSuccess;options.onSuccess=function(data){this.ngsi_proxy.associate_subscription_id_to_callback(proxy_callback.callback_id,data.subscriptionId);if(typeof oldOnSuccess==='function'){oldOnSuccess(data);}}.bind(this);makeXMLRequest.call(this,url,payload,parse_subscribe_update_context_availability_response,options);}.bind(this),function(){if(typeof options.onFailure==='function'){options.onFailure();}});}else{var payload=ngsi_build_subscribe_update_context_availability_request('subscribeContextAvailabilityRequest',entities,attributeNames,duration,restriction,null,options.onNotify);makeXMLRequest.call(this,url,payload,parse_subscribe_update_context_availability_response,options);}};NGSI.Connection.prototype.updateAvailabilitySubscription=function updateAvailabilitySubscription(subId,entities,attributeNames,duration,restriction,callbacks){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_subscribe_update_context_availability_request('updateContextAvailabilitySubscriptionRequest',entities,attributeNames,duration,restriction,subId);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION;makeXMLRequest.call(this,url,payload,parse_subscribe_update_context_availability_response,callbacks);};NGSI.Connection.prototype.cancelAvailabilitySubscription=function cancelAvailabilitySubscription(subId,callbacks){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_unsubscribe_context_availability_request(subId);var url=this.url+NGSI.endpoints.UNSUBSCRIBE_CONTEXT_AVAILABILITY;makeXMLRequest.call(this,url,payload,parse_unsubscribe_context_availability_response,callbacks);};NGSI.Connection.prototype.query=function query(entities,attrNames,options){var url,parameters,payload;if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attrNames!=null&&!Array.isArray(attrNames)){throw new TypeError('attrNames must be null or an array');}else if(attrNames==null){attrNames=[];}
if(options==null){options={};}
parameters={};if(options.limit!=null){if(typeof options.limit!=='number'||options.limit<20){throw new TypeError('invalid value for the limit option');}
parameters.limit=options.limit;}
if(options.offset!=null){if(typeof options.offset!=='number'||options.offset<0){throw new TypeError('invalid value for the offset option');}
parameters.offset=options.offset;}
if(options.details!=null){if(typeof options.details!=='boolean'){throw new TypeError('invalid value for the details option');}
if(options.details){parameters.details='on';}else{parameters.details='off';}}
url=this.url+NGSI.endpoints.QUERY_CONTEXT;payload=ngsi_build_query_context_request(entities,attrNames,options.restriction);makeXMLRequest.call(this,url,payload,parse_query_context_response,options,parameters);};NGSI.Connection.prototype.updateAttributes=function updateAttributes(update,callbacks){if(!Array.isArray(update)||update.length===0){throw new TypeError('update parameter must be a non-empty array');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_update_context_request('UPDATE',update);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_update_context_response,callbacks);};NGSI.Connection.prototype.addAttributes=function addAttributes(toAdd,callbacks){if(!Array.isArray(toAdd)||toAdd.length===0){throw new TypeError('toAdd parameter must be a non-empty array');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_update_context_request('APPEND',toAdd);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_update_context_response,callbacks);};NGSI.Connection.prototype.deleteAttributes=function deleteAttributes(toDelete,callbacks){if(!Array.isArray(toDelete)||toDelete.length===0){throw new TypeError('toDelete parameter must be a non-empty array');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_update_context_request('DELETE',toDelete);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_update_context_response,callbacks);};NGSI.Connection.prototype.createSubscription=function createSubscription(entities,attributeNames,duration,throttling,cond,options){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}
if(options==null){throw new TypeError('Missing options parameter');}
if(typeof options.onNotify!='string'&&typeof options.onNotify!='function'){throw new TypeError('Invalid onNotify callback');}
if(typeof options.onNotify==='function'&&this.ngsi_proxy==null){throw new Error('A ngsi-proxy is needed for using local onNotify callbacks');}
var url=this.url+NGSI.endpoints.SUBSCRIBE_CONTEXT;if(typeof options.onNotify==='function'&&this.ngsi_proxy!=null){var onNotify=function onNotify(payload){var doc=NGSI.XML.parseFromString(payload,'application/xml');var data=NGSI.parseNotifyContextRequest(doc,options);options.onNotify(data);};this.ngsi_proxy.request_callback(onNotify,function(proxy_callback){var payload=ngsi_build_subscribe_update_context_request(null,entities,attributeNames,duration,throttling,cond,proxy_callback.url);var oldOnFailure=options.onFailure;options.onFailure=function(){this.ngsi_proxy.close_callback(proxy_callback.callback_id);if(typeof oldOnFailure==='function'){oldOnFailure();}}.bind(this);var oldOnSuccess=options.onSuccess;options.onSuccess=function(data){this.ngsi_proxy.associate_subscription_id_to_callback(proxy_callback.callback_id,data.subscriptionId);if(typeof oldOnSuccess==='function'){oldOnSuccess(data);}}.bind(this);makeXMLRequest.call(this,url,payload,parse_subscribe_context_response,options);}.bind(this),function(e){if(typeof options.onFailure==='function'){var exception=new NGSI.ProxyConnectionError(e);try{options.onFailure(exception);}catch(error){}}
if(typeof options.onComplete==='function'){try{options.onComplete();}catch(error){}}});}else{var payload=ngsi_build_subscribe_update_context_request(null,entities,attributeNames,duration,throttling,cond,options.onNotify);makeXMLRequest.call(this,url,payload,parse_subscribe_context_response,options);}};NGSI.Connection.prototype.updateSubscription=function updateSubscription(subId,duration,throttling,cond,options){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(options==null){options={};}
var payload=ngsi_build_subscribe_update_context_request(subId,null,null,duration,throttling,cond);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT_SUBSCRIPTION;makeXMLRequest.call(this,url,payload,parse_update_context_subscription_response,options);};NGSI.Connection.prototype.cancelSubscription=function cancelSubscription(subId,options){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(options==null){options={};}
if(this.ngsi_proxy){var old_success_callback=options.onSuccess;options.onSuccess=function(data){var onSuccess=old_success_callback;if(onSuccess!=null){onSuccess=onSuccess.bind(null,data);}
this.ngsi_proxy.close_callback_by_subscriptionId(data.subscriptionId,onSuccess,options.onFailure);}.bind(this);}
var payload=ngsi_build_unsubscribe_context_request(subId);var url=this.url+NGSI.endpoints.UNSUBSCRIBE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_unsubscribe_context_response,options);};if(typeof window!=='undefined'){window.NGSI=NGSI;}})();(function(){var parseUri=function(str){var o={key:['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','anchor'],q:{name:'queryKey',parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser.strict.exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||'';uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};var CONNECTING=0,OPEN=1,CLOSED=2;window.EventSource=function EventSource(resource){var that=(this===window)?{}:this,retry=1000,offset=0,boundary="\n",lastEventId=null,xhr=null,resourceLocation=null,rest='',reconnectTimeout=null,data='',name='message',eventManager=document.createElement('div');that.readyState=CONNECTING;that.toString=function(){return'[object EventSource]'};that.addEventListener=function(type,listener,useCapture){eventManager.addEventListener(type,listener,useCapture);};that.removeEventListener=function(type,listener,useCapture){eventManager.removeEventListener(type,listener,useCapture);};that.dispatchEvent=function(event){eventManager.dispatchEvent(event);};that.close=function(){that.readyState=CLOSED;if(reconnectTimeout!==null){clearTimeout(reconnectTimeout);}
if(xhr!==null){xhr.abort();}}
resourceLocation=parseUri(resource);that.URL=resourceLocation.source;var openConnectionXHR=function(){xhr=new XMLHttpRequest();xhr.open('GET',that.URL,true);var openEvent=document.createEvent('HTMLEvents');openEvent.initEvent('open',true,true);openEvent.origin=document.domain;openEvent.source=null;that.dispatchEvent(openEvent);if(lastEventId){xhr.setRequestHeader('Last-Event-ID',lastEventId);}
xhr.onreadystatechange=function(){switch(xhr.readyState){case 4:if(that.readyState!==CLOSED){that.readyState=CONNECTING;reOpenConnectionXHR();}
break;case 3:that.readyState=OPEN;processMessageFromXHR();break;}}
xhr.send(null);};var reOpenConnectionXHR=function(){xhr=null;offset=0;data='';name='message';reconnectTimeout=setTimeout(openConnectionXHR,retry);};var processMessageFromXHR=function(){var queue=(rest+xhr.responseText.substr(offset)).split(boundary);offset=xhr.responseText.length;rest=queue.pop();pseudoDispatchEvent(queue);};var pseudoDispatchEvent=function(queue){var i,line,dataIndex,field,value;for(i=0;i<queue.length;i+=1){line=queue[i];if(line===""){if(data.length>0){var fireEvent=document.createEvent('HTMLEvents');fireEvent.initEvent(name,true,true);fireEvent.lastEventId=lastEventId;fireEvent.data=data.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,'');fireEvent.origin=document.domain;fireEvent.source=null;that.dispatchEvent(fireEvent);data='';name='message';}
continue;}
dataIndex=line.indexOf(':');field=null;value='';if(dataIndex===-1){field=line;value='';}else if(dataIndex===0){continue;}else{field=line.slice(0,dataIndex);value=line.slice(dataIndex+1);}
switch(field){case'event':name=value.trim();break;case'id':lastEventId=value;break;case'retry':value=parseInt(value);if(!isNaN(value)){retry=value;}
break;case'data':if(data.length>0){data+="\n";}
data+=value;}}};openConnectionXHR();};})();(function(NGSI){"use strict";var register_widget_proxy,register_operator_proxy,unload_widget,unload_operator,proxiesByWidget,proxiesByOperator,proxy_connections,Manager;proxiesByWidget={};proxiesByOperator={};proxy_connections={};Manager={};register_widget_proxy=function register_widget_proxy(id,proxy){var iwidget;if(!(id in proxiesByWidget)){iwidget=Wirecloud.activeWorkspace.getIWidget(id).internal_iwidget;proxiesByWidget[id]=[];iwidget.addEventListener('unload',unload_widget);}
proxiesByWidget[id].push(proxy);};unload_widget=function unload_widget(iwidget){var i,proxies;proxies=proxiesByWidget[iwidget.id];for(i=0;i<proxies.length;i+=1){try{proxies[i].close();}catch(e){}}
proxies.length=0;iwidget.removeEventListener('unload',unload_widget);delete proxiesByWidget[iwidget.id];};register_operator_proxy=function register_operator_proxy(id,proxy){var ioperator;if(!(id in proxiesByOperator)){ioperator=Wirecloud.activeWorkspace.wiring.ioperators[id];proxiesByOperator[id]=[];ioperator.addEventListener('unload',unload_operator);}
proxiesByOperator[id].push(proxy);};unload_operator=function unload_operator(ioperator){var i,proxies;proxies=proxiesByOperator[ioperator.id];for(i=0;i<proxies.length;i+=1){try{proxies[i].close();}catch(e){}}
proxies.length=0;ioperator.removeEventListener('unload',unload_operator);delete proxiesByOperator[ioperator.id];};Manager.Connection=function Connection(type,id,url,options){var wrapped_proxy;if(options==null){options={};}
if(typeof options.requestFunction!=='function'){options.requestFunction=Wirecloud.io.makeRequest;}
if(options.ngsi_proxy_url!=null){if(!(options.ngsi_proxy_url in proxy_connections)){proxy_connections[options.ngsi_proxy_url]=new NGSI.ProxyConnection(options.ngsi_proxy_url,options.requestFunction);}
wrapped_proxy=new WirecloudResourceProxy(proxy_connections[options.ngsi_proxy_url],this);options.ngsi_proxy_connection=wrapped_proxy;switch(type){case"operator":register_operator_proxy(id,wrapped_proxy);break;case"widget":register_widget_proxy(id,wrapped_proxy);break;}
delete options.ngsi_proxy_url;}
if(options.use_user_fiware_token===true){if(options.request_headers==null){options.request_headers={};}
options.request_headers['X-FI-WARE-OAuth-Token']='true';options.request_headers['X-FI-WARE-OAuth-Header-Name']='X-Auth-Token';}
NGSI.Connection.call(this,url,options);};Manager.Connection.prototype=NGSI.Connection.prototype;var WirecloudResourceProxy=function WirecloudResourceProxy(real_proxy,connection){Object.defineProperty(this,'real_proxy',{value:real_proxy});Object.defineProperty(this,'connection',{value:connection});Object.defineProperty(this,'connected',{get:function(){return this.real_proxy.connected;}});Object.defineProperty(this,'connecting',{get:function(){return this.real_proxy.connecting;}});Object.defineProperty(this,'url',{get:function(){return this.real_proxy.url;}});this.callbacks=[];};WirecloudResourceProxy.prototype=new NGSI.ProxyConnection();WirecloudResourceProxy.prototype.connect=function connect(options){this.real_proxy.connect(options);};WirecloudResourceProxy.prototype.request_callback=function request_callback(onNotify,onSuccess,onFailure){var old_on_success=onSuccess;onSuccess=function(data){this.callbacks.push(data.callback_id);if(typeof old_on_success==='function'){old_on_success(data);}}.bind(this);this.real_proxy.request_callback(onNotify,onSuccess,onFailure);};WirecloudResourceProxy.prototype.close_callback=function close_callback(callback_id,onSuccess,onFailure){if(this.callbacks.indexOf(callback_id)===-1){throw new TypeError('unhandled callback: '+callback_id);}
var old_on_success=onSuccess;onSuccess=function(data){var index=this.callbacks.indexOf(callback_id);if(index!=-1){this.callbacks.splice(index,1);}
if(typeof old_on_success==='function'){old_on_success(data);}}.bind(this);this.real_proxy.close_callback(callback_id,onSuccess,onFailure);};WirecloudResourceProxy.prototype.associate_subscription_id_to_callback=function associate_subscription_id_to_callback(callback_id,subscription_id){this.real_proxy.associate_subscription_id_to_callback(callback_id,subscription_id);};WirecloudResourceProxy.prototype.close_callback_by_subscriptionId=function close_callback_by_subscriptionId(subscription_id,onSuccess,onFailure){var callback_id;if(subscription_id in this.real_proxy.callbacks_by_subscriptionId){callback_id=this.real_proxy.callbacks_by_subscriptionId[subscription_id].callback_id;if(this.callbacks.indexOf(callback_id)!==-1){var old_on_success=onSuccess;onSuccess=function(data){var index=this.callbacks.indexOf(callback_id);if(index!=-1){this.callbacks.splice(index,1);}
if(typeof old_on_success==='function'){old_on_success(data);}}.bind(this);this.real_proxy.close_callback_by_subscriptionId(subscription_id,onSuccess,onFailure);return;}}
if(typeof onSuccess==='function'){onSuccess();}};WirecloudResourceProxy.prototype.close=function close(){var i;for(i=0;i<this.callbacks.length;i++){if(this.real_proxy.callbacks[this.callbacks[i]].subscription_id!=null){this.connection.cancelSubscription(this.real_proxy.callbacks[this.callbacks[i]].subscription_id);}}};Manager.NGSI=NGSI;window.NGSIManager=Manager;})(NGSI);delete window.NGSI;