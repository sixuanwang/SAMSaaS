var Wirecloud={constants:{WORKSPACE_PREFERENCES:[{"defaultValue":false,"description":"Allows other users to open this workspace (in read-only mode). (default: disabled)","type":"boolean","name":"public","label":"Public"},{"description":"Default layout for the new widgets.","defaultValue":"Fixed","label":"Default layout","type":"select","initialEntries":[{"value":"Fixed","label":"Base"},{"value":"Free","label":"Free"}],"name":"initiallayout"},{"defaultValue":{"verticalmargin":3,"smart":"false","horizontalmargin":4,"type":"columnlayout","columns":20,"cellheight":12},"type":"layout","name":"baselayout","label":"Base layout"}],FIWARE_PORTALS:[{"url":"https://cloud.lab.fiware.org","name":"Cloud","logout_path":"/logout"},{"url":"https://store.lab.fiware.org","name":"Store","logout_path":"/logout"},{"url":"https://mashup.lab.fiware.org","active":true,"name":"Mashup","logout_path":"/logout"},{"url":"https://data.lab.fiware.org","name":"Data","logout_path":"/user/_logout"},{"url":"https://account.lab.fiware.org","name":"Account","logout_path":"/users/sign_out"},{"url":"http://help.lab.fiware.org","name":"Help\u0026info"}],FIWARE_HOME:"https://lab.fiware.org",AVAILABLE_LANGUAGES:[{"value":"af","label":"Afrikaans"},{"value":"ar","label":"Arabic"},{"value":"az","label":"Azerbaijani"},{"value":"bg","label":"Bulgarian"},{"value":"be","label":"Belarusian"},{"value":"bn","label":"Bengali"},{"value":"br","label":"Breton"},{"value":"bs","label":"Bosnian"},{"value":"ca","label":"Catalan"},{"value":"cs","label":"Czech"},{"value":"cy","label":"Welsh"},{"value":"da","label":"Danish"},{"value":"de","label":"German"},{"value":"el","label":"Greek"},{"value":"en","label":"English"},{"value":"en-gb","label":"British English"},{"value":"eo","label":"Esperanto"},{"value":"es","label":"Spanish"},{"value":"es-ar","label":"Argentinian Spanish"},{"value":"es-mx","label":"Mexican Spanish"},{"value":"es-ni","label":"Nicaraguan Spanish"},{"value":"es-ve","label":"Venezuelan Spanish"},{"value":"et","label":"Estonian"},{"value":"eu","label":"Basque"},{"value":"fa","label":"Persian"},{"value":"fi","label":"Finnish"},{"value":"fr","label":"French"},{"value":"fy-nl","label":"Frisian"},{"value":"ga","label":"Irish"},{"value":"gl","label":"Galician"},{"value":"he","label":"Hebrew"},{"value":"hi","label":"Hindi"},{"value":"hr","label":"Croatian"},{"value":"hu","label":"Hungarian"},{"value":"ia","label":"Interlingua"},{"value":"id","label":"Indonesian"},{"value":"is","label":"Icelandic"},{"value":"it","label":"Italian"},{"value":"ja","label":"Japanese"},{"value":"ka","label":"Georgian"},{"value":"kk","label":"Kazakh"},{"value":"km","label":"Khmer"},{"value":"kn","label":"Kannada"},{"value":"ko","label":"Korean"},{"value":"lb","label":"Luxembourgish"},{"value":"lt","label":"Lithuanian"},{"value":"lv","label":"Latvian"},{"value":"mk","label":"Macedonian"},{"value":"ml","label":"Malayalam"},{"value":"mn","label":"Mongolian"},{"value":"my","label":"Burmese"},{"value":"nb","label":"Norwegian Bokmal"},{"value":"ne","label":"Nepali"},{"value":"nl","label":"Dutch"},{"value":"nn","label":"Norwegian Nynorsk"},{"value":"os","label":"Ossetic"},{"value":"pa","label":"Punjabi"},{"value":"pl","label":"Polish"},{"value":"pt","label":"Portuguese"},{"value":"pt-br","label":"Brazilian Portuguese"},{"value":"ro","label":"Romanian"},{"value":"ru","label":"Russian"},{"value":"sk","label":"Slovak"},{"value":"sl","label":"Slovenian"},{"value":"sq","label":"Albanian"},{"value":"sr","label":"Serbian"},{"value":"sr-latn","label":"Serbian Latin"},{"value":"sv","label":"Swedish"},{"value":"sw","label":"Swahili"},{"value":"ta","label":"Tamil"},{"value":"te","label":"Telugu"},{"value":"th","label":"Thai"},{"value":"tr","label":"Turkish"},{"value":"tt","label":"Tatar"},{"value":"udm","label":"Udmurt"},{"value":"uk","label":"Ukrainian"},{"value":"ur","label":"Urdu"},{"value":"vi","label":"Vietnamese"},{"value":"zh-cn","label":"Simplified Chinese"},{"value":"zh-tw","label":"Traditional Chinese"}],TAB_PREFERENCES:[{"description":"Default layout for the new widgets.","inheritByDefault":true,"defaultValue":"Fixed","label":"Default layout","inheritable":true,"type":"select","initialEntries":[{"value":"Fixed","label":"Base"},{"value":"Free","label":"Free"}],"name":"initiallayout"},{"name":"baselayout","inheritByDefault":true,"defaultValue":{"verticalmargin":3,"smart":"false","horizontalmargin":4,"type":"columnlayout","columns":20,"cellheight":12},"label":"Base layout","inheritable":true,"type":"layout"}],CURRENT_MODE:"embedded"},ui:{}};if(window.StyledElements==null){window.StyledElements={};}
(function(){"use strict";var Utils={};Utils.gettext=function gettext(text){return text;};Utils.interpolate=function interpolate(pattern,attributes){return pattern.replace(/%\(\w+\)s/g,function(match){return String(attributes[match.slice(2,-2)]);});};Utils.Template=function Template(template){this.template=template;};Utils.Template.prototype.evaluate=function evaluate(context){return Utils.interpolate(this.template,context);};Utils.stopPropagationListener=function stopPropagationListener(e){e.stopPropagation();};Utils.preventDefaultListener=function preventDefaultListener(e){e.preventDefault();};Utils.callCallback=function callCallback(callback){if(typeof callback==='function'){try{callback.apply(null,Array.prototype.slice.call(arguments,1));}catch(error){}}};Utils.onFullscreenChange=function onFullscreenChange(element,callback){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
element.ownerDocument.addEventListener('fullscreenchange',callback,true);element.ownerDocument.addEventListener('msfullscreenchange',callback,true);element.ownerDocument.addEventListener('mozfullscreenchange',callback,true);element.ownerDocument.addEventListener('webkitfullscreenchange',callback,true);};Utils.removeFullscreenChangeCallback=function onFullscreenChange(element,callback){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
element.ownerDocument.removeEventListener('fullscreenchange',callback,true);element.ownerDocument.removeEventListener('msfullscreenchange',callback,true);element.ownerDocument.removeEventListener('mozfullscreenchange',callback,true);element.ownerDocument.removeEventListener('webkitfullscreenchange',callback,true);};Utils.isFullscreenSupported=function isFullscreenSupported(){if('fullscreenEnabled'in document){return document.fullscreenEnabled;}else if('mozFullScreenEnabled'in document){return document.mozFullScreenEnabled;}else if('webkitFullscreenEnabled'in document){return document.webkitFullscreenEnabled;}};var fix_nonparticipanting_capturing_groups=function fix_nonparticipanting_capturing_groups(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undefined){this[i]=undefined;}}};Utils.split=function split(str,separator,limit){if(!separator instanceof RegExp){return str.split(separator,limit);}
var output=[],lastLastIndex=0,flags=(separator.ignoreCase?"i":"")+
(separator.multiline?"m":"")+
(separator.sticky?"y":""),separator2,match,lastIndex,lastLength;separator=new RegExp(separator.source,flags+"g");str=str+"";if(!Utils.split._compliantExecNpcg){separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags);}
if(limit===undefined||+limit<0){limit=Infinity;}else{limit=Math.floor(+limit);if(!limit){return[];}}
while((match=separator.exec(str))){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!Utils.split._compliantExecNpcg&&match.length>1){match[0].replace(separator2,fix_nonparticipanting_capturing_groups.bind(match));}
if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1));}
lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break;}}
if(separator.lastIndex===match.index){separator.lastIndex++;}}
if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("");}}else{output.push(str.slice(lastLastIndex));}
return output.length>limit?output.slice(0,limit):output;};Utils.split._compliantExecNpcg=/()??/.exec("")[1]===undefined;Utils.split._nativeSplit=String.prototype.split;Utils.hasWord=function hasWord(text,word){return text.match(new RegExp("(^\\s*|\\s+)"+word+"(\\s+|\\s*$)","g"))!=null;};Utils.removeWord=function removeWord(text,word){return text.replace(new RegExp("(^\\s*|\\s+)"+word+"(\\s+|\\s*$)","g")," ").trim();};Utils.appendWord=function appendWord(text,word){return Utils.removeWord(text,word)+(" "+word);};Utils.prependWord=function prependWord(text,word){return word+" "+Utils.removeWord(text,word);};Utils.escapeRegExp=function escapeRegExp(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");};var tmp_div=document.createElement('div');Utils.escapeHTML=function escapeHTML(text){tmp_div.textContent=text;return tmp_div.innerHTML;};if(!String.prototype.startsWith){Utils.startsWith=function startsWith(text,searchString,position){position=position||0;return text.indexOf(searchString,position)===position;};}else{Utils.startsWith=function startsWith(text,searchString,position){return text.startsWith(searchString,position);};}
if(!String.prototype.endsWith){Utils.endsWith=function endsWith(text,searchString,position){position=position||text.length;position=position-searchString.length;var lastIndex=text.lastIndexOf(searchString);return lastIndex!==-1&&lastIndex===position;};}else{Utils.endsWith=function endsWith(text,searchString,position){return text.endsWith(searchString,position);};}
Utils.getRelativePosition=function getRelativePosition(element1,element2){var coordinates={x:element1.offsetLeft,y:element1.offsetTop};var contextDocument=element1.ownerDocument;if(element1===element2){return{x:0,y:0};}
var parentNode=element1.offsetParent;while(parentNode!=element2){var cssStyle=contextDocument.defaultView.getComputedStyle(parentNode,null);var p=cssStyle.getPropertyValue('position');if(p!='static'){coordinates.y+=parentNode.offsetTop+cssStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);coordinates.x+=parentNode.offsetLeft+cssStyle.getPropertyCSSValue('border-left-width').getFloatValue(CSSPrimitiveValue.CSS_PX);coordinates.y-=parentNode.scrollTop;coordinates.x-=parentNode.scrollLeft;}
parentNode=parentNode.offsetParent;}
return coordinates;};Utils.getEventActions=function getEventActions(eventVar){var i,actions,contactSlots,nslotsByLabel,slotInfo,actionLabel;contactSlots=eventVar.getFinalSlots();nslotsByLabel={};actions=[];for(i=0;i<contactSlots.length;i+=1){slotInfo=contactSlots[i];if(nslotsByLabel[slotInfo.action_label]==null){nslotsByLabel[slotInfo.action_label]=1;}else{nslotsByLabel[slotInfo.action_label]+=1;}}
for(i=0;i<contactSlots.length;i+=1){slotInfo=contactSlots[i];actionLabel=slotInfo.action_label;if(nslotsByLabel[actionLabel]>1){actionLabel+=' ('+slotInfo.iGadgetName+')';}
actions.push({value:slotInfo,label:actionLabel});}
return actions;};Utils.XML={};Utils.XML.isElement=function isElement(element){return element&&('nodeType'in element)&&(element.nodeType===1);};if(window.Attr){Utils.XML.isAttribute=function isAttribute(element){return element instanceof Attr;};}else{Utils.XML.isAttribute=function isAttribute(element){return element&&('nodeType'in element)&&(element.nodeType===2);};}
if(document.createElementNS!=null){Utils.XML.createElementNS=function createElementNS(document,namespace,nodename){if(namespace){return document.createElementNS(namespace,nodename);}else{return document.createElement(nodename);}};}else{Utils.XML.createElementNS=function createElementNS(document,namespace,nodename){return document.createNode(1,nodename,namespace?namespace:"");};}
if(document.documentElement.getAttributeNS!=null){Utils.XML.getAttributeNS=function getAttributeNS(element,namespace,name){return element.getAttributeNS(namespace,name);};}else{Utils.XML.getAttributeNS=function getAttributeNS(element,namespace,name){for(var i=0;i<element.attributes.length;i++){var attr=element.attributes[i];if(attr.baseName==name&&attr.namespaceURI==namespace){return attr.nodeValue;}}
return"";};}
if(document.documentElement.hasAttribute!=null){Utils.XML.hasAttribute=function hasAttribute(element,name){return element.hasAttribute(name);};}else{Utils.XML.hasAttribute=function hasAttribute(element,name){return element.getAttribute(name)!==null;};}
if(document.documentElement.hasAttributeNS!=null){Utils.XML.hasAttributeNS=function hasAttribute(element,namespace,name){return element.hasAttributeNS(namespace,name);};}else{Utils.XML.hasAttributeNS=function hasAttributeNS(element,namespace,name){for(var i=0;i<element.attributes.length;i++){var attr=element.attributes[i];if(attr.baseName==name&&attr.namespaceURI==namespace){return true;}}
return false;};}
if(document.documentElement.setAttributeNS!=null){Utils.XML.setAttributeNS=function setAttributeNS(element,namespace,name,value){element.setAttributeNS(namespace,name,value);};}else{Utils.XML.setAttributeNS=function setAttributeNS(element,namespace,name,value){var attr;if(!('createNode'in element.ownerDocument)){alert('setAttributeNS is not supported in this browser');}
attr=element.ownerDocument.createNode(2,name,namespace);attr.nodeValue=value;element.setAttributeNode(attr);};}
if(document.implementation&&document.implementation.createDocument){Utils.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){return document.implementation.createDocument(namespaceURL,rootTagName,null);};}else if(window.ActiveXObject){Utils.XML.createDocument=function(namespaceURL,rootTagName,doctype){var doc=new ActiveXObject("MSXML2.DOMDocument");doc.appendChild(Utils.XML.createElementNS(doc,namespaceURL,rootTagName));return doc;};}else{Utils.XML.createDocument=function(namespaceURL,rootTagName,doctype){alert('createDocument is not supported in this browser');};}
if(window.DOMParser){Utils.XML.parseFromString=function parseFromString(text,type,fromAjax){var result,new_header,parser=new DOMParser();fromAjax=fromAjax!==undefined?fromAjax:true;if(fromAjax){result=text.match(new RegExp('<\\?xml(?:[^/]|/[^>])*standalone="([^"]+)"(?:[^/]|/[^>])*\\?>'));if(result&&(result[1]==='yes'||result[1]==='no')){new_header='<?xml version="1.0" standalone="'+result[1]+'" ?>';}else{new_header='<?xml version="1.0" ?>';}
text=text.replace(/<\?xml([^\/]|\/[^>])*\?>/g,new_header);}
return parser.parseFromString(text,type);};}else if(window.ActiveXObject){Utils.XML.parseFromString=function parseFromString(text,type,fromAjax){var xml=new ActiveXObject("Microsoft.XMLDOM");xml.async=false;xml.loadXML(text);return xml;};}else{Utils.XML.parseFromString=function parseFromString(text,type,fromAjax){var req=new XMLHttpRequest();req.open('GET','data:'+(type||"application/xml")+';charset=utf-8,'+encodeURIComponent(text),false);if(req.overrideMimeType){req.overrideMimeType(type);}
req.send(null);return req.responseXML;};}
if(window.XMLSerializer){Utils.XML.serializeXML=function serializeXML(node){return(new XMLSerializer()).serializeToString(node);};}else{Utils.XML.serializeXML=function serializeXML(node){if(node.xml){return node.xml;}else{throw"Error serializating xml";}};}
if(document.evaluate){Utils.XML.getChildElementByTagNameNS=function getChildElementByTagNameNS(element,ns,tagName){var xpathResult=element.ownerDocument.evaluate('s:'+tagName,element,function(namespace){return namespace==='s'?ns:null;},XPathResult.FIRST_ORDERED_NODE_TYPE,null);return xpathResult.singleNodeValue;};}else{Utils.XML.getChildElementByTagNameNS=function getChildElementByTagNameNS(element,ns,tagName){var i,currentChild;for(i=0;i<element.childNodes.length;i++){currentChild=element.childNodes[i];if(currentChild.namespaceURI===ns&&currentChild.localName===tagName){return currentChild;}}
return null;};}
Utils.values=function values(object){var result=[];for(var key in object){result.push(object[key]);}
return result;};Utils.clone=function clone(obj1){var result;if(obj1==null){return obj1;}else if(Array.isArray(obj1)){result=[];}else{result={};}
for(var key in obj1){result[key]=obj1[key];}
return result;};Utils.isEmptyObject=function isEmptyObject(obj){var name;for(name in obj){return false;}
return true;};Utils.removeFromParent=function removeFromParent(domNode){if(domNode.parentNode!=null){domNode.parentNode.removeChild(domNode);}};Utils.merge=function merge(obj1,obj2){if(obj2!=null){for(var key in obj2){obj1[key]=obj2[key];}}
return obj1;};StyledElements.Utils=Utils;})();Wirecloud.Utils=StyledElements.Utils;Wirecloud.Utils.gettext=gettext;Wirecloud.URLs={"LOGIN_VIEW":'/login',"LOGOUT_VIEW":'/logout',"LOCAL_REPOSITORY":'/',"LOCAL_RESOURCE_COLLECTION":'/api/resources',"LOCAL_RESOURCE_ENTRY":new Wirecloud.Utils.Template('/api/resource/%(vendor)s/%(name)s/%(version)s'),"LOCAL_UNVERSIONED_RESOURCE_ENTRY":new Wirecloud.Utils.Template('/api/resource/%(vendor)s/%(name)s'),"IWIDGET_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidgets'),"IWIDGET_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s'),"IWIDGET_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/preferences'),"IWIDGET_PROPERTIES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/properties'),"IWIDGET_VERSION_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/iwidget/%(iwidget_id)s/version'),"PLATFORM_CONTEXT_COLLECTION":'/api/context',"PLATFORM_PREFERENCES":'/api/preferences/platform',"PROXY":new Wirecloud.Utils.Template('/cdp/%(protocol)s/%(domain)s%(path)s'),"WORKSPACE_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/preferences'),"TAB_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tabs'),"TAB_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s'),"TAB_PREFERENCES":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/tab/%(tab_id)s/preferences'),"THEME_ENTRY":new Wirecloud.Utils.Template('/api/theme/%(name)s'),"MARKET_COLLECTION":'/api/markets',"GLOBAL_MARKET_ENTRY":new Wirecloud.Utils.Template('/api/market/%(market)s'),"MARKET_ENTRY":new Wirecloud.Utils.Template('/api/market/%(user)s/%(market)s'),"WIRING_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/wiring'),"OPERATOR_ENTRY":new Wirecloud.Utils.Template('/api/operator/%(vendor)s/%(name)s/%(version)s/html'),"WIDGET_CODE_ENTRY":new Wirecloud.Utils.Template('/api/widget/%(vendor)s/%(name)s/%(version)s/xhtml'),"WORKSPACE_COLLECTION":'/api/workspaces',"WORKSPACE_ENTRY":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s'),"WORKSPACE_PUBLISH":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/publish'),"WORKSPACE_RESOURCE_COLLECTION":new Wirecloud.Utils.Template('/api/workspace/%(workspace_id)s/resources'),"WORKSPACE_VIEW":new Wirecloud.Utils.Template('/%(owner)s/%(name)s'),"PUBLISH_ON_OTHER_MARKETPLACE":'/api/markets/publish',"WORKSPACE_MERGE":new Wirecloud.Utils.Template('/api/workspace/%(to_ws_id)s/merge'),"DJANGO_ADMIN":'/admin/',"FIWARE_RESOURCES_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/resources'),"FIWARE_OFFERING_ENTRY":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/%(store)s/offering/%(offering_id)s'),"FIWARE_FULL_SEARCH":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/search/%(search_string)s'),"FIWARE_STORE_RESOURCES_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/%(store)s/resources'),"FIWARE_STORE_SEARCH":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/search/%(store)s/%(search_string)s'),"FIWARE_STORE_COLLECTION":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/stores'),"FIWARE_STORE_START_PURCHASE":new Wirecloud.Utils.Template('/api/marketAdaptor/marketplace/%(market_user)s/%(market_name)s/store/%(store)s/start_purchase'),};var LayoutManagerFactory=function(){var instance=null;function LayoutManager(){this.mainLayout=new StyledElements.BorderLayout();this.mainLayout.getNorthContainer().appendChild(document.getElementById('wirecloud_header'));this.alternatives=new StyledElements.StyledAlternatives();this.mainLayout.getCenterContainer().appendChild(this.alternatives);this.mainLayout.insertInto(document.body);this.header=new Wirecloud.ui.WirecloudHeader(this);this.alternatives.addEventListener('preTransition',function(alternatives,old_alternative,new_alternative){this.header._notifyViewChange();}.bind(this));this.alternatives.addEventListener('postTransition',function(alternatives,old_alternative,new_alternative){this.header._notifyViewChange(new_alternative);}.bind(this));this.viewsByName={'initial':this.alternatives.createAlternative(),'workspace':this.alternatives.createAlternative({'alternative_constructor':Wirecloud.ui.WorkspaceView}),'wiring':this.alternatives.createAlternative({'alternative_constructor':Wirecloud.ui.WiringEditor}),'marketplace':this.alternatives.createAlternative({'alternative_constructor':Wirecloud.ui.MarketplaceView})};var plain_content=document.querySelector('.plain_content');if(plain_content!=null){this.viewsByName.initial.appendChild(plain_content);}
this._clickCallback=this._clickCallback.bind(this);this.timeout=null;if(document.getElementById("loading-window")){document.getElementById("loading-window").addEventListener('click',this._clickCallback,true);}
window.addEventListener("resize",this.resizeWrapper.bind(this),true);}
var updateSubTaskProgress=function updateSubTaskProgress(){this.subTask.updateTaskProgress((this.currentStep*100)/this.totalSteps);};var updateTaskProgress=function updateTaskProgress(monitor,progress){var msg;msg=gettext("%(task)s %(percentage)s%");msg=interpolate(msg,{task:monitor.title,percentage:Math.round(progress)},true);document.getElementById("loading-task-title").textContent=msg;if(monitor.subtasks.length===0){msg='';}else if(monitor.subtasks[monitor.currentsubtask].title!=""){msg=gettext("%(subTask)s: %(percentage)s%");msg=interpolate(msg,{subTask:monitor.subtasks[monitor.currentsubtask].title,percentage:Math.round(monitor.subtasks[monitor.currentsubtask].progress)},true);}else{msg="%(percentage)s";msg=interpolate(msg,{percentage:Math.round(monitor.subtasks[monitor.currentsubtask].progress)},true);}
document.getElementById("loading-subtask-title").textContent=msg;};LayoutManager.prototype._init=function _init(){this.viewsByName.myresources=this.alternatives.createAlternative({alternative_constructor:Wirecloud.ui.MyResourcesView});};LayoutManager.prototype._startComplexTask=function(task,subtasks){var monitor=new Wirecloud.TaskMonitorModel(task,subtasks);document.getElementById("loading-window").classList.remove("disabled");this.monitor=monitor;this.monitor.addEventListener('progress',updateTaskProgress);updateTaskProgress(monitor,0);return monitor;};LayoutManager.prototype.logSubTask=function(msg,totalSteps){this.subTask=this.monitor.nextSubtask(msg);this.currentStep=0;if(arguments.length==2){this.totalSteps=totalSteps;}else{this.totalSteps=1;}
updateSubTaskProgress.call(this);};LayoutManager.prototype.logStep=function(msg,totalSteps){this.currentStep++;if(this.currentStep>this.totalSteps){this.totalSteps=this.currentStep+1;}
if(arguments.length==2){this.totalSteps=totalSteps;}
updateSubTaskProgress.call(this);};LayoutManager.prototype._hideProgressIndicator=function(){var loadingElement=document.getElementById("loading-window");var loadingMessage=document.getElementById("loading-message");loadingElement.classList.add('disabled');loadingElement.classList.remove('fadding');loadingMessage.style.opacity='1';if(this.timeout!==null){clearTimeout(this.timeout);this.timeout=null;}};LayoutManager.prototype._clickCallback=function(event){if(document.getElementById("loading-window").classList.contains("fadding")){this._hideProgressIndicator();}
event.stopPropagation();};LayoutManager.prototype._notifyPlatformReady=function(){var loadingElement=document.getElementById("loading-window");loadingElement.classList.add("fadding");var loadingMessage=document.getElementById("loading-message");var step=0;var layoutManager=this;function fadder(){++step;if(step<80){loadingMessage.style.opacity=""+(1-(step*0.025));layoutManager.timeout=setTimeout(fadder,50);}else{layoutManager._hideProgressIndicator();}}
if(layoutManager.timeout!==null){clearTimeout(layoutManager.timeout);}
layoutManager.timeout=setTimeout(fadder,50);}
LayoutManager.prototype.resizeWrapper=function(){this.mainLayout.repaint();if(this.currentMenu){this.currentMenu.calculatePosition();}}
LayoutManager.prototype.changeCurrentView=function changeCurrentView(newView,options){if(options===true){options={};}else if(options==null){options={onComplete:function(alternatives,old_alternative,new_alternative){Wirecloud.HistoryManager.pushState(new_alternative.buildStateData());}};}
this.alternatives.showAlternative(this.viewsByName[newView],options);};LayoutManager.prototype.onHashChange=function(state){var nextView=this.viewsByName[state.view];if(nextView!==this.alternatives.getCurrentAlternative()){this.changeCurrentView(state.view,true);}
if('onHistoryChange'in nextView){nextView.onHistoryChange(state);}};return new function(){this.getInstance=function(){if(instance==null){instance=new LayoutManager();}
return instance;}}}();function IWidget(widget,iWidgetId,iWidgetName,layout,position,iconPosition,zPos,width,height,fulldragboard,minimized,refusedVersion,readOnly,description){this.code=null;this.position=position;this.contentWidth=Number(width);this.contentHeight=Number(height);this.zPos=zPos;this.draggable=null;this.visible=false;this.minimized=minimized;if(fulldragboard){this.minimized=false;this.previousContentWidth=this.contentWidth;this.previousHeight=this.contentHeight+layout.getMenubarSize().inLU;this.previousLayout=layout;this.previousPosition=this.position.clone();this.height=1;this.width=1;this.position.x=0;this.position.y=0;layout=layout.dragboard.fulldragboardLayout;}else if(!minimized){this.height=this.contentHeight;}else{this.height=layout.getMenubarSize().inLU;}
this.internal_iwidget=new Wirecloud.IWidget(widget,layout.dragboard.tab,description);this._iwidget_removed=this._iwidget_removed.bind(this);this.internal_iwidget.addEventListener('removed',this._iwidget_removed);this._updateErrorInfo=this._updateErrorInfo.bind(this);this.internal_iwidget.logManager.addEventListener('newentry',this._updateErrorInfo);Object.defineProperties(this,{'id':{get:function(){return this.internal_iwidget.id;}},'widget':{get:function(){return this.internal_iwidget.widget;}},'name':{get:function(){return this.internal_iwidget.name;}}});if(this.id){this.codeURL=this.internal_iwidget.widget.code_url+"#id="+this.id;}
this.refusedVersion=refusedVersion!==null?new Wirecloud.Version(refusedVersion):null;this.element=null;this.widgetMenu=null;this.contentWrapper=null;this.content=null;this.closeButton=null;this.settingsButton=null;this.minimizeButton=null;this.errorButton=null;this.iwidgetInputHTMLElement=null;this.statusBar=null;this.iconElement=null;this.iconImg=null;this.iwidgetIconNameHTMLElement=null;this.iconPosition=iconPosition;this.iconDraggable=null;this.extractOptionId=null;this.lowerOpId=null;this.raiseOpId=null;this.lowerToBottomOpId=null;this.raiseToTopOpId=null;this.menu=null;this.build();layout.addIWidget(this,true);}
IWidget.prototype.invalidIconPosition=function(){return this.iconPosition.x===-1&&this.iconPosition.y===-1;};IWidget.prototype.setPosition=function(position){if(!this.iconPosition){this.setIconPosition(new Wirecloud.DragboardPosition(-1,-1));}
if(this.onFreeLayout()&&this.invalidIconPosition()){this.setIconPosition(position);}
if(!position.equals(this.position)){this.position=position;if(this.element!==null){this.element.style.left=this.layout.getColumnOffset(position.x)+"px";this.element.style.top=this.layout.getRowOffset(position.y)+"px";this.internal_iwidget.contextManager.modify({'xPosition':this.position.x,'yPosition':this.position.y});}}};IWidget.prototype.setIconPosition=function(position){this.iconPosition=position.clone();if(this.iconElement){this.iconElement.style.left=this.layout.dragboard.freeLayout.getColumnOffset(this.iconPosition.x)+"px";this.iconElement.style.top=this.layout.dragboard.freeLayout.getRowOffset(this.iconPosition.y)+"px";}};IWidget.prototype.setZPosition=function(zPos){this.zPos=zPos;zPos=zPos!==null?zPos+1:"";if(this.element){this.element.style.zIndex=zPos;}
if(this.iconElement){this.iconElement.style.zIndex=zPos;}};IWidget.prototype.getPosition=function(){return this.position;};IWidget.prototype.getIconPosition=function(){return this.iconPosition;};IWidget.prototype.getZPosition=function(zPos){return this.zPos;};IWidget.prototype.getContentWidth=function(){return this.contentWidth;};IWidget.prototype.getContentHeight=function(){return this.contentHeight;};IWidget.prototype.getWidth=function(){return this.contentWidth;};IWidget.prototype.getHeight=function(){return this.height;};IWidget.prototype.isVisible=function(){return this.visible;};IWidget.prototype.onFreeLayout=function(){return this.layout.dragboard.freeLayout===this.layout;};IWidget.prototype.build=function(){var contents=this.internal_iwidget.buildInterface(Wirecloud.currentTheme.templates['iwidget'],this);this.element=contents.element;this.widgetMenu=this.element.getElementsByClassName('widget_menu')[0];this.contentWrapper=this.element.getElementsByClassName('widget_wrapper')[0];this.statusBar=this.element.getElementsByClassName('statusBar')[0];this.content=this.element.getElementsByTagName('iframe')[0];this.closeButton=contents.tmp.closebutton;this.errorButton=contents.tmp.errorbutton;this.minimizeButton=contents.tmp.minimizebutton;this.leftResizeHandle=contents.tmp.leftresizehandle;this.rightResizeHandle=contents.tmp.rightresizehandle;this.titleelement=contents.tmp.titleelement;this.element.addEventListener('transitionend',function(e){if(this.layout.iwidgetToMove==null&&['width','height','top','left'].indexOf(e.propertyName)!==-1){this.internal_iwidget.contextManager.modify({'height':this.contentHeight,'width':this.contentWidth,'heightInPixels':this.content.offsetHeight,'widthInPixels':this.content.offsetWidth});}}.bind(this),true);this.iconElement=document.createElement("div");this.iconElement.classList.add("floating_widget_icon");this.iconImg=document.createElement("img");this.iconImg.classList.add("floating_widget_img");this.iconImg.setAttribute("src",this.internal_iwidget.widget.getIcon());this.iconElement.appendChild(this.iconImg);this.iconImg.ondrag=function(){return false;};this.iwidgetIconNameHTMLElement=document.createElement("a");this.iwidgetIconNameHTMLElement.textContent=this.name;this.iwidgetIconNameHTMLElement.classList.add("floating_widget_title");this.iconElement.appendChild(this.iwidgetIconNameHTMLElement);this.iwidgetIconNameHTMLElement.addEventListener("click",function(){this.toggleMinimizeStatus(false);this.layout.dragboard.raiseToTop(this);}.bind(this),false);};IWidget.prototype.isAllowed=function isAllowed(action){return this.internal_iwidget.isAllowed(action);};IWidget.prototype._updateButtons=function(){this.closeButton.setDisabled(!this.isAllowed('close'));this.minimizeButton.setDisabled(!this.isAllowed('minimize'));var resizable=this.isAllowed('resize');this.leftResizeHandle.setDisabled(!resizable);this.rightResizeHandle.setDisabled(!resizable);};IWidget.prototype.paint=function(onInit){if(this.visible){return;}
this.visible=true;this.menu=new StyledElements.PopupMenu();this.menu.append(new Wirecloud.ui.IWidgetMenuItems(this));this.element.style.visibility="hidden";if(onInit){this.element.classList.add('in');}
this.layout.dragboard.dragboardElement.appendChild(this.element);this.element.style.left=this.layout.getColumnOffset(this.position.x)+"px";this.element.style.top=this.layout.getRowOffset(this.position.y)+"px";this.setZPosition(this.zPos);var minimizedStatusBackup=this.minimized;this.minimized=false;this._recomputeSize(false);this.minimized=null;this.setMinimizeStatus(minimizedStatusBackup,false,false);if(this.internal_iwidget.readOnly){this.element.classList.add("widget_window_readonly");}
if(!this.onFreeLayout()||!minimizedStatusBackup){this.element.style.visibility="";}
this.draggable=new Wirecloud.ui.IWidgetDraggable(this);this.internal_iwidget.contextManager.modify({'xPosition':this.position.x,'yPosition':this.position.y,'height':this.contentHeight,'width':this.contentWidth,'heightInPixels':this.content.offsetHeight,'widthInPixels':this.content.offsetWidth});this._updateButtons();this.layout.dragboard.dragboardElement.appendChild(this.iconElement);this.iconDraggable=new IWidgetIconDraggable(this);this.iconElement.style.left=this.layout.dragboard.freeLayout.getColumnOffset(this.iconPosition.x)+"px";this.iconElement.style.top=this.layout.dragboard.freeLayout.getRowOffset(this.iconPosition.y)+"px";this.iconImg.addEventListener("click",function(){this.setMinimizeStatus(false);this.layout.dragboard.raiseToTop(this);}.bind(this),true);this.content.setAttribute("src",this.codeURL);if(!onInit){this.element.classList.add('in');}};IWidget.prototype.load=function(){this.layout.dragboard.tab.paint();};IWidget.prototype.isPainted=function(){return this.menu!==null;};IWidget.prototype.destroy=function destroy(){if(this.loaded){this.events.unload.dispatch(this);}
if(this.draggable!==null){this.draggable.destroy();this.draggable=null;}
if(this.leftResizeHandle!==null){this.leftResizeHandle.destroy();this.leftResizeHandle=null;}
if(this.rightResizeHandle!==null){this.rightResizeHandle.destroy();this.rightResizeHandle=null;}
if(this.menu){this.menu.destroy();this.menu=null;}
this.position=null;if(this.internal_iwidget!=null){this.internal_iwidget.destroy();this.internal_iwidget=null;}};IWidget.prototype.remove=function(orderFromServer){orderFromServer=orderFromServer!==null?orderFromServer:false;if(this.layout===null){return;}
if(!orderFromServer){this.internal_iwidget.remove();}else{this.internal_iwidget.events.removed.dispatch(this.internal_iwidget);}};IWidget.prototype.setContentSize=function(newWidth,newHeight,persist){persist=persist!=null?persist:true;if(!this.isPainted()){this.contentWidth=newWidth;this.contentHeight=newHeight;return;}
var oldHeight=this.getHeight();var oldWidth=this.getWidth();this.contentWidth=newWidth;this.contentHeight=newHeight;this._recomputeSize(true);this.layout._notifyResizeEvent(this,oldWidth,oldHeight,this.getWidth(),this.getHeight(),false,persist);};IWidget.prototype._notifyWindowResizeEvent=function(){if(!this.isPainted()){return;}
var oldHeight=this.getHeight();var oldWidth=this.getWidth();this.element.style.left=this.layout.getColumnOffset(this.position.x)+"px";this.element.style.top=this.layout.getRowOffset(this.position.y)+"px";this._recomputeSize(true);};IWidget.prototype._recomputeWidth=function(){var width=this.layout.getWidthInPixels(this.contentWidth);width-=this._computeExtraWidthPixels();if(width<0){width=0;}
this.element.style.width=width+"px";};IWidget.prototype._recomputeWrapper=function(contentHeight){var wrapperHeight;if(!this.minimized){if(contentHeight){wrapperHeight=contentHeight;}else{wrapperHeight=parseInt(this.content.offsetHeight,10);}}else{wrapperHeight=0;}
this.contentWrapper.style.height=wrapperHeight+"px";};IWidget.prototype._computeExtraWidthPixels=function(){var windowStyle,pixels;windowStyle=document.defaultView.getComputedStyle(this.element,null);pixels=windowStyle.getPropertyCSSValue("border-left-width").getFloatValue(CSSPrimitiveValue.CSS_PX);pixels+=windowStyle.getPropertyCSSValue("border-right-width").getFloatValue(CSSPrimitiveValue.CSS_PX);return pixels;};IWidget.prototype._computeExtraHeightPixels=function(){var windowStyle,menubarStyle,statusbarStyle,pixels;windowStyle=document.defaultView.getComputedStyle(this.element,null);pixels=windowStyle.getPropertyCSSValue("border-bottom-width").getFloatValue(CSSPrimitiveValue.CSS_PX);pixels+=windowStyle.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX);menubarStyle=document.defaultView.getComputedStyle(this.widgetMenu,null);pixels+=menubarStyle.getPropertyCSSValue("border-bottom-width").getFloatValue(CSSPrimitiveValue.CSS_PX);pixels+=menubarStyle.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX);statusbarStyle=document.defaultView.getComputedStyle(this.statusBar,null);pixels+=statusbarStyle.getPropertyCSSValue("border-bottom-width").getFloatValue(CSSPrimitiveValue.CSS_PX);pixels+=statusbarStyle.getPropertyCSSValue("border-top-width").getFloatValue(CSSPrimitiveValue.CSS_PX);return pixels;};IWidget.prototype._recomputeHeight=function(basedOnContent){var contentHeight,oldHeight;oldHeight=this.height;if(!this.minimized){if(basedOnContent){contentHeight=this.layout.fromVCellsToPixels(this.contentHeight);var fullSize=contentHeight;fullSize+=this.widgetMenu.offsetHeight+
this.statusBar.offsetHeight;fullSize+=this._computeExtraHeightPixels();var processedSize=this.layout.adaptHeight(contentHeight,fullSize);contentHeight=processedSize.inPixels;this.height=processedSize.inLU;this.content.style.height=contentHeight+"px";}else{contentHeight=this.layout.getHeightInPixels(this.height);contentHeight-=this.widgetMenu.offsetHeight+this.statusBar.offsetHeight;contentHeight-=this._computeExtraHeightPixels();if(contentHeight<0){contentHeight=0;}
this.content.style.height=contentHeight+"px";this.contentHeight=Math.floor(this.layout.fromPixelsToVCells(contentHeight));}
this._recomputeWrapper(contentHeight);}else{this._recomputeWrapper();contentHeight=this.element.offsetHeight;this.content.style.height="0px";this.height=Math.ceil(this.layout.fromPixelsToVCells(contentHeight));}
this.internal_iwidget.contextManager.modify({'height':this.contentHeight});};IWidget.prototype._recomputeSize=function(basedOnContent){this._recomputeWidth();this._recomputeHeight(basedOnContent);};IWidget.prototype.setSize=function(newWidth,newHeight,resizeLeftSide,persist){resizeLeftSide=resizeLeftSide!==undefined?resizeLeftSide:false;persist=persist!==undefined?persist:true;if(!this.isPainted()){this.contentWidth=newWidth;this.height=newHeight;return;}
var oldWidth=this.getWidth();var oldHeight=this.getHeight();this.contentWidth=newWidth;this.height=newHeight;this._recomputeSize(false);if(persist){this.internal_iwidget.contextManager.modify({'height':this.contentHeight,'width':this.contentWidth,'heightInPixels':this.content.offsetHeight,'widthInPixels':this.content.offsetWidth});}else{this.internal_iwidget.contextManager.modify({'heightInPixels':this.content.offsetHeight,'widthInPixels':this.content.offsetWidth});}
this.layout._notifyResizeEvent(this,oldWidth,oldHeight,this.contentWidth,this.height,resizeLeftSide,persist);};IWidget.prototype.isMinimized=function(){return this.minimized;};IWidget.prototype.setMinimizeStatus=function(newStatus,persistence,reserveSpace){if(this.minimized===newStatus){return;}
this.minimized=newStatus;if(this.minimized){if(this.onFreeLayout()){this.element.style.visibility="hidden";this.iconElement.style.display="block";}else{this.contentWrapper.style.visibility="hidden";this.contentWrapper.style.border="0px";this.statusBar.style.display="none";this.minimizeButton.setTitle(gettext("Maximize"));this.minimizeButton.removeClassName("icon-minus");this.minimizeButton.addClassName("icon-plus");}}else{this.minimizeButton.setTitle(gettext("Minimize"));this.minimizeButton.removeClassName("icon-plus");this.minimizeButton.addClassName("icon-minus");this.contentWrapper.style.visibility="";this.contentWrapper.style.border="";if(this.onFreeLayout()){this.element.style.visibility="";this.iconElement.style.display="none";}else{this.statusBar.style.display="";}}
var oldHeight=this.getHeight();this._recomputeHeight(true);reserveSpace=(typeof reserveSpace!=='undefined'&&reserveSpace!==null)?reserveSpace:true;if(reserveSpace){var persist=persistence!==null?persistence:true;this.layout._notifyResizeEvent(this,this.contentWidth,oldHeight,this.contentWidth,this.getHeight(),false,persist,reserveSpace);}};IWidget.prototype.isInFullDragboardMode=function(){return this.layout instanceof FullDragboardLayout;};IWidget.prototype.setFullDragboardMode=function(enable){if(this.isInFullDragboardMode()===enable){return;}
var dragboard=this.layout.dragboard;if(enable){this.previousContentWidth=this.contentWidth;this.previousHeight=this.height;this.previousLayout=this.layout;this.previousPosition=this.position.clone();this.moveToLayout(dragboard.fulldragboardLayout);dragboard.raiseToTop(this);}else{this.moveToLayout(this.previousLayout);}};IWidget.prototype.toggleMinimizeStatus=function(persistence){this.setMinimizeStatus(!this.minimized,persistence);};IWidget.prototype._updateErrorInfo=function _updateErrorInfo(){var label,errorCount=this.internal_iwidget.logManager.getErrorCount();this.errorButton.setDisabled(errorCount===0);label=ngettext("%(errorCount)s error","%(errorCount)s errors",errorCount);label=interpolate(label,{errorCount:errorCount},true);this.errorButton.setTitle(label);};IWidget.prototype._iwidget_removed=function _iwidget_removed(){var dragboard=this.layout.dragboard;if(Wirecloud.Utils.XML.isElement(this.element.parentNode)){this.layout.removeIWidget(this,true);}
this.element=null;};IWidget.prototype.log=function(msg,level){level=level!=null?level:Wirecloud.constants.LOGGING.ERROR_MSG;this.internal_iwidget.logManager.log(msg,level);};IWidget.prototype.highlight=function highlight(){if(this.isVisible()){this.element.classList.add('highlighted');}};IWidget.prototype.unhighlight=function unhighlight(){if(this.isVisible()){this.element.classList.remove('highlighted');}};IWidget.prototype.toggleLayout=function(){if(this.onFreeLayout()){this.moveToLayout(this.layout.dragboard.baseLayout);}else{this.moveToLayout(this.layout.dragboard.freeLayout);}};IWidget.prototype.moveToLayout=function(newLayout){if(this.layout===newLayout){return;}
var affectedWidgetsRemoving=false;var affectedWidgetsAdding=false;var minimizeOnFinish=false;if(this.minimized){minimizeOnFinish=true;this.toggleMinimizeStatus();}
var contentWidth=this.element.offsetWidth;var fullWidth=contentWidth;contentWidth-=this._computeExtraWidthPixels();var contentHeight=this.content.offsetHeight;var fullHeight=contentHeight;fullHeight+=this.widgetMenu.offsetHeight+
this.statusBar.offsetHeight;fullHeight+=this._computeExtraHeightPixels();var dragboardChange=this.layout.dragboard!==newLayout.dragboard;var oldLayout=this.layout;if(dragboardChange){this.internal_iwidget._notifyUnloaded();}
affectedWidgetsRemoving=oldLayout.removeIWidget(this,dragboardChange);if(dragboardChange&&!(newLayout instanceof FreeLayout)){this.position=null;}else if(oldLayout instanceof FullDragboardLayout){this.position=this.previousPosition;}else{this.position.x=oldLayout.getColumnOffset(this.position.x);this.position.x=newLayout.adaptColumnOffset(this.position.x).inLU;this.position.y=oldLayout.getRowOffset(this.position.y);this.position.y=newLayout.adaptRowOffset(this.position.y).inLU;}
if(oldLayout instanceof FullDragboardLayout){this.contentWidth=this.previousContentWidth;this.height=this.previousHeight;}else{var newWidth=newLayout.adaptWidth(contentWidth,fullWidth,oldLayout);this.contentWidth=newWidth.inLU;var newHeight=newLayout.adaptHeight(contentHeight,fullHeight,oldLayout);this.height=newHeight.inLU;}
affectedWidgetsAdding=newLayout.addIWidget(this,dragboardChange);this.internal_iwidget.contextManager.modify({'height':this.contentHeight,'width':this.contentWidth});if(minimizeOnFinish){this.toggleMinimizeStatus();}
if(!dragboardChange&&(affectedWidgetsRemoving||affectedWidgetsAdding)){this.layout.dragboard._commitChanges();}else{var onSuccess=function(transport){};var onError=function(transport,e){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error saving changes to persistence: %(errorMsg)s."),transport,e);};var data=[];var iWidgetInfo={};iWidgetInfo['id']=this.id;if(!(newLayout instanceof FullDragboardLayout)){iWidgetInfo['top']=this.position.y;iWidgetInfo['left']=this.position.x;iWidgetInfo['width']=this.contentWidth;iWidgetInfo['height']=this.contentHeight;iWidgetInfo['layout']=this.onFreeLayout()?1:0;iWidgetInfo['fulldragboard']=false;}else{iWidgetInfo['fulldragboard']=true;}
iWidgetInfo['icon_top']=this.iconPosition.y;iWidgetInfo['icon_left']=this.iconPosition.x;iWidgetInfo['zIndex']=this.zPos;iWidgetInfo['tab']=this.layout.dragboard.tab.id;data.push(iWidgetInfo);var url=Wirecloud.URLs.IWIDGET_COLLECTION.evaluate({workspace_id:oldLayout.dragboard.workspace.id,tab_id:oldLayout.dragboard.tab.id});Wirecloud.io.makeRequest(url,{method:'PUT',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(data),onSuccess:onSuccess.bind(this),onFailure:onError.bind(this),});}};(function(view){"use strict";if(!('SVGElement'in view)){return;}
var svg_element=document.createElementNS("http://www.w3.org/2000/svg","svg:path");if('classList'in svg_element){return;}
var DOMEx=function(type,message){this.name=type;this.code=DOMException[type];this.message=message;};DOMEx.prototype=Error.prototype;var checkTokenAndGetIndex=function checkTokenAndGetIndex(classList,token){if(token===""){throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");}
if(/\s/.test(token)){throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");}
return classList.indexOf(token);};var ClassList=function ClassList(elem){var trimmedClasses=(elem.getAttribute("class")||"").trim(),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0;for(;i<classes.length;i++){this.push(classes[i]);}
this._updateClassName=function(){elem.setAttribute("class",this.toString());};};ClassList.prototype=[];ClassList.prototype.item=function item(i){return this[i]||null;};ClassList.prototype.contains=function contains(token){token+="";return checkTokenAndGetIndex(this,token)!==-1;};ClassList.prototype.add=function add(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";if(checkTokenAndGetIndex(this,token)===-1){this.push(token);updated=true;}}while(++i<l);if(updated){this._updateClassName();}};ClassList.prototype.remove=function remove(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+"";var index=checkTokenAndGetIndex(this,token);if(index!==-1){this.splice(index,1);updated=true;}}while(++i<l);if(updated){this._updateClassName();}};ClassList.prototype.toggle=function toggle(token,force){token+="";var result=this.contains(token),method=result?force!==true&&"remove":force!==false&&"add";if(method){this[method](token);}
return!result;};ClassList.prototype.toString=function toString(){return this.join(" ");};var classListGetter=function(){return new ClassList(this);};Object.defineProperty(view.SVGElement.prototype,"classList",{get:classListGetter});})(window);(function(){"use strict";var check_basic_requirements=function check_basic_requirements(){var tester={};if(!('addEventListener'in document.documentElement)){throw new Error('Missing basic DOM event support');}
if(!('JSON'in window)){throw new Error('Missing JSON support');}
if(!('freeze'in Object)){throw new Error('Missing Object.freeze support');}
if(!('defineProperty'in Object)){throw new Error('Missing Object.defineProperty support');}
try{tester={};Object.defineProperty(tester,'property',{});}catch(e){throw new Error('Missing proper Object.defineProperty support');}
if(!('defineProperties'in Object)){throw new Error('Missing Object.defineProperties support');}
if(!('defineProperties'in Object)){throw new Error('Missing Object.defineProperties support');}
if(!('classList'in document.documentElement)){throw new Error('Missing Element.classList support');}
if(window.history==null||typeof window.history.pushState!=='function'||typeof window.history.replaceState!=='function'){throw new Error("Missing HTML5's history API support");}
if(!('pointerEvents'in document.documentElement.style)){throw new Error('Missing pointer-events support for HTML elements');}};Wirecloud.check_basic_requirements=check_basic_requirements;})();(function(window){"use strict";var _internalGetCurrentStyle,cssProperties=[];var useInternalComputedStyle=typeof window.getComputedStyle==="undefined";if(!useInternalComputedStyle){try{var computedStyle,width;computedStyle=document.defaultView.getComputedStyle(document.documentElement,null);width=computedStyle.getPropertyCSSValue('width');width=width.getFloatValue(width.CSS_PX);}catch(e){useInternalComputedStyle=true;cssProperties=computedStyle;var _nativeGetComputedStyle=document.defaultView.getComputedStyle;_internalGetCurrentStyle=function _internalGetCurrentStyle(element,property,ieProperty){var computedStyle=_nativeGetComputedStyle.call(document.defaultView,element,null);return computedStyle.getPropertyValue(property);};}}else{_internalGetCurrentStyle=function _internalGetCurrentStyle(element,property,ieProperty){var value=element.currentStyle[ieProperty];if(value==='auto'){value=element.runtimeStyle[ieProperty];}
return value;};}
if(useInternalComputedStyle){var CSSPrimitiveValue=function CSSPrimitiveValue(element,property,ieProperty){if(arguments.length===0){return;}
this._element=element;this._property=property;this._ieProperty=ieProperty;this.cssText=_internalGetCurrentStyle(this._element,this._property,this._ieProperty);};CSSPrimitiveValue.CSS_PX=1;var _ValueRegExp=new RegExp('(\\d+|\\d+.\\d+)(\\w+)');CSSPrimitiveValue.prototype.getFloatValue=function getFloatValue(unit){var result;if(unit===CSSPrimitiveValue.CSS_PX){if(this.cssText===""){return 0;}
var parentNode=this._element.parentNode;var testElement=this._element.ownerDocument.createElement('div');testElement.style.visibility="hidden";testElement.style.padding="0";testElement.style.margin="0";testElement.style.border="0";var matching=/border-(top|right|bottom|left)-width/.exec(this._property);var side=matching!==null?matching[1]:null;matching=_ValueRegExp.exec(this.cssText);if(matching!=null){var value=matching[1];var units=matching[2];if(units=="px"){return parseInt(value,10);}else{testElement.style.height=this.cssText;}}else if((matching==null)&&(side!=null)){var property='border-'+side+'-style';var ieProperty=ComputedCSSStyleDeclaration.prototype._getIEProperty(property);var borderStyle=_internalGetCurrentStyle(this._element,property,ieProperty);if(borderStyle==="none"){return 0;}
var extraElement=this._element.ownerDocument.createElement('div');testElement.style.fontSize="0";testElement.style.lineHeight="0";extraElement.style.padding="0";extraElement.style.margin="0";extraElement.style.border="0";extraElement.style.width="1px";extraElement.style.borderTopWidth=this.cssText;extraElement.style.borderTopStyle=borderStyle;testElement.appendChild(extraElement);}else{throw new Error();}
parentNode.appendChild(testElement);if(testElement.offsetHeight!=null){result=testElement.offsetHeight;}else{throw new Error();}
parentNode.removeChild(testElement);return result;}else{throw new Error();}};var _rgbaColorParser=new RegExp('rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)');var _rgbColorParser=new RegExp('rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)');var _hexColorParser=new RegExp('#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})','i');var hex2value=function hex2value(hex){hex=hex.toUpperCase();return("0123456789ABCDEF".indexOf(hex.substr(0,1))*16)+"0123456789ABCDEF".indexOf(hex.substr(1,1));};CSSPrimitiveValue.prototype.getRGBColorValue=function getRGBColorValue(){switch(this._property){case'background-color':case'color':var red,green,blue,alpha='1';var matching=_rgbColorParser.exec(this.cssText);if(matching!==null){red=matching[1];green=matching[2];blue=matching[3];}else{matching=_rgbaColorParser.exec(this.cssText);if(matching!==null){red=matching[1];green=matching[2];blue=matching[3];alpha=matching[4];}else{matching=_hexColorParser.exec(this.cssText);if(matching===null){var parentNode=this._element.parentNode;var testElement=this._element.ownerDocument.createElement('table');testElement.setAttribute('bgcolor',this.cssText);testElement.style.visibility="hidden";parentNode.appendChild(testElement);var bgColor=testElement.bgColor;matching=_hexColorParser.exec(bgColor);if(matching===null){throw new Error('Error on getRGBColorValue');}
parentNode.removeChild(testElement);}
red=hex2value(matching[1]);green=hex2value(matching[2]);blue=hex2value(matching[3]);}}
return{red:new CSSColorComponentValue(red),green:new CSSColorComponentValue(green),blue:new CSSColorComponentValue(blue),alpha:new CSSColorComponentValue(alpha)};default:throw new Error();}};var CSSColorComponentValue=function CSSColorComponentValue(value){this.cssText=""+value;};CSSColorComponentValue.prototype=new CSSPrimitiveValue();CSSColorComponentValue.prototype.getFloatValue=function getFloatValue(unit){return parseInt(this.cssText,10);};var ComputedCSSStyleDeclaration=function ComputedCSSStyleDeclaration(element){this._element=element;};if(Object.defineProperty){var _defProp=function(object,property){Object.defineProperty(object,property,{get:function(){return this.getPropertyValue(property);},enumerable:true,configurable:false});};var i;for(i=0;i<cssProperties.length;i+=1){_defProp(ComputedCSSStyleDeclaration.prototype,cssProperties[i]);}}
ComputedCSSStyleDeclaration.prototype._getIEProperty=function _getIEProperty(property){if(property==='float'){return"styleFloat";}else{return property.replace(/-\w/g,function(a){return a.substr(1,1).toUpperCase();});}};ComputedCSSStyleDeclaration.prototype.getPropertyCSSValue=function getPropertyCSSValue(property){return new CSSPrimitiveValue(this._element,property,this._getIEProperty(property));};ComputedCSSStyleDeclaration.prototype.getPropertyValue=function getPropertyValue(property){return _internalGetCurrentStyle(this._element,property,this._getIEProperty(property));};window.CSSPrimitiveValue=CSSPrimitiveValue;window.CSSColorComponentValue=CSSColorComponentValue;window.getComputedStyle=function getComputedStyle(element,context){if(element==null){throw new Error('Operation is not supported');}
return new ComputedCSSStyleDeclaration(element);};if(window.document.defaultView===undefined){window.document.defaultView=window;}}})(window);(function(){"use strict";Wirecloud.constants.LOGGING={ERROR_MSG:1,WARN_MSG:2,INFO_MSG:3};Wirecloud.constants.HTTP_STATUS_DESCRIPTIONS={"0":gettext("Connection Refused"),"400":gettext("Bad Request"),"401":gettext("Unauthorized"),"402":gettext("Payment Required"),"403":gettext("Forbidden"),"404":gettext("Not Found"),"405":gettext("Method Not Allowed"),"406":gettext("Not Acceptable"),"407":gettext("Proxy Authentication Required"),"408":gettext("Request Timeout"),"409":gettext("Conflict"),"410":gettext("Gone"),"411":gettext("Length Required"),"412":gettext("Precondition Failed"),"413":gettext("Request Entity Too Large"),"414":gettext("Request-URI Too Long"),"415":gettext("Unsupported Media Type"),"416":gettext("Requested Range Not Satisfiable"),"417":gettext("Expectation Failed"),"422":gettext("Unprocessable Entity"),"423":gettext("Locked"),"424":gettext("Failed Dependency"),"426":gettext("Upgrade Required"),"500":gettext("Internal Server Error"),"501":gettext("Not Implemented"),"502":gettext("Bad Gateway"),"503":gettext("Service Unavailable"),"504":gettext("Gateway Timeout"),"505":gettext("HTTP Version Not Supported"),"506":gettext("Variant Also Negotiates"),"507":gettext("Insufficient Storage"),"508":gettext("Loop Detected"),"510":gettext("Not Extended")};Wirecloud.constants.UNKNOWN_STATUS_CODE_DESCRIPTION=gettext("Unknown status code");})();(function(){"use strict";var Event=function Event(){this.handlers=[];};Event.prototype.addEventListener=function addEventListener(handler){if(typeof handler!=='function'){throw new TypeError('Handlers must be functions');}
this.handlers.push(handler);};Event.prototype.removeEventListener=function removeEventListener(handler){if(typeof handler!=='function'){throw new TypeError('Handlers must be functions');}
var index=this.handlers.indexOf(handler);if(index!=-1){this.handlers.splice(index,1);}};Event.prototype.clearEventListeners=function clearEventListeners(){this.handlers.length=0;};Event.prototype.dispatch=function dispatch(){for(var i=0;i<this.handlers.length;i++){try{this.handlers[i].apply(null,arguments);}catch(e){}}};StyledElements.Event=Event;})();(function(){"use strict";var preferencesChanged=function preferencesChanged(preferences,modifiedValues){if('language'in modifiedValues){window.location.reload();}};Object.defineProperty(Wirecloud,'events',{value:{'activeworkspacechanged':new StyledElements.Event()}});Object.freeze(Wirecloud.events);var onCreateWorkspaceSuccess=function onCreateWorkspaceSuccess(options,response){var workspace=null;if([201,204].indexOf(response.status)===-1){onCreateWorkspaceFailure.call(this,options,response);}
if(response.status===201){workspace=JSON.parse(response.responseText);this.workspaceInstances[workspace.id]=workspace;if(!(workspace.creator in this.workspacesByUserAndName)){this.workspacesByUserAndName[workspace.creator]={};}
this.workspacesByUserAndName[workspace.creator][workspace.name]=workspace;}
if(typeof options.onSuccess==='function'){try{options.onSuccess(workspace);}catch(e){}}};var onCreateWorkspaceFailure=function onCreateWorkspaceFailure(options,response,e){var msg,details;msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding the workspace: %(errorMsg)s."),response,e);if(typeof options.onFailure==='function'){try{if(response.status===422){details=JSON.parse(response.responseText).details;}}catch(e){}
try{options.onFailure(msg,details);}catch(e){}}};var onWorkspaceRemoved=function onWorkspaceRemoved(workspace){delete this.workspacesByUserAndName[workspace.workspaceState.creator][workspace.workspaceState.name];delete this.workspaceInstances[workspace.id];var username=Wirecloud.contextManager.get('username');Wirecloud.changeActiveWorkspace(Wirecloud.Utils.values(this.workspacesByUserAndName[username])[0]);};var onMergeSuccess=function onMergeSuccess(options,response){Wirecloud.changeActiveWorkspace(Wirecloud.activeWorkspace.workspaceState);};var onMergeFailure=function onMergeFailure(options,response,e){var msg,details;msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error merging the mashup: %(errorMsg)s."),response,e);if(typeof options.onFailure==='function'){try{if(response.status===422){details=JSON.parse(response.responseText).details;}}catch(e){}
try{options.onFailure(msg,details);}catch(e){}}};Wirecloud.init=function init(options){this.workspaceInstances={};this.workspacesByUserAndName={};options=Wirecloud.Utils.merge({'monitor':null},options);Wirecloud.UserInterfaceManager.init();if(options.monitor==null){var layoutManager=LayoutManagerFactory.getInstance();layoutManager.resizeWrapper();options.monitor=layoutManager._startComplexTask(gettext('Loading Wirecloud Platform'),4);layoutManager.logSubTask(gettext('Retrieving Wirecloud code'));layoutManager.logStep('');layoutManager.logSubTask(gettext('Retrieving initial data'),4);}else if(!(options.monitor instanceof Wirecloud.TaskMonitorModel)){throw new TypeError('Invalid monitor');}
if(typeof options.onSuccess!=='function'){options.onSuccess=function(){Wirecloud.HistoryManager.init();var state=Wirecloud.HistoryManager.getCurrentState();LayoutManagerFactory.getInstance().changeCurrentView('workspace',true);if(state.workspace_name!==''){var workspace=this.workspacesByUserAndName[state.workspace_creator][state.workspace_name];this.changeActiveWorkspace(workspace,state.tab,{replaceNavigationState:true});}else{Wirecloud.createWorkspace({name:gettext('Workspace'),onSuccess:function(workspace){Wirecloud.changeActiveWorkspace(workspace,null,{replaceNavigationState:true});}});}}.bind(this);}
window.addEventListener("beforeunload",Wirecloud.unload.bind(this),true);var loaded_modules=0;var checkPlatformReady=function checkPlatformReady(){loaded_modules+=1;if(loaded_modules===4){options.onSuccess();}};Wirecloud.io.makeRequest(Wirecloud.URLs.PLATFORM_CONTEXT_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var url;options.monitor.nextSubtask('Processing initial context data');Wirecloud.contextManager=new Wirecloud.ContextManager(Wirecloud,JSON.parse(response.responseText));Wirecloud.contextManager.modify({'mode':Wirecloud.constants.CURRENT_MODE});LayoutManagerFactory.getInstance().header._initUserMenu();url=Wirecloud.URLs.THEME_ENTRY.evaluate({name:Wirecloud.contextManager.get('theme')})+"?v="+Wirecloud.contextManager.get('version_hash');Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){Wirecloud.currentTheme=new Wirecloud.ui.Theme(JSON.parse(response.responseText));LayoutManagerFactory.getInstance()._init();checkPlatformReady();}});Wirecloud.LocalCatalogue.reload({onSuccess:checkPlatformReady,onFailure:function(response){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error retrieving available resources: %(errorMsg)s."),response);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();}});}});Wirecloud.io.makeRequest(Wirecloud.URLs.PLATFORM_PREFERENCES,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var values=JSON.parse(response.responseText);Wirecloud.preferences=Wirecloud.PreferenceManager.buildPreferences('platform',values);},onFailure:function(response){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error retrieving platform preferences data: %(errorMsg)s"),response);Wirecloud.preferences=Wirecloud.PreferenceManager.buildPreferences('platform',{});},onComplete:function(){Wirecloud.preferences.addEventListener('post-commit',preferencesChanged.bind(this));checkPlatformReady();}.bind(this)});Wirecloud.io.makeRequest(Wirecloud.URLs.WORKSPACE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var workspaces=JSON.parse(response.responseText);for(var i=0;i<workspaces.length;i++){var workspace=workspaces[i];this.workspaceInstances[workspace.id]=workspace;if(!(workspace.creator in this.workspacesByUserAndName)){this.workspacesByUserAndName[workspace.creator]={};}
this.workspacesByUserAndName[workspace.creator][workspace.name]=workspace;}
checkPlatformReady();}.bind(this),onFailure:function(response){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error retrieving workspace list"),response);}});};Wirecloud.unload=function unload(){var layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext('Unloading Wirecloud Platform'));if(this.activeWorkspace!=null){this.activeWorkspace.unload();this.activeWorkspace=null;}};Wirecloud.logout=function logout(){window.location=Wirecloud.URLs.LOGOUT_VIEW;};Wirecloud.changeActiveWorkspace=function changeActiveWorkspace(workspace,initial_tab,options){var workspace_full_name,msg,state,steps=this.activeWorkspace!=null?2:1;options=Wirecloud.Utils.merge({replaceNavigationState:false},options);LayoutManagerFactory.getInstance()._startComplexTask(gettext("Changing current workspace"),steps);if(this.activeWorkspace!=null){this.activeWorkspace.unload();}
state={workspace_creator:workspace.creator,workspace_name:workspace.name,view:"workspace"};if(initial_tab){state.tab=initial_tab;}
workspace_full_name=workspace.creator+'/'+workspace.name;document.title=workspace_full_name;if(options.replaceNavigationState===true){Wirecloud.HistoryManager.replaceState(state);}else if(options.replaceNavigationState!=='leave'){Wirecloud.HistoryManager.pushState(state);}
msg=interpolate(gettext("Downloading workspace (%(name)s) data"),{name:workspace_full_name},true);LayoutManagerFactory.getInstance().logSubTask(msg,1);new Wirecloud.WorkspaceCatalogue(workspace.id,{onSuccess:function(workspace_resources){var workspaceUrl=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({'workspace_id':workspace.id});Wirecloud.io.makeRequest(workspaceUrl,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function(response){var workspace_data=JSON.parse(response.responseText);if(workspace_data.empty_params.length>0){var preferences,preferenceValues,param,i,dialog;preferenceValues={};for(i=0;i<workspace_data.empty_params.length;i+=1){param=workspace_data.empty_params[i];if(workspace_data.preferences[param]!=null){preferenceValues[param]=workspace_data.preferences[param];}}
LayoutManagerFactory.getInstance().header.refresh();preferences=Wirecloud.PreferenceManager.buildPreferences('workspace',preferenceValues,{workspaceState:workspace_data},workspace_data.empty_params);preferences.addEventListener('post-commit',function(){setTimeout(function(){Wirecloud.changeActiveWorkspace(workspace,initial_tab,options);},0);}.bind(this));LayoutManagerFactory.getInstance()._notifyPlatformReady();dialog=new Wirecloud.ui.PreferencesWindowMenu('workspace',preferences);dialog.setCancelable(false);dialog.show();return;}
this.activeWorkspace=new Workspace(workspace_data,workspace_resources);this.activeWorkspace.addEventListener('removed',onWorkspaceRemoved.bind(this));this.activeWorkspace.contextManager.addCallback(function(updated_attributes){var workspace,old_name;if('name'in updated_attributes){workspace=this.workspaceInstances[this.activeWorkspace.id];old_name=workspace.name;delete this.workspacesByUserAndName[workspace.creator][old_name];workspace.name=updated_attributes.name;this.workspacesByUserAndName[workspace.creator][workspace.name]=workspace;}}.bind(this));LayoutManagerFactory.getInstance()._notifyPlatformReady();LayoutManagerFactory.getInstance().header.refresh();this.events.activeworkspacechanged.dispatch(this.activeWorkspace);if(typeof options.onSuccess==="function"){try{options.onSuccess();}catch(e){}}}.bind(this)});}.bind(this)});};Wirecloud.createWorkspace=function createWorkspace(options){var body;options=Wirecloud.Utils.merge({allow_renaming:true,dry_run:false},options);body={allow_renaming:!!options.allow_renaming,dry_run:!!options.dry_run};if(options.name!=null){body.name=options.name;}
if(options.mashup!=null){body.mashup=options.mashup;}
Wirecloud.io.makeRequest(Wirecloud.URLs.WORKSPACE_COLLECTION,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(body),onSuccess:onCreateWorkspaceSuccess.bind(this,options),onFailure:onCreateWorkspaceFailure.bind(this,options)});};Wirecloud.mergeWorkspace=function mergeWorkspace(resource,options){if(options==null){options={};}
if(options.monitor){options.monitor.logSubTask(gettext("Merging mashup"));}
var active_ws_id=Wirecloud.activeWorkspace.id;var mergeURL=Wirecloud.URLs.WORKSPACE_MERGE.evaluate({to_ws_id:active_ws_id});Wirecloud.io.makeRequest(mergeURL,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({'mashup':resource.uri}),onSuccess:onMergeSuccess.bind(this,options),onFailure:onMergeFailure.bind(this,options)});};})();(function(){"use strict";var UserInterfaceManager={currentWindowMenu:null,currentPopups:[]};var coverLayerElement=null;var fadeInCover=function fadeInCover(){coverLayerElement.classList.add('in');};var showCover=function showCover(){coverLayerElement.style.display="block";setTimeout(fadeInCover,0);};var hideCover=function hideCover(){coverLayerElement.classList.remove('in');coverLayerElement.style.display="none";};UserInterfaceManager.init=function init(){if(coverLayerElement!=null){return;}
coverLayerElement=document.createElement('div');coverLayerElement.id='menu_layer';coverLayerElement.className='disabled_background fade';coverLayerElement.style.display='none';document.body.insertBefore(coverLayerElement,document.body.firstChild);document.addEventListener('keydown',function(event){if(event.keyCode===27){Wirecloud.UserInterfaceManager.handleEscapeEvent();}},true);};UserInterfaceManager.handleEscapeEvent=function handleEscapeEvent(){if(this.currentPopups.length>0){this.currentPopups[this.currentPopups.length-1].hide();}};UserInterfaceManager._unregisterRootWindowMenu=function _unregisterRootWindowMenu(window_menu){this._unregisterPopup(window_menu);this.currentWindowMenu=null;hideCover();};UserInterfaceManager._registerRootWindowMenu=function _registerRootWindowMenu(window_menu){if(!(window_menu instanceof Wirecloud.ui.WindowMenu)){throw TypeError('window_menu must be a WindowMenu instance');}
if(this.currentWindowMenu!=null){this.currentWindowMenu.hide();hideCover();}
this.currentWindowMenu=window_menu;this._registerPopup(window_menu);showCover();};UserInterfaceManager._unregisterPopup=function _unregisterPopup(popup){var index=this.currentPopups.indexOf(popup);if(index!==-1){this.currentPopups.splice(index,1);}};UserInterfaceManager._registerPopup=function _registerPopup(popup){if(popup!=null&&!('hide'in popup)){throw new TypeError('invalid popup parameter');}
this._unregisterPopup(popup);this.currentPopups.push(popup);};Wirecloud.UserInterfaceManager=UserInterfaceManager;})();Wirecloud.location={'domain':document.location.protocol+'//'+document.location.host,'protocol':document.location.protocol.substr(0,document.location.protocol.length-1),'host':document.location.host};(function(){"use strict";var HANDLER_RE=new RegExp(/^on(?:Create|Complete|Exception|Failure|Interactive|Loaded|Loading|Success|Uninitialized|\d{3})$/);var setRequestHeaders=function setRequestHeaders(){var headers,name;headers=Wirecloud.Utils.merge({'X-Requested-With':'XMLHttpRequest','Accept':'text/javascript, text/html, application/xml, text/xml, */*'},this.options.requestHeaders);if(!('Content-Type'in headers)&&this.options.contentType!=null){headers['Content-Type']=this.options.contentType;if(this.options.encoding!=null){headers['Content-Type']+='; charset='+this.options.encoding;}}
for(name in headers){if(headers[name]!=null){this.transport.setRequestHeader(name,headers[name]);}}};var onReadyStateChange=function onReadyStateChange(){if(this.transport.readyState==4){var response=new Response(this);try{if(('on'+response.status)in this.options){this.options['on'+response.status](response);}else if(this.options.onSuccess&&(response.status>=200&&response.status<300)){this.options.onSuccess(response);}else if(this.options.onFailure&&(response.status<200||response.status>=300)){this.options.onFailure(response);}}catch(e){if(this.options.onException){try{this.options.onException(response,e);}catch(e2){}}}
if(this.options.onComplete){try{this.options.onComplete(response);}catch(e){if(this.options.onException){try{this.options.onException(response,e);}catch(e2){}}}}}};var Response=function Response(request){Object.defineProperties(this,{'request':{value:request},'transport':{value:request.transport},'status':{value:request.transport.status},'statusText':{value:request.transport.statusText},'response':{value:request.transport.response}});if(request.options.responseType==null||request.options.responseType===''){Object.defineProperties(this,{'responseText':{value:request.transport.responseText},'responseXML':{value:request.transport.responseXML}});}};Response.prototype.getHeader=function getHeader(name){try{return this.transport.getResponseHeader(name);}catch(e){return null;}};Response.prototype.getAllResponseHeaders=function getAllResponseHeaders(){return this.transport.getAllResponseHeaders();};var toQueryString=function toQueryString(parameters){var key,query='';if(typeof parameters==='string'){return parameters;}
for(key in parameters){query+='&'+encodeURIComponent(key)+'='+encodeURIComponent(parameters[key]);}
return query.substr(1);};var Request=function Request(url,options){var key;this.url=url;this.options=Wirecloud.Utils.merge({method:'POST',asynchronous:true,responseType:null,contentType:null,encoding:null,postBody:null},options);for(key in this.options){if(HANDLER_RE.test(key)&&this.options[key]!=null&&typeof this.options[key]!=='function'){throw new TypeError(interpolate('Invalid %(callback)s callback',{callback:key},true));}}
this.method=this.options.method.toUpperCase();if(this.options.parameters!=null&&(typeof this.options.parameters==='string'||typeof this.options.parameters==='object')){if(['PUT','POST'].indexOf(this.method)!==-1&&this.options.postBody==null){this.options.postBody=toQueryString(this.options.parameters);if(this.options.contentType==null){this.options.contentType='application/x-www-form-urlencoded';}
if(this.options.encoding==null){this.options.encoding='UTF-8';}}else{if(this.url.indexOf('?')!==-1){this.url+='&'+toQueryString(this.options.parameters);}else{this.url+='?'+toQueryString(this.options.parameters);}}}
this.transport=new XMLHttpRequest();if(this.options.withCredentials===true&&this.options.supportsAccessControl){this.transport.withCredentials=true;}
this.transport.open(this.options.method,this.url,this.options.asynchronous);if(this.options.responseType){this.transport.responseType=this.options.responseType;}
this.transport.addEventListener('readystatechange',onReadyStateChange.bind(this),true);if(typeof this.options.onUploadProgress==='function'){this.transport.upload.addEventListener('progress',options.onUploadProgress,false);}
setRequestHeaders.call(this);this.transport.send(this.options.postBody);};var io={};io.buildProxyURL=function buildProxyURL(url,options){var final_url,protocolEnd,link,forceProxy,hostStart,pathStart,protocol,host,rest;if(options==null){options={};}
forceProxy=!!options.forceProxy;if(url.length>4&&url.indexOf('www.')===0){url='http://'+url;}
protocol=Wirecloud.location.protocol;host=Wirecloud.location.host;protocolEnd=url.indexOf('://');if(protocolEnd!==-1){hostStart=protocolEnd+3;pathStart=url.indexOf('/',hostStart);if(pathStart===-1){pathStart=url.length;}
protocol=url.substr(0,protocolEnd);host=url.substr(hostStart,pathStart-hostStart);rest=url.substring(pathStart);final_url=url;}else{if(url.charAt(0)==='/'){rest=url;}else{rest='/'+url;}
if(!forceProxy){final_url=Wirecloud.location.domain+rest;}}
if(forceProxy||(options.supportsAccessControl!==true&&(protocol!==Wirecloud.location.protocol||host!==Wirecloud.location.host))){final_url=Wirecloud.location.domain+
Wirecloud.URLs.PROXY.evaluate({protocol:protocol,domain:host,path:rest});}
return final_url;};io.makeRequest=function makeRequest(url,options){var key;if(options!=null&&options.context!=null){for(key in options){if(HANDLER_RE.test(key)&&typeof options[key]==='function'){options[key]=options[key].bind(options.context);}}}
return new Request(Wirecloud.io.buildProxyURL(url,options),options);};Wirecloud.io=io;})();(function(){"use strict";var ContextManager=function ContextManager(contextInstance,context_description){Object.defineProperty(this,'instance',{value:contextInstance});var context={};var handlers=[];for(var key in context_description){if(context_description==null||typeof context_description[key]!=='object'){delete context_description[key];}
context_description[key].name=key;if('value'in context_description[key]){context[key]=context_description[key].value;delete context_description[key].value;}else{context[key]=null;}
Object.freeze(context_description[key]);}
Object.freeze(context_description);Object.defineProperty(this,'getAvailableContext',{value:function getAvailableContext(){return context_description;}});Object.defineProperty(this,'addCallback',{value:function addCallback(handler){if(typeof handler!=='function'){throw new TypeError();}
handlers.push(handler);}});Object.defineProperty(this,'removeCallback',{value:function removeCallback(handler){var index;if(typeof handler!=='function'){throw new TypeError();}
index=handlers.indexOf(handler);if(index!==-1){handlers.splice(index,1);}}});Object.defineProperty(this,'get',{value:function get(key){return context[key];}});Object.defineProperty(this,'modify',{value:function get(values){var key,i,updated_values={};if(typeof values!=='object'){throw new TypeError();}
for(key in values){if(!context.hasOwnProperty(key)){throw new TypeError(key);}}
for(key in values){if(context[key]!==values[key]){context[key]=values[key];updated_values[key]=values[key];}}
if(!Wirecloud.Utils.isEmptyObject(updated_values)){for(i=0;i<handlers.length;i+=1){try{handlers[i](updated_values);}catch(e){}}}}});};Wirecloud.ContextManager=ContextManager;})();(function(){"use strict";var PreferenceError=function PreferenceError(message){this.name="PreferenceError";this.message=message||"";};PreferenceError.prototype=new Error();PreferenceError.prototype.constructor=PreferenceError;Object.freeze(PreferenceError.prototype);Object.freeze(PreferenceError);Wirecloud.PreferenceError=PreferenceError;})();(function(){"use strict";var UserPrefDef=function UserPrefDef(name,type,options){if(options.default!=null&&typeof options.default!=="string"){throw new TypeError('Invalid default option');}
if(type==='list'){type='select';}
if('value'in options){delete options.value;}
Object.defineProperty(this,'name',{value:name});Object.defineProperty(this,'type',{value:type});Object.defineProperty(this,'label',{value:options.label});Object.defineProperty(this,'description',{value:options.description});Object.defineProperty(this,'options',{value:options});var default_value='';if(options.type==='boolean'){default_value=options.default.trim().toLowerCase()==='true';}else if(options.type==='number'&&options.default!=null){default_value=Number(options.default);}else if(options.default!=null){default_value=options.default;}
Object.defineProperty(this,'default',{value:default_value});};Wirecloud.UserPrefDef=UserPrefDef;})();(function(){"use strict";var UserPref=function UserPref(pref_def,readOnly,hidden,currentValue){Object.defineProperty(this,'meta',{value:pref_def});Object.defineProperty(this,'readOnly',{value:!!readOnly});Object.defineProperty(this,'hidden',{value:!!hidden});if(pref_def.type==='boolean'&&typeof currentValue==='string'){this.value=currentValue.trim().toLowerCase()==='true';}else if(pref_def.type==='number'&&typeof currentValue==='string'){this.value=Number(currentValue);}else{this.value=currentValue;}};UserPref.prototype.getInterfaceDescription=function getInterfaceDescription(){var desc,type;type=this.meta.type;if(type==='list'){type='select';}
desc=Wirecloud.Utils.merge(this.meta.options,{'type':type,'defaultValue':this.meta.default,'initiallyDisabled':this.readOnly,'initialValue':this.value,'required':false});if(type==='select'){desc.initialEntries=this.meta.options.options;desc.required=true;}
return desc;};Wirecloud.UserPref=UserPref;})();(function(){"use strict";var PersistentVariable=function PersistentVariable(def,commiter,readonly,currentValue){Object.defineProperty(this,'meta',{value:def});Object.defineProperty(this,'readnOnly',{value:readonly});Object.defineProperty(this,'commiter',{value:commiter});this.value=currentValue;};PersistentVariable.prototype.get=function get(){return this.value;};PersistentVariable.prototype.set=function set(new_value){if(this.readOnly){throw new Error('Read only properties cannot be modified');}
this.value=new_value;this.commiter.add(this.meta.name,this.value);};Wirecloud.PersistentVariable=PersistentVariable;})();(function(){"use strict";var PersistentVariableDef=function PersistentVariableDef(name,type,options){if(options.default!=null&&typeof options.default!=="string"){throw new TypeError('Invalid default option');}
if('value'in options){delete options.value;}
Object.defineProperty(this,'name',{value:name});Object.defineProperty(this,'type',{value:type});Object.defineProperty(this,'label',{value:options.label});Object.defineProperty(this,'description',{value:options.description});Object.defineProperty(this,'options',{value:options});Object.defineProperty(this,'default',{value:options.default});};Wirecloud.PersistentVariableDef=PersistentVariableDef;})();(function(){var PolicyManager={},policy={};Object.defineProperty(PolicyManager,'evaluate',{value:function evaluate(context,action){var context;if(context in policy){context=policy[context];}else{return true;}
if(action in context){return context[action];}else{return true;}}});Object.preventExtensions(PolicyManager);Object.defineProperty(Wirecloud,'PolicyManager',{value:PolicyManager});})();(function(){"use strict";var currentState={};var onpopstate=function onpopstate(event){if(event.state===null){return;}
currentState=event.state;LayoutManagerFactory.getInstance().onHashChange(event.state);};var prepareData=function prepareData(data){var key,default_data={view:"workspace"};data=Wirecloud.Utils.merge(default_data,data);for(key in data){data[key]=""+data[key];}
return data;};var buildURL=function buildURL(data){var key,hash='';for(key in data){if(key==='workspace_name'||key==='workspace_creator'){continue;}
hash+='&'+encodeURI(key)+'='+encodeURI(data[key]);}
return window.location.protocol+"//"+
window.location.host+"/"+encodeURIComponent(data.workspace_creator)+'/'+encodeURIComponent(data.workspace_name)+
window.location.search+'#'+hash.substr(1);};var HistoryManager={};HistoryManager.init=function init(){var initialState=this._parseStateFromHash(window.location.hash);this._parseWorkspaceFromPathName(window.location.pathname,initialState);window.addEventListener("popstate",onpopstate.bind(this),true);initialState=prepareData(initialState);var url=buildURL(initialState);history.replaceState(initialState,document.title,url);currentState=initialState;};HistoryManager._parseStateFromHash=function _parseStateFromHash(hash){var definitions,i,pair,key,value,data={};if(hash.charAt(0)==='#'){hash=hash.substr(1);}
if(hash.length===0){return data;}
definitions=hash.split('&');for(i=0;i<definitions.length;i+=1){pair=definitions[i].split('=');key=decodeURIComponent(pair[0]);value=decodeURIComponent(pair[1]);data[key]=value;}
return data;};HistoryManager._parseWorkspaceFromPathName=function _parseWorkspaceFromPathName(pathname,status){var index,index2;index=pathname.lastIndexOf('/');index2=pathname.lastIndexOf('/',index-1);status.workspace_creator=decodeURIComponent(pathname.substring(index2+1,index));status.workspace_name=decodeURIComponent(pathname.substring(index+1));};HistoryManager.pushState=function pushState(data){var url,key,equal;data=prepareData(data);equal=true;for(key in data){if(data[key]!==currentState[key]){equal=false;break;}}
if(equal){return;}
url=buildURL(data);history.pushState(data,document.title,url);currentState=data;};HistoryManager.replaceState=function replaceState(data){var url,key,equal;data=prepareData(data);equal=true;for(key in data){if(data[key]!==currentState[key]){equal=false;break;}}
if(equal){return;}
url=buildURL(data);history.replaceState(data,document.title,url);currentState=data;};HistoryManager.getCurrentState=function getCurrentState(){return Wirecloud.Utils.clone(currentState);};Wirecloud.HistoryManager=HistoryManager;})();(function(){"use strict";var VERSION_RE=/^((?:[1-9]\d*\.|0\.)*(?:[1-9]\d*|0))((?:a|b|rc)[1-9]\d*)?$/;var Version=function Version(version,source){var groups;if(typeof version=='string'){groups=version.match(VERSION_RE);this.array=groups[1].split('.').map(function(x){return parseInt(x,10);});this.pre_version=groups[2]!=null?groups[2]:null;this.text=version;}else if(version instanceof Array){this.array=version;this.pre_version=null;this.text=version.join('.');}else{throw new TypeError();}
this.source=source;Object.freeze(this);};Version.prototype.compareTo=function compareTo(version){var len,value1,value2,pre_version1,pre_version2,i;len=Math.max(this.array.length,version.array.length);for(i=0;i<len;i+=1){value1=this.array[i]!=null?this.array[i]:0;value2=version.array[i]!=null?version.array[i]:0;if(value1!==value2){return value1-value2;}}
pre_version1=this.pre_version;if(pre_version1==null){pre_version1="z";}
pre_version2=version.pre_version;if(pre_version2==null){pre_version2="z";}
if(pre_version1<pre_version2){return-1;}else if(pre_version1>pre_version2){return 1;}else{return 0;}};Version.prototype.toString=function toString(){return this.text;};Wirecloud.Version=Version;})();(function(){"use strict";var MashableApplicationComponent=function MashableApplicationComponent(desc){var vendor,name,version,uri,title,description,changelog;if(!('vendor'in desc)||desc.vendor.trim()===''){throw new TypeError(gettext('missing vendor'));}
vendor=desc.vendor.trim();Object.defineProperty(this,'vendor',{value:vendor});if(!('name'in desc)||desc.name.trim()===''){throw new TypeError(gettext('missing name'));}
name=desc.name.trim();Object.defineProperty(this,'name',{value:name});if(!('version'in desc)||desc.version.trim()===''){throw new TypeError(gettext('missing version'));}
version=new Wirecloud.Version(desc.version.trim());Object.defineProperty(this,'version',{value:version});uri=desc.name.trim();Object.defineProperty(this,'uri',{value:vendor+'/'+name+'/'+version.text});if(typeof desc.type!=='string'){throw new TypeError(gettext('missing type'));}
Object.defineProperty(this,'type',{value:desc.type});if(!('changelog'in desc)||desc.changelog.trim()===''){changelog='';}else{changelog=desc.changelog;}
Object.defineProperty(this,'changelog',{value:changelog});if(!('title'in desc)||desc.title.trim()===''){title=name;}else{title=desc.title;}
Object.defineProperty(this,'title',{value:title});description=desc.description;if(description==null||description.trim()===''){description='';}
Object.defineProperty(this,'description',{value:description});};Wirecloud.MashableApplicationComponent=MashableApplicationComponent;})();(function(){"use strict";var Widget=function Widget(data){var i,preference,property;Wirecloud.MashableApplicationComponent.call(this,data);this.id=this.uri;this.code_url=Wirecloud.URLs.WIDGET_CODE_ENTRY.evaluate({vendor:this.vendor,name:this.name,version:this.version.text})+"?v="+Wirecloud.contextManager.get('version_hash');this.code_content_type=data.code_content_type;this.doc=data.doc;this.preferences={};this.preferenceList=[];for(i=0;i<data.preferences.length;i++){preference=new Wirecloud.UserPrefDef(data.preferences[i].name,data.preferences[i].type,data.preferences[i]);this.preferences[preference.name]=preference;this.preferenceList.push(preference);}
Object.freeze(this.preferences);Object.freeze(this.preferenceList);this.properties={}
this.propertyList=[];for(i=0;i<data.properties.length;i++){property=new Wirecloud.PersistentVariableDef(data.properties[i].name,data.properties[i].type,data.properties[i]);this.properties[property.name]=property;this.propertyList.push(property);}
Object.freeze(this.properties);Object.freeze(this.propertyList);this.inputList=data.wiring.inputs;this.inputs={};for(i=0;i<this.inputList.length;i++){this.inputs[this.inputList[i].name]=this.inputList[i];}
this.outputList=data.wiring.outputs;this.outputs={};for(i=0;i<this.outputList.length;i++){this.outputs[this.outputList[i].name]=this.outputList[i];}
this.image=data.image;this.default_width=data.widget_width;this.default_height=data.widget_height;this.getIcon=function getIcon(){return data.smartphoneimage!==''?data.smartphoneimage:data.image;};this.getIPhoneImageURI=this.getIcon;var lastVersion=this.version;var showcaseLastVersion=this.version;var catalogueLastVersion=null;var upToDate=true;this.getLastVersion=function getLastVersion(){if(lastVersion==null){if(catalogueLastVersion==null||showcaseLastVersion.compareTo(catalogueLastVersion)>=0){lastVersion=showcaseLastVersion;}else{lastVersion=catalogueLastVersion;}}
return lastVersion;};this.setLastVersion=function setLastVersion(v){var oldVersion=this.getLastVersion();if(v.source==='showcase'){showcaseLastVersion=v;}else{catalogueLastVersion=v;}
lastVersion=null;var newVersion=this.getLastVersion();upToDate=this.version.compareTo(newVersion)===0;return oldVersion.compareTo(newVersion)!==0;};this.isUpToDate=function isUpToDate(){return upToDate;};Object.freeze(this);};Widget.prototype.getInfoString=function getInfoString(){var transObj={vendor:this.vendor,name:this.name,version:this.version};var msg=gettext("[WidgetVendor: %(vendor)s, WidgetName: %(name)s, WidgetVersion: %(version)s]");return interpolate(msg,transObj,true);};Wirecloud.Widget=Widget;})();(function(){"use strict";var PreferenceDef=function PreferenceDef(name,inheritable,inheritByDefault,hidden,options){Object.defineProperties(this,{name:{value:name},label:{value:options.label},description:{value:options.description},inheritable:{value:!!inheritable},inheritByDefault:{value:!!(inheritable&&inheritByDefault)},default:{value:options.defaultValue},hidden:{value:!!hidden},options:{value:options}});Object.freeze(this);};Wirecloud.PreferenceDef=PreferenceDef;})();(function(){"use strict";var PlatformPref=function PlatformPref(manager,preferenceDef,inherit,value){Object.defineProperty(this,'meta',{value:preferenceDef});Object.defineProperty(this,'manager',{value:manager});this.inherit=inherit;if(value!=null){this.value=Wirecloud.ui.InputInterfaceFactory.parse(preferenceDef.options.type,value);}else{this.value=preferenceDef.default;}
this.handlers=[];};PlatformPref.prototype.getEffectiveValue=function getEffectiveValue(){if(this.inherit){return this.manager.getParentValue(this.meta.name);}
return this.value;};PlatformPref.prototype.addHandler=function addHandler(handler){this.handlers.push(handler);};PlatformPref.prototype._propagate=function _propagate(){for(var i=0;i<this.handlers.length;i++){try{this.handlers[i](this.scope,this.name,this.value);}catch(e){}}};PlatformPref.prototype.setDefaultValue=function setDefaultValue(){this.setValue(this.definition.inputInterface.getDefaultValue());};Wirecloud.PlatformPref=PlatformPref;})();(function(){"use strict";var PreferencesDef=function PreferencesDef(definitions){if(arguments.length==0){return;}
Object.defineProperty(this,'preferences',{value:definitions});};Wirecloud.PreferencesDef=PreferencesDef;})();(function(){"use strict";var PlatformPreferencesDef=function PlatformPreferencesDef(definitions){Wirecloud.PreferencesDef.call(this,definitions);};PlatformPreferencesDef.prototype=new Wirecloud.PreferencesDef();PlatformPreferencesDef.prototype.buildPreferences=function buildPreferences(values){return new Wirecloud.PlatformPreferences(this,values);};Wirecloud.PlatformPreferencesDef=PlatformPreferencesDef;})();(function(){"use strict";var WorkspacePreferencesDef=function WorkspacePreferencesDef(definitions,args){var extra_prefs,empty_params,i,param,workspace=args[1];extra_prefs=Wirecloud.PreferenceManager.processDefinitions(workspace.workspaceState.extra_prefs);if(Array.isArray(args[2])&&args[2].length>0){empty_params=args[2];definitions={};for(i=0;i<empty_params.length;i+=1){param=empty_params[i];definitions[param]=extra_prefs[param];}}else if(workspace.workspaceState!=null){definitions=Wirecloud.Utils.merge(definitions,extra_prefs);}
Wirecloud.PreferencesDef.call(this,definitions);};WorkspacePreferencesDef.prototype=new Wirecloud.PreferencesDef();WorkspacePreferencesDef.prototype.buildPreferences=function buildPreferences(values,workspace){return new Wirecloud.WorkspacePreferences(this,workspace,values);};Wirecloud.WorkspacePreferencesDef=WorkspacePreferencesDef;})();(function(){"use strict";var TabPreferencesDef=function TabPreferencesDef(definitions){Wirecloud.PreferencesDef.call(this,definitions);};TabPreferencesDef.prototype=new Wirecloud.PreferencesDef();TabPreferencesDef.prototype.buildPreferences=function buildPreferences(values,tab){return new Wirecloud.TabPreferences(this,tab,values);};Wirecloud.TabPreferencesDef=TabPreferencesDef;})();(function(){"use strict";var ObjectWithEvents=function ObjectWithEvents(events){events=events?events:[];this.events={};for(var i=0;i<events.length;i++){this.events[events[i]]=new StyledElements.Event();}};ObjectWithEvents.prototype.addEventListener=function addEventListener(event,handler){if(this.events[event]==null){throw new Error(StyledElements.Utils.interpolate("Unhandled event \"%(event)s\"",{event:event}));}
this.events[event].addEventListener(handler);};ObjectWithEvents.prototype.clearEventListeners=function clearEventListeners(event){if(event==null){for(event in this.events){this.events[event].clearEventListeners();}}else{if(this.events[event]==null){throw new TypeError(StyledElements.Utils.interpolate("Unhandled event \"%(event)s\"",{event:event}));}
this.events[event].clearEventListeners();}};ObjectWithEvents.prototype.removeEventListener=function removeEventListener(event,handler){if(this.events[event]==null){throw new Error(StyledElements.Utils.interpolate("Unhandled event \"%(event)s\"",{event:event}));}
this.events[event].removeEventListener(handler);};ObjectWithEvents.prototype.destroy=function destroy(){this.events=null;};StyledElements.ObjectWithEvents=ObjectWithEvents;})();(function(){"use strict";var StyledElement=function StyledElement(events){StyledElements.ObjectWithEvents.call(this,events);this.wrapperElement=null;this.enabled=true;};StyledElement.prototype=new StyledElements.ObjectWithEvents();StyledElement.prototype.insertInto=function insertInto(element,refElement){if(element instanceof StyledElements.StyledElement){element=element.wrapperElement;}
if(refElement instanceof StyledElements.StyledElement){refElement=refElement.wrapperElement;}
if(refElement){element.insertBefore(this.wrapperElement,refElement);}else{element.appendChild(this.wrapperElement);}
return this;};StyledElement.prototype._getUsableHeight=function _getUsableHeight(){var parentElement=this.wrapperElement.parentNode;if(!StyledElements.Utils.XML.isElement(parentElement)){return null;}
var parentStyle=document.defaultView.getComputedStyle(parentElement,null);if(parentStyle.getPropertyCSSValue('display')==null){return null;}
var containerStyle=document.defaultView.getComputedStyle(this.wrapperElement,null);var height=parentElement.offsetHeight-
parentStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
parentStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);return height;};StyledElement.prototype._getUsableWidth=function _getUsableWidth(){var parentElement=this.wrapperElement.parentNode;if(!StyledElements.Utils.XML.isElement(parentElement)){return null;}
var parentStyle=document.defaultView.getComputedStyle(parentElement,null);var containerStyle=document.defaultView.getComputedStyle(this.wrapperElement,null);var width=parentElement.offsetWidth-
parentStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX)-
parentStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX)-
containerStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);return width;};StyledElement.prototype.repaint=function repaint(temporal){};StyledElement.prototype.hasClassName=function hasClassName(className){return this.wrapperElement.classList.contains(className);};StyledElement.prototype.addClassName=function addClassName(className){var i,tokens;className=className.trim();if(className===''){return;}
tokens=className.split(/\s+/);for(i=0;i<tokens.length;i++){this.wrapperElement.classList.add(tokens[i]);}
return this;};StyledElement.prototype.removeClassName=function removeClassName(className){var i,tokens;className=className.trim();if(className===''){return;}
tokens=className.split(/\s+/);for(i=0;i<tokens.length;i++){this.wrapperElement.classList.remove(tokens[i]);}
return this;};StyledElement.prototype.setDisabled=function setDisabled(disable){if(disable){return this.disable();}else{return this.enable();}};StyledElement.prototype.enable=function enable(){this.enabled=true;this.removeClassName('disabled');return this;};StyledElement.prototype.disable=function disable(){this.enabled=false;this.addClassName('disabled');return this;};StyledElement.prototype.getBoundingClientRect=function(){return this.wrapperElement.getBoundingClientRect();};StyledElements.StyledElement=StyledElement;})();(function(){"use strict";var StyledInputElement=function StyledInputElement(defaultValue,events){this.inputElement=null;this.defaultValue=defaultValue;StyledElements.StyledElement.call(this,events);};StyledInputElement.prototype=new StyledElements.StyledElement();StyledInputElement.prototype.getValue=function getValue(){return this.inputElement.value;};StyledInputElement.prototype.setValue=function setValue(newValue){this.inputElement.value=newValue;return this;};StyledInputElement.prototype.reset=function reset(){return this.setValue(this.defaultValue);};StyledInputElement.prototype.enable=function enable(){StyledElements.StyledElement.prototype.enable.call(this);this.inputElement.disabled=false;return this;};StyledInputElement.prototype.disable=function disable(){StyledElements.StyledElement.prototype.disable.call(this);this.inputElement.disabled=true;return this;};StyledInputElement.prototype.focus=function focus(){this.inputElement.focus();return this;};StyledElements.StyledInputElement=StyledInputElement;})();(function(){"use strict";var CommandQueue=function CommandQueue(context,initFunc,stepFunc){var running=false;var elements=[];var step=0;var stepTimes=null;function doStep(){if(stepFunc(step,context)){var timeDiff=stepTimes[step]-(new Date()).getTime();if(timeDiff<0){timeDiff=0;}
step++;setTimeout(doStep,timeDiff);}else{doInit();}}
function doInit(){var command;do{command=elements.shift();}while(command!==undefined&&!(stepTimes=initFunc(context,command)));if(command!==undefined){step=0;var timeDiff=stepTimes[step]-(new Date()).getTime();if(timeDiff<0){timeDiff=0;}
setTimeout(doStep,timeDiff);}else{running=false;}}
this.addCommand=function addCommand(command){if(command===undefined){return;}
elements.push(command);if(!running){running=true;doInit();}};};StyledElements.CommandQueue=CommandQueue;})();(function(){"use strict";var Container=function Container(options,events){var defaultOptions={'extending':false,'class':'','useFullHeight':false};options=StyledElements.Utils.merge(defaultOptions,options);if(options.extending){return;}
StyledElements.StyledElement.call(this,events);this.useFullHeight=options.useFullHeight;this.wrapperElement=document.createElement("div");this.children=[];if(options.id){this.wrapperElement.setAttribute("id",options.id);}
this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"container");};Container.prototype=new StyledElements.StyledElement();Container.prototype.appendChild=function appendChild(element,refElement){if(element instanceof StyledElements.StyledElement){element.insertInto(this.wrapperElement,refElement);this.children.push(element);}else{if(refElement instanceof StyledElements.StyledElement){refElement=refElement.wrapperElement;}
if(refElement!=null){this.wrapperElement.insertBefore(element,refElement);}else{this.wrapperElement.appendChild(element);}}};Container.prototype.removeChild=function appendChild(element){var index;if(element instanceof StyledElements.StyledElement){index=this.children.indexOf(element);this.children.splice(index,1);this.wrapperElement.removeChild(element.wrapperElement);}else{this.wrapperElement.removeChild(element);}};Container.prototype.repaint=function repaint(temporal){temporal=temporal!==undefined?temporal:false;if(this.useFullHeight){if(this.wrapperElement.classList.contains('hidden')){this.wrapperElement.style.height="";return;}
var height=this._getUsableHeight();if(height==null){return;}
this.wrapperElement.style.height=(height+"px");}
for(var i=0;i<this.children.length;i++){this.children[i].repaint(temporal);}
if(this.disabledLayer!=null){this.disabledLayer.style.height=this.wrapperElement.scrollHeight+'px';this.disabledLayer.style.lineHeight=this.wrapperElement.clientHeight+'px';}};Container.prototype.clear=function clear(){this.children=[];this.wrapperElement.innerHTML="";if(this.disabledLayer!=null){this.wrapperElement.appendChild(this.disabledLayer);}};Container.prototype.isDisabled=function isDisabled(){return this.disabledLayer!=null;};Container.prototype.setDisabled=function setDisabled(disabled){if(this.isDisabled()==disabled){return;}
if(disabled){this.disabledLayer=document.createElement('div');this.disabledLayer.className='disable-layer';this.disabled_icon=document.createElement('i');this.disabled_icon.className='disable-icon icon-spin icon-spinner';this.disabledLayer.appendChild(this.disabled_icon);this.wrapperElement.appendChild(this.disabledLayer);this.wrapperElement.classList.add('disabled');this.disabledLayer.style.height=this.wrapperElement.scrollHeight+'px';this.disabledLayer.style.lineHeight=this.wrapperElement.clientHeight+'px';}else{this.wrapperElement.classList.remove('disabled');this.disabledLayer.parentNode.removeChild(this.disabledLayer);this.disabledLayer=null;this.disable_icon=null;}
this.enabled=!disabled;};Container.prototype.enable=function enable(){this.setDisabled(false);};Container.prototype.disable=function disable(){this.setDisabled(true);};StyledElements.Container=Container;})();(function(){"use strict";var clickCallback=function clickCallback(e){e.preventDefault();e.stopPropagation();if(this._related_input){this._related_input.focus();}};var Addon=function Addon(options){var defaultOptions={'text':null,'title':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement("span");this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"add-on");if(options.title){this.setTitle(options.title);}
if(options.text){this.setLabel(options.text);}
this._clickCallback=clickCallback.bind(this);this.wrapperElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._clickCallback,true);};Addon.prototype=new StyledElements.Container();Addon.prototype.setDisabled=function setDisabled(disabled){if(disabled){this.addClassName('disabled');}else{this.removeClassName('disabled');}
this.enabled=!disabled;};Addon.prototype.setLabel=function setLabel(label){this.clear();this.wrapperElement.textContent=label;};Addon.prototype.setTitle=function setTitle(title){this.wrapperElement.setAttribute('title',title);};Addon.prototype.assignInput=function assignInput(input){this._related_input=input;};Addon.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._clickCallback,true);delete this.wrapperElement;delete this._clickCallback;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Addon=Addon;})();(function(){"use strict";var Accordion=function Accordion(options){var defaultOptions={'class':'','exclusive':true,'full':true};options=StyledElements.Utils.merge(defaultOptions,options);this.exclusive=options.exclusive;this.full=options.full;this.children=[];this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"styled_accordion");};Accordion.prototype=new StyledElements.StyledElement();Accordion.prototype.createContainer=function createContainer(options){var expander,defaultOptions={'listenOnTitle':true};options=StyledElements.Utils.merge(defaultOptions,options);expander=new StyledElements.Expander(options);expander.insertInto(this.wrapperElement);if(this.exclusive){expander.addEventListener('expandChange',function(expander,expanded){var old_expander;if(expanded){old_expander=this.currentContainer;this.currentContainer=expander;if(old_expander){old_expander.setExpanded(false);old_expander.wrapperElement.style.height='';}}else if(this.currentContainer===expander){expander.wrapperElement.style.height='';this.currentContainer=null;}
this.repaint();}.bind(this));}else if(this.full){expander.addEventListener('expandChange',function(expanded){this.repaint();}.bind(this));}
this.children.push(expander);if(this.currentContainer==null){expander.setExpanded(true);}
return expander;};Accordion.prototype.repaint=function repaint(temporal){var height,computedStyle,i;height=this._getUsableHeight();if(height==null||this.currentContainer==null){return;}
for(i=0;i<this.children.length;i+=1){if(this.children[i]===this.currentContainer){continue;}
computedStyle=document.defaultView.getComputedStyle(this.currentContainer.wrapperElement,null);height-=this.children[i].wrapperElement.offsetHeight;height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);}
computedStyle=document.defaultView.getComputedStyle(this.currentContainer.wrapperElement,null);height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX);this.currentContainer.wrapperElement.style.height=height+'px';this.currentContainer.repaint(temporal);};Accordion.prototype.destroy=function destroy(){var i;for(i=0;i<this.children.length;i+=1){this.children[i].destroy();}
this.children=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Accordion=Accordion;})();(function(){"use strict";var Expander=function Expander(options){var defaultOptions={'class':'','listenOnTitle':false,'expandButton':true,'buttonFloat':'left','title':null};options=StyledElements.Utils.merge(defaultOptions,options);if(!options.expandButton&&!options.listenOnTitle){throw new TypeError();}
StyledElements.StyledElement.call(this,['expandChange']);this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord("panel se-expander",options['class']);var header=document.createElement('div');header.className='panel-heading';this.wrapperElement.appendChild(header);this.toggleButton=null;if(options.expandButton){this.toggleButton=new StyledElements.ToggleButton({'class':'icon-expand','plain':true});this.toggleButton.insertInto(header);}
this.titleContainer=new StyledElements.Container({'class':'title'});this.titleContainer.insertInto(header);if(options.title){this.titleContainer.appendChild(document.createTextNode(options.title));}
this.contentContainer=new StyledElements.Container({'class':'panel-body'});this.contentContainer.insertInto(this.wrapperElement);var callback=function(){this.setExpanded(!this.isExpanded());}.bind(this);if(this.toggleButton){this.toggleButton.addEventListener('click',callback);}
if(options.listenOnTitle){this.titleContainer.wrapperElement.style.cursor="pointer";this.titleContainer.wrapperElement.addEventListener('click',callback,false);}};Expander.prototype=new StyledElements.StyledElement();Expander.prototype.repaint=function repaint(temporal){var height,computedStyle;if(this.isExpanded()){height=this.wrapperElement.clientHeight;if(height==null){return;}
computedStyle=document.defaultView.getComputedStyle(this.titleContainer.wrapperElement,null);height-=this.titleContainer.wrapperElement.offsetHeight;height-=computedStyle.getPropertyCSSValue('margin-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('margin-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);computedStyle=document.defaultView.getComputedStyle(this.contentContainer.wrapperElement,null);height-=computedStyle.getPropertyCSSValue('border-top-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('border-bottom-width').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-top').getFloatValue(CSSPrimitiveValue.CSS_PX);height-=computedStyle.getPropertyCSSValue('padding-bottom').getFloatValue(CSSPrimitiveValue.CSS_PX);if(height<0){height=0;}
this.contentContainer.wrapperElement.style.height=height+'px';this.contentContainer.repaint(temporal);}};Expander.prototype.isExpanded=function isExpanded(){return this.hasClassName('expanded');};Expander.prototype.setExpanded=function setExpanded(expanded){if(this.isExpanded()==expanded){return;}
if(expanded){this.addClassName('expanded');}else{this.removeClassName('expanded');this.contentContainer.wrapperElement.style.height='';}
if(this.toggleButton){this.toggleButton.setChecked(expanded);}
this.events.expandChange.dispatch(this,expanded);};Expander.prototype.getTitleContainer=function getTitleContainer(){return this.titleContainer;};Expander.prototype.appendChild=function appendChild(element){this.contentContainer.appendChild(element);};Expander.prototype.removeChild=function removeChild(element){this.contentContainer.removeChild(element);};Expander.prototype.clear=function clear(){this.contentContainer.clear();};StyledElements.Expander=Expander;})();(function(){"use strict";var Fragment=function Fragment(elements){var tmp_element;if(Array.isArray(elements)){this.elements=elements;}else if(typeof elements==='string'){tmp_element=document.createElement('div');tmp_element.innerHTML=elements;this.elements=Array.prototype.slice.call(tmp_element.childNodes);}else{this.elements=[];}};Fragment.prototype=new StyledElements.StyledElement();Fragment.prototype.insertInto=function insertInto(element,refElement){var i,currentElement;if(refElement instanceof StyledElements.StyledElement){refElement=refElement.wrapperElement;}
for(i=0;i<this.elements.length;i+=1){currentElement=this.elements[i];if(currentElement instanceof StyledElements.StyledElement){currentElement.insertInto(element,refElement);}else{element.insertBefore(currentElement,refElement);}}};Fragment.prototype.repaint=function repaint(){var i;for(i=0;i<this.elements.length;i++){if(typeof this.elements[i].repaint==='function'){this.elements[i].repaint();}}
return this;};Fragment.prototype.appendChild=function appendChild(element){this.elements.push(element);return this;};StyledElements.Fragment=Fragment;})();(function(){"use strict";var PaginatedSource,onSuccessCallback,onErrorCallback;onSuccessCallback=function onSuccessCallback(elements,options){if(typeof this.pOptions.processFunc==='function'){this.pOptions.processFunc(elements,options);}
this.currentPage=parseInt(options.current_page,10);this.currentElements=elements;if(this.pCachedTotalCount!==options.total_count){this.pCachedTotalCount=options.total_count;this._calculatePages();this.events.paginationChanged.dispatch(this);}
this.events.requestEnd.dispatch(this);};onErrorCallback=function onErrorCallback(error){this.currentElements=[];if(error==null){error={'message':'unknown cause'};}
this.events.requestEnd.dispatch(this,error);};PaginatedSource=function PaginatedSource(options){var defaultOptions={'pageSize':25,'requestFunc':null,'processFunc':null};StyledElements.ObjectWithEvents.call(this,['optionsChanged','paginationChanged','requestStart','requestEnd']);this.pOptions=StyledElements.Utils.merge(defaultOptions,options);this.currentPage=1;this.currentElements=[];this.totalPages=1;};PaginatedSource.prototype=new StyledElements.ObjectWithEvents();PaginatedSource.prototype.getCurrentPage=function getCurrentPage(){return this.currentElements;};PaginatedSource.prototype.changeOptions=function changeOptions(options){var new_page_size,old_offset,key,changed=false;if(typeof options!=='object'){return;}
for(key in options){if(key==='pageSize'){new_page_size=parseInt(options.pageSize,10);if(!isNaN(new_page_size)&&new_page_size!==this.pOptions.pageSize){changed=true;old_offset=(this.currentPage-1)*this.pOptions.pageSize;this.currentPage=Math.floor(old_offset/new_page_size)+1;this.pOptions.pageSize=new_page_size;this._calculatePages();}}else{changed=true;this.pOptions[key]=options[key];this.currentPage=1;}}
if(changed){this.events.optionsChanged.dispatch(this,this.pOptions);this.refresh();}};PaginatedSource.prototype.goToFirst=function goToFirst(){this.changePage(0);};PaginatedSource.prototype.goToPrevious=function goToPrevious(){this.changePage(this.currentPage-1);};PaginatedSource.prototype.goToNext=function goToNext(){this.changePage(this.currentPage+1);};PaginatedSource.prototype.goToLast=function goToLast(){this.changePage(this.totalPages);};PaginatedSource.prototype._calculatePages=function _calculatePages(){this.totalPages=Math.ceil(this.pCachedTotalCount/this.pOptions.pageSize);if(this.totalPages<=0){this.totalPages=1;}};PaginatedSource.prototype.refresh=function refresh(){this.events.requestStart.dispatch(this);this.pOptions.requestFunc(this.currentPage,this.pOptions,onSuccessCallback.bind(this),onErrorCallback.bind(this));};PaginatedSource.prototype.changePage=function changePage(idx){if(idx<1){idx=1;}else if(idx>this.totalPages){idx=this.totalPages;}
this.events.requestStart.dispatch(this);this.pOptions.requestFunc(idx,this.pOptions,onSuccessCallback.bind(this),onErrorCallback.bind(this));};StyledElements.PaginatedSource=PaginatedSource;})();(function(){"use strict";var GUIBuilder,processTComponent,processTree,processRoot,extractOptions,NAMESPACE,TEMPLATE_NAMESPACE;NAMESPACE='http://wirecloud.conwet.fi.upm.es/StyledElements';TEMPLATE_NAMESPACE='http://wirecloud.conwet.fi.upm.es/Template';processTComponent=function processTComponent(element,tcomponents,context){var options,parsed_options,tcomponent,new_component;tcomponent=tcomponents[element.localName];if(typeof tcomponent==='function'){options=element.textContent.trim();if(options!==''){try{parsed_options=JSON.parse(options);}catch(e){}}
new_component=tcomponent(parsed_options,tcomponents,context);}else{new_component=tcomponent;}
if(typeof new_component==='string'){new_component=element.ownerDocument.createTextNode(new_component);}else if(new_component!=null){new_component=new_component;}else{new_component=element.ownerDocument.createTextNode('');}
return new_component;};processTree=function processTree(builder,element,tcomponents,context){var i,child,component,new_component;for(i=0;i<element.childNodes.length;i+=1){child=element.childNodes[i];if(!StyledElements.Utils.XML.isElement(child)){continue;}
if(child.namespaceURI===NAMESPACE){component=builder.build(child,tcomponents,context);component.insertInto(element,child);element.removeChild(child);}else if(child.namespaceURI===TEMPLATE_NAMESPACE){new_component=processTComponent(child,tcomponents,context);if(new_component instanceof StyledElements.StyledElement){new_component.insertInto(element,child);}else{element.insertBefore(new_component,child);}
element.removeChild(child);}else{processTree(builder,child,tcomponents,context);}}};processRoot=function processRoot(builder,element,tcomponents,context){var i,children,child,component;children=Array.prototype.slice.call(element.childNodes,0);for(i=0;i<children.length;i+=1){child=children[i];if(!StyledElements.Utils.XML.isElement(child)){continue;}
if(child.namespaceURI===NAMESPACE){component=builder.build(child,tcomponents,context);children[i]=component;}else if(child.namespaceURI===TEMPLATE_NAMESPACE){children[i]=processTComponent(child,tcomponents,context);}else{processTree(builder,child,tcomponents,context);}}
return new StyledElements.Fragment(children);};extractOptions=function extractOptions(element){var options,options_element;options=null;options_element=StyledElements.Utils.XML.getChildElementByTagNameNS(element,'http://wirecloud.conwet.fi.upm.es/StyledElements','options');if(options_element!=null){options_element.parentNode.removeChild(options_element);try{options=JSON.parse(options_element.textContent);}catch(e){}}
return options;};GUIBuilder=function GUIBuilder(){var mapping={'borderlayout':function(builder,element,options,tcomponents,context){var layout=new StyledElements.BorderLayout(options);var populateContainer=function populateContainer(element,xpath,container){var container_element,fragment;container_element=StyledElements.Utils.XML.getChildElementByTagNameNS(element,'http://wirecloud.conwet.fi.upm.es/StyledElements',xpath);if(container_element!=null){options=extractOptions(container_element);if(options!=null&&'class'in options){container.addClassName(options['class']);}
fragment=processRoot(builder,container_element,tcomponents,context);container.appendChild(fragment);}};populateContainer(element,'northcontainer',layout.getNorthContainer());populateContainer(element,'westcontainer',layout.getWestContainer());populateContainer(element,'centercontainer',layout.getCenterContainer());populateContainer(element,'eastcontainer',layout.getEastContainer());populateContainer(element,'southcontainer',layout.getSouthContainer());return layout;},'button':function(builder,element,options){options=StyledElements.Utils.merge({},options);options.text=element.textContent;return new StyledElements.StyledButton(options);},'select':function(builder,element,options){return new StyledElements.StyledSelect(options);}};this.build=function(element,tcomponents,context){var builder,options;builder=mapping[element.localName];options=extractOptions(element);return builder(this,element,options,tcomponents,context);};};GUIBuilder.prototype.DEFAULT_OPENING='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml">';GUIBuilder.prototype.DEFAULT_CLOSING='</s:styledgui>';GUIBuilder.prototype.parse=function parse(document,tcomponents,context){if(typeof document==='string'){document=StyledElements.Utils.XML.parseFromString(document,'application/xml');}
if(!(document instanceof Document)){throw new TypeError('document is not a Document or cannot be parsed into a Document');}
return processRoot(this,document.documentElement,tcomponents,context);};StyledElements.GUIBuilder=GUIBuilder;})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="tooltip fade" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"><t:content/></div></div></s:styledgui>';var setPosition=function setPosition(refPosition,position){this.element.classList.remove('top','right','bottom','left');switch(position){case'top':this.element.classList.add('top');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=(refPosition.top-this.element.offsetHeight)+"px";break;case'right':this.element.classList.add('right');this.element.style.left=refPosition.right+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;case'bottom':this.element.classList.add('bottom');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=refPosition.bottom+"px";break;case'left':this.element.classList.add('left');this.element.style.left=(refPosition.left-this.element.offsetWidth)+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;}};var standsOut=function standsOut(){var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setPosition.call(this,refPosition,position);var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.element.style.top="";this.element.style.bottom="10px";element_box=this.element.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.element.style.top="10px";}};var searchBestPosition=function(refPosition,positions){var i=0,weights=[];do{setPosition.call(this,refPosition,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,positions);}};var _show=function _show(refPosition){Wirecloud.UserInterfaceManager._registerPopup(this);if(this.visible){this.repaint();return;}
if('getBoundingClientRect'in refPosition){refPosition=refPosition.getBoundingClientRect();}
this.element=builder.parse(template,{content:this.options.content}).elements[0];document.body.appendChild(this.element);searchBestPosition.call(this,refPosition,this.options.placement);this.element.classList.add('in');};var Tooltip=function Tooltip(options){var defaultOptions={'content':'','class':'','placement':['right','bottom','left','top']};Object.defineProperty(this,'options',{value:StyledElements.Utils.merge(defaultOptions,options)});StyledElements.StyledElement.call(this,[]);Object.defineProperties(this,{visible:{get:function(){return this.element!=null;}},_show:{value:_show.bind(this),enumerable:false}});};Tooltip.prototype=new StyledElements.StyledElement();Tooltip.prototype.bind=function bind(element){element.addEventListener('focus',this.show.bind(this,element),false);element.addEventListener('blur',this.hide.bind(this),false);element.addEventListener('mouseenter',this.show.bind(this,element),false);element.addEventListener('mouseleave',this.hide.bind(this),false);element.addEventListener('click',this.hide.bind(this),false);};Tooltip.prototype.toggle=function toggle(refElement){if(this.visible){this.hide();}else{this._show(refElement);}};Tooltip.prototype.show=function show(refElement){this._show(refElement);};var _hide=function _hide(){if(this.element!=null){document.body.removeChild(this.element);this.element=null;Wirecloud.UserInterfaceManager._unregisterPopup(this);}};Tooltip.prototype.hide=function hide(){if(!this.visible){return;}
if(this.element.classList.contains('in')){this.element.addEventListener('transitionend',_hide.bind(this));this.element.classList.remove('in');}else{_hide.call(this);}};StyledElements.Tooltip=Tooltip;})();(function(){"use strict";var clickCallback=function clickCallback(e){e.preventDefault();e.stopPropagation();if(this.enabled){this.events.click.dispatch(this);}};var keydownCallback=function keydownCallback(e){if(this.enabled&&e.keyCode===13){this.events.click.dispatch(this);}};var onmouseenter=function onmouseenter(){this.events.mouseenter.dispatch(this);};var onmouseleave=function onmouseleave(){this.events.mouseleave.dispatch(this);};var onfocus=function onfocus(){this.events.focus.dispatch(this);};var onblur=function onblur(){this.events.blur.dispatch(this);};var StyledButton=function StyledButton(options){var defaultOptions={'text':null,'title':'','class':'','plain':false,'iconHeight':24,'iconWidth':24,'icon':null,'iconClass':null,'usedInForm':false};options=StyledElements.Utils.merge(defaultOptions,options);if(options.extending){return;}
StyledElements.StyledElement.call(this,['click','focus','blur','mouseenter','mouseleave']);if(options.usedInForm){this.wrapperElement=document.createElement("button");this.wrapperElement.setAttribute('type','button');}else{this.wrapperElement=document.createElement("div");}
this.wrapperElement.setAttribute('tabindex','0');this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"styled_button");if(options.id!=null){this.wrapperElement.setAttribute('id',options.id);}
if(options.plain){this.wrapperElement.classList.add('plain');}
if(options.icon!=null){this.icon=document.createElement("img");this.icon.className="icon";this.icon.style.width=options.iconWidth+'px';this.icon.style.height=options.iconHeight+'px';this.icon.src=options.icon;this.wrapperElement.appendChild(this.icon);}
if(options.text!=null||options.iconClass!=null){this.label=document.createElement('span');if(options.text!=null){this.label.appendChild(document.createTextNode(options.text));}
if(options.iconClass!=null){this.label.classList.add(options.iconClass);}
this.wrapperElement.appendChild(this.label);}
if(options.title){this.setTitle(options.title);}
this._clickCallback=clickCallback.bind(this);this._keydownCallback=keydownCallback.bind(this);this.wrapperElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._clickCallback,true);this.wrapperElement.addEventListener('keydown',this._keydownCallback,false);this.wrapperElement.addEventListener('focus',onfocus.bind(this),true);this.wrapperElement.addEventListener('blur',onblur.bind(this),true);this.wrapperElement.addEventListener('mouseenter',onmouseenter.bind(this),false);this.wrapperElement.addEventListener('mouseleave',onmouseleave.bind(this),false);};StyledButton.prototype=new StyledElements.StyledElement();StyledButton.prototype.Tooltip=StyledElements.Tooltip;StyledButton.prototype.focus=function focus(){this.wrapperElement.focus();};StyledButton.prototype.blur=function blur(){this.wrapperElement.blur();};StyledButton.prototype.setLabel=function setLabel(label){this.label.textContent=label;return this;};StyledButton.prototype.clearClassName=function clearClassName(){this.wrapperElement.className='styled_button';return this;};StyledButton.prototype.addIconClassName=function addIconClassName(classname){this.label.classList.add(classname);};StyledButton.prototype.removeIconClassName=function removeIconClassName(classname){this.label.classList.remove(classname);};StyledButton.prototype.setTitle=function setTitle(title){if(title==null||title===''){if(this.tooltip!=null){this.tooltip.destroy();this.tooltip=null;}}else{if(this.tooltip==null){this.tooltip=new this.Tooltip({content:title,placement:['bottom','top','right','left']});this.tooltip.bind(this);}
this.tooltip.options.content=title;}};StyledButton.prototype.click=function click(){if(this.enabled){this.events.click.dispatch(this);}};StyledButton.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._clickCallback,true);this.wrapperElement.removeEventListener('keydown',this._keydownCallback,false);delete this._clickCallback;delete this._keydownCallback;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.StyledButton=StyledButton;})();(function(){"use strict";var POPUP_POSITIONS=['left-bottom','right-bottom','top-left','top-right','bottom-right','bottom-left'];Object.freeze(POPUP_POSITIONS);var DEFAULT_PLACEMENT=['bottom-left','bottom-right','top-left','top-right'];Object.freeze(DEFAULT_PLACEMENT);var setPosition=function setPosition(refPosition,placement){var i=0;for(i=0;i<POPUP_POSITIONS.length;i++){this.wrapperElement.classList.remove('se-popup-menu-'+POPUP_POSITIONS[i]);}
this.wrapperElement.classList.add('se-popup-menu-'+placement);switch(placement){case'left-bottom':this.wrapperElement.style.left=(refPosition.left-this.wrapperElement.offsetWidth+1)+"px";this.wrapperElement.style.top=(refPosition.top-1)+"px";break;case'right-bottom':this.wrapperElement.style.left=(refPosition.right-1)+"px";this.wrapperElement.style.top=(refPosition.top-1)+"px";break;case'top-left':this.wrapperElement.style.top=(refPosition.top-this.wrapperElement.offsetHeight+1)+"px";this.wrapperElement.style.left=refPosition.left+"px";break;case'top-right':this.wrapperElement.style.top=(refPosition.top-this.wrapperElement.offsetHeight+1)+"px";this.wrapperElement.style.left=(refPosition.right-this.wrapperElement.offsetWidth)+"px";break;case'bottom-right':this.wrapperElement.style.top=(refPosition.bottom-1)+"px";this.wrapperElement.style.left=(refPosition.right-this.wrapperElement.offsetWidth)+"px";break;default:case'bottom-left':this.wrapperElement.style.top=(refPosition.bottom-1)+"px";this.wrapperElement.style.left=refPosition.left+"px";break;}};var standsOut=function standsOut(){var parent_box=this.wrapperElement.parentElement.getBoundingClientRect();var element_box=this.wrapperElement.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,placements){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var placement=placements[index];setPosition.call(this,refPosition,placement);var parent_box=this.wrapperElement.parentElement.getBoundingClientRect();var element_box=this.wrapperElement.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.wrapperElement.style.top="";this.wrapperElement.style.bottom="10px";element_box=this.wrapperElement.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.wrapperElement.style.top="10px";}};var PopupMenuBase=function PopupMenuBase(options){var defaultOptions={'placement':null};options=StyledElements.Utils.merge(defaultOptions,options);if(options.extending){return;}
StyledElements.ObjectWithEvents.call(this,['itemOver','visibilityChange']);this.wrapperElement=document.createElement('div');this.wrapperElement.className='se-popup-menu hidden';this._context=null;if('position'in options){if(Array.isArray(options.position)){this._placement=options.position;}else if(typeof options.position==='string'){this._placement=[options.placement];}else{this._placement=DEFAULT_PLACEMENT;}}else{if(Array.isArray(options.placement)){this._placement=options.placement;}else if(typeof options.placement==='string'){this._placement=[options.placement];}else{this._placement=DEFAULT_PLACEMENT;}}
this._items=[];this._dynamicItems=[];this._submenus=[];this._menuItemCallback=this._menuItemCallback.bind(this);this._menuItemEnterCallback=this._menuItemEnterCallback.bind(this);};PopupMenuBase.prototype=new StyledElements.ObjectWithEvents();PopupMenuBase.prototype._append=function _append(child,where){if(child instanceof StyledElements.MenuItem){child.addEventListener('click',this._menuItemCallback);child.addEventListener('mouseover',this._menuItemEnterCallback);}else if(child instanceof StyledElements.SubMenuItem){child.addEventListener('click',this._menuItemCallback);child.addEventListener('mouseover',this._menuItemEnterCallback);child._setParentPopupMenu(this);}else if(child instanceof StyledElements.DynamicMenuItems||child instanceof StyledElements.Separator){}else if(child!=null){throw new TypeError('Invalid chlid element');}else{throw new TypeError('The new child element is null');}
where.push(child);};PopupMenuBase.prototype.append=function append(child){this._append(child,this._items);};PopupMenuBase.prototype.appendSeparator=function appendSeparator(){this.append(new StyledElements.Separator());};PopupMenuBase.prototype.setContext=function setContext(context){this._context=context;};PopupMenuBase.prototype._menuItemCallback=function _menuItemCallback(menuItem){if(menuItem.wrapperElement.classList.contains('submenu')){this.show();menuItem.wrapperElement.classList.add("hovered");}else{this.hide();}
if(typeof menuItem.run==='function'){menuItem.run(this._context,menuItem.context);}};PopupMenuBase.prototype.isVisible=function isVisible(){return StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode);};PopupMenuBase.prototype.show=function show(refPosition){var i,j,item,generatedItems,generatedItem;if(this.isVisible()){return;}
for(i=0;i<this._items.length;i+=1){item=this._items[i];if(item instanceof StyledElements.DynamicMenuItems){generatedItems=item.build(this._context);for(j=0;j<generatedItems.length;j+=1){generatedItem=generatedItems[j];this._append(generatedItem,this._dynamicItems);if(generatedItem instanceof StyledElements.MenuItem||generatedItem instanceof StyledElements.Separator){generatedItem.insertInto(this.wrapperElement);}else if(generatedItem instanceof StyledElements.SubMenuItem){generatedItem._getMenuItem().insertInto(this.wrapperElement);}}}else if(item instanceof StyledElements.MenuItem||item instanceof StyledElements.Separator){item.insertInto(this.wrapperElement);}else if(item instanceof StyledElements.SubMenuItem){item._getMenuItem().insertInto(this.wrapperElement);this._submenus.push(item);}else{this.wrapperElement.appendChild(item);}}
this.wrapperElement.classList.remove('hidden');try{window.parent.document.body.appendChild(this.wrapperElement);}catch(e){document.body.appendChild(this.wrapperElement);}
Wirecloud.UserInterfaceManager._registerPopup(this);this.events.visibilityChange.dispatch(this);if(!('left'in refPosition)&&'x'in refPosition&&'y'in refPosition){this.wrapperElement.style.top=refPosition.y+"px";this.wrapperElement.style.left=refPosition.x+"px";}else{i=0;var weights=[];do{setPosition.call(this,refPosition,this._placement[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<this._placement.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,this._placement);}}
this.wrapperElement.style.display='block';};PopupMenuBase.prototype.hide=function hide(){var i,aux;if(!this.isVisible()){return;}
this.wrapperElement.classList.add('hidden');this.wrapperElement.style.bottom="";for(i=0;i<this._submenus.length;i+=1){this._submenus[i].hide();}
for(i=0;i<this._dynamicItems.length;i+=1){aux=this._dynamicItems[i];if(aux instanceof StyledElements.SubMenuItem){aux.hide();}
aux.destroy();}
this._dynamicItems=[];this._submenus=[];this.wrapperElement.innerHTML='';StyledElements.Utils.removeFromParent(this.wrapperElement);Wirecloud.UserInterfaceManager._unregisterPopup(this);this.events.visibilityChange.dispatch(this);};PopupMenuBase.prototype._menuItemEnterCallback=function _menuItemEnterCallback(menuItem){this.events.itemOver.dispatch(this,menuItem);};PopupMenuBase.prototype.destroy=function destroy(){var i,item;this.hide();for(i=0;i<this._items.length;i+=1){item=this._items[i];if(item instanceof StyledElements.MenuItem){item.destroy();}}
this._items=null;this._menuItemCallback=null;this._context=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.PopupMenuBase=PopupMenuBase;})();(function(){"use strict";var disableCallback=function disableCallback(e){if(e.button!==0){return;}
var boundingBox=this.wrapperElement.getBoundingClientRect();if(e.clientX<boundingBox.left||e.clientX>boundingBox.right||e.clientY<boundingBox.top||e.clientY>boundingBox.bottom){setTimeout(this.hide.bind(this),0);}};var PopupMenu=function PopupMenu(options){StyledElements.PopupMenuBase.call(this,options);this._disableCallback=disableCallback.bind(this);};PopupMenu.prototype=new StyledElements.PopupMenuBase({extending:true});PopupMenu.prototype.show=function show(refPosition){document.addEventListener("click",this._disableCallback,true);StyledElements.PopupMenuBase.prototype.show.call(this,refPosition);};PopupMenu.prototype.hide=function hide(){StyledElements.PopupMenuBase.prototype.hide.call(this);document.removeEventListener("click",this._disableCallback,true);document.removeEventListener("contextmenu",this._disableCallback,true);};PopupMenu.prototype.destroy=function destroy(){this._disableCallback=null;StyledElements.PopupMenuBase.prototype.destroy.call(this);};StyledElements.PopupMenu=PopupMenu;})();(function(){"use strict";StyledElements.DynamicMenuItems=function DynamicMenuItems(){};StyledElements.DynamicMenuItems.prototype.build=function build(){return[];};})();(function(){"use strict";var MenuItem=function MenuItem(text,handler,context){StyledElements.StyledElement.call(this,['click','mouseover','mouseout']);this.wrapperElement=document.createElement("div");this.wrapperElement.classList.add("se-popup-menu-item");var span=document.createElement("span");span.appendChild(document.createTextNode(text));this.wrapperElement.appendChild(span);this.run=handler;this.context=context;this._mouseoverEventHandler=function(event){if(this.enabled){this.wrapperElement.classList.add("hovered");this.events.mouseover.dispatch(this);}}.bind(this);this.wrapperElement.addEventListener("mouseover",this._mouseoverEventHandler,false);this._mouseoutEventHandler=function(event){if(this.enabled){this.wrapperElement.classList.remove("hovered");this.events.mouseout.dispatch(this);}}.bind(this);this.wrapperElement.addEventListener("mouseout",this._mouseoutEventHandler,false);this._clickHandler=function(event){event.stopPropagation();if(this.enabled){this.wrapperElement.classList.remove("hovered");this.events.mouseout.dispatch(this);this.events.click.dispatch(this);}}.bind(this);this.wrapperElement.addEventListener("click",this._clickHandler,true);};MenuItem.prototype=new StyledElements.StyledElement();MenuItem.prototype.destroy=function destroy(){if(StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode)){StyledElements.Utils.removeFromParent(this.wrapperElement);}
this.wrapperElement.removeEventListener("mouseover",this._mouseoverEventHandler,false);this.wrapperElement.removeEventListener("mouseout",this._mouseoutEventHandler,false);this.wrapperElement.removeEventListener("click",this._clickHandler,true);this._mouseoverEventHandler=null;this._mouseoutEventHandler=null;this._clickHandler=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.MenuItem=MenuItem;})();(function(){"use strict";var Separator=function Separator(){StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement("hr");};Separator.prototype=new StyledElements.StyledElement();Separator.prototype.destroy=function destroy(){if(StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode)){StyledElements.Utils.removeFromParent(this.wrapperElement);}
StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.Separator=Separator;})();(function(){"use strict";var SubMenuItem=function SubMenuItem(text,handler,options){if(arguments.length===0){return true;}
options=StyledElements.Utils.merge({'position':['right-bottom','left-bottom']},options);StyledElements.PopupMenuBase.call(this,options);this.wrapperElement.classList.add('se-popup-submenu');this.menuItem=new StyledElements.MenuItem(text,handler);this.menuItem.addClassName('submenu');};SubMenuItem.prototype=new StyledElements.PopupMenuBase({extending:true});SubMenuItem.prototype._getContext=function _getContext(){if(this.parentMenu instanceof SubMenuItem){return this.parentMenu._getContext();}else{return this.parentMenu._context;}};SubMenuItem.prototype._menuItemCallback=function _menuItemCallback(menuItem){var currentMenu=this;while(currentMenu.parentMenu){currentMenu=currentMenu.parentMenu;}
currentMenu.hide();menuItem.run(currentMenu._context);};SubMenuItem.prototype._setParentPopupMenu=function _setParentPopupMenu(popupMenu){this.parentMenu=popupMenu;this.parentMenu.addEventListener('itemOver',function(popupMenu,item){if(item===this.menuItem){this.show(this.menuItem.wrapperElement.getBoundingClientRect());}else{this.hide();}}.bind(this));};SubMenuItem.prototype._getMenuItem=function _getMenuItem(){return this.menuItem;};SubMenuItem.prototype.addEventListener=function addEventListener(eventId,handler){switch(eventId){case'mouseover':case'click':return this.menuItem.addEventListener(eventId,handler);default:return StyledElements.PopupMenuBase.prototype.addEventListener.call(this,eventId,handler);}};SubMenuItem.prototype.enable=function enable(){this.menuItem.enable();};SubMenuItem.prototype.disable=function disable(){this.menuItem.disable();};SubMenuItem.prototype.setDisabled=function setDisabled(disabled){this.menuItem.setDisabled(disabled);};SubMenuItem.prototype.destroy=function destroy(){if(this.menuItem){this.menuItem.destroy();}
this.menuItem=null;StyledElements.PopupMenuBase.prototype.destroy.call(this);};StyledElements.SubMenuItem=SubMenuItem;})();(function(){"use strict";var visibilityChangeListener=function visibilityChangeListener(){if(this.popup_menu.isVisible()){this.wrapperElement.classList.add('open');}else{this.wrapperElement.classList.remove('open');}};var PopupButton=function PopupButton(options){var defaultOptions={'menuOptions':null,'menu':null};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledButton.call(this,options);if(options.menu!=null){this.popup_menu=options.menu;this._owned_popup_menu=false;}else{this.popup_menu=new this.PopupMenu(options.menuOptions);this._owned_popup_menu=true;}
this.addEventListener('click',function(){if(this.popup_menu.isVisible()){this.popup_menu.hide();}else{this.popup_menu.show(this.getBoundingClientRect());}}.bind(this));this._visibilityChangeListener=visibilityChangeListener.bind(this);this.popup_menu.addEventListener('visibilityChange',this._visibilityChangeListener);};PopupButton.prototype=new StyledElements.StyledButton({extending:true});PopupButton.prototype.PopupMenu=StyledElements.PopupMenu;PopupButton.prototype.getPopupMenu=function getPopupMenu(){return this.popup_menu;};PopupButton.prototype.replacePopupMenu=function replacePopupMenu(new_popup_menu){if(this._owned_popup_menu){this.popup_menu.destroy();this._owned_popup_menu=false;}
this.popup_menu=new_popup_menu;};PopupButton.prototype.destroy=function destroy(){StyledElements.StyledButton.prototype.destroy.call(this);if(this._owned_popup_menu){this.popup_menu.destroy();}else{this.popup_menu.removeEventListener('visibilityChange',this._visibilityChangeListener);}
this.popup_menu=null;};StyledElements.PopupButton=PopupButton;})();(function(){"use strict";var getFieldValue=function getFieldValue(item,field){var fieldPath,currentNode,currentField;if(typeof field==="string"){fieldPath=[field];}else{fieldPath=field.slice();}
currentNode=item;while(currentNode!==null&&fieldPath.length>0){currentField=fieldPath.splice(0,1)[0];currentNode=currentNode[currentField];}
if(currentNode===null||fieldPath.length>0){return"";}
return currentNode;};var elementPassFilter=function elementPassFilter(element,pattern){return Object.getOwnPropertyNames(element).some(function(key,index,array){var value=getFieldValue(element,key);switch(typeof value){case"number":return pattern.test(""+value);case"string":return pattern.test(value);default:return false;}});};var filterElements=function filterElements(keywords){var filteredElements,i,element;if(!keywords){this.filteredElements=this.elements;return;}
this._currentPattern=new RegExp(StyledElements.Utils.escapeRegExp(keywords),'i');filteredElements=[];for(i=0;i<this.elements.length;i+=1){element=this.elements[i];if(elementPassFilter.call(this,element,this._currentPattern)){filteredElements.push(element);}}
this.filteredElements=filteredElements;};var sortElements=function sortElements(order){var sort_id,inverse,column,sortFunc,parseDate;if(order==null){this.sortedElements=this.filteredElements;return;}
sort_id=order[0];inverse=false;if(sort_id[0]==='-'){inverse=true;sort_id=sort_id.substr(1);}
column=this.sort_info[sort_id];sortFunc=column.sortFunc;if(sortFunc==null){switch(column.type){case"date":if(typeof column.dateparser==='function'){parseDate=column.dateparser;}else{parseDate=function(string){return new Date(string);};}
sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);try{value1=parseDate(value1);}catch(e){value1=new Date(0);}
value2=getFieldValue(value2,this.field);try{value2=parseDate(value2);}catch(e2){value2=new Date(0);}
return value1-value2;}.bind({field:column.field});break;case"number":sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);value1=value1!==null?Number(value1):0;value2=getFieldValue(value2,this.field);value2=value2!==null?Number(value2):0;return value1-value2;}.bind({field:column.field});break;default:sortFunc=function(value1,value2){value1=getFieldValue(value1,this.field);value1=value1!==null?value1:'';value2=getFieldValue(value2,this.field);value2=value2!==null?value2:'';return value1.localeCompare(value2);}.bind({field:column.field});}}
if(inverse){sortFunc=function(value1,value2){return-this(value1,value2);}.bind(sortFunc);}
this.sortedElements=this.filteredElements.sort(sortFunc);};var requestFunc=function requestFunc(index,options,onSuccess,onError){var page=index;if(index>this.totalPages){index=this.totalPages;}
index-=1;var start=index*options.pageSize;var end=start+options.pageSize;var elements=this.sortedElements.slice(start,end);onSuccess(elements,{current_page:page,total_count:this.filteredElements.length});};var StaticPaginatedSource=function StaticPaginatedSource(options){if(typeof options!=='object'){options={};}
options.requestFunc=requestFunc.bind(this);StyledElements.PaginatedSource.call(this,options);this.sort_info=options.sort_info;if(typeof this.sort_info!=='object'){this.sort_info={};}
if(Array.isArray(options.initialElements)){this.changeElements(options.initialElements);}else{this.elements=[];this.filteredElements=[];this.sortedElements=[];}};StaticPaginatedSource.prototype=new StyledElements.PaginatedSource();StaticPaginatedSource.prototype.changeOptions=function changeOptions(newOptions){var force_sort=false;if('keywords'in newOptions){filterElements.call(this,newOptions.keywords);force_sort=true;}
if('order'in newOptions){sortElements.call(this,newOptions.order);}else if(force_sort){sortElements.call(this,this.pOptions.order);}
StyledElements.PaginatedSource.prototype.changeOptions.call(this,newOptions);};StaticPaginatedSource.prototype.changeElements=function changeElements(newElements){if(Array.isArray(newElements)){this.elements=newElements;}else{this.elements=[];}
filterElements.call(this,this.pOptions.keywords);sortElements.call(this,this.pOptions.order);this.refresh();};StaticPaginatedSource.prototype.addElement=function addElement(newElement){this.elements.push(newElement);if(elementPassFilter.call(this,newElement,this._currentPattern)){this.filteredElements.push(newElement);sortElements.call(this,this.pOptions.order);this.refresh();}};StyledElements.StaticPaginatedSource=StaticPaginatedSource;})();(function(){"use strict";var StyledFileField,onchange,onclick,onfocus,onblur;onclick=function onclick(e){if(e.target===this.inputElement){return;}
this.inputElement.click();e.stopPropagation();e.preventDefault();return false;};onchange=function onchange(){var file,filename;file=this.getValue();if(file!=null){filename=file.name;}else{filename='';}
this.name_preview.textContent=filename;this.name_preview.setAttribute('title',filename);this.events.change.dispatch(this);};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};StyledFileField=function StyledFileField(options){var defaultOptions={'class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.layout=new StyledElements.HorizontalLayout({'class':'se-file-field input input-append'});this.wrapperElement=this.layout.wrapperElement;if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
var wrapper=document.createElement('div');wrapper.className='input_wrapper';this.wrapperElement.appendChild(wrapper);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","file");this.inputElement.setAttribute('tabindex',0);wrapper.appendChild(this.inputElement);if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.name_preview=document.createElement('div');this.name_preview.className='filename';this.layout.getCenterContainer().appendChild(this.name_preview);var button=document.createElement('div');button.className='styled_button';var button_span=document.createElement('span');button_span.textContent=StyledElements.Utils.gettext('Select');button.appendChild(button_span);this.layout.getEastContainer().appendChild(button);this._onchange=onchange.bind(this);this._onclick=onclick.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.addEventListener('click',this._onclick,true);this.inputElement.addEventListener('change',this._onchange,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);};StyledFileField.prototype=new StyledElements.StyledInputElement();StyledFileField.prototype.repaint=function repaint(){this.layout.repaint();};StyledFileField.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledInputElement.prototype.insertInto.call(this,element,refElement);this.repaint();};StyledFileField.prototype.getValue=function getValue(){return this.inputElement.files[0];};StyledFileField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeEventListener('click',this._onclick,true);this.inputElement.removeEventListener('change',this._onchange,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._onchange;delete this._onfocus;delete this._onblur;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledFileField=StyledFileField;})();(function(){"use strict";var update=function update(inc){var value=Number(this.inputElement.value);if(!isNaN(value)){value=Math.round((value+inc)*100)/100;if(value>this.options.max){value=this.options.max;}else if(value<this.options.min){value=this.options.min;}}else if(inc>0&&this.options.min!==Number.NEGATIVE_INFINITY){value=this.options.min;}else if(inc<0&&this.options.max!==Number.POSITIVE_INFINITY){value=this.options.max;}else{value=0;}
this.inputElement.value=value;};var onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};var onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};var StyledNumericField=function StyledNumericField(options){var defaultOptions={'initialValue':0,'class':'','min':Number.NEGATIVE_INFINITY,'max':Number.POSITIVE_INFINITY,'inc':1};this.options=options=StyledElements.Utils.merge(defaultOptions,options);options.min=Number(options.min);options.max=Number(options.max);options.inc=Number(options.inc);options.initialValue=Number(options.initialValue);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.wrapperElement=document.createElement("div");this.wrapperElement.className="se-numeric-field";this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","text");if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);var topButton=new StyledElements.StyledButton({'class':'se-numeric-field-top-button',iconClass:'icon-caret-up'});var bottomButton=new StyledElements.StyledButton({'class':'se-numeric-field-bottom-button',iconClass:'icon-caret-down'});topButton.addEventListener("click",update.bind(this,options.inc));bottomButton.addEventListener("click",update.bind(this,-options.inc));this.inputElement.addEventListener("focus",onfocus.bind(this),true);this.inputElement.addEventListener("blur",onblur.bind(this),true);this.wrapperElement.appendChild(this.inputElement);topButton.insertInto(this.wrapperElement);bottomButton.insertInto(this.wrapperElement);};StyledNumericField.prototype=new StyledElements.StyledInputElement();StyledNumericField.prototype.getValue=function getValue(){return Number(this.inputElement.value);};StyledElements.StyledNumericField=StyledNumericField;})();(function(){"use strict";var StyledTextField,oninput,onfocus,onblur,onkeypress;oninput=function oninput(){this.events.change.dispatch(this);};onfocus=function onfocus(){this.events.focus.dispatch(this);};onblur=function onblur(){this.events.blur.dispatch(this);};onkeypress=function onkeypress(event){if(event.keyCode===13){this.events.submit.dispatch(this);}};StyledTextField=function StyledTextField(options){var defaultOptions={'initialValue':'','class':'','placeholder':null};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur','submit']);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","text");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-text-field";if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.placeholder!=null){this.setPlaceholder(options.placeholder);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this._onkeypress=onkeypress.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);this.inputElement.addEventListener('keypress',this._onkeypress,true);};StyledTextField.prototype=new StyledElements.StyledInputElement();StyledTextField.prototype.setPlaceholder=function setPlaceholder(placeholder){this.inputElement.setAttribute('placeholder',placeholder);};StyledTextField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);this.inputElement.removeEventListener('keypress',this._onkeypress,true);delete this._oninput;delete this._onfocus;delete this._onblur;delete this._onkeypress;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledTextField=StyledTextField;})();(function(){"use strict";var StyledTextArea,oninput,onfocus,onblur;oninput=function oninput(){this.events.change.dispatch(this);};onfocus=function onfocus(){this.events.focus.dispatch(this);};onblur=function onblur(){this.events.blur.dispatch(this);};StyledTextArea=function StyledTextArea(options){var defaultOptions={'initialValue':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['blur','change','focus']);this.inputElement=document.createElement("textarea");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-text-area";if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.setValue(options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);};StyledTextArea.prototype=new StyledElements.StyledInputElement();StyledTextArea.prototype.select=function select(){this.inputElement.select();};StyledTextArea.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._oninput;delete this._onfocus;delete this._onblur;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledTextArea=StyledTextArea;})();(function(){"use strict";var itemListener=function itemListener(){if(this.listComponent.enabled){this.listComponent.toggleElementSelection(this.value);}};var _cleanSelection=function _cleanSelection(){for(var i=0;i<this.currentSelection.length;i++){var value=this.currentSelection[i];this.entriesByValue[value].element.classList.remove("selected");}
this.currentSelection=[];};var StyledList=function StyledList(options){options=StyledElements.Utils.merge({'class':'','id':null,'multivalued':false,'initialEntries':[],'initialSelection':[]},options);StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"styled_list");if(options.id!=null){this.wrapperElement.id=options.id;}
this.content=document.createElement("div");this.wrapperElement.appendChild(this.content);this.entries=[];this.entriesByValue={};this.currentSelection=[];this.addEntries(options.initialEntries);this.select(options.initialSelection);if(options.full){this.wrapperElement.classList.add("full");}
this.multivalued=options.multivalued;if(options.allowEmpty===undefined){this.allowEmpty=this.multivalued;}else{this.allowEmpty=options.allowEmpty;}};StyledList.prototype=new StyledElements.StyledElement();StyledList.prototype.addEntries=function addEntries(entries){var entryValue,entryText;if(entries==null||entries.length===0){return;}
if(!Array.isArray(entries)){throw new TypeError();}
for(var i=0;i<entries.length;i++){var entry=entries[i];if(Array.isArray(entry)){entryValue=entry[0];entryText=entry[1];}else{entryValue=entries[i].value;entryText=entries[i].label;}
entryText=entryText?entryText:entryValue;var row=document.createElement("div");row.className="row";var context={listComponent:this,value:entryValue};row.addEventListener("click",itemListener.bind(context),true);entry.element=row;row.appendChild(document.createTextNode(entryText));this.content.appendChild(row);this.entriesByValue[entryValue]=entry;}
this.entries=this.entries.concat(entries);};StyledList.prototype.removeEntryByValue=function removeEntryByValue(value){var entry,index;entry=this.entriesByValue[value];delete this.entriesByValue[value];this.entries.slice(this.entries.indexOf(entry),1);StyledElements.Utils.removeFromParent(entry.element);if(index!==-1){this.currentSelection.splice(index,1);this.event.change.dispatch(this,this.currentSelection,[],[value]);}};StyledList.prototype.clear=function clear(){this.cleanSelection();this.content.innerHTML='';this.entries=[];this.entriesByValue={};};StyledList.prototype.getSelection=function getSelection(){return StyledElements.Utils.clone(this.currentSelection);};StyledList.prototype.cleanSelection=function cleanSelection(){if(this.currentSelection.length===0){return;}
var oldSelection=this.currentSelection;_cleanSelection.call(this);this.events.change.dispatch(this,[],[],oldSelection);};StyledList.prototype.select=function select(selection){_cleanSelection.call(this);this.addSelection(selection);};StyledList.prototype.addSelection=function addSelection(selection){var i,entry,addedValues=[],removedValues=[];if(selection.length===0){return;}
if(!this.multivalued){if(selection[0]===this.currentSelection[0]){return;}
removedValues=this.currentSelection;_cleanSelection.call(this);if(selection.length>1){selection=selection.splice(0,1);}}
for(i=0;i<selection.length;i++){entry=selection[i];if(this.currentSelection.indexOf(entry)===-1){this.entriesByValue[entry].element.classList.add("selected");this.currentSelection.push(entry);addedValues.push(entry);}}
this.events.change.dispatch(this,this.currentSelection,addedValues,removedValues);};StyledList.prototype.removeSelection=function removeSelection(selection){var i,entry,index,removedValues=[];if(selection.length===0){return;}
for(i=0;i<selection.length;i++){entry=selection[i];this.entriesByValue[entry].element.classList.remove("selected");index=this.currentSelection.indexOf(entry);if(index!==-1){this.currentSelection.splice(index,1);this.entriesByValue[entry].element.classList.remove("selected");removedValues.push(entry);}}
if(removedValues.length>0){this.events.change.dispatch(this,this.currentSelection,[],removedValues);}};StyledList.prototype.toggleElementSelection=function toggleElementSelection(element){if(!this.entriesByValue[element].element.classList.contains("selected")){this.addSelection([element]);}else if(this.allowEmpty){this.removeSelection([element]);}};StyledElements.StyledList=StyledList;})();(function(){"use strict";var StyledPasswordField,oninput,onfocus,onblur;oninput=function oninput(){this.events.change.dispatch(this);};onfocus=function onfocus(){this.events.focus.dispatch(this);};onblur=function onblur(){this.events.blur.dispatch(this);};StyledPasswordField=function StyledPasswordField(options){var defaultOptions={'initialValue':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","password");this.wrapperElement=this.inputElement;this.wrapperElement.className="se-password-field";if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
if('name'in options){this.inputElement.setAttribute("name",options.name);}
if('id'in options){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this._oninput=oninput.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('input',this._oninput,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);};StyledPasswordField.prototype=new StyledElements.StyledInputElement();StyledPasswordField.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('input',this._oninput,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledPasswordField=StyledPasswordField;})();(function(){"use strict";var StyledSelect,onchange,onfocus,onblur;onchange=function onchange(event){if(this.enabled){var optionList=event.target;this.textDiv.textContent=optionList[optionList.selectedIndex].text;this.events.change.dispatch(this);}};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};StyledSelect=function StyledSelect(options){options=StyledElements.Utils.merge({'class':'','initialEntries':[],'initialValue':null,'idFunc':function(value){if(typeof value==='string'){return value;}else if(value===null||value===undefined){return'';}else if(typeof value==='number'){return''+value;}else{throw new TypeError();}}},options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"se-select");var div=document.createElement("div");div.className="se-select-arrow";this.inputElement=document.createElement("select");if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id){this.wrapperElement.setAttribute("id",options.id);}
this.textDiv=document.createElement("div");this.textDiv.className="se-select-text";this.wrapperElement.appendChild(this.textDiv);this.wrapperElement.appendChild(div);this.wrapperElement.appendChild(this.inputElement);this.optionsByValue={};this.optionValues={};this.idFunc=options.idFunc;this.addEntries(options.initialEntries);this._onchange=onchange.bind(this);this._onfocus=onfocus.bind(this);this._onblur=onblur.bind(this);this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('change',this._onchange,true);this.inputElement.addEventListener('focus',this._onfocus,true);this.inputElement.addEventListener('blur',this._onblur,true);var selectedIndex=this.inputElement.options.selectedIndex;if(selectedIndex!==-1){this.textDiv.textContent=this.inputElement.options[selectedIndex].text;}};StyledSelect.prototype=new StyledElements.StyledInputElement();StyledSelect.prototype.getLabel=function getLabel(){return this.textDiv.textContent;};StyledSelect.prototype.getValue=function getValue(){return this.optionValues[this.inputElement.value];};StyledSelect.prototype.setValue=function setValue(newValue){if(typeof newValue!=='string'){try{newValue=this.idFunc(newValue);}catch(e){newValue=null;}}
if(newValue===null||!(newValue in this.optionValues)){if(this.defaultValue!=null){newValue=this.defaultValue;}else if(this.inputElement.options.length>0){newValue=this.inputElement.options[0].value;}else{StyledElements.StyledInputElement.prototype.setValue.call(this,'');this.textDiv.textContent='';return;}}
StyledElements.StyledInputElement.prototype.setValue.call(this,newValue);this.textDiv.textContent=this.optionsByValue[newValue];};StyledSelect.prototype.addEntries=function addEntries(newEntries){var oldSelectedIndex,optionValue,optionLabel;oldSelectedIndex=this.inputElement.options.selectedIndex;if(newEntries==null||newEntries.length===0){return;}
for(var i=0;i<newEntries.length;i++){var option=document.createElement("option");if(newEntries[i]instanceof Array){optionValue=newEntries[i][0];optionLabel=newEntries[i][1];}else{optionValue=newEntries[i].value;optionLabel=newEntries[i].label;}
optionLabel=optionLabel?optionLabel:optionValue;var realValue=optionValue;if(typeof optionValue!=='string'){optionValue=this.idFunc(optionValue);}
option.setAttribute("value",optionValue);option.appendChild(document.createTextNode(optionLabel));if(this.defaultValue==optionValue){option.setAttribute("selected","selected");}
this.inputElement.appendChild(option);this.optionValues[optionValue]=realValue;this.optionsByValue[optionValue]=optionLabel;}
var selectedIndex=this.inputElement.options.selectedIndex;if(oldSelectedIndex!==selectedIndex){this.textDiv.textContent=this.inputElement.options[selectedIndex].text;}};StyledSelect.prototype.clear=function clear(){this.textDiv.textContent="";this.inputElement.textContent="";this.optionsByValue={};this.optionsValues={};};StyledSelect.prototype.destroy=function destroy(){this.inputElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.removeEventListener('change',this._onchange,true);this.inputElement.removeEventListener('focus',this._onfocus,true);this.inputElement.removeEventListener('blur',this._onblur,true);delete this._onchange;delete this._onfocus;delete this._onblur;StyledElements.StyledInputElement.prototype.destroy.call(this);};StyledElements.StyledSelect=StyledSelect;})();(function(){"use strict";StyledElements.ToggleButton=function ToggleButton(options){var defaultOptions={'initiallyChecked':false};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledButton.call(this,options);if(options.checkedIcon==null){options.checkedIcon=options.icon;}
if(options.checkedText==null){options.checkedText=options.text;}
this._icon=options.icon;this._checkedIcon=options.checkedIcon;this._text=options.text;this._checkedText=options.checkedText;this._checked=false;this.setChecked(options.initiallyChecked);};StyledElements.ToggleButton.prototype=new StyledElements.StyledButton({extending:true});StyledElements.ToggleButton.prototype.isChecked=function isChecked(checked){return this._checked;};StyledElements.ToggleButton.prototype.setChecked=function setChecked(checked){if(checked==this.isChecked()){return;}
if(checked){this.wrapperElement.classList.add('checked');if(this.icon){this.icon.src=this._checkedIcon;}
if(this.label){this.label.textContent=this._checkedText;}}else{this.wrapperElement.classList.remove('checked');if(this.icon){this.icon.src=this._icon;}
if(this.label){this.label.textContent=this._text;}}
this._checked=checked;};StyledElements.ToggleButton.prototype._clickCallback=function _clickCallback(event){if(!this.enabled){return;}
event.stopPropagation();this.setChecked(!this.isChecked());this.events.click.dispatch(this);};})();(function(){"use strict";var clickCallback=function clickCallback(id,e){e.preventDefault();e.stopPropagation();this.switchPill(id);};var Pills=function Pills(options){var defaultOptions={'class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement("ul");this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"se-pills");this.activePill=null;this.pills={};};Pills.prototype=new StyledElements.Container();Pills.prototype.add=function add(id,label){var pill=document.createElement('li');pill.className='se-pill';pill.textContent=label;pill.addEventListener('click',clickCallback.bind(this,id),true);this.wrapperElement.appendChild(pill);this.pills[id]=pill;};Pills.prototype.switchPill=function switchPill(id){if(!(id in this.pills)){throw new TypeError('Invalid pill id');}
if(id==this.activePill){return;}
if(this.activePill!=null){this.pills[this.activePill].classList.remove('active');}
this.activePill=id;this.pills[this.activePill].classList.add('active');this.events.change.dispatch(this,id);};StyledElements.Pills=Pills;})();(function(){"use strict";var Tab=function Tab(id,notebook,options){if(arguments.length===0){return;}
if(!(notebook instanceof StyledElements.StyledNotebook)){throw new Error("Invalid notebook argument");}
var defaultOptions={'closable':true,'containerOptions':{},'name':''};options=StyledElements.Utils.merge(defaultOptions,options);if(options.closeable){options.closable=options.closeable;}
options.useFullHeight=true;Object.defineProperties(this,{'notebook':{value:notebook},'tabId':{value:id}});this.tabElement=document.createElement("div");this.tabElement.className="se-notebook-tab";this.name=document.createElement('span');this.tabElement.appendChild(this.name);StyledElements.Container.call(this,options.containerOptions,['show','hide','close']);this.wrapperElement.classList.add("se-notebook-tab-content");this.wrapperElement.classList.add("hidden");this.tabElement.addEventListener("click",function(){this.notebook.goToTab(this.tabId);}.bind(this),false);if(options.closable){var closeButton=new this.Button({iconClass:"icon-remove",plain:true,'class':"close_button"});closeButton.insertInto(this.tabElement);closeButton.addEventListener("click",this.close.bind(this),false);}
this.rename(options.name);this.setTitle(options.title);};Tab.prototype=new StyledElements.Container({extending:true});Tab.prototype.Tooltip=StyledElements.Tooltip;Tab.prototype.Button=StyledElements.StyledButton;Tab.prototype.close=function close(){this.notebook.removeTab(this.tabId);};Tab.prototype.rename=function rename(newName){this.nameText=newName;this.name.textContent=this.nameText;};Tab.prototype.setTitle=function setTitle(title){if(title==null||title===''){if(this.tooltip!=null){this.tooltip.destroy();this.tooltip=null;}}else{if(this.tooltip==null){this.tooltip=new this.Tooltip({content:title,placement:['bottom','top','right','left']});this.tooltip.bind(this.tabElement);}
this.tooltip.options.content=title;}};Tab.prototype.setIcon=function setIcon(iconURL){if(iconURL==null){if(this.tabIcon!=null){StyledElements.Utils.removeFromParent(this.tabIcon);this.tabIcon=null;}
return;}
if(this.tabIcon==null){this.tabIcon=document.createElement('img');this.tabElement.insertBefore(this.tabIcon,this.tabElement.firstChild);}
this.tabIcon.src=iconURL;};Tab.prototype.setVisible=function setVisible(newStatus){if(newStatus){this.tabElement.classList.add("selected");this.wrapperElement.classList.remove("hidden");this.repaint(false);this.events.show.dispatch(this);}else{this.tabElement.classList.remove("selected");this.wrapperElement.classList.add("hidden");this.events.hide.dispatch(this);}};Tab.prototype.getId=function getId(){return this.tabId;};Tab.prototype.getTabElement=function getTabElement(){return this.tabElement;};StyledElements.Tab=Tab;})();(function(){"use strict";var onNewTab=function onNewTab(){this.events.newTab.dispatch(this);};var StyledNotebook=function StyledNotebook(options){var tabWrapper;StyledElements.StyledElement.call(this,['change','changed','tabDeletion','tabInsertion','newTab']);var defaultOptions={'class':'','focusOnSetVisible':true,'full':true};options=StyledElements.Utils.merge(defaultOptions,options);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"se-notebook");tabWrapper=new StyledElements.HorizontalLayout({'class':'se-notebook-tabs-wrapper','autoHeight':false});this.tabWrapper=tabWrapper;tabWrapper.insertInto(this.wrapperElement);this.tabArea=new StyledElements.Container();tabWrapper.getCenterContainer().appendChild(this.tabArea);this.tabArea.addClassName('se-notebook-tab-area');this.moveLeftButton=new this.Button({'class':'move_left','iconClass':'icon-caret-left'});tabWrapper.getWestContainer().appendChild(this.moveLeftButton);this.moveRightButton=new this.Button({'class':'move_right','iconClass':'icon-caret-right'});tabWrapper.getEastContainer().appendChild(this.moveRightButton);this.contentArea=document.createElement("div");this.contentArea.className="se-notebook-content-wrapper";this.wrapperElement.appendChild(this.contentArea);this.tabs=[];this.tabsById=[];this.visibleTab=null;this.maxTabElementWidth=null;if(options.id!=null){this.wrapperElement.setAttribute('id',options.id);}
if(options.full){this.wrapperElement.classList.add('full');}
this.focusOnSetVisible=options.focusOnSetVisible;this.events.newTab.addEventListener=function addEventListener(listener){var new_tab_main_listener;if(this.new_tab_button_tabs==null){new_tab_main_listener=onNewTab.bind(this);this.new_tab_button_tabs=new this.Button({iconClass:'icon-plus','class':'se-notebook-new-tab',title:StyledElements.Utils.gettext('Add Tab')});this.new_tab_button_tabs.addEventListener('click',new_tab_main_listener);this.tabArea.appendChild(this.new_tab_button_tabs);this.new_tab_button_left=new this.Button({iconClass:'icon-plus','class':'se-notebook-new-tab',title:StyledElements.Utils.gettext('Add Tab')});this.new_tab_button_left.addEventListener('click',new_tab_main_listener);this.addButton(this.new_tab_button_left);}
StyledElements.Event.prototype.addEventListener.call(this.events.newTab,listener);}.bind(this);var context={control:this,initialScrollLeft:null,finalScrollLeft:null,steps:null,step:null,inc:null};var stepFunc=function stepFunc(step,context){var scrollLeft=context.initialScrollLeft+Math.floor((step+1)*context.inc);if((context.inc<0)&&(scrollLeft>context.finalScrollLeft)||(context.inc>0)&&(scrollLeft<context.finalScrollLeft)){context.control.tabArea.wrapperElement.scrollLeft=Math.round(scrollLeft);return true;}else{context.control.tabArea.wrapperElement.scrollLeft=context.finalScrollLeft;enableDisableButtons.call(context.control);return false;}};var initFunc=function initFunc(context,command){var firstVisibleTab,currentTab,maxScrollLeft,baseTime,stepTimes,computedStyle,padding;context.initialScrollLeft=context.control.tabArea.wrapperElement.scrollLeft;computedStyle=document.defaultView.getComputedStyle(context.control.tabArea.wrapperElement,null);padding=computedStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);switch(command.type){case'shiftLeft':if(isTabVisible.call(context.control,0)){return false;}
firstVisibleTab=getFirstVisibleTab.call(context.control);currentTab=context.control.tabs[firstVisibleTab-1].getTabElement();context.finalScrollLeft=currentTab.offsetLeft-padding;break;case'shiftRight':if(isLastTabVisible.call(context.control)){return false;}
firstVisibleTab=getFirstVisibleTab.call(context.control);currentTab=context.control.tabs[firstVisibleTab+1].getTabElement();context.finalScrollLeft=currentTab.offsetLeft-padding;break;case'focus':currentTab=context.control.tabsById[command.tabId].getTabElement();if(isTabVisible.call(context.control,context.control.getTabIndex(command.tabId),true)){return false;}
context.finalScrollLeft=currentTab.offsetLeft-padding;break;}
maxScrollLeft=context.control.tabArea.wrapperElement.scrollWidth-context.control.tabArea.wrapperElement.clientWidth;if(context.finalScrollLeft>maxScrollLeft){context.finalScrollLeft=maxScrollLeft;}
baseTime=(new Date()).getTime()+100;stepTimes=[];context.steps=6;for(var i=0;i<=context.steps;i++){stepTimes[i]=baseTime+(i*100);}
context.inc=Math.floor((context.finalScrollLeft-context.initialScrollLeft)/context.steps);return stepTimes;};this.transitionsQueue=new StyledElements.CommandQueue(context,initFunc,stepFunc);this.moveLeftButton.addEventListener("click",this.shiftLeftTabs.bind(this));this.moveRightButton.addEventListener("click",this.shiftRightTabs.bind(this));Object.defineProperty(this,'fullscreen',{get:function(){if('fullscreenElement'in document){return document.fullscreenElement===this.wrapperElement;}else if('msFullscreenElement'in document){return document.msFullscreenElement===this.wrapperElement;}else if('mozFullScreenElement'in document){return document.mozFullScreenElement===this.wrapperElement;}else if('webkitFullscreenElement'in document){return document.webkitFullscreenElement===this.wrapperElement;}}});};StyledNotebook.prototype=new StyledElements.StyledElement();StyledNotebook.prototype.Button=StyledElements.StyledButton;StyledNotebook.prototype.Tab=StyledElements.Tab;var isTabVisible=function isTabVisible(tabIndex,full){var tabElement,tabAreaStart,tabAreaEnd,tabOffsetRight;tabElement=this.tabs[tabIndex].getTabElement();tabAreaStart=this.tabArea.wrapperElement.scrollLeft;tabAreaEnd=tabAreaStart+this.tabArea.wrapperElement.clientWidth;if(full){tabOffsetRight=tabElement.offsetLeft+tabElement.offsetWidth;return tabElement.offsetLeft>=tabAreaStart&&tabOffsetRight<=tabAreaEnd;}else{return tabElement.offsetLeft>=tabAreaStart&&tabElement.offsetLeft<=tabAreaEnd;}};var isLastTabVisible=function isLastTabVisible(){var lastTab=this.tabs.length-1;if(this.tabs.length===0||isTabVisible.call(this,lastTab,true)){return true;}
if(!isTabVisible.call(this,lastTab)){return false;}
return this.tabs.length<2||!isTabVisible.call(this,lastTab-1);};var enableDisableButtons=function enableDisableButtons(){if(this.tabs.length===0){this.moveLeftButton.disable();this.moveRightButton.disable();if(this.new_tab_button_tabs!=null){this.new_tab_button_tabs.enable();this.new_tab_button_left.disable();}
return;}
var first_tab_visible=isTabVisible.call(this,0);var last_tab_visible=isLastTabVisible.call(this);this.moveLeftButton.setDisabled(first_tab_visible);this.moveRightButton.setDisabled(last_tab_visible);if(this.new_tab_button_tabs!=null){if(first_tab_visible&&last_tab_visible){this.new_tab_button_tabs.enable();this.new_tab_button_left.disable();}else{this.new_tab_button_tabs.disable();this.new_tab_button_left.enable();}
this.tabWrapper.repaint();}};var getFirstVisibleTab=function getFirstVisibleTab(){var i;for(i=0;i<this.tabs.length;i+=1){if(isTabVisible.call(this,i)){return i;}}
return null;};StyledNotebook.prototype.shiftLeftTabs=function shiftLeftTabs(){this.transitionsQueue.addCommand({type:'shiftLeft'});};StyledNotebook.prototype.shiftRightTabs=function shiftRightTabs(){this.transitionsQueue.addCommand({type:'shiftRight'});};StyledNotebook.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.repaint();};StyledNotebook.prototype.createTab=function createTab(options){var defaultOptions={'initiallyVisible':false,'name':'','tab_constructor':this.Tab};options=StyledElements.Utils.merge(defaultOptions,options);var tabId=this.tabsById.push(null);if((options.tab_constructor!=this.Tab)&&!(options.tab_constructor.prototype instanceof StyledElements.Tab)){throw new TypeError();}
var tab=new options.tab_constructor(tabId,this,options);this.tabs[this.tabs.length]=tab;this.tabsById[tabId]=tab;var tabElement=tab.getTabElement();this.tabArea.appendChild(tabElement,this.new_tab_button_tabs);tab.insertInto(this.contentArea);if(this.maxTabElementWidth==null){this._computeMaxTabElementWidth();}
tabElement.style.maxWidth=this.maxTabElementWidth+'px';if(!this.visibleTab){this.visibleTab=tab;tab.setVisible(true);}
enableDisableButtons.call(this);if(options.initiallyVisible){this.goToTab(tabId);}
this.events.tabInsertion.dispatch(this);return tab;};StyledNotebook.prototype.getTab=function getTab(id){return this.tabsById[id];};StyledNotebook.prototype.getTabByLabel=function getTabByLabel(label){for(var i=0;i<this.tabs.length;i++){if(this.tabs[i].nameText===label){return this.tabs[i];}}
return null;};StyledNotebook.prototype.getVisibleTab=function getVisibleTab(){return this.visibleTab;};StyledNotebook.prototype.getTabByIndex=function getTabByIndex(index){return this.tabs[index];};StyledNotebook.prototype.getTabIndex=function getTabIndex(id){for(var i=0;i<this.tabs.length;i++){if(this.tabs[i].tabId==id){return i;}}
return null;};StyledNotebook.prototype.removeTab=function removeTab(id){var index,tabToExtract,nextTab;if(!this.tabsById[id]){return;}
delete this.tabsById[id];index=this.getTabIndex(id);tabToExtract=this.tabs.splice(index,1)[0];this.tabArea.removeChild(tabToExtract.getTabElement());this.contentArea.removeChild(tabToExtract.wrapperElement);enableDisableButtons.call(this);if((this.visibleTab===tabToExtract)&&(this.tabs.length>0)){nextTab=this.tabs[index];if(!nextTab){nextTab=this.tabs[index-1];}
this.goToTab(nextTab.tabId);}
tabToExtract.events.close.dispatch(tabToExtract,this);this.events.tabDeletion.dispatch(this,tabToExtract);};StyledNotebook.prototype.goToTab=function goToTab(tab,options){var newTab,oldTab;if(tab instanceof StyledElements.Tab){if(this.tabsById[tab.tabId]!==tab){throw new TypeError('tab is not owned by this notebook');}
newTab=tab;}else{newTab=this.tabsById[tab];if(newTab==null){throw new TypeError('Invalid tab id');}}
oldTab=this.visibleTab;if(options==null){options={};}
if(this.visibleTab&&newTab==this.visibleTab){if(this.focusOnSetVisible){this.focus(newTab.tabId);}
return;}
this.events.change.dispatch(this,oldTab,newTab,options.context);if(this.visibleTab){this.visibleTab.setVisible(false);}
this.visibleTab=newTab;this.visibleTab.setVisible(true);if(this.focusOnSetVisible){this.focus(newTab.tabId);}
this.events.changed.dispatch(this,oldTab,newTab,options.context);};StyledNotebook.prototype.getNumberOfTabs=function getNumberOfTabs(){return this.tabs.length;};StyledNotebook.prototype.focus=function focus(tabId){this.transitionsQueue.addCommand({type:'focus',tabId:tabId});};StyledNotebook.prototype._computeMaxTabElementWidth=function _computeMaxTabElementWidth(){var tabAreaWidth,tabElement,computedStyle,tabAreaComputedStyle;if(this.tabs.length===0){this.maxTabElementWidth=null;return;}
tabAreaWidth=this.tabArea.wrapperElement.clientWidth;tabElement=this.tabs[0].getTabElement();computedStyle=document.defaultView.getComputedStyle(tabElement,null);if(computedStyle.getPropertyCSSValue('display')==null){this.maxTabElementWidth=null;return;}
tabAreaComputedStyle=document.defaultView.getComputedStyle(this.tabArea.wrapperElement,null);tabAreaWidth-=tabAreaComputedStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);tabAreaWidth-=tabAreaComputedStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);this.maxTabElementWidth=tabAreaWidth;};var repaint_tab_area=function repaint_tab_area(){var i,j,tabElement,maxWidth,tabComputedStyle,childComputedStyle;this._computeMaxTabElementWidth();for(i=0;i<this.tabs.length;i++){tabElement=this.tabs[i].getTabElement();maxWidth=this.maxTabElementWidth;tabComputedStyle=document.defaultView.getComputedStyle(tabElement,null);maxWidth-=tabComputedStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=tabComputedStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=tabComputedStyle.getPropertyCSSValue('border-left-width').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=tabComputedStyle.getPropertyCSSValue('border-right-width').getFloatValue(CSSPrimitiveValue.CSS_PX);for(j=1;j<tabElement.childNodes.length;j++){childComputedStyle=document.defaultView.getComputedStyle(tabElement.childNodes[j],null);maxWidth-=tabElement.childNodes[j].offsetWidth;maxWidth-=childComputedStyle.getPropertyCSSValue('margin-left').getFloatValue(CSSPrimitiveValue.CSS_PX);maxWidth-=childComputedStyle.getPropertyCSSValue('margin-right').getFloatValue(CSSPrimitiveValue.CSS_PX);}
tabElement.style.maxWidth=this.maxTabElementWidth+'px';tabElement.firstChild.style.maxWidth=maxWidth+'px';}};StyledNotebook.prototype.repaint=function repaint(temporal){var i,height;temporal=temporal!==undefined?temporal:false;if(this.fullscreen!==true){height=this._getUsableHeight();if(height==null){return;}
this.wrapperElement.style.height=(height+"px");}else{this.wrapperElement.style.height='';}
this.tabWrapper.repaint();repaint_tab_area.call(this);enableDisableButtons.call(this);if(temporal){if(this.visibleTab){this.visibleTab.repaint(true);}}else{for(i=0;i<this.tabs.length;i++){this.tabs[i].repaint(false);}}};StyledNotebook.prototype.isDisabled=function isDisabled(){return this.disabledLayer!=null;};StyledNotebook.prototype.setDisabled=function setDisabled(disabled){if(this.isDisabled()==disabled){return;}
if(disabled){this.disabledLayer=document.createElement('div');this.disabledLayer.classList.add('disable-layer');this.wrapperElement.appendChild(this.disabledLayer);}else{StyledElements.Utils.removeFromParent(this.disabledLayer);this.disabledLayer=null;}
this.enabled=!disabled;};StyledNotebook.prototype.enable=function enable(){this.setDisabled(false);};StyledNotebook.prototype.disable=function disable(){this.setDisabled(true);};StyledNotebook.prototype.clear=function clear(){this.tabs=[];this.tabsById=[];this.visibleTab=null;this.tabArea.clear();this.contentArea.innerHTML='';enableDisableButtons.call(this);};StyledNotebook.prototype.addButton=function addButton(button,position){if(!(button instanceof StyledElements.StyledButton)&&!(button instanceof StyledElements.StyledSelect)){throw new TypeError();}
position=position||'right';switch(position){case'left':this.tabWrapper.getWestContainer().appendChild(button,this.moveLeftButton);break;case'right':this.tabWrapper.getEastContainer().appendChild(button);break;}};StyledNotebook.prototype.requestFullscreen=function requestFullscreen(){if('requestFullscreen'in this.wrapperElement){this.wrapperElement.requestFullscreen();}else if('msRequestFullscreen'in this.wrapperElement){this.wrapperElement.msRequestFullscreen();}else if('mozRequestFullScreen'in this.wrapperElement){this.wrapperElement.mozRequestFullScreen();}else if('webkitRequestFullscreen'in this.wrapperElement){this.wrapperElement.webkitRequestFullscreen();}};StyledNotebook.prototype.exitFullscreen=function exitFullscreen(){if(this.fullscreen!==true){return;}
if('exitFullscreen'in document){document.exitFullscreen();}else if('msExitFullscreen'in document){document.msExitFullscreen();}else if('mozCancelFullScreen'in document){document.mozCancelFullScreen();}else if('webkitExitFullscreen'in document){document.webkitExitFullscreen();}};StyledNotebook.prototype.destroy=function destroy(){if(StyledElements.Utils.XML.isElement(this.wrapperElement.parentNode)){StyledElements.Utils.removeFromParent(this.wrapperElement);}
this.tabs=null;this.tabsById=null;this.visibleTab=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.StyledNotebook=StyledNotebook;})();(function(){"use strict";var Alternative=function Alternative(id,options){var defaultOptions;if(arguments.length===0){return;}
defaultOptions={useFullHeight:true};options=StyledElements.Utils.merge(defaultOptions,options);this.altId=id;StyledElements.Container.call(this,options,['show','hide']);this.wrapperElement.classList.add("hidden");};Alternative.prototype=new StyledElements.Container({extending:true});Alternative.prototype.setVisible=function setVisible(newStatus){if(newStatus){this.wrapperElement.classList.remove("hidden");this.repaint(false);this.events.show.dispatch(this);}else{this.wrapperElement.classList.add("hidden");this.repaint(false);this.events.hide.dispatch(this);}};Alternative.prototype.isVisible=function isVisible(newStatus){return!this.wrapperElement.classList.contains("hidden");};Alternative.prototype.getId=function getId(){return this.altId;};StyledElements.Alternative=Alternative;})();(function(){"use strict";var StyledAlternatives=function StyledAlternatives(options){var defaultOptions={'class':'','full':true,'defaultEffect':'None'};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['preTransition','postTransition']);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],"alternatives");this.contentArea=document.createElement("div");this.contentArea.className="wrapper";this.wrapperElement.appendChild(this.contentArea);this.visibleAlt=null;this.alternatives={};this.alternativeList=[];this.nextAltId=0;if(options.id){this.wrapperElement.setAttribute("id",options.id);}
if(options.full){this.wrapperElement.classList.add("full");}
this.defaultEffect=options.defaultEffect;var context={alternativesObject:this,inAlternative:null,outAlternative:null,width:null,steps:null,step:null,inc:null};var stepFunc=function stepFunc(step,context){var newLeftPosOut,newLeftPosIn,offset=Math.floor(step*context.inc);if(context.inc<0){newLeftPosOut=offset;newLeftPosIn=context.width+offset;}else{newLeftPosOut=offset;newLeftPosIn=-context.width+offset;}
if((context.inc<0)&&(newLeftPosIn>0)||(context.inc>0)&&(newLeftPosOut<context.width)){context.outAlternative.wrapperElement.style.left=newLeftPosOut+"px";context.inAlternative.wrapperElement.style.left=newLeftPosIn+"px";return true;}else{context.outAlternative.setVisible(false);context.outAlternative.wrapperElement.style.left='';context.outAlternative.wrapperElement.style.width='';context.inAlternative.wrapperElement.style.left='';context.inAlternative.wrapperElement.style.width='';context.alternativesObject.visibleAlt=context.inAlternative;StyledElements.Utils.callCallback(context.onComplete,context.alternativesObject,context.outAlternative,context.inAlternative);context.alternativesObject.events.postTransition.dispatch(context.alternativesObject,context.outAlternative,context.inAlternative);return false;}};var initFunc=function initFunc(context,command){context.outAlternative=context.alternativesObject.visibleAlt;context.inAlternative=command.id;context.onComplete=command.onComplete;if(context.inAlternative!=null){context.inAlternative=context.alternativesObject.alternatives[context.inAlternative];}
if(context.inAlternative==null||context.inAlternative==context.outAlternative){StyledElements.Utils.callCallback(context.onComplete,context.alternativesObject,context.outAlternative,context.inAlternative);return false;}
context.alternativesObject.events.preTransition.dispatch(context.alternativesObject,context.outAlternative,context.inAlternative);var baseTime=(new Date()).getTime()+150;context.width=context.alternativesObject.wrapperElement.offsetWidth;context.inAlternative.wrapperElement.style.width=context.width+"px";context.outAlternative.wrapperElement.style.width=context.width+"px";context.inAlternative.setVisible(true);var stepTimes=[];switch(context.alternativesObject.defaultEffect){case StyledAlternatives.HORIZONTAL_SLICE:context.steps=6;for(var i=0;i<=context.steps;i++){stepTimes[i]=baseTime+(i*150);}
context.inc=Math.floor(context.width/context.steps);if(context.inAlternative.getId()>context.outAlternative.getId()){context.inAlternative.wrapperElement.style.left=context.width+"px";context.inc=-context.inc;}else{context.inAlternative.wrapperElement.style.left=-context.width+"px";}
break;default:context.steps=1;stepTimes[0]=baseTime;context.inc=Math.floor(context.width/context.steps);if(context.inAlternative.getId()>context.outAlternative.getId()){context.inAlternative.wrapperElement.style.left=context.width+"px";context.inc=-context.inc;}else{context.inAlternative.wrapperElement.style.left=-context.width+"px";}}
return stepTimes;};this.transitionsQueue=new StyledElements.CommandQueue(context,initFunc,stepFunc);};StyledAlternatives.prototype=new StyledElements.StyledElement();StyledAlternatives.HORIZONTAL_SLICE="HorizontalSlice";StyledAlternatives.NONE="HorizontalSlice";StyledAlternatives.prototype.repaint=function repaint(temporal){temporal=temporal!==undefined?temporal:false;var height=this._getUsableHeight();if(height==null){return;}
this.wrapperElement.style.height=(height+"px");if(this.visibleAlt!=null){this.visibleAlt.repaint();}};StyledAlternatives.prototype.createAlternative=function createAlternative(options){var defaultOptions={'containerOptions':{},'alternative_constructor':StyledElements.Alternative};options=StyledElements.Utils.merge(defaultOptions,options);var altId=this.nextAltId++;if((options.alternative_constructor!==StyledElements.Alternative)&&!(options.alternative_constructor.prototype instanceof StyledElements.Alternative)){throw new TypeError();}
var alt=new options.alternative_constructor(altId,options.containerOptions);alt.insertInto(this.contentArea);this.alternatives[altId]=alt;this.alternativeList.push(alt);if(!this.visibleAlt){this.visibleAlt=alt;alt.setVisible(true);}
return alt;};StyledAlternatives.prototype.removeAlternative=function removeAlternative(alternative){var index,id,nextAlternative=null;if(alternative instanceof StyledElements.Alternative){id=alternative.getId();if(this.alternatives[id]!==alternative){throw new TypeError('Invalid alternative');}}else{id=alternative;if(this.alternatives[id]==null){throw new TypeError('Invalid alternative');}
alternative=this.alternatives[id];}
delete this.alternatives[id];index=this.alternativeList.indexOf(alternative);this.alternativeList.splice(index,1);alternative.setVisible(false);this.contentArea.removeChild(alternative.wrapperElement);if(this.visibleAlt===alternative){if(this.alternativeList.length>0){nextAlternative=this.alternativeList[index];if(!nextAlternative){nextAlternative=this.alternativeList[index-1];}
nextAlternative.setVisible(true);this.visibleAlt=nextAlternative;}else{this.visibleAlt=null;}
this.events.postTransition.dispatch(this,alternative,nextAlternative);}};StyledAlternatives.prototype.clear=function clear(){this.alternatives={};this.alternativeList=[];this.nextAltId=0;this.visibleAlt=null;this.contentArea.innerHTML='';};StyledAlternatives.prototype.getCurrentAlternative=function getCurrentAlternative(){return this.visibleAlt;};StyledAlternatives.prototype.showAlternative=function showAlternative(alternative,options){var command={};if(options==null){options={};}
if(alternative instanceof StyledElements.Alternative){command.id=alternative.getId();if(this.alternatives[command.id]!==alternative){throw new Error('Invalid alternative');}}else{command.id=alternative;if(this.alternatives[command.id]==null){throw new Error('Invalid alternative');}}
command.onComplete=options.onComplete;this.transitionsQueue.addCommand(command);};StyledElements.StyledAlternatives=StyledAlternatives;})();(function(){"use strict";var HorizontalLayout=function HorizontalLayout(options){StyledElements.StyledElement.call(this,[]);this.options=StyledElements.Utils.merge({'class':'','autoHeight':true},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord(this.options['class'],"horizontal_layout");this.west=new StyledElements.Container({'class':'west_container'});this.center=new StyledElements.Container({'class':'center_container'});this.east=new StyledElements.Container({'class':'east_container'});this.west.insertInto(this.wrapperElement);this.center.insertInto(this.wrapperElement);this.east.insertInto(this.wrapperElement);};HorizontalLayout.prototype=new StyledElements.StyledElement();HorizontalLayout.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.repaint();};HorizontalLayout.prototype.repaint=function repaint(temporal){var usableWidth=this.wrapperElement.offsetWidth;var v1=this.west.wrapperElement.offsetWidth;var v2=usableWidth-this.east.wrapperElement.offsetWidth;var centerWidth=v2-v1;if(centerWidth<0){centerWidth=0;}
var height=Math.max(this.west.wrapperElement.offsetHeight,this.center.wrapperElement.offsetHeight,this.east.wrapperElement.offsetHeight);this.center.wrapperElement.style.width=centerWidth+'px';this.center.wrapperElement.style.left=v1+'px';this.east.wrapperElement.style.left=v2+'px';if(this.options.autoHeight){this.wrapperElement.style.height=height+'px';}
this.west.repaint(temporal);this.center.repaint(temporal);this.east.repaint(temporal);};HorizontalLayout.prototype.getWestContainer=function getWestContainer(){return this.west;};HorizontalLayout.prototype.getCenterContainer=function getCenterContainer(){return this.center;};HorizontalLayout.prototype.getEastContainer=function getEastContainer(){return this.east;};StyledElements.HorizontalLayout=HorizontalLayout;})();(function(){"use strict";var BorderLayout=function BorderLayout(options){StyledElements.StyledElement.call(this,[]);options=StyledElements.Utils.merge({'class':''},options);this.wrapperElement=document.createElement('div');this.wrapperElement.className=StyledElements.Utils.appendWord(options['class'],"border_layout");this.north=new StyledElements.Container({'class':'north_container'});this.west=new StyledElements.Container({'class':'west_container'});this.center=new StyledElements.Container({'class':'center_container'});this.east=new StyledElements.Container({'class':'east_container'});this.south=new StyledElements.Container({'class':'south_container'});this.north.insertInto(this.wrapperElement);this.west.insertInto(this.wrapperElement);this.center.insertInto(this.wrapperElement);this.east.insertInto(this.wrapperElement);this.south.insertInto(this.wrapperElement);};BorderLayout.prototype=new StyledElements.StyledElement();BorderLayout.prototype.repaint=function repaint(temporal){var usableArea={'width':this.wrapperElement.offsetWidth,'height':this.wrapperElement.offsetHeight};var h1=this.north.wrapperElement.offsetHeight;var h2=usableArea.height-this.south.wrapperElement.offsetHeight;var centerHeight=h2-h1;if(centerHeight<0){centerHeight=0;}
var v1=this.west.wrapperElement.offsetWidth;var v2=usableArea.width-this.east.wrapperElement.offsetWidth;var centerWidth=v2-v1;if(centerWidth<0){centerWidth=0;}
this.west.wrapperElement.style.top=h1+'px';this.west.wrapperElement.style.height=centerHeight+'px';this.center.wrapperElement.style.top=h1+'px';this.center.wrapperElement.style.height=centerHeight+'px';this.center.wrapperElement.style.width=centerWidth+'px';this.center.wrapperElement.style.left=v1+'px';this.east.wrapperElement.style.top=h1+'px';this.east.wrapperElement.style.height=centerHeight+'px';this.east.wrapperElement.style.left=v2+'px';this.south.wrapperElement.style.top=h2+'px';this.north.repaint(temporal);this.west.repaint(temporal);this.center.repaint(temporal);this.east.repaint(temporal);this.south.repaint(temporal);};BorderLayout.prototype.getNorthContainer=function getNorthContainer(){return this.north;};BorderLayout.prototype.getWestContainer=function getWestContainer(){return this.west;};BorderLayout.prototype.getCenterContainer=function getCenterContainer(){return this.center;};BorderLayout.prototype.getEastContainer=function getEastContainer(){return this.east;};BorderLayout.prototype.getSouthContainer=function getSouthContainer(){return this.south;};StyledElements.BorderLayout=BorderLayout;})();(function(){"use strict";var buildHeader=function buildHeader(){var i,column,cell,label;this.pHeaderCells=[];for(i=0;i<this.columns.length;i+=1){column=this.columns[i];if(column.label==null){label=column.field;}else{label=column.label;}
cell=document.createElement('div');cell.className='cell';if(column.width!=null){cell.style.width=column.width;}
cell.textContent=label;if(column.sortable!==false){cell.classList.add('sortable');cell.setAttribute('title',StyledElements.Utils.interpolate(StyledElements.Utils.gettext('Sort by %(column_name)s'),{column_name:label}));cell.callback=this.pSortByColumnCallback.bind({widget:this,column:i});cell.addEventListener('click',cell.callback,true);}
this.header.appendChild(cell);this.pHeaderCells.push(cell);}};var applyWidth=function applyWidth(cell,width){var cellStyle,paddingLeft,paddingRight;cellStyle=document.defaultView.getComputedStyle(cell,null);if(cellStyle.getPropertyCSSValue('display')==null){cell.style.widht='0';return;}
paddingLeft=cellStyle.getPropertyCSSValue('padding-left').getFloatValue(CSSPrimitiveValue.CSS_PX);paddingRight=cellStyle.getPropertyCSSValue('padding-right').getFloatValue(CSSPrimitiveValue.CSS_PX);cell.style.width=(width-paddingLeft-paddingRight)+'px';};var highlight_selection=function highlight_selection(){if(this._selected_entry_id in this._current_elements){this._current_elements[this._selected_entry_id].row.classList.add('highlight');}};var paintTable=function paintTable(items){var i,j,item,row,cell,callback,today,cellContent,column;this.pClearTable();for(i=0;i<items.length;i+=1){item=items[i];callback=this.pRowCallback.bind({control:this,item:item});row=document.createElement('div');row.className='row';if((i%2)===1){row.classList.add('odd');}
for(j=0;j<this.columns.length;j+=1){column=this.columns[j];cell=document.createElement('div');cell.className='cell';this.columnsCells[j].push(cell);if(typeof column.width==='string'){cell.style.width=column.width;}
if(typeof column['class']==='string'){cell.classList.add(column['class']);}
if(column.contentBuilder){cellContent=column.contentBuilder(item);}else if(column.type==='date'){if(this.pGetFieldValue(item,column.field)===''){cellContent='';}else{if(!today){today=new Date();}
cellContent=this.pFormatDate(item,column.field,today,column.dateparser);}}else if(column.type==='number'){cellContent=this.pGetFieldValue(item,column.field);if(column.unit){cellContent=cellContent+" "+column.unit;}}else{cellContent=this.pGetFieldValue(item,column.field);}
if(!cellContent){cellContent='';}
if(typeof cellContent==='string'){cell.textContent=cellContent;}else if(typeof cellContent==='number'||typeof cellContent==='boolean'){cell.textContent=""+cellContent;}else if(cellContent instanceof StyledElements.StyledElement){cellContent.insertInto(cell);this.pComponents.push(cellContent);}else{cell.appendChild(cellContent);}
cell.addEventListener('click',callback,false);this.pListeners.push({element:cell,callback:callback});row.appendChild(cell);if(typeof this._extract_id==='function'){this._current_elements[this._extract_id(item)]={row:row,data:item};}}
this.tableBody.appendChild(row);}
highlight_selection.call(this);this.resizeColumns();this.resizeColumns();};var ModelTable=function ModelTable(columns,options){var i,column,sort_info,sort_id,defaultOptions;defaultOptions={'initialSortColumn':-1,'pageSize':5};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledElement.call(this,['click']);this.columns=columns;this.layout=new StyledElements.BorderLayout({'class':'model_table'});this.wrapperElement=this.layout.wrapperElement;this.header=this.layout.getNorthContainer();this.header.addClassName('headrow');buildHeader.call(this);this.pComponents=[];this.pListeners=[];this.tableBody=this.layout.getCenterContainer();this.tableBody.addClassName('tbody');this.statusBar=this.layout.getSouthContainer();this.statusBar.addClassName('statusrow');this.sortColumn=null;if(options.source!=null){this.source=options.source;}else if(options.pagination!=null){this.source=options.pagination;}else{sort_info={};for(i=0;i<columns.length;i+=1){column=columns[i];if(sort_id in column){sort_id=column.sort_id;}else{sort_id=column.field;}
sort_info[sort_id]=column;}
this.source=new StyledElements.StaticPaginatedSource({pageSize:options.pageSize,sort_info:sort_info});}
Object.defineProperty(this,'pagination',{get:function(){return this.source;}});this.paginationInterface=new StyledElements.PaginationInterface(this.source);this.pRefreshBody=this.reload.bind(this);this.source.addEventListener('requestEnd',this.pRefreshBody);this.statusBar.appendChild(this.paginationInterface);if(options.initialSortColumn===-1){for(i=0;i<this.columns.length;i+=1){if(this.columns[i].sortable!==false){options.initialSortColumn=i;break;}}
if(options.initialSortColumn===-1){options.initialSortColumn=null;}}else if(typeof options.initialSortColumn==='string'){for(i=0;i<this.columns.length;i+=1){if(this.columns[i].field===options.initialSortColumn){options.initialSortColumn=i;break;}}
if(typeof options.initialSortColumn==='string'){options.initialSortColumn=null;}}
this.pSortByColumn(options.initialSortColumn,options.initialDescendingOrder);this._current_elements={};if(typeof options.id==='string'){this._extract_id=function(data){return data[options.id];};}else if(typeof options.id==='function'){this._extract_id=options.id;}};ModelTable.prototype=new StyledElements.StyledElement();ModelTable.prototype.repaint=function repaint(){this.layout.repaint();this.resizeColumns();};ModelTable.prototype.select=function select(id){if(this._selected_entry_id!==null){if(this._selected_entry_id in this._current_elements){this._current_elements[this._selected_entry_id].row.classList.remove('highlight');}}
if(id!=null){this._selected_entry_id=id;highlight_selection.call(this);}};ModelTable.prototype.resizeColumns=function resizeColumns(){var i,j,autocells=[],extra_width,autowidth,columnCells;extra_width=this.tableBody.wrapperElement.clientWidth;for(i=0;i<this.columns.length;i+=1){if(typeof this.columns[i].width!=='string'){autocells.push(i);}else{extra_width-=this.pHeaderCells[i].offsetWidth;}}
autowidth=extra_width/autocells.length;for(i=0;i<autocells.length;i+=1){columnCells=this.columnsCells[autocells[i]];applyWidth(this.pHeaderCells[autocells[i]],autowidth);for(j=0;j<columnCells.length;j+=1){applyWidth(columnCells[j],autowidth);}}
for(i=0;i<this.pComponents.length;i+=1){this.pComponents[i].repaint();}};ModelTable.prototype.pSortByColumn=function pSortByColumn(column,descending){var sort_id,order,oldSortHeaderCell,sortHeaderCell;if(this.sortColumn!=null){oldSortHeaderCell=this.pHeaderCells[this.sortColumn];oldSortHeaderCell.classList.remove('ascending');oldSortHeaderCell.classList.remove('descending');}
this.sortInverseOrder=descending;this.sortColumn=column;if(this.sortColumn!=null){sortHeaderCell=this.pHeaderCells[this.sortColumn];if(this.sortInverseOrder){sortHeaderCell.classList.remove('ascending');sortHeaderCell.classList.add('descending');}else{sortHeaderCell.classList.remove('descending');sortHeaderCell.classList.add('ascending');}
column=this.columns[this.sortColumn];if(column.sort_id!=null){sort_id=column.sort_id;}else{sort_id=column.field;}
if(this.sortInverseOrder){sort_id='-'+sort_id;}
order=[sort_id];}else{order=null;}
this.source.changeOptions({order:order});};ModelTable.prototype.pSortByColumnCallback=function pSortByColumnCallback(){var descending=this.widget.sortColumn===this.column?!this.widget.sortInverseOrder:false;this.widget.pSortByColumn(this.column,descending);};ModelTable.prototype.pGetFieldValue=function pGetFieldValue(item,field){var fieldPath,currentNode,currentField;if(typeof field==="string"){fieldPath=[field];}else{fieldPath=field.slice();}
currentNode=item;while(currentNode!==null&&fieldPath.length>0){currentField=fieldPath.splice(0,1)[0];currentNode=currentNode[currentField];}
if(currentNode===null||fieldPath.length>0){return"";}
return currentNode;};ModelTable.prototype.pFormatDate=function pFormatDate(item,field,today,dateparser){var date,formatedDate,sameDay,shortVersion,fullVersion,element;date=this.pGetFieldValue(item,field);if(typeof dateparser==='function'){formatedDate=dateparser(date);}else{formatedDate=new Date(date);}
formatedDate.locale='es';sameDay=(formatedDate.getDate()===today.getDate())&&(formatedDate.getMonth()===today.getMonth())&&(formatedDate.getFullYear()===today.getFullYear());if(sameDay){shortVersion=formatedDate.strftime('%R');}else{shortVersion=formatedDate.strftime('%x');}
fullVersion=formatedDate.strftime('%c');element=document.createElement('span');element.textContent=shortVersion;element.setAttribute('title',fullVersion);return element;};ModelTable.prototype.pRowCallback=function pRowCallback(){this.control.events.click.dispatch(this.item);};ModelTable.prototype.pClearTable=function pClearTable(){var i,entry;for(i=0;i<this.pListeners.length;i+=1){entry=this.pListeners[i];entry.element.removeEventListener('click',entry.callback,false);}
this.pComponents=[];this.pListeners=[];this.columnsCells=[];for(i=0;i<this.columns.length;i+=1){this.columnsCells[i]=[];}
this.tableBody.clear();this._current_elements={};};ModelTable.prototype.reload=function reload(){paintTable.call(this,this.source.getCurrentPage());};ModelTable.prototype.insertInto=function insertInto(){StyledElements.StyledElement.prototype.insertInto.apply(this,arguments);this.repaint();};ModelTable.prototype.destroy=function destroy(){var i,cell;for(i=0;i<this.pHeaderCells.length;i+=1){cell=this.pHeaderCells[i];if(cell.callback){cell.removeEventListener('click',cell.callback,true);cell.callback=null;}}
this.pClearTable();this.layout.destroy();this.layout=null;this.paginationInterface.destroy();this.paginationInterface=null;this.source.destroy();this.source=null;this.pRefreshBody=null;};StyledElements.ModelTable=ModelTable;})();(function(){"use strict";var onFocus=function onFocus(e){var range=document.createRange();range.selectNodeContents(this.wrapperElement);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);document.addEventListener('mousedown',this._onBlur,false);};var onKeydown=function onKeydown(e){if(e.keyCode===13){this._onBlur();}};var onBlur=function onBlur(e){if(!this.wrapperElement.hasAttribute('contenteditable')){return;}
document.removeEventListener('mousedown',this._onBlur,false);this.events.change.dispatch(this,this.wrapperElement.textContent);this.disableEdition();};var EditableElement=function EditableElement(options){StyledElements.StyledElement.call(this,['change']);this.wrapperElement=document.createElement('span');this.wrapperElement.textContent=options.initialContent;this._onFocus=onFocus.bind(this);this._onKeydown=onKeydown.bind(this);this._onBlur=onBlur.bind(this);this.wrapperElement.addEventListener('focus',this._onFocus,true);this.wrapperElement.addEventListener('keydown',this._onKeydown,true);this.wrapperElement.addEventListener('blur',this._onBlur,true);};EditableElement.prototype=new StyledElements.StyledElement();EditableElement.prototype.disableEdition=function disableEdition(){if(this.wrapperElement.hasAttribute('contenteditable')){this.wrapperElement.removeEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.removeAttribute('contenteditable');this.wrapperElement.blur();this.wrapperElement.scrollLeft=0;this.wrapperElement.scrollTop=0;}};EditableElement.prototype.enableEdition=function enableEdition(){if(!this.wrapperElement.hasAttribute('contenteditable')){this.wrapperElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.wrapperElement.setAttribute('contenteditable','true');}
this.wrapperElement.focus();};EditableElement.prototype.destroy=function destroy(){this.wrapperElement.removeEventListener('focus',this._onFocus,true);this.wrapperElement.removeEventListener('keydown',this._onKeydown,true);this.wrapperElement.removeEventListener('blur',this._onBlur,true);this._onFocus=null;this._onKeydown=null;this._onBlur=null;StyledElements.StyledElement.prototype.destroy.call(this);};StyledElements.EditableElement=EditableElement;})();(function(){"use strict";var HiddenField=function HiddenField(options){var defaultOptions={'initialValue':'','class':''};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,[]);this.wrapperElement=document.createElement("div");this.wrapperElement.className=StyledElements.Utils.prependWord(options['class'],'styled_hidden_field');this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","hidden");if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.inputElement.setAttribute("value",options.initialValue);this.wrapperElement.appendChild(this.inputElement);};HiddenField.prototype=new StyledElements.StyledInputElement();StyledElements.HiddenField=HiddenField;})();(function(){"use strict";var ButtonsGroup=function ButtonsGroup(name){StyledElements.StyledInputElement.call(this,"",['change']);Object.defineProperty(this,'name',{value:name});this.buttons=[];};ButtonsGroup.prototype=new StyledElements.StyledInputElement();ButtonsGroup.prototype.insertButton=function insertButton(button){this.buttons[this.buttons.length]=button;button.addEventListener('change',function(){this.events.change.dispatch(this);}.bind(this));return this;};ButtonsGroup.prototype.getValue=function getValue(){var i,result=[];if(this.buttons[0]instanceof StyledElements.StyledCheckBox){for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){result.push(this.buttons[i].getValue());}}}else{for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){return[this.buttons[i].getValue()];}}}
return result;};ButtonsGroup.prototype.setValue=function setValue(newValue){if(newValue==null){newValue=[];}else if(typeof newValue==='string'){newValue=[newValue];}
for(var i=0;i<this.buttons.length;i++){if(newValue.indexOf(this.buttons[i].inputElement.value)!==-1){this.buttons[i].setValue(true);}else{this.buttons[i].setValue(false);}}
return this;};ButtonsGroup.prototype.reset=function reset(){for(var i=0;i<this.buttons.length;i++){this.buttons[i].reset();}
return this;};ButtonsGroup.prototype.getSelectedButtons=function getSelectedButtons(){var i;if(this.buttons.length===0){return[];}
if(this.buttons[0]instanceof StyledElements.StyledCheckBox){var result=[];for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){result[result.length]=this.buttons[i];}}
return result;}else{for(i=0;i<this.buttons.length;i++){if(this.buttons[i].inputElement.checked){return[this.buttons[i]];}}
return[];}};StyledElements.ButtonsGroup=ButtonsGroup;})();(function(){"use strict";var CheckBox=function StyledCheckBox(options){var defaultOptions={'initialValue':false,'class':'','group':null,'secondInput':null,'value':true};options=StyledElements.Utils.merge(defaultOptions,options);if('initiallyChecked'in options){options.initialValue=options.initiallyChecked;}
StyledElements.StyledInputElement.call(this,options.initialValue,['change']);this.wrapperElement=document.createElement("input");this.wrapperElement.className='checkbox';this.wrapperElement.setAttribute("type","checkbox");this.inputElement=this.wrapperElement;if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.value=options.value;this.inputElement.setAttribute("value",options.value);this.secondInput=options.secondInput;this.setValue(options.initialValue);if(options.group instanceof StyledElements.ButtonsGroup){this.wrapperElement.setAttribute("name",options.group.name);options.group.insertButton(this);}else if(typeof options.group==='string'){this.wrapperElement.setAttribute("name",options.group);}
this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('change',function(){if(this.enabled){if(this.secondInput!=null){this.secondInput.setDisabled(!this.inputElement.checked);}
this.events.change.dispatch(this);}}.bind(this),true);};CheckBox.prototype=new StyledElements.StyledInputElement();CheckBox.prototype.reset=function reset(){this.setValue(this.defaultValue);};CheckBox.prototype.getValue=function getValue(){if(this.value===true&&this.secondInput==null){return this.inputElement.checked;}else if(this.secondInput==null){return this.inputElement.checked?this.value:null;}else{return this.secondInput.getValue();}};CheckBox.prototype.setValue=function setValue(newValue){this.inputElement.checked=newValue!=null&&newValue!==false;if(this.secondInput!=null){this.secondInput.setDisabled(!this.inputElement.checked);if(this.inputElement.checked){this.secondInput.setValue(newValue);}}};StyledElements.StyledCheckBox=CheckBox;})();(function(){"use strict";var StyledRadioButton=function StyledRadioButton(options){var defaultOptions={'initiallyChecked':false,'class':'','group':null,'value':null};options=StyledElements.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initiallyChecked,['change']);this.wrapperElement=document.createElement("input");this.wrapperElement.setAttribute("type","radio");if(options.value!=null){this.wrapperElement.setAttribute("value",options.value);}
this.inputElement=this.wrapperElement;if(options.name!=null){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
if(options.initiallyChecked===true){this.inputElement.setAttribute("checked",true);}
if(options.group instanceof StyledElements.ButtonsGroup){this.wrapperElement.setAttribute("name",options.group.name);options.group.insertButton(this);}else if(typeof options.group==='string'){this.wrapperElement.setAttribute("name",options.group);}
this.inputElement.addEventListener('mousedown',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('click',StyledElements.Utils.stopPropagationListener,true);this.inputElement.addEventListener('change',function(){if(this.enabled){this.events.change.dispatch(this);}}.bind(this),true);};StyledRadioButton.prototype=new StyledElements.StyledInputElement();StyledRadioButton.prototype.insertInto=function insertInto(element,refElement){var checked=this.inputElement.checked;StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.inputElement.checked=checked;};StyledRadioButton.prototype.reset=function reset(){this.inputElement.checked=this.defaultValue;return this;};StyledRadioButton.prototype.setValue=function setValue(newValue){this.inputElement.checked=newValue;return this;};StyledElements.StyledRadioButton=StyledRadioButton;})();(function(){"use strict";var InputInterface=function InputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.StyledElement.call(this,[]);options.name=fieldId;this._fieldId=fieldId;this._initialValue=options.initialValue;this._defaultValue=options.defaultValue;this._label=options.label;Object.defineProperty(this,'required',{value:'required'in options?!!options.required:false});this._readOnly=!!options.readOnly;this._hidden=!!options.hidden;if(options.description){this._description=options.description;}else{this._description=options.label;}};InputInterface.prototype=new StyledElements.StyledElement();InputInterface.prototype.repaint=function repaint(){this.inputElement.repaint();};InputInterface.prototype.getValue=function getValue(){return this.inputElement.getValue();};InputInterface.prototype.setValue=function setValue(newValue){if(this.isValidValue(newValue)){this._setValue(newValue);}};InputInterface.prototype.getLabel=function getLabel(){return this._label;};InputInterface.prototype.getDescription=function getDescription(){return this._description;};InputInterface.prototype.getDefaultValue=function getDefaultValue(){return this._defaultValue;};InputInterface.prototype.isEmpty=function isEmpty(){return this._isEmptyValue(this.getValue());};InputInterface.prototype._isEmptyValue=function _isEmptyValue(value){return value===""||value==null;};InputInterface.prototype._normalize=function _normalize(value){if(value==null){return"";}else{return(""+value).trim();}};InputInterface.prototype._checkValue=function _checkValue(newValue){return InputValidationError.NO_ERROR;};InputInterface.prototype.checkValue=function checkValue(newValue){if(newValue===undefined){newValue=this.getValue();}else{newValue=this._normalize(newValue);}
if(!(this instanceof SelectInputInterface)){if(this.required&&this._isEmptyValue(newValue)){return InputValidationError.REQUIRED_ERROR;}
if(!this.required&&this._isEmptyValue(newValue)){return InputValidationError.NO_ERROR;}}
return this._checkValue(newValue);};InputInterface.prototype.isValidValue=function isValidValue(newValue){return this.checkValue(newValue)===InputValidationError.NO_ERROR;};InputInterface.prototype._setValue=function _setValue(newValue){newValue=this._normalize(newValue);this.inputElement.setValue(newValue);};InputInterface.prototype._setError=function _setError(error){if(error){this.inputElement.wrapperElement.classList.add('error');}else{this.inputElement.wrapperElement.classList.remove('error');}};InputInterface.prototype.resetToDefault=function resetToDefault(){this._setError(false);this._setValue(this._defaultValue);};InputInterface.prototype.reset=function reset(){this._setError(false);this._setValue(this._initialValue);};InputInterface.prototype.focus=function focus(){this.inputElement.focus();};InputInterface.prototype.setDisabled=function setDisabled(disable){this.inputElement.setDisabled(this._readOnly||disable);};InputInterface.prototype.enable=function enable(){this.setDisabled(false);};InputInterface.prototype.disable=function disable(){this.setDisabled(true);};InputInterface.prototype.insertInto=function insertInto(element){this.inputElement.insertInto(element);};InputInterface.prototype.assignDefaultButton=function assignDefaultButton(button){};StyledElements.InputInterface=InputInterface;})();"use strict";var ValidationErrorManager,InputValidationError={};InputValidationError.NO_ERROR=0;InputValidationError.REQUIRED_ERROR=1;InputValidationError.URL_ERROR=2;InputValidationError.EMAIL_ERROR=3;InputValidationError.ID_ERROR=4;InputValidationError.COLOR_ERROR=5;InputValidationError.BOOLEAN_ERROR=6;InputValidationError.VERSION_ERROR=7;InputValidationError.OUT_OF_RANGE_ERROR=8;var ValidationErrorManager=function ValidationErrorManager(){this.fieldsWithErrorById={};};ValidationErrorManager.prototype._addValidationError=function _addValidationError(errorCode,fieldName){if(this.fieldsWithErrorById[errorCode]===undefined){this.fieldsWithErrorById[errorCode]=[];}
this.fieldsWithErrorById[errorCode].push(fieldName);};ValidationErrorManager.prototype.validate=function validate(field){var errorCode=field.checkValue();if(errorCode!==InputValidationError.NO_ERROR){field._setError(true);this._addValidationError(errorCode,field.getLabel());}else{field._setError(false);}};ValidationErrorManager.prototype._buildErrorMsg=function _buildErrorMsg(errorCode){var msg,fields,i;errorCode=parseInt(errorCode,10);switch(errorCode){case InputValidationError.REQUIRED_ERROR:msg="The following required fields are empty: %(fields)s.";break;case InputValidationError.URL_ERROR:msg="The following fields do not contain a valid URL: %(fields)s.";break;case InputValidationError.EMAIL_ERROR:msg="The following fields do not contain a valid E-Mail address: %(fields)s.";break;case InputValidationError.VERSION_ERROR:msg="The following field do not contain a valid version number: %(fields)s.";break;case InputValidationError.ID_ERROR:msg="The following fields contain invalid characters: %(fields)s.";break;case InputValidationError.COLOR_ERROR:msg="The following fields do not contain a valid color value: %(fields)s.";break;case InputValidationError.OUT_OF_RANGE_ERROR:msg="The following fields does contain an out of range value: %(fields)s.";break;}
fields="";for(i=0;i<this.fieldsWithErrorById[errorCode].length;i+=1){fields+=", "+this.fieldsWithErrorById[errorCode][i];}
fields=fields.substring(2);return StyledElements.Utils.interpolate(msg,{'fields':fields});};ValidationErrorManager.prototype.toHTML=function toHTML(){var errorCode,errorMsgs=[];for(errorCode in this.fieldsWithErrorById){if(this.fieldsWithErrorById.hasOwnProperty(errorCode)){errorMsgs.push(this._buildErrorMsg(errorCode));}}
return errorMsgs;};function TextInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledTextField(options);}
TextInputInterface.prototype=new StyledElements.InputInterface();TextInputInterface.parse=function parse(value){return value;};TextInputInterface.stringify=function stringify(value){return value;};TextInputInterface.prototype.assignDefaultButton=function assignDefaultButton(button){this.inputElement.addEventListener('submit',function(){button.click();});};function PasswordInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledPasswordField(options);}
PasswordInputInterface.prototype=new StyledElements.InputInterface();PasswordInputInterface.parse=TextInputInterface.parse;PasswordInputInterface.stringify=TextInputInterface.stringify;function ListInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledList(options);}
ListInputInterface.prototype=new StyledElements.InputInterface();ListInputInterface.prototype.parse=function parse(value){return JSON.parse(value);};ListInputInterface.prototype.stringify=function stringify(value){return JSON.stringify(value);};ListInputInterface.prototype._normalize=function _normalize(value){if(!Array.isArray(value)){value=[];}};ListInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.cleanSelection();this.inputElement.addSelection(newValue);};ListInputInterface.prototype.getValue=function getValue(){return this.inputElement.getSelection();};ListInputInterface.prototype.isEmpty=function isEmpty(){return this.getValue().length===0;};function NumberInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledNumericField(options);}
NumberInputInterface.prototype=new StyledElements.InputInterface();NumberInputInterface.parse=function parse(value){return Number(value);};NumberInputInterface.prototype._normalize=function _normalize(value){return Number(value);};NumberInputInterface.prototype._checkValue=function _checkValue(newValue){if(!Number.isFinite(newValue)||newValue<this.inputElement.options.min||newValue>this.inputElement.options.max){return InputValidationError.OUT_OF_RANGE_ERROR;}
return InputValidationError.NO_ERROR;};function LongTextInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledTextArea(options);}
LongTextInputInterface.prototype=new StyledElements.InputInterface();LongTextInputInterface.parse=TextInputInterface.parse;LongTextInputInterface.stringify=TextInputInterface.stringify;var URLInputInterface=function URLInputInterface(fieldId,options){if(arguments.length===0){return;}
TextInputInterface.call(this,fieldId,options);};URLInputInterface.prototype=new TextInputInterface();URLInputInterface.parse=TextInputInterface.parse;URLInputInterface.stringify=TextInputInterface.stringify;URLInputInterface.prototype._URLChecker=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;URLInputInterface.prototype._checkValue=function _checkValue(newValue){return this._URLChecker.test(newValue)?InputValidationError.NO_ERROR:InputValidationError.URL_ERROR;};function EMailInputInterface(fieldId,options){TextInputInterface.call(this,fieldId,options);}
EMailInputInterface.prototype=new TextInputInterface();EMailInputInterface.prototype._EMailChecker=/[\w\d][\w\-]*@[\w\d\-]+\.[\w\d]+/;EMailInputInterface.prototype._checkValue=function _checkValue(newValue){return this._EMailChecker.test(newValue)?InputValidationError.NO_ERROR:InputValidationError.EMAIL_ERROR;};function BooleanInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);if(typeof options.initialValue==='string'){options.initiallyChecked=options.initialValue.toLowerCase()==='true';}else if(typeof options.initialValue==='boolean'){options.initiallyChecked=options.initialValue;}
this.inputElement=new StyledElements.StyledCheckBox(options);}
BooleanInputInterface.prototype=new StyledElements.InputInterface();BooleanInputInterface.parse=function parse(value){return(""+value).trim().toLowerCase()==='true';};BooleanInputInterface.stringify=function stringify(value){return""+value;};BooleanInputInterface.prototype.isEmpty=function isEmpty(){return false;};BooleanInputInterface.prototype._normalize=function _normalize(value){return!!value;};BooleanInputInterface.prototype._checkValue=function _checkValue(newValue){return(typeof newValue==='boolean')?InputValidationError.NO_ERROR:InputValidationError.BOOLEAN_ERROR;};function SelectInputInterface(fieldId,desc){if(!('required'in desc)){desc.required=true;}
StyledElements.InputInterface.call(this,fieldId,desc);if(typeof desc.entries==='function'){this._update=desc.entries;}else if(desc.initialEntries&&!this.required){var i,found=false;for(i=0;i<desc.initialEntries.length;i+=1){if(this._isEmptyValue(desc.initialEntries[i].value)){found=true;break;}}
if(!found){desc.initialEntries=[{label:'---------',value:null}].concat(desc.initialEntries);}}
this.inputElement=new StyledElements.StyledSelect(desc);}
SelectInputInterface.prototype=new StyledElements.InputInterface();SelectInputInterface.parse=function parse(value){return value;};SelectInputInterface.stringify=function stringify(value){return""+value;};SelectInputInterface.prototype._setValue=function _setValue(newValue){var entries;if(this._update){this.inputElement.clear();entries=this._update();if(!this.required){entries=[{label:'---------',value:null}].concat(entries);}
this.inputElement.addEntries(entries);}
this.inputElement.setValue(newValue);};SelectInputInterface.prototype._checkValue=function _checkValue(newValue){var newValueId;if(typeof newValue!=='string'){try{newValueId=this.inputElement.idFunc(newValue);}catch(e){}}else{newValueId=newValue;}
if(typeof newValueId!=='string'||!(newValueId in this.inputElement.optionValues)){return InputValidationError.OUT_OF_RANGE_ERROR;}else{return InputValidationError.NO_ERROR;}};function HiddenInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new StyledElements.StyledHiddenField(options);}
HiddenInputInterface.prototype=new StyledElements.InputInterface();function ButtonGroupInputInterface(fieldId,fieldDesc){var ButtonClass,buttonDesc,i,button,label;if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,fieldDesc);this.inputElement=new StyledElements.ButtonsGroup(fieldId);this.wrapperElement=document.createElement('div');this.wrapperElement.className='button_group';switch(fieldDesc.kind){case'radio':ButtonClass=StyledElements.StyledRadioButton;break;case'checkbox':ButtonClass=StyledElements.StyledCheckBox;break;default:throw new Error();}
for(i=0;i<fieldDesc.buttons.length;i+=1){buttonDesc=fieldDesc.buttons[i];label=document.createElement('label');label.className=fieldDesc.kind;button=new ButtonClass({group:this.inputElement,value:buttonDesc.value,secondInput:buttonDesc.secondInput});button.insertInto(label);label.appendChild(document.createTextNode(buttonDesc.label));if(buttonDesc.secondInput){buttonDesc.secondInput.insertInto(label);}
this.wrapperElement.appendChild(label);}
if('initialValue'in fieldDesc){this.inputElement.setValue(fieldDesc.initialValue);}}
ButtonGroupInputInterface.prototype=new StyledElements.InputInterface();ButtonGroupInputInterface.prototype.insertInto=function insertInto(element){element.appendChild(this.wrapperElement);};ButtonGroupInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.setValue(newValue);};ButtonGroupInputInterface.prototype._setError=function _setError(error){};function FileInputInterface(fieldId,fieldDesc){StyledElements.InputInterface.call(this,fieldId,fieldDesc);this.inputElement=new StyledElements.StyledFileField(fieldDesc);}
FileInputInterface.prototype=new StyledElements.InputInterface();FileInputInterface.prototype.getValue=function getValue(){return this.inputElement.getValue();};FileInputInterface.prototype._setValue=function _setValue(newValue){};FileInputInterface.prototype._setError=function _setError(error){};FileInputInterface.prototype.setDisabled=function setDisabled(disable){this.inputElement.disabled=!!disable;};function MultivaluedInputInterface(fieldId,fieldDesc){this.entries=[];this.fields=fieldDesc.fields;this.wrapperElement=new StyledElements.Container();this._addEntry();}
MultivaluedInputInterface.prototype=new StyledElements.InputInterface();MultivaluedInputInterface.prototype._addEntry=function _addEntry(){var entry,fields;entry={};entry.wrapper=document.createElement('div');fields={'':{type:'lineLayout',fields:this.fields}};entry.form=new Form(fields,{useHtmlForm:false,acceptButton:false,cancelButton:false,legend:false});entry.form.wrapperElement.style.display="inline-block";entry.form.wrapperElement.style.verticalAlign="middle";entry.form.insertInto(entry.wrapper);entry.addRowButton=new StyledElements.StyledButton({text:'+'});entry.addRowButton.addEventListener('click',function(){this._addEntry();}.bind(this));entry.addRowButton.insertInto(entry.wrapper);entry.removeRowButton=new StyledElements.StyledButton({text:'-'});entry.removeRowButton.addEventListener('click',function(){this.control._removeEntry(entry);}.bind({control:this,entry:entry}));entry.removeRowButton.insertInto(entry.wrapper);this.entries.push(entry);this.wrapperElement.appendChild(entry.wrapper);return entry;};MultivaluedInputInterface.prototype._removeEntry=function _removeEntry(entry){var index;this.wrapperElement.removeChild(entry.wrapper);index=this.entries.indexOf(entry);this.entries.splice(index,1);entry.form.destroy();if(this.entries.length===0){this._addEntry();}};MultivaluedInputInterface.prototype._removeAllEntries=function _removeAllEntries(){var i,entry;for(i=0;i<this.entries.length;i+=1){entry=this.entries[i];this.wrapperElement.removeChild(entry.wrapper);entry.form.destroy();}
this.entries=[];};MultivaluedInputInterface.prototype.getValue=function getValue(){var i,data=[];for(i=0;i<this.entries.length;i+=1){data.push(this.entries[i].form.getData());}
return data;};MultivaluedInputInterface.prototype._setValue=function _setValue(newValue){var i,entry;this._removeAllEntries();if(!(newValue instanceof Array)){newValue=[];}
for(i=0;i<newValue.length;i+=1){entry=this._addEntry();entry.form.setData(newValue[i]);}
if(this.entries.length===0){this._addEntry();}};MultivaluedInputInterface.prototype._setError=function _setError(error){};var FieldSetInterface=function FieldSetInterface(fieldId,fieldDesc,factory){this.form=new Form(fieldDesc.fields,{factory:factory,useHtmlForm:false,acceptButton:false,cancelButton:false,legend:false});};FieldSetInterface.prototype=new StyledElements.InputInterface();FieldSetInterface.prototype.repaint=function repaint(){return this.form.repaint();};FieldSetInterface.prototype.insertInto=function insertInto(element){this.form.insertInto(element);};FieldSetInterface.prototype.getValue=function getValue(){return this.form.getData();};FieldSetInterface.prototype._setValue=function _setValue(newValue){return this.form.setData(newValue);};FieldSetInterface.prototype._setError=function _setError(error){};function ParametrizedTextInputInterface(fieldId,options){var i,param,option;StyledElements.InputInterface.call(this,fieldId,options);this.variable=options.variable;this.parameters=this.getAvailableParameters();this.wrapperElement=new StyledElements.Container({'class':'parametrized_text_input'});this.resetButton=new StyledElements.StyledButton({'text':StyledElements.Utils.gettext('Use current value')});this.resetButton.addEventListener('click',function(){this.inputElement.setValue(this.escapeValue(this.variable.value));}.bind(this));this.wrapperElement.appendChild(this.resetButton);this.selectorWrapperElement=new StyledElements.Container({'class':'context_selector'});this.wrapperElement.appendChild(this.selectorWrapperElement);this.mainSelect=document.createElement('select');for(i=0;i<this.parameters.length;i+=1){param=this.parameters[i];option=new Option(param.label,param.value);try{this.mainSelect.add(option,null);}catch(e){this.mainSelect.add(option);}}
this.mainSelect.addEventListener('change',this._updateSecondSelect.bind(this),true);this.selectorWrapperElement.appendChild(this.mainSelect);this.secondSelect=document.createElement('select');this.selectorWrapperElement.appendChild(this.secondSelect);this.secondSelect.addEventListener('change',this._updateDescription.bind(this),true);this.addButton=new StyledElements.StyledButton({'text':StyledElements.Utils.gettext('Add')});this.addButton.addEventListener('click',function(){var prefix,suffix,parameter,start,input;input=this.inputElement.inputElement;start=input.selectionStart;prefix=input.value.substr(0,start);suffix=input.value.substr(input.selectionEnd);parameter=this.mainSelect.value+'.'+this.secondSelect.value;this.inputElement.setValue(prefix+'%('+parameter+')'+suffix);input.selectionStart=start;input.selectionEnd=start+parameter.length+3;}.bind(this));this.selectorWrapperElement.appendChild(this.addButton);this.descriptionDiv=document.createElement('div');this.descriptionDiv.className='description';this.wrapperElement.appendChild(this.descriptionDiv);this.inputElement=new StyledElements.StyledTextArea();this.wrapperElement.appendChild(this.inputElement);this._updateSecondSelect();}
ParametrizedTextInputInterface.prototype=new StyledElements.InputInterface();ParametrizedTextInputInterface.prototype._ESCAPE_RE=new RegExp("(%+)(\\([a-zA-Z]\\w*(?:\\.[a-zA-Z]\\w*)*\\))");ParametrizedTextInputInterface.prototype._ESCAPE_FUNC=function(){var str,i;i=arguments[1].length*2;str='';while((i-=1)>=0){str+='%';}
return str+arguments[2];};ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS=null;ParametrizedTextInputInterface.prototype.getAvailableParameters=function getAvailableParameters(){var concepts,contextFields,conceptName,dashIndex,provider,concept,parameters,label;if(ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS===null){concepts=Wirecloud.activeWorkspace.contextManager._concepts;contextFields={'':[]};for(conceptName in concepts){concept=concepts[conceptName];dashIndex=conceptName.indexOf('-');provider=conceptName.substring(0,dashIndex);if(!(provider in contextFields)){contextFields[provider]=[];}
label=interpolate('%(label)s (%(concept)s)',{label:concept._label,concept:conceptName},true);contextFields[provider].push({label:label,description:concept._description,value:conceptName});}
parameters=[{label:StyledElements.Utils.gettext('User'),value:'user',fields:[{label:StyledElements.Utils.gettext('User Name'),description:'',value:'username'},{label:StyledElements.Utils.gettext('First Name'),description:'',value:'first_name'},{label:StyledElements.Utils.gettext('Last Name'),description:'',value:'last_name'}]},{label:StyledElements.Utils.gettext('Context'),value:'context',fields:contextFields['']}];delete contextFields[''];for(conceptName in contextFields){parameters.push({label:conceptName,value:'context',fields:contextFields[conceptName]});}
ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS=parameters;}
return ParametrizedTextInputInterface.prototype._CONTEXT_PARAMS;};ParametrizedTextInputInterface.prototype.escapeValue=function escapeValue(value){switch(typeof value){case"number":case"boolean":value=value.toString();break;default:if(value==null){value="";}}
return value.replace(ParametrizedTextInputInterface.prototype._ESCAPE_RE,ParametrizedTextInputInterface.prototype._ESCAPE_FUNC);};ParametrizedTextInputInterface.prototype._updateSecondSelect=function _updateSecondSelect(){var fields,field,i;this.secondSelect.innerHTML='';fields=this.parameters[this.mainSelect.selectedIndex].fields;for(i=0;i<fields.length;i+=1){field=fields[i];try{this.secondSelect.add(new Option(field.label,field.value),null);}catch(e){this.secondSelect.add(new Option(field.label,field.value));}}
this._updateDescription();};ParametrizedTextInputInterface.prototype._updateDescription=function _updateDescription(){var fields,field;fields=this.parameters[this.mainSelect.selectedIndex].fields;field=fields[this.secondSelect.selectedIndex];this.descriptionDiv.textContent=field.description;};ParametrizedTextInputInterface.prototype._setError=function _setError(){};ParametrizedTextInputInterface.prototype._setValue=function _setValue(newValue){this.inputElement.value=newValue;if(this.update){this.update();}};ParametrizedTextInputInterface.prototype.setDisabled=function setDisabled(disabled){this.mainSelect.disabled=!!disabled;this.secondSelect.disabled=!!disabled;this.addButton.setDisabled(disabled);this.resetButton.setDisabled(disabled);this.inputElement.setDisabled(disabled);};ParametrizedTextInputInterface.prototype.insertInto=function insertInto(element){this.wrapperElement.insertInto(element);};(function(){"use strict";var VALID_SOURCE_VALUES=['current','default','custom'];var VALID_STATUS_VALUES=['normal','hidden','readonly'];var updateInputElement=function updateInputElement(){switch(this.source){case'default':this.inputElement.setValue('');break;case'current':this.inputElement.setValue(ParametrizedTextInputInterface.prototype.escapeValue(this.variable.value));break;case'custom':this.inputElement.setValue(this.value);}};var updateButton=function updateButton(){if(this.source==='default'){this.buttonElement.setLabel(gettext('Parametrize'));}else{this.buttonElement.setLabel(gettext('Modify'));}
if(this.status!=='normal'){this.readOnlyIcon.classList.add('readOnly');this.readOnlyIcon.title=gettext("This value won't be editable by the user");}else{this.readOnlyIcon.classList.remove('readOnly');this.readOnlyIcon.title=gettext("This value will be editable by the user");}
if(this.status!=='hidden'){this.visibilityIcon.classList.add('visible');this.visibilityIcon.title=gettext("This value will be visible to the user");}else{this.visibilityIcon.classList.remove('visible');this.visibilityIcon.title=gettext("This value won't be visible to the user");}};var ParametrizableValueInputInterface=function ParametrizableValueInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.parentWindow=options.parentWindow;this.variable=options.variable;this.canBeHidden=options.canBeHidden;this.wrapperElement=document.createElement('div');this.wrapperElement.className="parametrizable_input";this.readOnlyIcon=document.createElement('div');this.readOnlyIcon.className='readOnlyIcon';this.wrapperElement.appendChild(this.readOnlyIcon);this.visibilityIcon=document.createElement('div');this.visibilityIcon.className='visibilityIcon';this.wrapperElement.appendChild(this.visibilityIcon);if(!this.canBeHidden){this.visibilityIcon.style.visibility='hidden';}
this.inputElement=new StyledElements.StyledTextField();this.inputElement.disable();this.inputElement.insertInto(this.wrapperElement);this.buttonElement=new StyledElements.StyledButton({text:''});this.buttonElement.addEventListener('click',function(){var dialog=new Wirecloud.ui.ParametrizeWindowMenu(this);dialog.show(this.parentWindow);dialog.setValue(this.getValue());}.bind(this));this.buttonElement.insertInto(this.wrapperElement);};ParametrizableValueInputInterface.prototype=new StyledElements.InputInterface();ParametrizableValueInputInterface.prototype._checkValue=function _checkValue(newValue){return InputValidationError.NO_ERROR;};ParametrizableValueInputInterface.prototype.getValue=function getValue(){var value={'source':this.source,'status':this.status};if(this.source!=='default'){value.value=this.inputElement.getValue();}
return value;};ParametrizableValueInputInterface.prototype._setValue=function _setValue(newValue){if(newValue==null||VALID_SOURCE_VALUES.indexOf(newValue.source)===-1){this.source='current';}else{this.source=newValue.source;}
if(newValue==null||typeof newValue.value!=='string'){this.value='';}else{this.value=newValue.value;}
if(newValue==null||VALID_STATUS_VALUES.indexOf(newValue.status)===-1){this.status='normal';}else if(!this.canBeHidden&&newValue.status==='hidden'){this.status='readOnly';}else{this.status=newValue.status;}
updateInputElement.call(this);updateButton.call(this);};ParametrizableValueInputInterface.prototype.insertInto=function insertInto(element){element.appendChild(this.wrapperElement);};Wirecloud.ui.ParametrizableValueInputInterface=ParametrizableValueInputInterface;})();(function(){"use strict";var LAYOUT_FIELDS_MAPPING={'columnlayout':[{"name":"smart","defaultValue":true,"label":gettext("Smart"),"type":"boolean","description":gettext("Widgets will tend to be placed on the topmost position available if this option is enabled. (default: enabled)")},{"name":"columns","min":1,"max":200,"defaultValue":20,"label":gettext("Columns"),"type":"number","description":gettext("Grid columns. (default: 20 columns)")},{"name":"cellheight","min":7,"max":1024,"defaultValue":13,"label":gettext("Row Height (in pixels)"),"type":"number","description":gettext("Row/cell height. Must be specified in pixel units. (default: 13px)")},{"name":"horizontalmargin","min":0,"defaultValue":4,"label":gettext("Horizontal Margin between widgets (in pixels)"),"type":"number","description":gettext("Horizontal Margin between widgets. Must be specified in pixel units. (default: 4px)")},{"name":"verticalmargin","min":0,"defaultValue":3,"label":gettext("Vertical Margin between widgets (in pixels)"),"type":"number","description":gettext("Vertical margin between widgets. Must be specified in pixel units. (default: 3px)")}],'gridlayout':[{"name":"columns","min":1,"max":200,"defaultValue":20,"label":gettext("Columns"),"type":"number","description":gettext("Grid columns. (default: 12 columns)")},{"name":"rows","min":1,"max":200,"defaultValue":6,"label":gettext("Rows"),"type":"number","description":gettext("Grid rows (default: 6 rows)")},{"name":"horizontalmargin","min":0,"defaultValue":4,"label":gettext("Horizontal Margin between widgets (in pixels)"),"type":"number","description":gettext("Horizontal Margin between widgets. Must be specified in pixel units. (default: 4px)")},{"name":"verticalmargin","min":0,"defaultValue":3,"label":gettext("Vertical Margin between widgets (in pixels)"),"type":"number","description":gettext("Vertical Margin between widgets. Must be specified in pixel units. (default: 3px)")}]};var updateLayoutSummary=function updateLayoutSummary(){var summary='',context=Wirecloud.Utils.clone(this.layout);switch(this.layout.type){case'columnlayout':if(context.smart){context.smart=' smart';}else{context.smart='';}
summary='%(columns)s%(smart)s columns';break;case'gridlayout':summary='%(columns)s columns x %(rows)s rows';break;}
summary=Wirecloud.Utils.interpolate(summary,context);this.summary_addon.setLabel(summary);};var LayoutInputInterface=function LayoutInputInterface(fieldId,options){StyledElements.InputInterface.call(this,fieldId,options);this.wrapperElement=new StyledElements.HorizontalLayout({'class':'se-layout-field input input-prepend input-append'});this.selectElement=new StyledElements.StyledSelect({name:options.name+'-type',initialEntries:[{"value":"columnlayout","label":gettext("Columns")},{"value":"gridlayout","label":gettext("Grid")}]});this.selectElement.addEventListener('change',function(select){this.layout=Wirecloud.Utils.clone(this.layout);this.layout.type=select.getValue();var fields=LAYOUT_FIELDS_MAPPING[this.layout.type];for(var i=0;i<fields.length;i++){if(!(fields[i].name in this.layout)){this.layout[fields[i].name]=fields[i].defaultValue;}}
updateLayoutSummary.call(this);}.bind(this));this.wrapperElement.getWestContainer().appendChild(this.selectElement);this.summary_addon=new StyledElements.Addon();this.wrapperElement.getCenterContainer().appendChild(this.summary_addon);this.buttonElement=new StyledElements.StyledButton({iconClass:'icon-cogs'});this.buttonElement.addEventListener('click',function(){var fields=LAYOUT_FIELDS_MAPPING[this.layout.type];var dialog=new Wirecloud.ui.FormWindowMenu(fields,gettext('Layout configuration'),'layout_settings');dialog.executeOperation=function(data){this.layout=Wirecloud.Utils.clone(this.layout);Wirecloud.Utils.merge(this.layout,data);updateLayoutSummary.call(this);}.bind(this);dialog.show(Wirecloud.UserInterfaceManager.currentWindowMenu);dialog.setValue(this.layout);}.bind(this));this.wrapperElement.getEastContainer().appendChild(this.buttonElement);};LayoutInputInterface.prototype=new StyledElements.InputInterface();LayoutInputInterface.parse=function parse(value){return JSON.parse(value);};LayoutInputInterface.stringify=function stringify(value){return JSON.stringify(value);};LayoutInputInterface.prototype._checkValue=function _checkValue(newValue){return InputValidationError.NO_ERROR;};LayoutInputInterface.prototype.getValue=function getValue(){return this.layout;};LayoutInputInterface.prototype.setDisabled=function setDisabled(disabled){this.selectElement.setDisabled(disabled);this.summary_addon.setDisabled(disabled);this.buttonElement.setDisabled(disabled);};LayoutInputInterface.prototype.repaint=function epaint(){this.wrapperElement.repaint();};LayoutInputInterface.prototype._setValue=function _setValue(newValue){this.layout=newValue;this.selectElement.setValue(this.layout.type);updateLayoutSummary.call(this);};LayoutInputInterface.prototype._setError=function _setError(error){};LayoutInputInterface.prototype.insertInto=function insertInto(element){this.wrapperElement.insertInto(element);this.wrapperElement.repaint();};Wirecloud.ui.LayoutInputInterface=LayoutInputInterface;})();(function(){"use strict";var VERSION_RE=/^([1-9]\d*|0)(?:\.([1-9]\d*|0))*$/;var VersionInputInterface=function VersionInputInterface(fieldId,options){if(options==null){options={};}
if(options.placeholder==null){options.placeholder='1.0';}
TextInputInterface.call(this,fieldId,options);};VersionInputInterface.prototype=new TextInputInterface();VersionInputInterface.prototype._checkValue=function _checkValue(newValue){if(newValue.match(VERSION_RE)!=null){return InputValidationError.NO_ERROR;}else{return InputValidationError.VERSION_ERROR;}};StyledElements.VersionInputInterface=VersionInputInterface;})();(function(){"use strict";var default_mapping={'boolean':BooleanInputInterface,'text':TextInputInterface,'version':StyledElements.VersionInputInterface,'password':PasswordInputInterface,'hidden':HiddenInputInterface,'list':ListInputInterface,'number':NumberInputInterface,'longtext':LongTextInputInterface,'url':URLInputInterface,'email':EMailInputInterface,'select':SelectInputInterface,'buttons':ButtonGroupInputInterface,'file':FileInputInterface,'fieldset':FieldSetInterface,'multivalued':MultivaluedInputInterface};var InputInterfaceFactory=function InputInterfaceFactory(){var mapping=StyledElements.Utils.clone(default_mapping);this.createInterface=function createInterface(fieldId,fieldDesc){var Class_=mapping[fieldDesc.type];if(Class_==null){throw new Error(fieldDesc.type);}
var instance=new Class_(fieldId,fieldDesc,this);if(fieldDesc.initiallyDisabled){instance.disable();}
return instance;};this.addFieldType=function addFieldType(type,class_){if(!class_ instanceof StyledElements.InputInterface){throw new TypeError();}
if(mapping[type]!==undefined){throw new Error();}
mapping[type]=class_;};this.parse=function parse(type,value){if(mapping[type]==null){throw new TypeError('Invalid data type');}
return mapping[type].parse(value);};this.stringify=function stringify(type,value){if(mapping[type]==null){throw new TypeError('Invalid data type');}
return mapping[type].stringify(value);};};StyledElements.InputInterfaceFactory=InputInterfaceFactory;})();(function(){"use strict";StyledElements.DefaultInputInterfaceFactory=new StyledElements.InputInterfaceFactory();})();(function(){"use strict";var Form=function Form(fields,options){var div,buttonArea,defaultOptions;defaultOptions={'readOnly':false,'buttonArea':null,'setdefaultsButton':false,'resetButton':false,'acceptButton':true,'cancelButton':true,'useHtmlForm':true,'legend':'auto','edition':false,'factory':StyledElements.DefaultInputInterfaceFactory};if(options&&options.readOnly){defaultOptions.acceptButton=false;defaultOptions.cancelButton=false;}
options=StyledElements.Utils.merge(defaultOptions,options);this.setdefaultsButton=null;if(options.setdefaultsButton instanceof StyledElements.StyledButton){this.setdefaultsButton=options.setdefaultsButton;}else if(options.setdefaultsButton===true){this.setdefaultsButton=new StyledElements.StyledButton({usedInForm:options.useHtmlForm,text:StyledElements.Utils.gettext('Set Defaults')});}
this.resetButton=null;if(options.resetButton instanceof StyledElements.StyledButton){this.resetButton=options.resetButton;}else if(options.resetButton===true){this.resetButton=new StyledElements.StyledButton({usedInForm:options.useHtmlForm,text:StyledElements.Utils.gettext('Reset')});}
this.acceptButton=null;if(options.acceptButton instanceof StyledElements.StyledButton){this.acceptButton=options.acceptButton;}else if(options.acceptButton===true){this.acceptButton=new StyledElements.StyledButton({'usedInForm':options.useHtmlForm,'class':'btn-primary','text':StyledElements.Utils.gettext('Accept')});}
this.cancelButton=null;if(options.cancelButton instanceof StyledElements.StyledButton){this.cancelButton=options.cancelButton;}else if(options.cancelButton===true){this.cancelButton=new StyledElements.StyledButton({usedInForm:options.useHtmlForm,text:StyledElements.Utils.gettext('Cancel')});}
StyledElements.StyledElement.call(this,['submit','cancel']);this.childComponents=[];this.readOnly=options.readOnly;this.fields={};this.fieldInterfaces={};this.edition=options.edition;this.factory=options.factory;div=document.createElement('div');if(options.useHtmlForm){this.wrapperElement=document.createElement('form');this.wrapperElement.addEventListener('submit',function(e){e.preventDefault();},true);this.wrapperElement.appendChild(div);}else{this.wrapperElement=div;}
div.appendChild(this.pBuildFieldTable(fields));this.wrapperElement.className="styled_form";this.msgElement=document.createElement('div');this.msgElement.className='alert alert-error';div.appendChild(this.msgElement);this.pSetMsgs([]);if(options.buttonArea!=null){buttonArea=options.buttonArea;}else if(options.acceptButton!==false||options.cancelButton!==false){buttonArea=document.createElement('div');buttonArea.className='buttons';div.appendChild(buttonArea);}
if(this.setdefaultsButton!=null){this.setdefaultsButton.addEventListener("click",this.defaults.bind(this));this.setdefaultsButton.insertInto(buttonArea);}
if(this.resetButton!=null){this.resetButton.addEventListener("click",this.reset.bind(this));this.resetButton.insertInto(buttonArea);}
if(this.acceptButton!=null){this.acceptButton.addEventListener("click",acceptHandler.bind(this));this.acceptButton.insertInto(buttonArea);}
if(this.cancelButton!=null){this.cancelButton.addEventListener("click",cancelHandler.bind(this));this.cancelButton.insertInto(buttonArea);}};Form.prototype=new StyledElements.StyledElement();Form.prototype.repaint=function repaint(temporal){var i;for(i=0;i<this.childComponents.length;i+=1){this.childComponents[i].repaint(temporal);}
for(i in this.fieldInterfaces){this.fieldInterfaces[i].repaint();}};Form.prototype.pSetMsgs=function(msgs){var i,wrapper;this.msgElement.innerHTML='';if(msgs.length>0){for(i=0;i<msgs.length;i+=1){wrapper=document.createElement('p');wrapper.textContent=msgs[i];this.msgElement.appendChild(wrapper);}
this.msgElement.style.display='';}else{this.msgElement.style.display='none';}};Form.prototype.pBuildFieldGroups=function(fields){var notebook,i,field,tab,tmp_field,tmp_input;notebook=new StyledElements.StyledNotebook();this.childComponents.push(notebook);for(i=0;i<fields.length;i+=1){field=fields[i];tab=notebook.createTab({name:field.shortTitle,closable:false});if(field.nested===true){tmp_field={'name':field.name,'type':'fieldset','fields':field.fields};tmp_input=this.factory.createInterface(field.name,tmp_field);tmp_input.assignDefaultButton(this.acceptButton);this.fieldInterfaces[field.name]=tmp_input;this.fields[field.name]=tmp_field;tab.appendChild(tmp_input);}else{tab.appendChild(this.pBuildFieldTable(field.fields));}}
return notebook.wrapperElement;};Form.prototype.pBuildFieldTable=function(fields){var table,tbody,fieldId,field,row,cell;if(fields[0]&&fields[0].type==='group'){return this.pBuildFieldGroups(fields);}
table=document.createElement('table');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');tbody=document.createElement('tbody');table.appendChild(tbody);for(fieldId in fields){if(fields.hasOwnProperty(fieldId)){field=fields[fieldId];if('name'in field){fieldId=field.name;}
row=tbody.insertRow(-1);switch(field.type){case'columnLayout':cell=row.insertCell(-1);cell.setAttribute('colspan',2);this.pInsertColumnLayout(field,cell);break;case'lineLayout':cell=row.insertCell(-1);cell.setAttribute('colspan',2);this.pInsertLineLayout(field,cell);break;case'hidden':row.className="hidden";this.pInsertField(fieldId,field,row);break;default:this.pInsertField(fieldId,field,row);}}}
return table;};Form.prototype.pInsertColumnLayout=function(desc,wrapper){var table,tbody,row,cell,i;table=document.createElement('table');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');tbody=document.createElement('tbody');table.appendChild(tbody);row=tbody.insertRow(-1);for(i=0;i<desc.columns.length;i+=1){cell=row.insertCell(-1);cell.appendChild(this.pBuildFieldTable(desc.columns[i]));}
wrapper.appendChild(table);};Form.prototype.pInsertLineLayout=function(desc,wrapper){var field,fieldId,inputInterface,wrapperElement;for(fieldId in desc.fields){if(desc.fields.hasOwnProperty(fieldId)){field=desc.fields[fieldId];inputInterface=this.factory.createInterface(fieldId,field);inputInterface.assignDefaultButton(this.acceptButton);inputInterface.insertInto(wrapper);wrapperElement=null;if(inputInterface.wrapperElement&&inputInterface.wrapperElement.wrapperElement){wrapperElement=inputInterface.wrapperElement.wrapperElement;}else if(inputInterface.inputElement&&inputInterface.inputElement.wrapperElement){wrapperElement=inputInterface.inputElement.wrapperElement;}
if(wrapperElement){wrapperElement.style.display='inline-block';wrapperElement.style.verticalAlign='middle';}
this.fieldInterfaces[fieldId]=inputInterface;this.fields[fieldId]=field;}}};Form.prototype.pInsertField=function(fieldId,field,row){var separator,hr,labelRow,labelCell,label,requiredMark,inputCell,inputInterface;if(field.type==='separator'){separator=row.insertCell(-1);separator.setAttribute('colspan','2');hr=document.createElement('hr');separator.appendChild(hr);return;}
if(field.type==='label'){labelRow=row.insertCell(-1);labelRow.setAttribute('colspan','2');labelRow.addClassName('label-row');if(field.url){label=document.createElement('a');label.setAttribute("href",field.url);label.setAttribute("target","_blank");}else{label=document.createElement('label');}
label.appendChild(document.createTextNode(field.label));labelRow.appendChild(label);return;}
labelCell=row.insertCell(-1);labelCell.classList.add('label-cell');label=document.createElement('label');label.textContent=field.label;labelCell.appendChild(label);if(field.description!=null){label.setAttribute('title',field.description);}
if(field.required&&!this.readOnly){requiredMark=document.createElement('span');requiredMark.appendChild(document.createTextNode('*'));requiredMark.className='required_mark';labelCell.appendChild(requiredMark);}
inputCell=document.createElement('td');row.appendChild(inputCell);inputInterface=this.factory.createInterface(fieldId,field);inputInterface.assignDefaultButton(this.acceptButton);inputInterface.insertInto(inputCell);if(this.readOnly||inputInterface._readOnly){inputInterface.setDisabled(true);}
this.fieldInterfaces[fieldId]=inputInterface;this.fields[fieldId]=field;};Form.prototype.extraValidation=function(fields){return[];};Form.prototype.getData=function getData(){var data,fieldId,field;data={};for(fieldId in this.fieldInterfaces){if(this.fieldInterfaces.hasOwnProperty(fieldId)){field=this.fieldInterfaces[fieldId];data[fieldId]=field.getValue();}}
return data;};Form.prototype.setData=function setData(data){var field,fieldId;if(typeof data!=='object'&&typeof data!=='undefined'){throw new TypeError();}
this.pSetMsgs([]);if(data!=null){for(fieldId in this.fieldInterfaces){field=this.fieldInterfaces[fieldId];field._setValue(data[fieldId]);}}else{for(fieldId in this.fields){field=this.fieldInterfaces[fieldId];field.reset();}}};Form.prototype.is_valid=function(){var fieldId,extraErrorMsgs,errorMsgs,validationManager=new ValidationErrorManager();for(fieldId in this.fieldInterfaces){if(this.fieldInterfaces.hasOwnProperty(fieldId)){validationManager.validate(this.fieldInterfaces[fieldId]);}}
extraErrorMsgs=this.extraValidation(this.fields);errorMsgs=validationManager.toHTML();if(extraErrorMsgs!==null){errorMsgs=errorMsgs.concat(extraErrorMsgs);}
this.pSetMsgs(errorMsgs);return errorMsgs.length===0;};var acceptHandler=function acceptHandler(){if(this.is_valid()){var data=this.getData();this.events.submit.dispatch(this,data);}};var cancelHandler=function cancelHandler(){this.events.cancel.dispatch(this);};Form.prototype.reset=function reset(){this.setData();return this;};Form.prototype.defaults=function defaults(){var field,fieldId;this.pSetMsgs([]);for(fieldId in this.fields){field=this.fieldInterfaces[fieldId];field.setValue(field._defaultValue);}
return this;};Form.prototype.normalSubmit=function(method,url,options){options=options?options:{};this.wrapperElement.method=method;this.wrapperElement.action=url;if(options.enctype){this.wrapperElement.setAttribute('enctype',options.enctype);}else{this.wrapperElement.removeAttribute('enctype');}
if(options.target){this.wrapperElement.setAttribute('target',options.target);}else{this.wrapperElement.removeAttribute('target');}
this.wrapperElement.submit();};Form.prototype.destroy=function destroy(){var i=0;for(i=0;i<this.childComponents.length;i+=1){this.childComponents[i].destroy();}
this.childComponents=null;if(this.setdefaultsButton){this.setdefaultsButton.destroy();this.setdefaultsButton=null;}
if(this.resetButton){this.resetButton.destroy();this.resetButton=null;}
if(this.acceptButton){this.acceptButton.destroy();this.acceptButton=null;}
if(this.cancelButton){this.cancelButton.destroy();this.cancelButton=null;}};Form.prototype.setDisabled=function setDisabled(disabled){var fieldId,inputInterface;if(this.enabled!=disabled){return;}
if(disabled){this.wrapperElement.classList.add('disabled');}else{this.wrapperElement.classList.remove('disabled');}
for(fieldId in this.fieldInterfaces){inputInterface=this.fieldInterfaces[fieldId];inputInterface.setDisabled(disabled||this.readOnly||inputInterface._readOnly);}
if(this.acceptButton!=null){this.acceptButton.setDisabled(disabled);}
if(this.cancelButton!=null){this.cancelButton.setDisabled(disabled);}
this.enabled=!disabled;};Form.prototype.enable=function enable(){this.setDisabled(false);};Form.prototype.disable=function disable(){this.setDisabled(true);};Form.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledElement.prototype.insertInto.call(this,element,refElement);this.repaint();};window.Form=Form;})();(function(){"use strict";var builder,onPaginationChanged,onPageChange,updateButtons,updateLayout,PaginationInterface;builder=new StyledElements.GUIBuilder();onPaginationChanged=function onPaginationChanged(pagination){if(this.autoHide&&this.pagination.totalPages===1){this.wrapperElement.style.display='none';}else{this.wrapperElement.style.display='';}
this.totalPagesLabel.textContent=this.pagination.totalPages;this.currentPageLabel.textContent=this.pagination.currentPage;updateButtons.call(this);};onPageChange=function onPageChange(){this.currentPageLabel.textContent=this.currentPage+1;updateButtons.call(this);};updateButtons=function updateButton(){if(this.pagination.currentPage<=1){this.prevBtn.disable();this.firstBtn.disable();}else{this.prevBtn.enable();this.firstBtn.enable();}
if(this.pagination.currentPage>=this.pagination.totalPages){this.nextBtn.disable();this.lastBtn.disable();}else{this.nextBtn.enable();this.lastBtn.enable();}};updateLayout=function updateLayout(pattern){var elements={'firstBtn':this.firstBtn,'prevBtn':this.prevBtn,'nextBtn':this.nextBtn,'lastBtn':this.lastBtn,'currentPage':this.currentPageLabel,'totalPages':this.totalPagesLabel};var contents=builder.parse(pattern,elements);this.wrapperContainer.appendChild(contents);};PaginationInterface=function PaginationInterface(pagination,options){var defaultOptions={'layout':'<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><t:firstBtn/><t:prevBtn/><div class="box">Page: <t:currentPage/>/<t:totalPages/></div><t:nextBtn/><t:lastBtn/></s:styledgui>','autoHide':false};options=StyledElements.Utils.merge(defaultOptions,options);this.autoHide=options.autoHide;StyledElements.StyledElement.call(this,[]);this.pagination=pagination;this.wrapperContainer=new StyledElements.Container();this.wrapperContainer.addClassName('pagination');this.wrapperElement=this.wrapperContainer.wrapperElement;this.firstBtn=new StyledElements.StyledButton({'iconClass':'icon-first-page'});this.firstBtn.addEventListener('click',pagination.goToFirst.bind(pagination));this.prevBtn=new StyledElements.StyledButton({'iconClass':'icon-prev-page'});this.prevBtn.addEventListener('click',pagination.goToPrevious.bind(pagination));this.nextBtn=new StyledElements.StyledButton({'iconClass':'icon-next-page'});this.nextBtn.addEventListener('click',pagination.goToNext.bind(pagination));this.lastBtn=new StyledElements.StyledButton({'iconClass':'icon-last-page'});this.lastBtn.addEventListener('click',pagination.goToLast.bind(pagination));this.currentPageLabel=document.createElement('span');this.currentPageLabel.classList.add('current-page');this.totalPagesLabel=document.createElement('span');this.totalPagesLabel.classList.add('total-pages');updateLayout.call(this,options.layout);this.currentPageLabel.textContent=this.currentPage+1;this.totalPagesLabel.textContent=this.totalPages;updateButtons.call(this);this.pagination.addEventListener('requestEnd',onPaginationChanged.bind(this));};PaginationInterface.prototype=new StyledElements.StyledElement();PaginationInterface.prototype.changeLayout=function changeLayout(newLayout){updateLayout.call(this,newLayout);};StyledElements.PaginationInterface=PaginationInterface;})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="popover fade"><div class="arrow"/><h3 class="popover-title"><t:title/></h3><div class="popover-content"><t:content/></div></div></s:styledgui>';var disableCallback=function disableCallback(e){if(e.button!==0){return;}
setTimeout(this.hide.bind(this),0);};var setPosition=function setPosition(refPosition,position){this.element.classList.remove('top','right','bottom','left');switch(position){case'top':this.element.classList.add('top');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=(refPosition.top-this.element.offsetHeight)+"px";break;case'right':this.element.classList.add('right');this.element.style.left=refPosition.right+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;case'bottom':this.element.classList.add('bottom');this.element.style.left=(refPosition.left+(refPosition.width-this.element.offsetWidth)/2)+"px";this.element.style.top=refPosition.bottom+"px";break;case'left':this.element.classList.add('left');this.element.style.left=(refPosition.left-this.element.offsetWidth)+"px";this.element.style.top=(refPosition.top+(refPosition.height-this.element.offsetHeight)/2)+"px";break;}};var standsOut=function standsOut(){var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setPosition.call(this,refPosition,position);var parent_box=this.element.parentElement.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();if(element_box.bottom>parent_box.bottom){this.element.style.top="";this.element.style.bottom="10px";element_box=this.element.getBoundingClientRect();}
if(element_box.top<parent_box.top){this.element.style.top="10px";}};var searchBestPosition=function(refPosition,positions){var i=0,weights=[];do{setPosition.call(this,refPosition,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,refPosition,weights,positions);}};var _show=function _show(refPosition){Wirecloud.UserInterfaceManager._registerPopup(this);if(this.visible){this.repaint();return;}
if('getBoundingClientRect'in refPosition){refPosition=refPosition.getBoundingClientRect();}
this.element=builder.parse(template,{title:this.options.title,content:this.options.content}).elements[0];document.body.appendChild(this.element);document.addEventListener("click",this._disableCallback,true);searchBestPosition.call(this,refPosition,this.options.placement);this.element.classList.add('in');};var Popover=function Popover(options){var defaultOptions={'content':'','title':'','class':'','html':false,'placement':['right','bottom','left','top']};Object.defineProperty(this,'options',{value:StyledElements.Utils.merge(defaultOptions,options)});StyledElements.StyledElement.call(this,[]);Object.defineProperties(this,{visible:{get:function(){return this.element!=null;}},_disableCallback:{value:disableCallback.bind(this),enumerable:false},_show:{value:_show.bind(this),enumerable:false}});};Popover.prototype=new StyledElements.StyledElement();Popover.prototype.bind=function bind(element,mode){switch(mode){case"click":element.addEventListener('click',this.toggle.bind(this),true);break;case"hover":break;default:throw new TypeError('Invalid mode: '+mode);}};Popover.prototype.toggle=function toggle(refElement){if(this.visible){this.hide();}else{this._show(refElement);}};Popover.prototype.show=function show(refElement){this._show(refElement);};var _hide=function _hide(){if(this.element!=null){document.body.removeChild(this.element);this.element=null;Wirecloud.UserInterfaceManager._unregisterPopup(this);}};Popover.prototype.hide=function hide(){if(!this.visible){return;}
document.removeEventListener('click',this._disableCallback,true);if(this.element.classList.contains('in')){this.element.addEventListener('transitionend',_hide.bind(this));this.element.classList.remove('in');}else{_hide.call(this);}};StyledElements.Popover=Popover;})();(function(){"use strict";var onSuccessSavePreferences=function onSuccessSavePreferences(){this.preferences.events['post-commit'].dispatch(this.preferences,this.modifiedValues);};var onErrorSavePreferences=function onErrorSavePreferences(){};var persist=function persist(modifiedValues){var context={preferences:this,modifiedValues:modifiedValues};Wirecloud.io.makeRequest(this._build_save_url(),{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(modifiedValues),onSuccess:onSuccessSavePreferences.bind(context),onFailure:onErrorSavePreferences.bind(context)});};var Preferences=function Preferences(preferencesDef,values){if(arguments.length===0){return;}
Object.defineProperty(this,'meta',{value:preferencesDef});Object.defineProperty(this,'preferences',{value:{}});var inherit,value,definition;for(var key in preferencesDef.preferences){definition=preferencesDef.preferences[key];if(key in values){inherit=values[definition.name].inherit;value=values[key].value;}else{value=null;inherit=definition.inheritByDefault;}
this.preferences[definition.name]=new Wirecloud.PlatformPref(this,definition,inherit,value);}
this._handleParentChanges=this._handleParentChanges.bind(this);StyledElements.ObjectWithEvents.call(this,['pre-commit','post-commit']);};Preferences.prototype=new StyledElements.ObjectWithEvents();Preferences.prototype.get=function get(name){return this.preferences[name].getEffectiveValue();};Preferences.prototype.set=function set(newValues){var newEffectiveValues={};var modifiedValues={};for(var name in newValues){var preference=this.preferences[name];var changes=newValues[name];if('inherit'in changes){preference.inherit=changes.inherit;}
if('value'in changes){preference.value=changes.value;changes.value=Wirecloud.ui.InputInterfaceFactory.stringify(preference.meta.options.type,preference.value);}
modifiedValues[name]=changes;newEffectiveValues[name]=preference.getEffectiveValue();}
this.events['pre-commit'].dispatch(this,newEffectiveValues);persist.call(this,modifiedValues);};Preferences.prototype._handleParentChanges=function _handleParentChanges(parentPreferences,modifiedValues){var valuesToPropagate={};var propagate=false;for(var preferenceName in modifiedValues){if(preferenceName in this.preferences&&this.preferences[preferenceName].inherit){propagate=true;valuesToPropagate[preferenceName]=modifiedValues[preferenceName];}}
if(propagate){this.events['pre-commit'].dispatch(this,valuesToPropagate);}};Preferences.prototype.destroy=function destroy(){};Wirecloud.Preferences=Preferences;})();(function(){"use strict";var PlatformPreferences=function PlatformPreferences(definitions,values){Wirecloud.Preferences.call(this,definitions,values);};PlatformPreferences.prototype=new Wirecloud.Preferences();PlatformPreferences.prototype.buildTitle=function buildTitle(){return gettext("Platform Preferences");};PlatformPreferences.prototype._build_save_url=function _build_save_url(){return Wirecloud.URLs.PLATFORM_PREFERENCES;};Wirecloud.PlatformPreferences=PlatformPreferences;})();(function(){"use strict";var PreferenceManager=function PreferenceManager(){this.preferencesDef={};var definitions,i;var platformPreferences=[{"name":"language","label":gettext('Language'),"type":"select","initialEntries":[{value:'default',label:gettext('Default setting')},{value:'browser',label:gettext('Browser detect')}]}];for(i=0;i<Wirecloud.constants.AVAILABLE_LANGUAGES.length;i+=1){platformPreferences[0].initialEntries.push(Wirecloud.constants.AVAILABLE_LANGUAGES[i]);}
definitions=this.processDefinitions(platformPreferences);this.preferencesDef.platform=[Wirecloud.PlatformPreferencesDef,definitions];definitions=this.processDefinitions(Wirecloud.constants.WORKSPACE_PREFERENCES);this.preferencesDef.workspace=[Wirecloud.WorkspacePreferencesDef,definitions];definitions=this.processDefinitions(Wirecloud.constants.TAB_PREFERENCES);this.preferencesDef.tab=[Wirecloud.TabPreferencesDef,definitions];};PreferenceManager.prototype.processDefinitions=function processDefinitions(preferences){var i,preference_data,preferenceDef,definitions={};for(i=0;i<preferences.length;i++){preference_data=preferences[i];preferenceDef=new Wirecloud.PreferenceDef(preference_data.name,preference_data.inheritable,preference_data.inheritByDefault,preference_data.hidden,preference_data);definitions[preference_data.name]=preferenceDef;}
return definitions;};PreferenceManager.prototype.buildPreferences=function buildPreferences(scope,values){var args=Array.prototype.slice.call(arguments,1);if(!(scope in this.preferencesDef)){throw new TypeError();}
var manager=new(this.preferencesDef[scope][0])(this.preferencesDef[scope][1],args);return manager.buildPreferences.apply(manager,args);};Wirecloud.PreferenceManager=new PreferenceManager();})();(function(){"use strict";var WorkspacePreferences=function WorkspacePreferences(definitions,workspace,values){Wirecloud.Preferences.call(this,definitions,values);this._workspace=workspace;Wirecloud.preferences.addEventListener('pre-commit',this._handleParentChanges);};WorkspacePreferences.prototype=new Wirecloud.Preferences();WorkspacePreferences.prototype.buildTitle=function buildTitle(){var msg=gettext("Workspace preferences (%(workspaceName)s)");return interpolate(msg,{workspaceName:this._workspace.workspaceState.name},true);};WorkspacePreferences.prototype.getParentValue=function getParentValue(name){return Wirecloud.preferences.get(name);};WorkspacePreferences.prototype._build_save_url=function _build_save_url(){return Wirecloud.URLs.WORKSPACE_PREFERENCES.evaluate({workspace_id:this._workspace.workspaceState.id});};WorkspacePreferences.prototype.destroy=function destroy(){Wirecloud.preferences.removeEventListener('pre-commit',this._handleParentChanges);Wirecloud.Preferences.prototype.destroy.call(this);this._workspace=null;};Wirecloud.WorkspacePreferences=WorkspacePreferences;})();(function(){"use strict";var TabPreferences=function TabPreferences(definitions,tab,values){Wirecloud.Preferences.call(this,definitions,values);this._tab=tab;this._workspace=this._tab.workspace;this._workspace.preferences.addEventListener('pre-commit',this._handleParentChanges);};TabPreferences.prototype=new Wirecloud.Preferences();TabPreferences.prototype.buildTitle=function buildTitle(){var msg=gettext("Tab preferences (%(tabName)s)");return interpolate(msg,{tabName:this._tab.tabInfo.name},true);};TabPreferences.prototype.getParentValue=function getParentValue(name){return this._workspace.preferences.get(name);};TabPreferences.prototype._build_save_url=function _build_save_url(modifiedValues){return Wirecloud.URLs.TAB_PREFERENCES.evaluate({workspace_id:this._workspace.workspaceState.id,tab_id:this._tab.tabInfo.id});};TabPreferences.prototype.destroy=function destroy(){this._workspace.preferences.removeEventListener('pre-commit',this._handleParentChanges);Wirecloud.Preferences.prototype.destroy.call(this);this._workspace=null;this._tab=null;};Wirecloud.TabPreferences=TabPreferences;})();(function(){"use strict";var SubtaskMonitorModel=function SubtaskMonitorModel(title){this.title=title;this.progress=0;StyledElements.ObjectWithEvents.call(this,['progress']);};SubtaskMonitorModel.prototype=new StyledElements.ObjectWithEvents();SubtaskMonitorModel.prototype.updateTaskProgress=function updateTaskProgress(progress){if(progress<0){this.progress=0;}else if(progress>100){this.progress=100;}else{this.progress=progress;}
this.events.progress.dispatch(this,this.progress);};var updateGlobalTaskProgress=function updateGlobalTaskProgress(){var accumulated_progress=0;if(this.subtasks.length!==0){for(var i=0;i<this.subtasks.length;i+=1){accumulated_progress+=this.subtasks[i].progress;}
this.progress=accumulated_progress/this.subtasks.length;}else{this.progress=0;}
this.events.progress.dispatch(this,this.progress);};var TaskMonitorModel=function TaskMonitorModel(title,nsubtasks){this.title=title;this.subtasks=[];this.nsubtasks=nsubtasks;this.currentsubtask=-1;StyledElements.ObjectWithEvents.call(this,['progress']);};TaskMonitorModel.prototype=new StyledElements.ObjectWithEvents();TaskMonitorModel.prototype.nextSubtask=function nextSubtask(title){if(title){Wirecloud.GlobalLogManager.log(title,Wirecloud.constants.LOGGING.INFO_MSG);}
this.currentsubtask++;if(this.currentsubtask>=this.nsubtasks){this.nsubtasks=this.currentsubtask+1;}
var subtask=new SubtaskMonitorModel(title);this.subtasks.push(subtask);subtask.addEventListener('progress',updateGlobalTaskProgress.bind(this));updateGlobalTaskProgress.call(this);return subtask;};Wirecloud.TaskMonitorModel=TaskMonitorModel;})();(function(){"use strict";var PropertyCommiter=function PropertyCommiter(iwidget){Object.defineProperty(this,'iwidget',{value:iwidget});this.values={};this.pending_values=null;this.timeout=null;};PropertyCommiter.prototype.add=function add(name,value){if(this.pending_values==null){this.values[name]=value;if(this.timeout!=null){clearTimeout(this.timeout);}
this.timeout=setTimeout(this.commit.bind(this),1000);}else{this.pending_values[name]=value;}};PropertyCommiter.prototype.commit=function commit(){if(this.timeout!=null){clearTimeout(this.timeout);}
if(Object.keys(this.values).length===0){return;}
this.timeout=null;this.pending_values={};var url=Wirecloud.URLs.IWIDGET_PROPERTIES.evaluate({workspace_id:this.iwidget.workspace.id,tab_id:this.iwidget.tab.id,iwidget_id:this.iwidget.id});Wirecloud.io.makeRequest(url,{contentType:'application/json',postBody:JSON.stringify(this.values),onSuccess:function(){this.values=this.pending_values;if(Object.keys(this.values).length>0){this.timeout=setTimeout(this.commit.bind(this),1000);}
this.pending_values=null;}.bind(this),onFailure:function(){this.values=Wirecloud.Utils.merge(this.values,this.pending_values);this.timeout=setTimeout(this.commit.bind(this),30000);}.bind(this)});};Wirecloud.PropertyCommiter=PropertyCommiter;})();(function(){"use strict";var renameSuccess=function renameSuccess(options,old_name,new_name,response){this.name=new_name;this.contextManager.modify({title:new_name});var msg=gettext("Name changed from \"%(oldName)s\" to \"%(newName)s\" succesfully");msg=interpolate(msg,{oldName:old_name,newName:new_name},true);this.logManager.log(msg,Wirecloud.constants.LOGGING.INFO_MSG);this.events.name_changed.dispatch(new_name);if(options.onSuccess==='function'){try{options.onSuccess();}catch(e){}}};var renameFailure=function renameFailure(options,response){var msg=gettext("Error renaming iwidget from persistence: %(errorMsg)s.");msg=this.logManager.formatError(msg,response);this.log(msg);if(options.onFailure==='function'){try{options.onFailure(msg);}catch(e){}}};var removeSuccess=function removeSuccess(options,response){var msg=gettext("IWidget \"%(name)s\" removed from workspace succesfully");msg=interpolate(msg,{name:this.name},true);this.logManager.log(msg,Wirecloud.constants.LOGGING.INFO_MSG);this.events.removed.dispatch(this);if(options.onSuccess==='function'){try{options.onSuccess();}catch(e){}}
this.destroy();};var removeFailure=function removeFailure(options,response){var msg=gettext("Error removing iwidget from persistence: %(errorMsg)s.");msg=this.logManager.formatError(msg,response);this.logManager.log(msg);if(options.onFailure==='function'){try{options.onFailure(msg);}catch(e){}}};var IWidget=function IWidget(widget,tab,options){var key,i,preferences,iwidget_pref_info,properties,iwidget_prop_info;if(typeof options!=='object'||!(widget instanceof Wirecloud.Widget)){throw new TypeError();}
if(!(tab instanceof Tab)){throw new TypeError();}
Object.defineProperty(this,'widget',{value:widget});Object.defineProperty(this,'meta',{value:widget});Object.defineProperty(this,'tab',{value:tab});Object.defineProperty(this,'workspace',{value:tab.workspace});this.id=options.id;this.loaded=false;this.name=options.name;this.readOnly=options.readOnly;this.pending_events=[];this.inputs={};for(key in this.meta.inputs){this.inputs[key]=new Wirecloud.wiring.WidgetTargetEndpoint(this,this.meta.inputs[key]);}
this.outputs={};for(key in this.meta.outputs){this.outputs[key]=new Wirecloud.wiring.WidgetSourceEndpoint(this,this.meta.outputs[key]);}
preferences=this.meta.preferenceList;this.preferenceList=[];this.preferences={};for(i=0;i<preferences.length;i++){iwidget_pref_info=options.preferences[preferences[i].name];if(iwidget_pref_info!=null){this.preferenceList[i]=new Wirecloud.UserPref(preferences[i],iwidget_pref_info.readonly,iwidget_pref_info.hidden,iwidget_pref_info.value);}else{this.preferenceList[i]=new Wirecloud.UserPref(preferences[i],false,false,preferences[i].default);}
this.preferences[preferences[i].name]=this.preferenceList[i];}
properties=this.meta.propertyList;this.propertyList=[];this.properties={};this.propertyCommiter=new Wirecloud.PropertyCommiter(this);for(i=0;i<properties.length;i++){iwidget_prop_info=options.properties[properties[i].name];if(iwidget_prop_info!=null){this.propertyList[i]=new Wirecloud.PersistentVariable(properties[i],this.propertyCommiter,iwidget_prop_info.readonly,iwidget_prop_info.value);}else{this.propertyList[i]=new Wirecloud.PersistentVariable(properties[i],this.propertyCommiter,false,properties[i].meta.default);}
this.properties[properties[i].name]=this.propertyList[i];}
this.callbacks={'iwidget':[],'mashup':[],'platform':[]};this.contextManager=new Wirecloud.ContextManager(this,{'title':{label:gettext("Title"),description:gettext("Widget's title"),value:options.name},'xPosition':{label:gettext("X-Position"),description:gettext("Specifies the x-coordinate at which the widget is placed"),value:0},'yPosition':{label:gettext("Y-Position"),description:gettext("Specifies the y-coordinate at which the widget is placed"),value:0},'height':{label:gettext("Height"),description:gettext("Widget's height in layout cells"),value:0},'width':{label:gettext("Width"),description:gettext("Widget's width in layout cells"),value:0},'heightInPixels':{label:gettext("Height in pixels"),description:gettext("Widget's height in pixels"),value:0},'widthInPixels':{label:gettext("Width in pixels"),description:gettext("Widget's width in pixels"),value:0}});Object.defineProperty(this,'logManager',{value:new Wirecloud.Widget.LogManager(this)});this.prefCallback=null;StyledElements.ObjectWithEvents.call(this,['load','unload','removed','name_changed']);};IWidget.prototype=new StyledElements.ObjectWithEvents();IWidget.prototype.isAllowed=function isAllowed(action){if(this.workspace.restricted){return false;}
switch(action){case"close":return!this.readOnly&&this.workspace.isAllowed('add_remove_iwidgets');case"move":case"resize":return!this.tab.readOnly&&this.workspace.isAllowed('edit_layout');case"minimize":return this.workspace.isAllowed('edit_layout');case"rename":case"configure":return true;default:return false;}};IWidget.prototype.registerPrefCallback=function registerPrefCallback(prefCallback){this.prefCallback=prefCallback;};IWidget.prototype.registerContextAPICallback=function registerContextAPICallback(scope,callback){switch(scope){case'iwidget':this.contextManager.addCallback(callback);break;case'mashup':this.workspace.contextManager.addCallback(callback);break;case'platform':Wirecloud.contextManager.addCallback(callback);break;default:throw new TypeError('invalid scope');}
this.callbacks[scope].push(callback);};IWidget.prototype._notifyLoaded=function _notifyLoaded(element){if(this.loaded||!element.hasAttribute('src')){return;}
this.logManager.log(gettext('iWidget loaded'),Wirecloud.constants.LOGGING.INFO_MSG);this.loaded=true;element.contentDocument.defaultView.addEventListener('unload',this._notifyUnloaded.bind(this),true);element.contentDocument.defaultView.addEventListener('keydown',function(event){if(event.keyCode===27){Wirecloud.UserInterfaceManager.handleEscapeEvent();}},true);for(var i=0;i<this.pending_events.length;i+=1){this.inputs[this.pending_events[i].endpoint].propagate(this.pending_events[i].value);}
this.pending_events=[];this.events.load.dispatch(this);};IWidget.prototype._notifyUnloaded=function _notifyUnloaded(){var i;if(!this.loaded){return;}
this.logManager.log(gettext('iWidget unloaded'),Wirecloud.constants.LOGGING.INFO_MSG);this.logManager.newCycle();for(i=0;i<this.callbacks.iwidget.length;i+=1){this.contextManager.removeCallback(this.callbacks.iwidget[i]);}
for(i=0;i<this.callbacks.mashup.length;i+=1){this.workspace.contextManager.removeCallback(this.callbacks.mashup[i]);}
for(i=0;i<this.callbacks.platform.length;i+=1){Wirecloud.contextManager.removeCallback(this.callbacks.platform[i]);}
this.callbacks={'iwidget':[],'mashup':[],'platform':[]};this.propertyCommiter.commit();this.prefCallback=null;this.loaded=false;this.events.unload.dispatch(this);};IWidget.prototype.buildInterface=function buildInterface(template,view){return new Wirecloud.ui.IWidgetView(this,template,view);};IWidget.prototype.fullDisconnect=function fullDisconnect(){var key,connectables;connectables=this.inputs;for(key in connectables){connectables[key].fullDisconnect();}
connectables=this.outputs;for(key in connectables){connectables[key].fullDisconnect();}};IWidget.prototype.setName=function setName(new_name,options){var old_name=this.name;if(options==null){options={};}
if(new_name!==null&&new_name.length>0){var iwidgetUrl=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});Wirecloud.io.makeRequest(iwidgetUrl,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({name:new_name}),onSuccess:renameSuccess.bind(this,options,old_name,new_name),onFailure:renameFailure.bind(this,options)});}};IWidget.prototype.remove=function remove(options){var url;if(options==null){options={};}
url=Wirecloud.URLs.IWIDGET_ENTRY.evaluate({workspace_id:this.workspace.id,tab_id:this.tab.id,iwidget_id:this.id});Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:removeSuccess.bind(this,options),onFailure:removeFailure.bind(this,options)});};IWidget.prototype.destroy=function destroy(){if(this.loaded){this.events.unload.dispatch(this);this.loaded=false;}
this.contextManager=null;this.logManager.close();};Wirecloud.IWidget=IWidget;})();(function(){"use strict";var Wiring,findEntity,unload,addIWidget,removeIWidget,iwidget_added_listener,iwidget_removed_listener,iwidget_unload_listener,restore_connections,unload_operators;findEntity=function findEntity(desc){switch(desc.type){case'iwidget':return this.iwidgets[desc.id];case'ioperator':return this.ioperators[desc.id];}};var findEndpoint=function findEndpoint(entity,desc,type){if(entity instanceof Wirecloud.wiring.GhostEntity){if(!(desc.endpoint in entity[type])){if(type==='outputs'){entity[type][desc.endpoint]=new Wirecloud.wiring.GhostSourceEndpoint(entity,desc.endpoint);}else{entity[type][desc.endpoint]=new Wirecloud.wiring.GhostTargetEndpoint(entity,desc.endpoint);}}}
return entity[type][desc.endpoint];};restore_connections=function restore_connections(entity){var i,connection,sourceEntity,sourceEndpoint,targetEntity,targetEndpoint,msg;for(i=0;i<this.status.connections.length;i+=1){connection=this.status.connections[i];sourceEntity=findEntity.call(this,connection.source);targetEntity=findEntity.call(this,connection.target);if(entity!=null&&sourceEntity!=entity&&targetEntity!=entity){continue;}
if(sourceEntity==null||targetEntity==null){msg=gettext('The connection between %(source)s and %(target)s could not be established');msg=interpolate(msg,{source:JSON.stringify(connection.source),target:JSON.stringify(connection.target)},true);this.logManager.log(msg);continue;}
sourceEndpoint=findEndpoint(sourceEntity,connection.source,'outputs');targetEndpoint=findEndpoint(targetEntity,connection.target,'inputs');if(sourceEndpoint!=null&&targetEndpoint!=null){sourceEndpoint.connect(targetEndpoint);}else{msg=gettext('The connection between %(source)s and %(target)s could not be established');msg=interpolate(msg,{source:JSON.stringify(connection.source),target:JSON.stringify(connection.target)},true);this.logManager.log(msg);}}};unload=function unload(){var widgets,key,i;if(this.status==null){return;}
this.events.unload.dispatch();widgets=this.workspace.getIWidgets();for(i=0;i<widgets.length;i++){this.iwidgets[widgets[i].id].fullDisconnect();}
for(key in this.ioperators){this.ioperators[key].fullDisconnect();}
this.events.unloaded.dispatch();this.logManager.newCycle();this.status=null;};addIWidget=function addIWidget(iwidget){if(iwidget.id in this.iwidgets){var msg=gettext("Error adding iWidget into the wiring module of the workspace: Widget instance already exists.");this.logManager.log(msg);return;}
iwidget.addEventListener('unload',this._iwidget_unload_listener);this.iwidgets[iwidget.id]=iwidget;};removeIWidget=function removeIWidget(iwidget){var widgetEntry,i,connection;if(!(iwidget.id in this.iwidgets)){var msg=gettext("Error: trying to remove an inexistant iWidget from the wiring module.");this.logManager.log(msg);return;}
iwidget.fullDisconnect();if(this.status.views!=null&&this.status.views[0].iwidgets[iwidget.id]){delete this.status.views[0].iwidgets[iwidget.id];}
for(i=this.status.connections.length-1;i>=0;i-=1){connection=this.status.connections[i];if(connection.source.type==='iwidget'&&connection.source.id===iwidget.id){this.status.connections.splice(i,1);this.status.views[0].connections.splice(i,1);}else if(connection.target.type==='iwidget'&&connection.target.id===iwidget.id){this.status.connections.splice(i,1);this.status.views[0].connections.splice(i,1);}}
iwidget.removeEventListener('unload',this._iwidget_unload_listener);delete this.iwidgets[iwidget.id];};iwidget_added_listener=function iwidget_added_listener(workspace,iwidget){addIWidget.call(this,iwidget);};iwidget_removed_listener=function iwidget_removed_listener(workspace,iwidget){removeIWidget.call(this,iwidget);};iwidget_unload_listener=function iwidget_unload_listener(iWidget){var key,entry=this.iwidgets[iWidget.id];for(key in entry.inputs){entry.inputs[key].callback=null;}};unload_operators=function unload_operators(resource_details,version){var id,operator,msg,ghost_operator,i,endpoint,key,uri;uri=resource_details.vendor+'/'+resource_details.name+'/'+version;for(id in this.ioperators){if(this.ioperators[id].meta.uri===uri){operator=this.ioperators[id];this.ioperators[id].destroy();ghost_operator=new Wirecloud.wiring.GhostOperator(id,this.status.operators[id]);this.ioperators[id]=ghost_operator;ghost_operator.preferences={};for(key in operator.preferences){ghost_operator.preferences[key]={"readOnly":operator.preferences[key].readOnly,"hidden":operator.preferences[key].hidden,"value":operator.preferences[key].value};}
for(i=0;i<operator.meta.inputs.length;i++){endpoint=new Wirecloud.wiring.GhostTargetEndpoint(ghost_operator,operator.meta.inputs[i].name);ghost_operator.inputs[endpoint.name]=endpoint;}
for(i=0;i<operator.meta.outputs.length;i++){endpoint=new Wirecloud.wiring.GhostSourceEndpoint(ghost_operator,operator.meta.outputs[i].name);ghost_operator.outputs[endpoint.name]=endpoint;}
msg=gettext('operator instance %(ioperator_id)s was unloaded as %(operator)s operator has been uninstalled');msg=interpolate(msg,{ioperator_id:id,operator:operator.meta.uri},true);this.logManager.log(msg);}}};Wiring=function Wiring(workspace){this.status=null;this.workspace=workspace;this.iwidgets={};this.ioperators={};Object.defineProperty(this,'logManager',{value:new Wirecloud.wiring.LogManager(this)});this._iwidget_unload_listener=iwidget_unload_listener.bind(this);this._iwidget_added_listener=iwidget_added_listener.bind(this);this._iwidget_removed_listener=iwidget_removed_listener.bind(this);this.workspace.addEventListener('iwidgetadded',this._iwidget_added_listener);this.workspace.addEventListener('iwidgetremoved',this._iwidget_removed_listener);StyledElements.ObjectWithEvents.call(this,['load','loaded','unload','unloaded']);};Wiring.prototype=new StyledElements.ObjectWithEvents();Wiring.prototype.load=function load(status){var operators,id,operator_info,old_operators,msg;if(status==null||status===''){unload.call(this);return;}
if(typeof status==='string'){status=JSON.parse(status);}
unload.call(this);this.events.load.dispatch();if(!('views'in status)||!Array.isArray(status.views)){status.views=[];}
if(status.views.length===0){status.views.push({label:'default',iwidgets:{},operators:{},multiconnectors:{},connections:[]});}
if(this.workspace.owned){operators=Wirecloud.wiring.OperatorFactory.getAvailableOperators();}else{operators=this.workspace.resources.getAvailableResourcesByType('operator');}
old_operators=this.ioperators;this.ioperators={};for(id in status.operators){operator_info=status.operators[id];if(id in old_operators){this.ioperators[id]=old_operators[id];delete old_operators[id];if(this.ioperators[id]instanceof Wirecloud.wiring.GhostOperator){msg=gettext('%(operator)s operator is not available for this account');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);}}else{if(operator_info.name in operators){try{this.ioperators[id]=operators[operator_info.name].instantiate(id,operator_info,this);}catch(e){msg=gettext('Error instantiating the %(operator)s operator');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);this.ioperators[id]=new Wirecloud.wiring.GhostOperator(id,operator_info);if(id in status.views[0].operators){this.ioperators[id].fillFromViewInfo(status.views[0].operators[id]);}}}else{msg=gettext('%(operator)s operator is not available for this account');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);this.ioperators[id]=new Wirecloud.wiring.GhostOperator(id,operator_info);if(id in status.views[0].operators){this.ioperators[id].fillFromViewInfo(status.views[0].operators[id]);}}}}
for(id in old_operators){old_operators[id].destroy();}
this.status=status;restore_connections.call(this);this.events.loaded.dispatch();};Wiring.prototype.save=function save(){Wirecloud.io.makeRequest(Wirecloud.URLs.WIRING_ENTRY.evaluate({workspace_id:this.workspace.id}),{method:'PUT',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(this.status)});};Wiring.prototype.destroy=function destroy(){var key,i;for(key in this.iwidgets){this.iwidgets[key].fullDisconnect();}
this.iwidgets=null;for(key in this.ioperators){this.ioperators[key].destroy();}
this.ioperators=null;this.workspace.removeEventListener('iwidgetadded',this._iwidget_added_listener);this.workspace.removeEventListener('iwidgetremoved',this._iwidget_removed_listener);this.workspace=null;};Wiring.prototype._notifyOperatorInstall=function _notifyOperatorInstall(operator){var id,operator_info,ioperator,msg;for(id in this.status.operators){operator_info=this.status.operators[id];if(operator_info.name===operator.uri){this.ioperators[id].fullDisconnect();try{ioperator=operator.instantiate(id,operator_info,this);this.ioperators[id]=ioperator;this.logManager.errorCount-=1;}catch(e){msg=gettext('Error instantiating the %(operator)s operator');msg=interpolate(msg,{operator:operator_info.name},true);this.logManager.log(msg);}
restore_connections.call(this,ioperator);}}};Wiring.prototype._notifyOperatorUninstall=function _notifyOperatorUninstall(resource_details,versions){var i;for(i=0;i<versions.length;i++){unload_operators.call(this,resource_details,versions[i]);}};Wirecloud.Wiring=Wiring;Wirecloud.wiring={};})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var LogManager=function LogManager(parentLogger){Object.defineProperties(this,{wrapperElement:{value:document.createElement('div')},parentLogger:{value:parentLogger}});this.errorCount=0;this.totalCount=0;this.entries=[];this.childManagers=[];this.closed=false;StyledElements.ObjectWithEvents.call(this,['newentry']);if(parentLogger){parentLogger.childManagers.push(this);}};LogManager.prototype=new StyledElements.ObjectWithEvents();LogManager.prototype._addEntry=function _addEntry(entry){Object.freeze(entry);this.entries.push(entry);if(entry.level===Wirecloud.constants.LOGGING.ERROR_MSG){this.errorCount+=1;}
this.totalCount+=1;if(this.parentLogger){this.parentLogger._addEntry(entry);}
this.events.newentry.dispatch(this,entry);};LogManager.prototype.newCycle=function newCycle(){this.wrapperElement.insertBefore(document.createElement('hr'),this.wrapperElement.firstChild);this.resetCounters();};LogManager.prototype.log=function log(msg,options){var date,index,entry,level,expander;if(typeof options==='number'){level=options;options={};}else if(options==null){options={};}
date=new Date();switch(level){default:level=Wirecloud.constants.LOGGING.ERROR_MSG;case Wirecloud.constants.LOGGING.ERROR_MSG:if('console'in window&&typeof console.error==='function'){console.error(msg);}
break;case Wirecloud.constants.LOGGING.WARN_MSG:if('console'in window&&typeof console.warn==='function'){console.warn(msg);}
break;case Wirecloud.constants.LOGGING.INFO_MSG:if('console'in window&&typeof console.info==='function'){console.info(msg);}
break;}
entry={"level":level,"msg":msg,"date":date,"logManager":this};if(options.details!=null){entry.details=options.details;}
this._addEntry(entry);};LogManager.prototype.formatException=function formatException(exception){return builder.parse(Wirecloud.currentTheme.templates.exception_log_details,{message:exception.toString(),stacktrace:exception.stack});};LogManager.prototype.formatError=function formatError(format,transport,e){var msg,errorDesc;if(e){var context;if(e.lineNumber!==undefined){context={errorFile:e.fileName,errorLine:e.lineNumber,errorDesc:e.message};}else if(e.line!==undefined){context={errorFile:e.sourceURL,errorLine:e.line,errorDesc:e.message};}else{var text=gettext("unknown");context={errorFile:text,errorLine:text,errorDesc:e.message};}
msg=interpolate(gettext("JavaScript exception on file %(errorFile)s (line: %(errorLine)s): %(errorDesc)s"),context,true);}else{try{var errorInfo=JSON.parse(transport.responseText);msg=errorInfo.description;}catch(error){msg=gettext("HTTP Error %(errorCode)s - %(errorDesc)s");if(transport.status!==0&&transport.statusText!==''){errorDesc=gettext(transport.statusText);}else{errorDesc=Wirecloud.constants.HTTP_STATUS_DESCRIPTIONS[transport.status];if(errorDesc==null){errorDesc=Wirecloud.constants.UNKNOWN_STATUS_CODE_DESCRIPTION;}}
msg=interpolate(msg,{errorCode:transport.status,errorDesc:errorDesc},true);}}
msg=interpolate(format,{errorMsg:msg},true);return msg;};LogManager.prototype.formatAndLog=function formatAndLog(format,transport,e,level){var msg=this.formatError(format,transport,e);this.log(msg,level);return msg;};LogManager.prototype.reset=function reset(){var i;this.wrapperElement.innerHTML='';this.resetCounters();this.entries=[];for(i=this.childManagers.length-1;i>=0;i-=1){if(this.childManagers[i].isClosed()){this.childManagers.splice(i,1);}else{this.childManagers[i].reset();}}};LogManager.prototype.resetCounters=function resetCounters(){this.errorCount=0;this.totalCount=0;};LogManager.prototype.getErrorCount=function getErrorCount(){return this.errorCount;};LogManager.prototype.close=function close(){this.closed=true;};LogManager.prototype.isClosed=function isClosed(){return this.closed;};Wirecloud.LogManager=LogManager;Wirecloud.GlobalLogManager=new LogManager();})();(function(){"use strict";var LogManager=function LogManager(iWidget){Wirecloud.LogManager.call(this,Wirecloud.GlobalLogManager);this.iWidget=iWidget;};LogManager.prototype=new Wirecloud.LogManager();LogManager.prototype.buildExtraInfo=function buildExtraInfo(){var extraInfo=document.createElement('div'),extraInfoIcon=document.createElement('div'),extraInfoText=document.createElement('span');extraInfo.className+=" iwidget_info_container";extraInfo.appendChild(extraInfoIcon);extraInfo.appendChild(extraInfoText);extraInfoIcon.className="iwidget_info";extraInfoText.innerHTML=this.iWidget.id;extraInfoText.setAttribute('title',this.iWidget.name+"\n "+this.iWidget.widget.getInfoString());extraInfo.style.cursor="pointer";return extraInfo;};LogManager.prototype.buildTitle=function buildTitle(){var title;if(this.iWidget){title=gettext('%(iwidget_name)s\'s logs');title=interpolate(title,{iwidget_name:this.iWidget.name},true);return title;}else{return this.title;}};LogManager.prototype.close=function close(){this.title=this.buildTitle();this.iWidget=null;};Wirecloud.Widget.LogManager=LogManager;})();(function(){"use strict";var MACField,onclick,onfocus,onblur;onclick=function onclick(e){if('target'in e&&e.target===this.wrapperElement){e.stopPropagation();e.preventDefault();}
var dialog=new Wirecloud.ui.MACSelectionWindowMenu(this.dialog_title,{scope:this.scope,});dialog.show(this.parent_dialog);dialog.addEventListener('select',function(selected_mashup){this.setValue(selected_mashup);}.bind(this));};onfocus=function onfocus(){this.wrapperElement.classList.add('focus');this.events.focus.dispatch(this);};onblur=function onblur(){this.wrapperElement.classList.remove('focus');this.events.blur.dispatch(this);};MACField=function MACField(options){var defaultOptions={'class':'','scope':'','dialog':null};options=Wirecloud.Utils.merge(defaultOptions,options);StyledElements.StyledInputElement.call(this,options.initialValue,['change','focus','blur']);this.layout=new StyledElements.HorizontalLayout({'class':'se-mac-field input input-prepend input-append'});this.wrapperElement=this.layout.wrapperElement;if(options['class']!==""){this.wrapperElement.className+=" "+options['class'];}
this.inputElement=document.createElement("input");this.inputElement.setAttribute("type","hidden");this.wrapperElement.appendChild(this.inputElement);this.resource_details=null;if(options.name){this.inputElement.setAttribute("name",options.name);}
if(options.id!=null){this.wrapperElement.setAttribute("id",options.id);}
this.name_preview=document.createElement('div');this.name_preview.className='add-on';this.layout.getCenterContainer().appendChild(this.name_preview);var close_button=new StyledElements.StyledButton({iconClass:'icon-remove',title:gettext('Clear current selection')});this.layout.getWestContainer().appendChild(close_button);close_button.disable();close_button.addEventListener('click',function(){this.setValue('');}.bind(this));var button=new StyledElements.StyledButton({iconClass:'icon-search',title:gettext('Search')});this.layout.getEastContainer().appendChild(button);Object.defineProperties(this,{'close_button':{value:close_button},'scope':{value:options.scope},'parent_dialog':{value:options.parent_dialog},'dialog_title':{value:options.dialog_title}});this.wrapperElement.addEventListener('click',onclick.bind(this),false);button.addEventListener('click',onclick.bind(this),true);close_button.addEventListener('focus',onfocus.bind(this));close_button.addEventListener('blur',onblur.bind(this));button.addEventListener('focus',onfocus.bind(this));button.addEventListener('blur',onblur.bind(this));};MACField.prototype=new StyledElements.StyledInputElement();MACField.prototype.repaint=function repaint(){this.layout.repaint();};MACField.prototype.insertInto=function insertInto(element,refElement){StyledElements.StyledInputElement.prototype.insertInto.call(this,element,refElement);this.repaint();};MACField.prototype.setValue=function setValue(new_value){var mac_id,mac_title;if(typeof new_value!=='string'){mac_id=new_value.uri;mac_title=new_value.title;this.resource_details;}else{mac_id=new_value;mac_title=new_value;this.resource_details=null;}
this.inputElement.value=mac_id;this.name_preview.textContent=mac_title;this.close_button.setDisabled(new_value==='');this.events.change.dispatch(this);};MACField.prototype.getValue=function getValue(){return this.inputElement.value;};Wirecloud.ui.MACField=MACField;var MACInputInterface=function MACInputInterface(fieldId,options){if(arguments.length===0){return;}
StyledElements.InputInterface.call(this,fieldId,options);this.inputElement=new Wirecloud.ui.MACField(options);};MACInputInterface.prototype=new StyledElements.InputInterface();Wirecloud.ui.MACInputInterface=MACInputInterface;})();(function(){"use strict";var InputInterfaceFactory=new StyledElements.InputInterfaceFactory();InputInterfaceFactory.addFieldType('layout',Wirecloud.ui.LayoutInputInterface);InputInterfaceFactory.addFieldType('parametrizableValue',Wirecloud.ui.ParametrizableValueInputInterface);InputInterfaceFactory.addFieldType('parametrizedText',ParametrizedTextInputInterface);InputInterfaceFactory.addFieldType('mac',Wirecloud.ui.MACInputInterface);Wirecloud.ui.InputInterfaceFactory=InputInterfaceFactory;})();(function(){"use strict";var IWidgetMenuItems=function IWidgetMenuItems(iWidget){StyledElements.DynamicMenuItems.call(this);this.iWidget=iWidget;this.has_prefs=iWidget.widget.preferenceList.length>0;};IWidgetMenuItems.prototype=new StyledElements.DynamicMenuItems();IWidgetMenuItems.prototype.build=function(){var items,item,fulldragboard_label,layout_label;items=[];item=new StyledElements.MenuItem(gettext('Rename'),function(){this.titleelement.enableEdition();}.bind(this.iWidget));item.setDisabled(!this.iWidget.isAllowed('rename'));items.push(item);item=new StyledElements.MenuItem(gettext("Settings"),function(){var dialog=new Wirecloud.Widget.PreferencesWindowMenu();dialog.show(this);}.bind(this.iWidget.internal_iwidget));item.setDisabled(!this.has_prefs||!this.iWidget.isAllowed('configure'));items.push(item);items.push(new StyledElements.MenuItem(gettext("Logs"),function(){var dialog=new Wirecloud.ui.LogWindowMenu(this.logManager);dialog.show();}.bind(this.iWidget.internal_iwidget)));items.push(new StyledElements.MenuItem(gettext("Reload"),function(){try{var prev=this.content.src;this.content.src=this.codeURL;if(this.content.src===prev){this.content.contentDocument.location.reload();}}catch(e){}}.bind(this.iWidget)));item=new StyledElements.MenuItem(gettext("User's Manual"),function(){var myresources_view=LayoutManagerFactory.getInstance().viewsByName.myresources;myresources_view.createUserCommand('showDetails',this.widget,{version:this.widget.version,tab:'Documentation'})();}.bind(this.iWidget));item.setDisabled(this.iWidget.widget.doc==='');items.push(item);if(this.iWidget.isInFullDragboardMode()){fulldragboard_label=gettext("Exit Full Dragboard");}else{fulldragboard_label=gettext("Full Dragboard");}
item=new StyledElements.MenuItem(fulldragboard_label,function(){this.setFullDragboardMode(!this.isInFullDragboardMode());}.bind(this.iWidget));item.setDisabled(!this.iWidget.isAllowed('move'));items.push(item);if(!this.iWidget.isInFullDragboardMode()){if(this.iWidget.onFreeLayout()){layout_label=gettext("Snap to grid");}else{layout_label=gettext("Extract from grid");}
item=new StyledElements.MenuItem(layout_label,this.iWidget.toggleLayout.bind(this.iWidget));item.setDisabled(!this.iWidget.isAllowed('move'));items.push(item);}
return items;};Wirecloud.ui.IWidgetMenuItems=IWidgetMenuItems;})();(function(){"use strict";var returnTrue=function returnTrue(){return true;};var ResizeHandle=function ResizeHandle(resizableElement,handleElement,data,onStart,onResize,onFinish,canBeResized){var xDelta=0,yDelta=0;var xStart=0,yStart=0;var scrollDelta,scrollStart=0;var dragboardCover;var x,y;var endresize,resize,startresize,scroll;canBeResized=canBeResized?canBeResized:returnTrue;endresize=function endresize(e){if(e.type==='mouseup'&&e.button!==0){return;}else if(e.type==='touchend'&&e.touches.length>0){return;}
document.removeEventListener("mouseup",endresize,false);document.removeEventListener("touchend",endresize,false);document.removeEventListener("mousemove",resize,false);document.removeEventListener("touchmove",resize,false);dragboardCover.parentNode.removeEventListener("scroll",scroll,true);dragboardCover.parentNode.removeChild(dragboardCover);dragboardCover=null;handleElement.removeEventListener("mouseup",endresize,false);handleElement.removeEventListener("touchend",endresize,false);handleElement.removeEventListener("mousemove",resize,false);handleElement.removeEventListener("touchmove",resize,false);onFinish(resizableElement,handleElement,data);handleElement.addEventListener("mousedown",startresize,false);handleElement.addEventListener("touchstart",startresize,false);document.removeEventListener('mousedown',Wirecloud.Utils.preventDefaultListener,false);document.removeEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener,false);};resize=function resize(e){var clientX,clientY;if('touches'in e){clientX=e.touches[0].clientX;clientY=e.touches[0].clientY;e.preventDefault();}else{clientX=e.clientX;clientY=e.clientY;}
xDelta=clientX-xStart;yDelta=clientY-yStart;onResize(resizableElement,handleElement,data,x+xDelta,y+yDelta-scrollDelta);};scroll=function scroll(){var dragboard=dragboardCover.parentNode;dragboardCover.style.height=dragboard.scrollHeight+"px";var scrollTop=parseInt(dragboard.scrollTop,10);scrollDelta=scrollStart-scrollTop;onResize(resizableElement,handleElement,data,x+xDelta,y+yDelta-scrollDelta);};startresize=function startresize(e){if(e.type==='mousedown'&&e.button!==0){return;}
if(!canBeResized(resizableElement,data)){return false;}
document.addEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener,false);document.addEventListener('mousedown',Wirecloud.Utils.preventDefaultListener,false);handleElement.removeEventListener("mousedown",startresize,false);handleElement.removeEventListener("touchstart",startresize,false);if('touches'in e){xStart=e.touches[0].clientX;yStart=e.touches[0].clientY;}else{xStart=e.clientX;yStart=e.clientY;}
x=resizableElement.offsetLeft+handleElement.offsetLeft+(handleElement.offsetWidth/2);y=resizableElement.offsetTop+handleElement.offsetTop+(handleElement.offsetHeight/2);document.addEventListener("mouseup",endresize,false);document.addEventListener("touchend",endresize,false);document.addEventListener("mousemove",resize,false);document.addEventListener("touchmove",resize,false);var dragboard=EzWebEffectBase.findDragboardElement(resizableElement);dragboardCover=document.createElement("div");dragboardCover.className="cover";dragboardCover.addEventListener("mouseup",endresize,true);dragboardCover.addEventListener("mousemove",resize,true);dragboardCover.style.zIndex="1000000";dragboardCover.style.position="absolute";dragboardCover.style.top="0";dragboardCover.style.left="0";dragboardCover.style.width="100%";dragboardCover.style.height=dragboard.scrollHeight+"px";scrollStart=dragboard.scrollTop;scrollDelta=0;dragboard.addEventListener("scroll",scroll,true);dragboard.insertBefore(dragboardCover,dragboard.firstChild);handleElement.addEventListener("mouseup",endresize,false);handleElement.addEventListener("touchend",endresize,false);handleElement.addEventListener("mousemove",resize,false);handleElement.addEventListener("touchmove",resize,false);onStart(resizableElement,handleElement,data);return false;};handleElement.addEventListener("mousedown",startresize,false);handleElement.addEventListener("touchstart",startresize,false);this.setResizableElement=function(element){resizableElement=element;};this.destroy=function(){handleElement.removeEventListener("mousedown",startresize,true);startresize=null;resize=null;scroll=null;endresize=null;data=null;handleElement=null;};};Wirecloud.ui.ResizeHandle=ResizeHandle;})();(function(){"use strict";var IWidgetResizeHandle=function IWidgetResizeHandle(iWidget,options){if(options==null){options={};}
options.resizeLeftSide=!!options.resizeLeftSide;options.resizeTopSide=!!options.resizeTopSide;options.fixHeight=!!options.fixHeight;options.fixWidth=!!options.fixWidth;options.iWidget=iWidget;if(options.fixWidth&&options.fixHeight){throw new Exception('fixWidth and fixHeight cannot be true at the same time');}
StyledElements.StyledElement.call(this,[]);this.wrapperElement=document.createElement('div');Wirecloud.ui.ResizeHandle.call(this,iWidget.element,this.wrapperElement,options,IWidgetResizeHandle.prototype.startFunc,IWidgetResizeHandle.prototype.updateFunc,IWidgetResizeHandle.prototype.finishFunc,IWidgetResizeHandle.prototype.canBeResizedFunc);};IWidgetResizeHandle.prototype=new StyledElements.StyledElement();IWidgetResizeHandle.prototype.canBeResizedFunc=function canBeResizedFunc(resizableElement,data){return data.iWidget.isAllowed('resize');};IWidgetResizeHandle.prototype.startFunc=function startFunc(resizableElement,handleElement,data){handleElement.classList.add("inUse");data.iWidget.element.classList.add('draganddrop');data.minWidth=Math.ceil(data.iWidget.layout.fromPixelsToHCells(80));data.minHeight=Math.ceil(data.iWidget.layout.fromPixelsToVCells(50));data.innitialWidth=data.iWidget.getWidth();data.innitialHeight=data.iWidget.getHeight();data.oldZIndex=data.iWidget.getZPosition();data.iWidget.setZPosition("999999");data.dragboard=data.iWidget.layout.dragboard;};IWidgetResizeHandle.prototype.updateFunc=function updateFunc(resizableElement,handleElement,data,x,y){var iWidget=data.iWidget;if(iWidget.layout.isInside(x,y)){var position=iWidget.layout.getCellAt(x,y);var currentPosition=iWidget.getPosition();var width,height;if(!data.fixWidth){if(data.resizeLeftSide){width=currentPosition.x+iWidget.getWidth()-position.x;}else{width=position.x-currentPosition.x+1;}}else{width=iWidget.getWidth();}
if(!data.fixHeight){height=position.y-currentPosition.y+1;}else{height=iWidget.getHeight();}
if(width<data.minWidth){width=data.minWidth;}
if(height<data.minHeight){height=data.minHeight;}
if(width!==iWidget.getWidth()||height!==iWidget.getHeight()){iWidget.setSize(width,height,data.resizeLeftSide,false);}}};IWidgetResizeHandle.prototype.finishFunc=function finishFunc(resizableElement,handleElement,data){var iWidget=data.iWidget;data.iWidget.element.classList.remove('draganddrop');data.iWidget.setZPosition(data.oldZIndex);if(data.innitialWidth!==data.iWidget.getWidth()||data.innitialHeight!==data.iWidget.getHeight()){iWidget.setSize(iWidget.getWidth(),iWidget.getHeight(),data.resizeLeftSide,true);}
handleElement.classList.remove("inUse");data.dragboard._notifyWindowResizeEvent();};window.IWidgetResizeHandle=IWidgetResizeHandle;})();(function(){var builder=new StyledElements.GUIBuilder();var IWidgetView=function IWidgetView(iwidget,template,view){var tmp={};var ui_fragment=builder.parse(template,{'closebutton':function(){var button=new StyledElements.StyledButton({'plain':true,'class':'icon-remove','title':gettext('Close')});button.addEventListener("click",function(){iwidget.remove();});tmp.closebutton=button;return button;},'errorbutton':function(){var button=new StyledElements.StyledButton({'plain':true,'class':'errorbutton icon-warning-sign'});button.addEventListener("click",function(button){var dialog=new Wirecloud.ui.LogWindowMenu(this.logManager);dialog.show();}.bind(this));button.disable();tmp.errorbutton=button;return button;}.bind(iwidget),'menubutton':function(){var button=new StyledElements.StyledButton({'plain':true,'class':'icon-cogs','title':gettext('Menu')});button.addEventListener("click",function(button){view.menu.show(button.getBoundingClientRect());});tmp.menubutton=button;return button;},'minimizebutton':function(){var button=new StyledElements.StyledButton({'plain':true});button.addEventListener("click",function(button){view.toggleMinimizeStatus(true);});tmp.minimizebutton=button;return button;},'title':function(){var element=new StyledElements.EditableElement({initialContent:view.name});element.addEventListener('change',function(element,new_name){iwidget.setName(new_name);});tmp.titleelement=element;return element;},'bottomresizehandle':function(){var handle=new IWidgetResizeHandle(view,{resizeLeftSide:true,fixWidth:true});tmp.bottomresizehandle=handle;handle.addClassName("bottomResizeHandle");return handle;},'leftresizehandle':function(){var handle=new IWidgetResizeHandle(view,{resizeLeftSide:true});tmp.leftresizehandle=handle;handle.addClassName("leftResizeHandle");return handle;},'rightresizehandle':function(){var handle=new IWidgetResizeHandle(view,{resizeLeftSide:false});tmp.rightresizehandle=handle;handle.addClassName("rightResizeHandle");return handle;},'iframe':function(){var content=document.createElement("iframe");content.classList.add("widget_object");content.setAttribute("type",this.widget.code_content_type);content.setAttribute("frameBorder","0");content.addEventListener("load",iwidget._notifyLoaded.bind(iwidget,content),true);return content;}.bind(iwidget)});if('bottomresizehandle'in tmp){tmp.bottomresizehandle.setResizableElement(ui_fragment.elements[1]);}
if('leftresizehandle'in tmp){tmp.leftresizehandle.setResizableElement(ui_fragment.elements[1]);}
if('rightresizehandle'in tmp){tmp.rightresizehandle.setResizableElement(ui_fragment.elements[1]);}
this.element=ui_fragment.elements[1];this.element.classList.add('iwidget');this.tmp=tmp;};Wirecloud.ui.IWidgetView=IWidgetView;})();(function(){"use strict";var _canBeDragged=function(){return true;};var _cancel=function(){return false;};var Draggable=function Draggable(handler,data,onStart,onDrag,onFinish,canBeDragged,onScroll){var xStart=0,yStart=0,xScrollStart=0,yScrollStart=0;var xScrollDelta,yScrollDelta;var dragboardCover;var draggable=this;var enddrag,drag,startdrag,scroll;canBeDragged=canBeDragged?canBeDragged:_canBeDragged;enddrag=function enddrag(e){if(e.type==='mouseup'&&e.button!==0){return;}else if(e.type==='touchend'&&e.touches.length>0){return;}
document.removeEventListener("mouseup",enddrag,false);document.removeEventListener("touchend",enddrag,false);document.removeEventListener("mousemove",drag,false);document.removeEventListener("touchmove",drag,false);if(dragboardCover!=null){dragboardCover.parentNode.removeEventListener("scroll",scroll,true);dragboardCover.parentNode.removeChild(dragboardCover);dragboardCover=null;}
onFinish(draggable,data,e);handler.addEventListener("mousedown",startdrag,false);handler.addEventListener("touchstart",startdrag,false);document.removeEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener);document.removeEventListener('mousedown',Wirecloud.Utils.preventDefaultListener);};drag=function drag(e){var clientX,clientY;if('touches'in e){clientX=e.touches[0].clientX;clientY=e.touches[0].clientY;e.preventDefault();}else{clientX=e.clientX;clientY=e.clientY;}
var xDelta=clientX-xStart-xScrollDelta;var yDelta=clientY-yStart-yScrollDelta;onDrag(e,draggable,data,xDelta,yDelta);};startdrag=function startdrag(e){if(e.type==='mousedown'&&e.button!==0){return;}
if(!canBeDragged(draggable,data)){return false;}
e.preventDefault();document.addEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener);document.addEventListener('mousedown',Wirecloud.Utils.preventDefaultListener);handler.removeEventListener("mousedown",startdrag,false);handler.removeEventListener("touchstart",startdrag,false);if('touches'in e){xStart=e.touches[0].clientX;yStart=e.touches[0].clientY;}else{xStart=e.clientX;yStart=e.clientY;}
document.addEventListener("mouseup",enddrag,false);document.addEventListener("touchend",enddrag,false);document.addEventListener("mousemove",drag,false);document.addEventListener("touchmove",drag,false);yScrollDelta=0;xScrollDelta=0;var options=onStart(draggable,data,e);if(options!=null&&options.dragboard){var dragboard=options.dragboard;dragboardCover=document.createElement("div");dragboardCover.className="cover";dragboardCover.addEventListener("mouseup",enddrag,true);dragboardCover.addEventListener("touchend",enddrag,true);dragboardCover.addEventListener("mousemove",drag,true);dragboardCover.addEventListener("touchmove",drag,true);dragboardCover.style.zIndex="1000000";dragboardCover.style.position="absolute";dragboardCover.style.top="0";dragboardCover.style.left="0";dragboardCover.style.width="100%";dragboardCover.style.height=dragboard.scrollHeight+"px";yScrollStart=parseInt(dragboard.scrollTop,10);xScrollStart=parseInt(dragboard.scrollLeft,10);dragboardCover.addEventListener("scroll",scroll,true);dragboard.insertBefore(dragboardCover,dragboard.firstChild);}
e.stopPropagation();};scroll=function scroll(e){var dragboard=dragboardCover.parentNode;dragboardCover.style.height=dragboard.scrollHeight+"px";var scrollTop=parseInt(dragboard.scrollTop,10);var oldYDelta=yScrollDelta;yScrollDelta=yScrollStart-scrollTop;var yScrollDeltaDiff=yScrollDelta-oldYDelta;var scrollLeft=parseInt(dragboard.scrollLeft,10);var oldXDelta=xScrollDelta;xScrollDelta=xScrollStart-scrollLeft;var xScrollDeltaDiff=xScrollDelta-oldXDelta;onScroll(e,draggable,data,xScrollDeltaDiff,yScrollDeltaDiff);};handler.addEventListener("mousedown",startdrag,false);handler.addEventListener("touchstart",startdrag,false);this.destroy=function destroy(){handler.removeEventListener("mousedown",startdrag,false);handler.removeEventListener("touchstart",startdrag,false);startdrag=null;enddrag=null;drag=null;scroll=null;draggable=null;data=null;handler=null;};};Wirecloud.ui.Draggable=Draggable;})();(function(){"use strict";var Theme=function Theme(desc){Object.defineProperty(this,'templates',{value:desc});};Wirecloud.ui.Theme=Theme;})();(function(){"use strict";var WirecloudCatalogue,_onSearchSuccess,_onSearchFailure,deleteSuccessCallback,deleteErrorCallback;_onSearchSuccess=function _onSearchSuccess(response){var i,data,raw_data;raw_data=JSON.parse(response.responseText);data={'resources':raw_data.results,'current_page':parseInt(raw_data.pagenum,10),'total_count':parseInt(raw_data.total,10)};if('corrected_q'in raw_data){data.corrected_query=raw_data.corrected_q;}
this.onSuccess(data.resources,data);};_onSearchFailure=function _onSearchFailure(reponse){this.onFailure();};deleteSuccessCallback=function deleteSuccessCallback(response){var result;if(typeof this.onSuccess==='function'){result=JSON.parse(response.responseText);this.onSuccess(result);}};deleteErrorCallback=function deleteErrorCallback(response,e){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error deleting resource: %(errorMsg)s."),response,e);if(typeof this.onFailure==='function'){this.onFailure(msg);}};WirecloudCatalogue=function WirecloudCatalogue(options){Object.defineProperty(this,'name',{'value':options.name});Object.defineProperty(this,'permissions',{'value':options.permissions});if(options.url==null){options.url=Wirecloud.URLs.LOCAL_REPOSITORY;}else if(options.url[options.url.length-1]!=='/'){options.url+='/';}
Object.defineProperties(this,{'RESOURCE_CHANGELOG_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s/changelog')},'RESOURCE_USERGUIDE_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s/userguide')},'RESOURCE_COLLECTION':{value:options.url+'catalogue/resources'},'RESOURCE_UNVERSIONED_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s')},'RESOURCE_ENTRY':{value:new Wirecloud.Utils.Template(options.url+'catalogue/resource/%(vendor)s/%(name)s/%(version)s')},});};WirecloudCatalogue.prototype.isAllow=function isAllow(action){if(action in this.permissions){return this.permissions[action];}else{return false;}};WirecloudCatalogue.prototype.search=function search(options){var params,url;if(options==null){throw new TypeError();}
params={};if(options.search_criteria!=null&&options.search_criteria!==''){params.q=options.search_criteria;}
if(options.scope!=null&&options.scope!==''&&options.scope!=='all'){if(['widget','operator','mashup'].indexOf(options.scope)===-1){throw new TypeError('invalid scope value');}
params.scope=options.scope;}
if(options.order_by!=null&&options.order_by!==''){params.orderby=options.order_by;}
if(options.maxresults!=null){if(typeof options.maxresults!=='number'||options.maxresults<20){throw new TypeError('invalid maxresults value');}
params.maxresults=options.maxresults;}
if(options.pagenum!=null){if(typeof options.pagenum!=='number'||options.pagenum<0){throw new TypeError('invalid pagenum value');}
params.pagenum=options.pagenum;}
Wirecloud.io.makeRequest(this.RESOURCE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},parameters:params,onSuccess:_onSearchSuccess.bind(options),onFailure:_onSearchFailure.bind(options),onComplete:options.onComplete});};WirecloudCatalogue.prototype.getResourceDetails=function getResourceDetails(vendor,name,options){if(options==null){options={};}
var url=this.RESOURCE_UNVERSIONED_ENTRY.evaluate({vendor:vendor,name:name});Wirecloud.io.makeRequest(url,{method:'GET',onSuccess:function(response){var resource_details=new Wirecloud.WirecloudCatalogue.ResourceDetails(JSON.parse(response.responseText),this);try{options.onSuccess(resource_details);}catch(e){}}.bind(this),onFailure:options.onFailure,onComplete:options.onComplete});};WirecloudCatalogue.prototype.is_purchased=function is_purchased(){return true;};WirecloudCatalogue.prototype.addPackagedResource=function addPackagedResource(data,options){var url,requestHeaders,task,onUploadProgress;requestHeaders={'Accept':'application/json'};if(typeof options!='object'){options={};}
if(this.name==='local'){url=Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION;}else{url=this.RESOURCE_COLLECTION;if(this.accesstoken!=null){requestHeaders['Authorization']='Bearer '+this.accesstoken;}}
data.append('install_embedded_resources','true');if(options.monitor){task=options.monitor.nextSubtask(gettext('Uploading packaged resource'));onUploadProgress=function(event){task.updateTaskProgress(Math.round(event.loaded*100/event.total));};}
Wirecloud.io.makeRequest(url,{method:'POST',requestHeaders:requestHeaders,postBody:data,onSuccess:function(transport){var response_data=JSON.parse(transport.responseText);if(typeof options.onSuccess==='function'){try{options.onSuccess(response_data.resource_details,response_data.extra_resources);}catch(e){}}}.bind(this),onFailure:function(transport){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding packaged resource: %(errorMsg)s."),transport);if(typeof options.onFailure==='function'){try{options.onFailure(msg);}catch(e){}}},onComplete:function(){if(typeof options.onComplete==='function'){try{options.onComplete();}catch(e){}}},onUploadProgress:onUploadProgress});};WirecloudCatalogue.prototype.addResourceFromURL=function addResourceFromURL(url,options){if(typeof options!='object'){options={};}
Wirecloud.io.makeRequest(this.RESOURCE_COLLECTION,{method:'POST',requestHeaders:{'Accept':'application/json'},parameters:{'template_uri':url,force_create:!!options.forceCreate},onSuccess:function(){if(typeof options.onSuccess==='function'){options.onSuccess();}}.bind(this),onFailure:function(transport){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding resource from URL: %(errorMsg)s."),transport);if(typeof options.onFailure==='function'){options.onFailure(msg);}},onComplete:function(){if(typeof options.onComplete==='function'){options.onComplete();}}});};WirecloudCatalogue.prototype.deleteResource=function deleteResource(resource,options){var url;options=Wirecloud.Utils.merge({'allversions':false},options);if(options.allversions){url=this.RESOURCE_UNVERSIONED_ENTRY.evaluate({vendor:resource.vendor,name:resource.name});}else{url=this.RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name,version:resource.version.text});}
Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:deleteSuccessCallback.bind(options),onFailure:deleteErrorCallback.bind(options),onException:deleteErrorCallback.bind(options)});};Wirecloud.WirecloudCatalogue=WirecloudCatalogue;})();(function(){"use strict";var ResourceDetails=function ResourceDetails(data,catalogue){var currentVersion=null,allVersions=[],data_by_version={};this.getLastVersion=function(){return allVersions[0];};this.getAllVersions=function(){return allVersions;};this.isAllow=function isAllow(action){switch(action){case'uninstall':case'uninstall-all':return currentVersion.permissions.uninstall;case'delete':case'delete-all':return currentVersion.permissions.delete;}};Object.defineProperties(this,{'catalogue':{value:catalogue},'vendor':{value:data.vendor},'name':{value:data.name},'version':{get:function(){return currentVersion.version;}},'authors':{get:function(){return currentVersion.authors;}},'contributors':{get:function(){return currentVersion.contributors;}},'uri':{get:function(){return[this.vendor,this.name,currentVersion.version.text].join('/');}},'type':{value:data.type},'image':{get:function(){return currentVersion.image;}},'description_url':{get:function(){return currentVersion.uriTemplate;}},'description':{get:function(){return currentVersion.description;}},'longdescription':{get:function(){return currentVersion.longdescription;}},'homepage':{get:function(){return currentVersion.homepage;}},'doc':{get:function(){return currentVersion.doc;}},'changelog':{get:function(){return currentVersion.changelog;}},'size':{get:function(){return currentVersion.size;}},'title':{get:function(){return currentVersion.title;}},'tags':{get:function(){return[];}},'rating':{get:function(){return 0;}},'date':{get:function(){return currentVersion.date;}},'license':{get:function(){return currentVersion.license;}},'licenseurl':{get:function(){return currentVersion.licenseurl;}}});this.changeVersion=function changeVersion(version){if(version instanceof Wirecloud.Version){version=version.text;}
if(version in data_by_version){currentVersion=data_by_version[version];}else{currentVersion=data_by_version[allVersions[0].text];}
return this;};var i,version_data;for(i=0;i<data.versions.length;i+=1){version_data=data.versions[i];version_data.version=new Wirecloud.Version(version_data.version,'catalogue');version_data.date=new Date(version_data.date);allVersions.push(version_data.version);data_by_version[version_data.version.text]=version_data;}
allVersions=allVersions.sort(function(version1,version2){return-version1.compareTo(version2);});this.changeVersion(allVersions[0]);Object.freeze(this);};Wirecloud.WirecloudCatalogue.ResourceDetails=ResourceDetails;})();(function(){"use strict";var uninstallOrDeleteSuccessCallback=function uninstallOrDeleteSuccessCallback(resource,next,result){var layoutManager,result,i,iwidget,uri;if(result.affectedVersions==null){result.affectedVersions=[resource.version];}
switch(resource.type){case'widget':layoutManager=LayoutManagerFactory.getInstance();layoutManager.logSubTask(gettext('Removing affected iWidgets'));for(i=0;i<result.removedIWidgets.length;i+=1){iwidget=Wirecloud.activeWorkspace.getIWidget(result.removedIWidgets[i]);if(iwidget!=null){iwidget.remove(true);}}
layoutManager.logSubTask(gettext('Purging widget info'));break;case'operator':layoutManager=LayoutManagerFactory.getInstance();layoutManager.logSubTask(gettext('Uninstantiating affected operators'));Wirecloud.activeWorkspace.wiring._notifyOperatorUninstall(resource,result.affectedVersions);layoutManager.logSubTask(gettext('Purging operator info'));break;}
for(i=0;i<result.affectedVersions.length;i++){try{uri=resource.vendor+'/'+resource.name+'/'+result.affectedVersions[i];delete this.resources[uri];delete this.resourcesByType[resource.type][uri];}catch(e){}}
if(typeof next==='function'){next();}};var uninstallSuccessCallback=function uninstallSuccessCallback(resource,next,response){var result=JSON.parse(response.responseText);uninstallOrDeleteSuccessCallback.call(this,resource,next,result);};var uninstallErrorCallback=function uninstallErrorCallback(options,response){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error uninstalling resource: %(errorMsg)s."),response);if(typeof options.onFailure==='function'){options.onFailure(msg);}};var loadSuccessCallback=function loadFailureCallback(context,transport){var resources,resource_id;resources=JSON.parse(transport.responseText);this.resources={};this.resourceVersions={};this.resourcesByType={};for(resource_id in resources){this._includeResource.call(this,resources[resource_id]);}
if(typeof context.onSuccess==='function'){context.onSuccess();}};var loadFailureCallback=function loadFailureCallback(context,transport){if(typeof context.onError==='function'){context.onError();}};var process_upload_response=function process_upload_response(response_data){var i,id,resource_data;if(!Array.isArray(response_data)){response_data=[response_data];}
for(i=0;i<response_data.length;i+=1){resource_data=response_data[i];id=[resource_data.vendor,resource_data.name,resource_data.version].join('/');if(this.resourceExistsId(id)){continue;}
this._includeResource.call(this,resource_data);}};var process_packaged_upload_response=function process_packaged_upload_response(next,response_data){process_upload_response.call(this,response_data);if(typeof next==='function'){try{next();}catch(e){}}};var LocalCatalogue=new Wirecloud.WirecloudCatalogue({name:'local',permissions:{'delete':false}});LocalCatalogue.reload=function reload(options){if(typeof options!=='object'){options={};}
var context={'onSuccess':options.onSuccess,'onError':options.onError};if(Wirecloud.contextManager.get('username')!=='anonymous'){Wirecloud.io.makeRequest(Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:loadSuccessCallback.bind(this,context),onFailure:loadFailureCallback.bind(this,context)});}else{loadSuccessCallback.call(this,context,{responseText:"{}"});}};LocalCatalogue.uninstallResource=function uninstallResource(resource,options){var url;options=Wirecloud.Utils.merge({'allversions':false},options);if(options.allversions){url=Wirecloud.URLs.LOCAL_UNVERSIONED_RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name});}else{url=Wirecloud.URLs.LOCAL_RESOURCE_ENTRY.evaluate({vendor:resource.vendor,name:resource.name,version:resource.version.text});}
Wirecloud.io.makeRequest(url+'?affected=true',{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:uninstallSuccessCallback.bind(this,resource,options.onSuccess),onFailure:uninstallErrorCallback.bind(this,options),onComplete:options.onComplete});};LocalCatalogue.deleteResource=function deleteResource(resource,options){if(options==null){options={};}
options.onSuccess=uninstallOrDeleteSuccessCallback.bind(this,resource,options.onSuccess);Wirecloud.WirecloudCatalogue.prototype.deleteResource.call(this,resource,options);};LocalCatalogue.addPackagedResource=function addPackagedResource(data,options){if(options==null){options={};}
options.onSuccess=function(next,main_resource,extra_resources){process_packaged_upload_response.call(this,next,[main_resource].concat(extra_resources));}.bind(this,options.onSuccess);Wirecloud.WirecloudCatalogue.prototype.addPackagedResource.call(this,data,options);};LocalCatalogue.addResourceFromURL=function addResourceFromURL(url,options){if(typeof options!='object'){options={};}
Wirecloud.io.makeRequest(Wirecloud.URLs.LOCAL_RESOURCE_COLLECTION,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({template_uri:url,force_create:!!options.forceCreate,install_embedded_resources:true,market_endpoint:options.market_info}),onSuccess:function(response){var i,id,response_data,resource_data;response_data=JSON.parse(response.responseText);process_upload_response.call(this,[response_data.resource_details].concat(response_data.extra_resources));if(typeof options.onSuccess==='function'){options.onSuccess();}}.bind(this),onFailure:function(response){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding resource from URL: %(errorMsg)s."),response);if(typeof options.onFailure==='function'){options.onFailure(msg);}},onComplete:function(){if(typeof options.onComplete==='function'){options.onComplete();}}});};LocalCatalogue.getAvailableResourcesByType=function getAvailableResourcesByType(type){if(type in this.resourcesByType){return this.resourcesByType[type];}else{return{};}};LocalCatalogue._includeResource=function _includeResource(resource_data){var resource,resource_id,resource_full_id;resource_id=resource_data.vendor+'/'+resource_data.name;resource_full_id=resource_id+'/'+resource_data.version;switch(resource_data.type){case'widget':resource=new Wirecloud.Widget(resource_data);break;case'operator':resource=new Wirecloud.wiring.OperatorMeta(resource_data);if(Wirecloud.activeWorkspace!=null&&Wirecloud.activeWorkspace.wiring!=null){try{Wirecloud.activeWorkspace.wiring._notifyOperatorInstall(resource);}catch(error){}}
break;default:resource=resource_data;}
if(!(resource_id in this.resourceVersions)){this.resourceVersions[resource_id]=[];}
this.resourceVersions[resource_id].push(resource);this.resources[resource_full_id]=resource;if(!(resource_data.type in this.resourcesByType)){this.resourcesByType[resource_data.type]={};}
this.resourcesByType[resource_data.type][resource_full_id]=resource;};LocalCatalogue.getResourceId=function getResourceId(id){return this.resources[id];};LocalCatalogue.getResource=function getResource(vendor,name,version){var id=[vendor,name,version].join('/');return this.getResourceId(id);};LocalCatalogue.resourceExistsId=function resourceExistsId(id){return this.getResourceId(id)!=null;};LocalCatalogue.resourceExists=function resourceExists(resource){var id=[resource.vendor,resource.name,resource.version].join('/');return this.resourceExistsId(id);};Wirecloud.LocalCatalogue=LocalCatalogue;})();(function(){"use strict";var includeResource=function includeResource(resource_data){var resource,resource_id,resource_full_id;resource_id=resource_data.vendor+'/'+resource_data.name;resource_full_id=resource_id+'/'+resource_data.version;switch(resource_data.type){case'widget':resource=new Wirecloud.Widget(resource_data);break;case'operator':resource=new Wirecloud.wiring.OperatorMeta(resource_data);break;default:resource=resource_data;}
if(!(resource_id in this.resourceVersions)){this.resourceVersions[resource_id]=[];}
this.resourceVersions[resource_id].push(resource);this.resources[resource_full_id]=resource;if(!(resource_data.type in this.resourcesByType)){this.resourcesByType[resource_data.type]={};}
this.resourcesByType[resource_data.type][resource_full_id]=resource;};var loadSuccessCallback=function loadFailureCallback(context,transport){var resources,resource_id;resources=JSON.parse(transport.responseText);this.resources={};this.resourceVersions={};this.resourcesByType={};for(resource_id in resources){includeResource.call(this,resources[resource_id]);}
if(typeof context.onSuccess==='function'){context.onSuccess(this);}};var loadFailureCallback=function loadFailureCallback(context,transport){if(typeof context.onError==='function'){context.onError(this);}};var WorkspaceCatalogue=function WorkspaceCatalogue(workspace_id,options){Object.defineProperty(this,'workspace_id',{value:workspace_id});this.reload(options);};WorkspaceCatalogue.prototype.reload=function reload(options){if(typeof options!=='object'){options={};}
var context={'onSuccess':options.onSuccess,'onError':options.onError};var url=Wirecloud.URLs.WORKSPACE_RESOURCE_COLLECTION.evaluate({workspace_id:this.workspace_id});Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:loadSuccessCallback.bind(this,context),onFailure:loadFailureCallback.bind(this,context)});};WorkspaceCatalogue.prototype.getAvailableResourcesByType=function getAvailableResourcesByType(type){if(type in this.resourcesByType){return this.resourcesByType[type];}else{return{};}};WorkspaceCatalogue.prototype.getResourceId=function getResourceId(id){return this.resources[id];};WorkspaceCatalogue.prototype.getResource=function getResource(vendor,name,version){var id=[vendor,name,version].join('/');return this.getResourceId(id);};WorkspaceCatalogue.prototype.resourceExistsId=function resourceExistsId(id){return this.getResourceId(id)!=null;};WorkspaceCatalogue.prototype.resourceExists=function resourceExists(resource){var id=[resource.vendor,resource.name,resource.version.text].join('/');return this.resourceExistsId(id);};Wirecloud.WorkspaceCatalogue=WorkspaceCatalogue;})();(function(){"use strict";var LogManager=function LogManager(wiring){Wirecloud.LogManager.call(this,Wirecloud.GlobalLogManager);Object.defineProperty(this,'wiring',{value:wiring});};LogManager.prototype=new Wirecloud.LogManager();LogManager.prototype.buildExtraInfo=function buildExtraInfo(){var extraInfo=document.createElement('div');return extraInfo;};LogManager.prototype.buildTitle=function buildTitle(){return gettext('Wiring\'s logs');};LogManager.prototype.close=function close(){};Wirecloud.wiring.LogManager=LogManager;})();(function(){"use strict";var Endpoint=function Endpoint(name,type,friendCode,id){this.id=id;};Endpoint.prototype.getId=function getId(){return this.id;};Endpoint.prototype.getFinalSlots=function getFinalSlots(){return null;};Endpoint.prototype.fullDisconnect=function fullDisconnect(){var funcName='fullDisconnect';var msg=gettext("Unimplemented function: %(funcName)s");msg=interpolate(msg,{funcName:funcName},true);Wirecloud.GlobalLogManager.log(msg);return;};Endpoint.prototype.destroy=function destroy(){this.fullDisconnect();};Wirecloud.wiring.Endpoint=Endpoint;})();(function(){"use strict";var EndpointError=function EndpointError(message){this.name="EndpointError";this.message=message||"";};EndpointError.prototype=new Error();EndpointError.prototype.constructor=EndpointError;Object.freeze(EndpointError.prototype);Object.freeze(EndpointError);Wirecloud.wiring.EndpointError=EndpointError;})();(function(){"use strict";var SourceEndpoint=function SourceEndpoint(name,type,friendCode,id){Wirecloud.wiring.Endpoint.call(this,name,type,friendCode,id);this.outputs=[];};SourceEndpoint.prototype=new Wirecloud.wiring.Endpoint();SourceEndpoint.prototype.connect=function connect(out){if(!(out instanceof Wirecloud.wiring.TargetEndpoint)){throw new TypeError('Invalid target endpoint');}
this.outputs.push(out);out._addInput(this);};SourceEndpoint.prototype.disconnect=function disconnect(out){var index=this.outputs.indexOf(out);if(index!=-1){this.outputs.splice(index,1);out._removeInput(this);}};SourceEndpoint.prototype.fullDisconnect=function fullDisconnect(){var outputs=Wirecloud.Utils.clone(this.outputs);for(var i=0;i<outputs.length;++i){this.disconnect(outputs[i]);}};SourceEndpoint.prototype.propagate=function propagate(value,options){var i;options=Wirecloud.Utils.merge({initial:false},options);for(i=0;i<this.outputs.length;++i){this.outputs[i].propagate(value,options);}};SourceEndpoint.prototype.getFinalSlots=function getFinalSlots(){var slots=[];for(var i=0;i<this.outputs.length;++i){var currentSlots=this.outputs[i].getFinalSlots();if(currentSlots&&currentSlots.length>0){slots=slots.concat(currentSlots);}}
return slots;};Wirecloud.wiring.SourceEndpoint=SourceEndpoint;})();(function(){"use strict";var TargetEndpoint=function TargetEndpoint(name,type,friendCode,id){Wirecloud.wiring.Endpoint.call(this,name,type,friendCode,id);this.inputs=[];};TargetEndpoint.prototype=new Wirecloud.wiring.Endpoint();TargetEndpoint.prototype._addInput=function _addInput(input){this.inputs.push(input);};TargetEndpoint.prototype._removeInput=function _removeInput(input){var index=this.inputs.indexOf(input);if(index!=-1){this.inputs.splice(index,input);}};TargetEndpoint.prototype.fullDisconnect=function fullDisconnect(){var inputs=this.inputs.slice(0);for(var i=0;i<inputs.length;++i){inputs[i].disconnect(this);}};Wirecloud.wiring.TargetEndpoint=TargetEndpoint;})();(function(){"use strict";var GhostEntity=function GhostEntity(id,info){if(arguments.length===0){return;}
if(info.preferences==null){info.preferences={};}
Object.defineProperties(this,{'id':{value:id},'meta':{value:{uri:info.name,preferenceList:[]}},'name':{value:info.name},'title':{value:info.name},'preferences':{value:info.preferences,writable:true}});this.inputs={};this.outputs={};};GhostEntity.prototype.fillFromViewInfo=function fillFromViewInfo(data){var i,endpoint;if(!('endPointsInOuts'in data)){return;}
if('sources'in data.endPointsInOuts){for(i=0;i<data.endPointsInOuts.sources.length;i++){endpoint=new Wirecloud.wiring.GhostSourceEndpoint(this,data.endPointsInOuts.sources[i]);this.outputs[endpoint.name]=endpoint;}}
if('targets'in data.endPointsInOuts){for(i=0;i<data.endPointsInOuts.targets.length;i++){endpoint=new Wirecloud.wiring.GhostTargetEndpoint(this,data.endPointsInOuts.targets[i]);this.inputs[endpoint.name]=endpoint;}}};GhostEntity.prototype.destroy=function destroy(){};GhostEntity.prototype.fullDisconnect=function fullDisconnect(){var key,connectables;connectables=this.inputs;for(key in connectables){connectables[key].fullDisconnect();}
connectables=this.outputs;for(key in connectables){connectables[key].fullDisconnect();}};Wirecloud.wiring.GhostEntity=GhostEntity;var GhostOperator=function GhostOperator(id,info){GhostEntity.call(this,id,info);};GhostOperator.prototype=new GhostEntity();Wirecloud.wiring.GhostOperator=GhostOperator;var GhostSourceEndpoint=function GhostSourceEndpoint(entity,endpoint){Object.defineProperties(this,{'entity':{value:entity},'name':{value:endpoint},'label':{value:endpoint},'type':{value:'ioperator'},'friendcode':{value:'ghost_null'}});};GhostSourceEndpoint.prototype=new Wirecloud.wiring.SourceEndpoint();GhostSourceEndpoint.prototype.serialize=function serialize(){return{'type':this.type,'id':this.entity.id,'endpoint':this.name};};Wirecloud.wiring.GhostSourceEndpoint=GhostSourceEndpoint;var GhostTargetEndpoint=function GhostTargetEndpoint(entity,endpoint){Object.defineProperties(this,{'entity':{value:entity},'name':{value:endpoint},'label':{value:endpoint},'type':{value:'ioperator'},'friendcode':{value:'ghost_null'}});};GhostTargetEndpoint.prototype=new Wirecloud.wiring.TargetEndpoint();GhostTargetEndpoint.prototype.propagate=function propagate(newValue,options){};GhostTargetEndpoint.prototype.serialize=function serialize(){return{'type':this.type,'id':this.entity.id,'endpoint':this.name};};Wirecloud.wiring.GhostTargetEndpoint=GhostTargetEndpoint;})();(function(){"use strict";var OperatorFactory={};OperatorFactory.getAvailableOperators=function getAvailableOperators(){return Wirecloud.LocalCatalogue.getAvailableResourcesByType('operator');};OperatorFactory.getOperatorMeta=function getOperatorMeta(name){return Wirecloud.LocalCatalogue.getResourceId(name);};Wirecloud.wiring.OperatorFactory=OperatorFactory;})();(function(){"use strict";var OperatorLogManager=function OperatorLogManager(ioperator){Wirecloud.LogManager.call(this,ioperator.wiring.logManager);this.ioperator=ioperator;};OperatorLogManager.prototype=new Wirecloud.LogManager();OperatorLogManager.prototype.buildTitle=function buildTitle(){var title;if(this.ioperator){title=gettext('%(ioperator_title)s\'s logs');title=interpolate(title,{ioperator_title:this.ioperator.name},true);return title;}else{return this.title;}};OperatorLogManager.prototype.close=function close(){this.title=this.buildTitle();this.ioperator=null;};Wirecloud.wiring.OperatorLogManager=OperatorLogManager;})();(function(){"use strict";var Operator=function Operator(operator_meta,id,operator_status,wiring){var i,inputs,outputs,data_uri,preferenceList,preferences,readonly,hidden,key,value;if(["object","undefined"].indexOf(typeof operator_status)===-1){throw new TypeError('invalid operator status');}
if(operator_status==null){operator_status={};}
if(operator_status.preferences==null){operator_status.preferences={};}
StyledElements.ObjectWithEvents.call(this,['load','unload']);Object.defineProperties(this,{meta:{value:operator_meta},name:{value:operator_meta.name},title:{value:operator_meta.title},id:{value:""+id},wiring:{value:wiring}});Object.defineProperty(this,'logManager',{value:new Wirecloud.wiring.OperatorLogManager(this)});this.loaded=false;inputs=this.meta.inputs;this.inputs={};for(i=0;i<inputs.length;i++){this.inputs[inputs[i].name]=new Wirecloud.wiring.OperatorTargetEndpoint(this,inputs[i]);}
outputs=this.meta.outputs;this.outputs={};for(i=0;i<outputs.length;i++){this.outputs[outputs[i].name]=new Wirecloud.wiring.OperatorSourceEndpoint(this,outputs[i]);}
this.pending_events=[];preferenceList=[];preferences={};for(i=0;i<this.meta.preferenceList.length;i++){key=this.meta.preferenceList[i].name;if(key in operator_status.preferences){value=operator_status.preferences[key].value;readonly=operator_status.preferences[key].readonly;hidden=operator_status.preferences[key].hidden;}else{value=this.meta.preferenceList[i].default;readonly=hidden=false;}
preferences[key]=new Wirecloud.UserPref(this.meta.preferenceList[i],readonly,hidden,value);preferenceList.push(preferences[key]);}
Object.freeze(preferenceList);Object.defineProperty(this,'preferenceList',{value:preferenceList});Object.freeze(preferences);Object.defineProperty(this,'preferences',{value:preferences});if(wiring instanceof Wirecloud.Wiring){this.element=document.createElement('iframe');this.element.className='ioperator';data_uri=Wirecloud.URLs.OPERATOR_ENTRY.evaluate({vendor:operator_meta.vendor,name:operator_meta.name,version:operator_meta.version.text})+'#id='+id;this.element.addEventListener('load',function(){this.logManager.log('Operator loaded',Wirecloud.constants.LOGGING.INFO_MSG);this.loaded=true;this.events.load.dispatch(this);for(var i=0;i<this.pending_events.length;i+=1){this.inputs[this.pending_events[i].endpoint].propagate(this.pending_events[i].value);}
this.pending_events=[];}.bind(this),true);this.element.addEventListener('unload',function(){this.logManager.log('Operator unloaded',Wirecloud.constants.LOGGING.INFO_MSG);this.loaded=false;this.events.unload.dispatch(this);}.bind(this),true);this.element.setAttribute('type','text/html');this.element.setAttribute('src',data_uri);document.getElementById('workspace').appendChild(this.element);}};Operator.prototype=new StyledElements.ObjectWithEvents();Operator.prototype.registerPrefCallback=function registerPrefCallback(prefCallback){this.prefCallback=prefCallback;};Operator.prototype.fullDisconnect=function fullDisconnect(){var key,connectables;connectables=this.inputs;for(key in connectables){connectables[key].fullDisconnect();}
connectables=this.outputs;for(key in connectables){connectables[key].fullDisconnect();}};Operator.prototype.destroy=function destroy(){this.fullDisconnect();if(this.loaded){this.events.unload.dispatch(this);}
if(this.element.parentNode){this.element.parentNode.removeChild(this.element);}};Wirecloud.Operator=Operator;})();(function(){"use strict";var OperatorMeta=function OperatorMeta(desc){var inputs,outputs,prefList,prefs,pref,i;Wirecloud.MashableApplicationComponent.call(this,desc);prefList=desc.preferences;if(!Array.isArray(prefList)){prefList=[];}
prefs={};for(i=0;i<prefList.length;i+=1){pref=prefList[i]=new Wirecloud.UserPrefDef(prefList[i].name,prefList[i].type,prefList[i]);prefs[pref.name]=pref;}
Object.defineProperty(this,'preferences',{value:prefs});Object.defineProperty(this,'preferenceList',{value:prefList});inputs=desc.wiring.inputs;if(inputs==null){inputs={};}
Object.defineProperty(this,'inputs',{value:inputs});outputs=desc.wiring.outputs;if(outputs==null){outputs={};}
Object.defineProperty(this,'outputs',{value:outputs});};OperatorMeta.prototype.instantiate=function instantiate(id,operator_status,wiring){return new Wirecloud.Operator(this,id,operator_status,wiring);};Wirecloud.wiring.OperatorMeta=OperatorMeta;})();(function(){"use strict";var OperatorSourceEndpoint=function OperatorSourceEndpoint(operator,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'operator',{value:operator});Wirecloud.wiring.SourceEndpoint.call(this,this.meta.name,this.meta.type,this.friendcode,'ioperator_'+this.operator.id+'_'+this.meta.name);};OperatorSourceEndpoint.prototype=new Wirecloud.wiring.SourceEndpoint();OperatorSourceEndpoint.prototype.serialize=function serialize(){return{'type':'ioperator','id':this.operator.id,'endpoint':this.meta.name};};Wirecloud.wiring.OperatorSourceEndpoint=OperatorSourceEndpoint;})();(function(){"use strict";var OperatorTargetEndpoint=function OperatorTargetEndpoint(operator,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'operator',{value:operator});Wirecloud.wiring.TargetEndpoint.call(this,this.meta.name,this.meta.type,this.meta.friendcode,'ioperator_'+this.operator.id+'_'+this.meta.name);};OperatorTargetEndpoint.prototype=new Wirecloud.wiring.TargetEndpoint();OperatorTargetEndpoint.prototype.serialize=function serialize(){return{'type':'ioperator','id':this.operator.id,'endpoint':this.meta.name};};OperatorTargetEndpoint.prototype._is_target_slot=function _is_target_slot(list){var i,target;if(list==null){return true;}
for(i=0;i<list.length;i+=1){target=list[i];if((target.type==='ioperator')&&(target.id==this.operator.id)&&(target.endpoint==this.meta.name)){return true;}}
return false;};OperatorTargetEndpoint.prototype.getFinalSlots=function getFinalSlots(){var action_label=this.meta.action_label,result;if(!action_label||action_label===''){action_label=gettext('Use in %(slotName)s');action_label=interpolate(action_label,{slotName:this.meta.label},true);}
result=this.serialize();result.action_label=action_label;return[result];};OperatorTargetEndpoint.prototype.propagate=function propagate(newValue,options){var msg,details;if(!options||this._is_target_slot(options.targetEndpoints)){if(this.operator.loaded){if(this.callback==null){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=gettext('Operator has not registered a callback for this input endpoint');this.operator.logManager.log(msg,{details:details});return;}
try{this.callback.call(this.operator,newValue);}catch(error){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=this.operator.logManager.formatException(error);this.operator.logManager.log(msg,{details:details});}}else{this.operator.pending_events.push({'endpoint':this.meta.name,'value':newValue});}}};Wirecloud.wiring.OperatorTargetEndpoint=OperatorTargetEndpoint;})();(function(){"use strict";var WidgetSourceEndpoint=function WidgetSourceEndpoint(iwidget,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'iwidget',{value:iwidget});Wirecloud.wiring.SourceEndpoint.call(this,this.meta.name,this.meta.type,this.friendcode,'iwidget_'+iwidget.id+'_'+this.meta.name);};WidgetSourceEndpoint.prototype=new Wirecloud.wiring.SourceEndpoint();WidgetSourceEndpoint.prototype.serialize=function serialize(){return{'type':'iwidget','id':this.iwidget.id,'endpoint':this.meta.name};};Wirecloud.wiring.WidgetSourceEndpoint=WidgetSourceEndpoint;})();(function(){"use strict";var is_target_endpoint=function is_target_endpoint(list){var i,target;if(list==null){return true;}
for(i=0;i<list.length;i+=1){target=list[i];if(target.type==='iwidget'&&(target.id==this.widget.id)&&(target.endpoint==this.meta.name)){return true;}}
return false;};var WidgetTargetEndpoint=function WidgetTargetEndpoint(iwidget,meta){Object.defineProperty(this,'meta',{value:meta});Object.defineProperty(this,'name',{value:meta.name});Object.defineProperty(this,'friendcode',{value:meta.friendcode});Object.defineProperty(this,'label',{value:meta.label});Object.defineProperty(this,'description',{value:meta.description});Object.defineProperty(this,'iwidget',{value:iwidget});Wirecloud.wiring.TargetEndpoint.call(this,this.meta.name,this.meta.type,this.meta.friendcode,'iwidget_'+iwidget.id+'_'+this.meta.name);};WidgetTargetEndpoint.prototype=new Wirecloud.wiring.TargetEndpoint();WidgetTargetEndpoint.prototype.serialize=function serialize(){return{'type':'iwidget','id':this.iwidget.id,'endpoint':this.meta.name};};WidgetTargetEndpoint.prototype.getFinalSlots=function getFinalSlots(){var result,action_label=this.meta.action_label;if(!action_label||action_label===''){action_label=gettext('Use in %(slotName)s');action_label=interpolate(action_label,{slotName:this.meta.label},true);}
result=this.serialize();result.action_label=action_label;result.iWidgetName=this.iwidget.name;return[result];};WidgetTargetEndpoint.prototype.propagate=function propagate(newValue,options){var msg,details;if(!options||is_target_endpoint.call(this,options.targetEndpoints)){if(this.iwidget.loaded){if(this.callback==null){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=gettext('Widget has not registered a callback for this input endpoint');this.iwidget.logManager.log(msg,{details:details});return;}
try{this.callback.call(this.iwidget,newValue);}catch(error){msg=gettext('Exception catched while processing an event that reached the "%(inputendpoint)s" input endpoint');msg=interpolate(msg,{inputendpoint:this.meta.name},true);details=this.iwidget.logManager.formatException(error);this.iwidget.logManager.log(msg,{details:details});}}else{this.iwidget.pending_events.push({'endpoint':this.meta.name,'value':newValue});Wirecloud.activeWorkspace.getIWidget(this.iwidget.id).load();}}};Wirecloud.wiring.WidgetTargetEndpoint=WidgetTargetEndpoint;})();function Workspace(workspaceState,resources){var _failsafeInit=function(transport,e){this.valid=false;Wirecloud.GlobalLogManager.formatAndLog(gettext("Error loading workspace: %(errorMsg)s"),transport,e);var layoutManager=LayoutManagerFactory.getInstance();var msg=gettext('Error loading workspace. Please, change active workspace or create a new one.');(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();this.varmanager=null;this.contextManager=null;this.wiring=null;layoutManager.currentViewType="dragboard";this.preferences=Wirecloud.PreferenceManager.buildPreferences('workspace',{},this)
var initialTab={'id':0,'readOnly':"true",'iwidgets':[],'name':gettext("Unusable Tab"),'visible':1,'preferences':{}};this.workspaceState={'tabs':[initialTab]};this.tabInstances={};this.tabsByName={};this.notebook.clear()
this.tabInstances[0]=this.notebook.createTab({'tab_constructor':Tab,'tab_info':initialTab,'workspace':this});this.loaded=true;layoutManager.logStep('');};var loadWorkspace=function(){var layoutManager,params,preferenceValues,iwidgets;layoutManager=LayoutManagerFactory.getInstance();layoutManager.logStep('');layoutManager.logSubTask(gettext('Processing workspace data'));try{params=this.workspaceState.empty_params;preferenceValues=this.workspaceState.preferences;this.preferences=Wirecloud.PreferenceManager.buildPreferences('workspace',preferenceValues,this,params);this.restricted=!this.owned||Wirecloud.contextManager.get('mode')==='embedded';this.removable=!this.restricted&&this.workspaceState.removable;var tabs=this.workspaceState.tabs;var default_initial_tab=null;var loading_tab=this.notebook.createTab({'closeable':false});if(tabs.length>0){default_initial_tab=tabs[0];for(var i=0;i<tabs.length;i++){var tab=tabs[i];var tabInstance=this.notebook.createTab({'tab_constructor':Tab,'tab_info':tab,'workspace':this});this.tabInstances[tab.id]=tabInstance;this.tabsByName[tabInstance.getName()]=tabInstance;if(tab.visible){default_initial_tab=tabInstance;}}}
this.contextManager=new Wirecloud.ContextManager(this,this.workspaceState.context);this.wiring=new Wirecloud.Wiring(this);iwidgets=this.getIWidgets();for(i=0;i<iwidgets.length;i+=1){iwidgets[i].internal_iwidget.addEventListener('removed',this._iwidget_removed);this.events.iwidgetadded.dispatch(this,iwidgets[i].internal_iwidget);}
this.valid=true;LayoutManagerFactory.getInstance().mainLayout.repaint();LayoutManagerFactory.getInstance().header._notifyWorkspaceLoaded(this);this.wiring.load(this.workspaceState.wiring);var initial_tab=Wirecloud.HistoryManager.getCurrentState().tab;if(initial_tab!=null&&this.tabsByName[initial_tab]){this.notebook.goToTab(this.tabsByName[initial_tab]);}else if(default_initial_tab!=null){this.notebook.goToTab(default_initial_tab);}
loading_tab.close();}catch(error){_failsafeInit.call(this,transport,error);return;}
this.loaded=true;layoutManager.logStep('');Wirecloud.GlobalLogManager.log(gettext('Workspace loaded'),Wirecloud.constants.LOGGING.INFO_MSG);this.emptyWorkspaceInfoBox=document.createElement('div');this.emptyWorkspaceInfoBox.className='emptyWorkspaceInfoBox';var subBox=document.createElement('div');subBox.className='alert alert-info alert-block';var pTitle=document.createElement('h4');pTitle.textContent=gettext("Hey! Welcome to Wirecloud! This is an empty workspace");subBox.appendChild(pTitle);var message=document.createElement('p');message.innerHTML=gettext("To create really impressive mashup applications, the first step to take is always to add widgets in this area. To do so, please surf the <strong>Marketplace</strong> the place where resources are all in there, by clicking on the proper button up in the right corner!");subBox.appendChild(message);subBox.appendChild(Wirecloud.TutorialCatalogue.buildTutorialReferences(['basic-concepts']));this.emptyWorkspaceInfoBox.appendChild(subBox);this.notebook.getTabByIndex(0).wrapperElement.appendChild(this.emptyWorkspaceInfoBox);if(this.getIWidgets().length!==0){this.emptyWorkspaceInfoBox.classList.add('hidden');}}
var onError=function(transport,e){_failsafeInit.call(this,transport,e);}
var renameError=function(transport,e){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error renaming workspace: %(errorMsg)s."),transport,e);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();};var deleteSuccess=function(transport){this.events.removed.dispatch(this);LayoutManagerFactory.getInstance().logSubTask(gettext('Workspace removed successfully'));LayoutManagerFactory.getInstance().logStep('');};var deleteError=function(transport,e){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error removing workspace, changes will not be saved: %(errorMsg)s."),transport,e);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();LayoutManagerFactory.getInstance()._notifyPlatformReady();};var publishSuccess=function publishSuccess(options,response){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager.logSubTask(gettext('Workspace published successfully'));layoutManager.logStep('');layoutManager._notifyPlatformReady();Wirecloud.LocalCatalogue._includeResource(JSON.parse(response.responseText));layoutManager.viewsByName.myresources.viewsByName.search.mark_outdated();if(typeof options.onSuccess==='function'){try{options.onSuccess();}catch(e){}}};var publishFailure=function publishFailure(options,transport,e){var layoutManager,msg;layoutManager=LayoutManagerFactory.getInstance();msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error publishing workspace: %(errorMsg)s."),transport,e);layoutManager._notifyPlatformReady();if(typeof options.onFailure==='function'){try{options.onFailure(msg);}catch(e){}}};var mergeSuccess=function(transport){var response=transport.responseText;var data=JSON.parse(response);var workspace=new Workspace(Wirecloud.workspaceInstances[data.merged_workspace_id]);Wirecloud.changeActiveWorkspace(workspace);LayoutManagerFactory.getInstance().hideCover();}
var mergeError=function(transport,e){var layoutManager,msg;msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error merging workspaces: %(errorMsg)s."),transport,e);layoutManager=LayoutManagerFactory.getInstance();layoutManager.logStep('');layoutManager._notifyPlatformReady();(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();}
var createTabSuccess=function(transport){var layoutManager=LayoutManagerFactory.getInstance();var response=transport.responseText;var tabInfo=JSON.parse(response);tabInfo.iwidgets=[];tabInfo.preferences={};var newTab=this.notebook.createTab({'tab_constructor':Tab,'tab_info':tabInfo,'workspace':this});this.tabInstances[tabInfo.id]=newTab;this.tabsByName[newTab.getName()]=newTab;layoutManager.logSubTask(gettext('Tab added successfully'));layoutManager.logStep('');};var createTabError=function(transport,e){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error creating a tab: %(errorMsg)s."),transport,e);};var iwidget_removed=function iwidget_removed(iwidget){this.events.iwidgetremoved.dispatch(this,iwidget);if(this.getIWidgets().length==0){this.emptyWorkspaceInfoBox.classList.remove('hidden');}};Workspace.prototype.addInstance=function addInstance(widget,options){this.getVisibleTab().getDragboard().addInstance(widget,options);};Workspace.prototype.getHeader=function(){return this.headerHTML;}
Workspace.prototype.rename=function rename(name){var layoutManager,workspaceUrl,msg=null;name=name.trim();if(name===""){throw new TypeError(gettext("Invalid workspace name"));}
if(msg!==null){Wirecloud.GlobalLogManager.log(msg);return;}
layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Renaming workspace"),1);msg=gettext('Renaming "%(workspacename)s" to "%(newname)s"');msg=interpolate(msg,{workspacename:this.workspaceState.name,newname:name},true);layoutManager.logSubTask(msg);workspaceUrl=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({workspace_id:this.id});Wirecloud.io.makeRequest(workspaceUrl,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({name:name}),onSuccess:function(){var state,layoutManager=LayoutManagerFactory.getInstance();this.workspaceState.name=name;this.contextManager.modify({'name':name});state={workspace_creator:this.workspaceState.creator,workspace_name:name,view:"workspace",tab:Wirecloud.HistoryManager.getCurrentState().tab};Wirecloud.HistoryManager.replaceState(state);layoutManager.header.refresh();layoutManager.logSubTask(gettext('Workspace renamed successfully'));layoutManager.logStep('');}.bind(this),onFailure:renameError,onException:renameError,onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});};Workspace.prototype.delete=function(){var layoutManager,workspaceUrl;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Removing workspace"),2);msg=gettext('Removing "%(workspacename)s"');msg=interpolate(msg,{workspacename:this.workspaceState.name},true);layoutManager.logSubTask(msg);workspaceUrl=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({workspace_id:this.id});Wirecloud.io.makeRequest(workspaceUrl,{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:deleteSuccess.bind(this),onFailure:deleteError,onException:deleteError});};Workspace.prototype.getName=function(){return this.workspaceState.name;}
Workspace.prototype.initGUI=function initGUI(){this.notebook.addEventListener("tabDeletion",function(notebook,tab){delete this.tabInstances[tab.id];delete this.tabsByName[tab.getName()];}.bind(this));if(this.isAllowed('edit')){this.notebook.addEventListener('newTab',this.addTab.bind(this));}
if(Wirecloud.Utils.isFullscreenSupported()){this.fullscreenButton=new StyledElements.StyledButton({'iconClass':'icon-resize-full',title:gettext('Full screen')});this.notebook.addButton(this.fullscreenButton);Wirecloud.Utils.onFullscreenChange(this.notebook,function(){this.fullscreenButton.removeIconClassName('icon-resize-full');this.fullscreenButton.removeIconClassName('icon-resize-small');if(this.notebook.fullscreen){this.fullscreenButton.addIconClassName('icon-resize-small');this.fullscreenButton.setTitle(gettext('Exit full screen'));this.notebook.addClassName('fullscreen');}else{this.fullscreenButton.addIconClassName('icon-resize-full');this.fullscreenButton.setTitle(gettext('Full screen'));this.notebook.removeClassName('fullscreen');}}.bind(this));this.fullscreenButton.addEventListener('click',function(){if(this.notebook.fullscreen){this.notebook.exitFullscreen();}else{this.notebook.requestFullscreen();}}.bind(this));}
if(Wirecloud.contextManager.get('mode')==='embedded'){this.seeOnWirecloudButton=new StyledElements.StyledButton({'class':'powered-by-wirecloud'});this.notebook.addButton(this.seeOnWirecloudButton);this.seeOnWirecloudButton.addEventListener('click',function(){var url=Wirecloud.URLs.WORKSPACE_VIEW.evaluate({owner:encodeURIComponent(this.workspaceState.creator),name:encodeURIComponent(this.workspaceState.name)});window.open(url,'_blank')}.bind(this));}else{this.poweredByWirecloudButton=new StyledElements.StyledButton({'class':'powered-by-wirecloud'});this.notebook.addButton(this.poweredByWirecloudButton);this.poweredByWirecloudButton.addEventListener('click',function(){window.open('http://conwet.fi.upm.es/wirecloud/','_blank')});}
LayoutManagerFactory.getInstance().viewsByName.workspace.repaint();};Workspace.prototype.getIWidget=function(iwidgetId){for(var key in this.tabInstances){var tab=this.tabInstances[key];var iwidget=tab.getDragboard().getIWidget(iwidgetId);if(iwidget){return iwidget;}}
return null;}
Workspace.prototype.isValid=function(){return this.valid;}
Workspace.prototype.getTab=function(tabId){return this.tabInstances[tabId];}
Workspace.prototype.getVisibleTab=function(){if(!this.loaded)
return;return this.notebook.getVisibleTab();}
Workspace.prototype.tabExists=function(tabName){return tabName in this.tabsByName;};Workspace.prototype.addTab=function(){var layoutManager,msg,counter,prefixName,tabName,url;if(!this.isValid()){return;}
layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Adding a tab to the workspace"),1);msg=gettext('Adding tab to "%(workspacename)s"');msg=interpolate(msg,{workspacename:this.workspaceState.name},true);layoutManager.logSubTask(msg);counter=Object.keys(this.tabInstances).length+1;prefixName=gettext("Tab");tabName=prefixName+" "+counter.toString();while(this.tabExists(tabName)){tabName=prefixName+" "+(counter++).toString();}
url=Wirecloud.URLs.TAB_COLLECTION.evaluate({workspace_id:this.id});Wirecloud.io.makeRequest(url,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({name:tabName}),onSuccess:createTabSuccess.bind(this),onFailure:createTabError,onException:createTabError,onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});}
Workspace.prototype.removeTab=function(tab){var msg=null;if(Object.keys(this.tabInstances).length<=1){msg=gettext("there must be one tab at least");msg=interpolate(gettext("Error removing tab: %(errorMsg)s."),{errorMsg:msg},true);}else if(tab.hasReadOnlyIWidgets()){msg=gettext("it contains some widgets that cannot be removed");msg=interpolate(gettext("Error removing tab: %(errorMsg)s."),{errorMsg:msg},true);}
if(msg){Wirecloud.GlobalLogManager.log(msg);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();return false;}
tab.delete();return true;}
Workspace.prototype.unload=function(){var layoutManager=LayoutManagerFactory.getInstance();layoutManager.logSubTask(gettext("Unloading current workspace"));this.loaded=false;this.notebook.clear();this.tabInstances=null;this.tabsByName=null;if(this.pref_window_menu!=null){this.pref_window_menu.destroy();this.pref_window_menu=null;}
if(this.preferences){this.preferences.destroy();this.preferences=null;}
if(this.wiring!==null){this.wiring.destroy();this.wiring=null;}
this.contextManager=null;layoutManager.logStep('');Wirecloud.GlobalLogManager.log(gettext('workspace unloaded'),Wirecloud.constants.LOGGING.INFO_MSG);Wirecloud.GlobalLogManager.newCycle();}
Workspace.prototype.addIWidget=function(tab,iwidget,iwidgetJSON,options){this.emptyWorkspaceInfoBox.classList.add('hidden');iwidget.internal_iwidget.addEventListener('removed',this._iwidget_removed);this.events.iwidgetadded.dispatch(this,iwidget.internal_iwidget);options.setDefaultValues.call(this,iwidget.id);iwidget.paint();};Workspace.prototype.getIWidgets=function(){var iWidgets=[];for(var keys in this.tabInstances){iWidgets=iWidgets.concat(this.tabInstances[keys].getDragboard().getIWidgets());}
return iWidgets;}
Workspace.prototype.getActiveDragboard=function(){var current_tab=this.notebook.getVisibleTab();if(current_tab){return current_tab.getDragboard();}else{return null;}};Workspace.prototype.publish=function(data,options){var layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext('Publishing current workspace'),1);if(options==null){options={};}
var payload=new FormData();if(data.image!=null){payload.append('image',data.image);}
delete data.image;payload.append('json',JSON.stringify(data));var workspaceUrl=Wirecloud.URLs.WORKSPACE_PUBLISH.evaluate({workspace_id:this.id});Wirecloud.io.makeRequest(workspaceUrl,{method:'POST',requestHeaders:{'Accept':'application/json'},postBody:payload,context:{workspace:this,params:data,options:options},onSuccess:publishSuccess.bind(null,options),onFailure:publishFailure.bind(null,options),onComplete:function(){if(typeof options.onComplete==='function'){options.onComplete();}}});};Workspace.prototype.mergeWith=function(workspace){var workspaceUrl,layoutManager,msg;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Merging workspaces"),1);msg=gettext('Merging "%(srcworkspace)s" into "%(dstworkspace)s"');msg=interpolate(msg,{srcworkspace:workspace.name,dstworkspace:this.getName()},true);layoutManager.logSubTask(msg);workspaceUrl=Wirecloud.URLs.WORKSPACE_MERGE.evaluate({to_ws_id:this.id});Wirecloud.io.markeRequest(workspaceUrl,{method:'POST',contentType:'application/json',postBody:JSON.stringify({'workspace':from_ws_id}),onSuccess:mergeSuccess,onFailure:mergeError});};Workspace.prototype.isShared=function(){return this.workspaceState['shared'];};Workspace.prototype._isAllowed=function _isAllowed(action){return Wirecloud.PolicyManager.evaluate('workspace',action);};Workspace.prototype.isAllowed=function(action){var username,workspaces,nworkspaces;if(action!=="remove"&&(!this.valid||this.restricted)){return false;}
switch(action){case"remove":username=Wirecloud.contextManager.get('username');workspaces=Wirecloud.workspacesByUserAndName[username];if(workspaces!=null){nworkspaces=Object.keys(workspaces).length;}else{nworkspaces=0;}
return this.removable&&(nworkspaces>1);case"merge_workspaces":return this._isAllowed('add_remove_iwidgets')||this._isAllowed('merge_workspaces');case"catalogue_view_widgets":return this._isAllowed('add_remove_iwidgets');case"catalogue_view_mashups":return this.isAllowed('add_remove_workspaces')||this._isAllowed('merge_workspaces');case"update_preferences":return this.removable&&this._isAllowed('change_workspace_preferences');case"rename":return this.removable&&this._isAllowed('rename_workspaces');case"edit":return this.removable;default:return this._isAllowed(action);}};Object.defineProperty(this,'id',{value:workspaceState.id});Object.defineProperty(this,'resources',{value:resources});Object.defineProperty(this,'owned',{value:workspaceState.owned});Object.defineProperty(this,'_iwidget_removed',{value:iwidget_removed.bind(this)});this.workspaceState=workspaceState;this.tabInstances={};this.tabsByName={};this.highlightTimeouts={};this.wiring=null;this.contextManager=null;this.loaded=false;this.valid=false;StyledElements.ObjectWithEvents.call(this,['iwidgetadded','iwidgetremoved','removed']);this.notebook=new StyledElements.StyledNotebook({'class':'workspace se-notebook-bottom'});LayoutManagerFactory.getInstance().viewsByName['workspace'].clear();LayoutManagerFactory.getInstance().viewsByName['workspace'].appendChild(this.notebook);loadWorkspace.call(this);this.initGUI();this.markAsActive=function(){var workspaceUrl=Wirecloud.URLs.WORKSPACE_ENTRY.evaluate({'workspace_id':this.id});Wirecloud.io.makeRequest(workspaceUrl,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({active:true}),onSuccess:this.markAsActiveSuccess.bind(this),onFailure:this.markAsActiveError.bind(this)});}.bind(this);this.markAsActiveSuccess=function(){this.workspaceState.active=true;if(this.activeEntryId!=null){this.confMenu.removeOption(this.activeEntryId);this.activeEntryId=null;}}.bind(this);this.markAsActiveError=function(transport,e){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error marking as first active workspace, changes will not be saved: %(errorMsg)s."),transport,e);}.bind(this);};Workspace.prototype=new StyledElements.ObjectWithEvents();Workspace.prototype.getPreferencesWindow=function getPreferencesWindow(){if(this.pref_window_menu==null){this.pref_window_menu=new Wirecloud.ui.PreferencesWindowMenu('workspace',this.preferences);}
return this.pref_window_menu;};Workspace.prototype.drawAttention=function drawAttention(iWidgetId){var iWidget=this.getIWidget(iWidgetId);if(iWidget!==null){this.highlightTab(iWidget.layout.dragboard.tab);iWidget.layout.dragboard.raiseToTop(iWidget);iWidget.highlight();}};Workspace.prototype.highlightTab=function highlightTab(tab){if(typeof tab==='number'){tab=this.tabInstances[tab];}
if(!(tab instanceof Tab)){throw new TypeError();}
tab.tabElement.classList.add("highlight");};Workspace.prototype.unhighlightTab=function unhighlightTab(tab){if(typeof tab==='number'){tab=this.tabInstances[tab];}
if(!(tab instanceof Tab)){throw new TypeError();}
tab.tabElement.classList.remove("highlight");};(function(){"use strict";var WorkspaceListItems=function(handler){StyledElements.DynamicMenuItems.call(this);this.handler=handler;};WorkspaceListItems.prototype=new StyledElements.DynamicMenuItems();WorkspaceListItems.prototype.build=function(){var workspace_name,items,workspace,username,user_workspaces;items=[];username=Wirecloud.contextManager.get('username');user_workspaces=Wirecloud.workspacesByUserAndName[username];if(user_workspaces==null||Object.keys(user_workspaces).length===0){items.push(new StyledElements.MenuItem(gettext('Empty workspace list'),this.handler,null));items[0].disable();return items;}
for(workspace_name in user_workspaces){workspace=user_workspaces[workspace_name];items.push(new StyledElements.MenuItem(workspace_name,this.handler,workspace));}
return items;};Wirecloud.ui.WorkspaceListItems=WorkspaceListItems;})();(function(){"use strict";var WorkspaceViewItems=function WorkspaceViewItems(){StyledElements.DynamicMenuItems.call(this);};WorkspaceViewItems.prototype=new StyledElements.DynamicMenuItems();WorkspaceViewItems.prototype.build=function(){var current_workspace,item,items;items=[];current_workspace=Wirecloud.activeWorkspace;item=new StyledElements.MenuItem(gettext('Rename'),function(){(new Wirecloud.ui.RenameWindowMenu(current_workspace,'rename')).show();}.bind(this));items.push(item);item.setDisabled(current_workspace==null||!current_workspace.isAllowed('rename'));item=new StyledElements.MenuItem(gettext('Settings'),function(){current_workspace.getPreferencesWindow().show();});items.push(item);item.setDisabled(current_workspace==null||!current_workspace.isAllowed('update_preferences'));item=new StyledElements.MenuItem(gettext("Remove"),function(){var msg=gettext('Do you really want to remove the "%(workspaceName)s" workspace?');msg=interpolate(msg,{workspaceName:current_workspace.workspaceState.name},true);var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(function(){current_workspace.delete();});dialog.show();}.bind(this));items.push(item);item.setDisabled(current_workspace==null||!current_workspace.isAllowed('remove'));item=new StyledElements.MenuItem(gettext('New workspace'),function(){var dialog=new Wirecloud.ui.NewWorkspaceWindowMenu();dialog.show();}.bind(this));items.push(item);item=new StyledElements.MenuItem(gettext('Embed'),function(){var title=gettext('Embed Code');var path=Wirecloud.URLs.WORKSPACE_VIEW.evaluate({owner:encodeURIComponent(current_workspace.workspaceState.creator),name:encodeURIComponent(current_workspace.workspaceState.name)});var workspace_url=document.location.protocol+'//'+document.location.host+path+'?mode=embedded';var dialog=new Wirecloud.ui.EmbedCodeWindowMenu(title,'<iframe src="'+workspace_url+'" frameborder="0" allowfullscreen></iframe>');dialog.show();});items.push(item);item=new StyledElements.MenuItem(gettext('Upload to my resources'),function(){LayoutManagerFactory.getInstance().viewsByName.marketplace.waitMarketListReady({onComplete:function(){var dialog=new Wirecloud.ui.PublishWorkspaceWindowMenu(current_workspace);dialog.show();}});}.bind(this));items.push(item);item.setDisabled(current_workspace==null);return items;};Wirecloud.ui.WorkspaceViewItems=WorkspaceViewItems;})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var _search=function _search(keywords){this._list.classList.add('disabled');Wirecloud.LocalCatalogue.search({scope:this.search_scope,search_criteria:keywords,onSuccess:function(widgets,search_info){var i,msg;if(this.resource_painter==null){this.resource_painter=new Wirecloud.ui.ResourcePainter(null,Wirecloud.currentTheme.templates.wallet_widget,null,{'mainbutton':function(options,context,resource){var tooltip=this.resourceButtonTooltip;if(typeof tooltip==='function'){tooltip=tooltip(resource);}
var button=new StyledElements.StyledButton({'class':'mainbutton btn-primary','iconClass':this.resourceButtonIconClass,'title':tooltip});button.addEventListener('click',this.resourceButtonListener.bind(null,resource));return button;}.bind(this)});}
this._list.innerHTML='';if(search_info.total_count!==0){if('corrected_query'in search_info){msg=gettext("<p>Showing results for <b><t:corrected_query/></b></p>");this.resource_painter.paintInfo(msg,{corrected_query:search_info.corrected_query}).insertInto(this._list);}
for(i=0;i<widgets.length;i+=1){this.resource_painter.paint(widgets[i]).insertInto(this._list);}}else{msg=gettext("<p>We couldn't find anything for your search - <b>%(keywords)s.</b></p>"+"<p>Suggestions:</p>"+"<ul>"+"<li>Make sure all words are spelled correctly.</li>"+"<li>Try different keywords.</li>"+"<li>Try more general keywords.</li>"+"</ul>");msg=interpolate(msg,{keywords:Wirecloud.Utils.escapeHTML(keywords.trim())},true);this.resource_painter.paintError(new StyledElements.Fragment(msg)).insertInto(this._list);}}.bind(this),onComplete:function(){this._list.classList.remove('disabled');}.bind(this)});};var _keywordTimeoutHandler=function _keywordTimeoutHandler(input){this._search_timeout=null;_search.call(this,input.getValue());};var _onSearchInput=function _onSearchInput(input){if(this._search_timeout!==null){clearTimeout(this._search_timeout);}
this._search_timeout=setTimeout(_keywordTimeoutHandler.bind(this,input),700);};var _onSearchInputKeyPress=function _onSearchInputKeyPress(input,event){if(event.keyCode===13){if(this._search_timeout!==null){clearTimeout(this._search_timeout);}
_keywordTimeoutHandler.call(this,input);}};var MACSearch=function MACSearch(options){options=Wirecloud.Utils.merge({'extra_template_context':null,'scope':'','template':'macsearch'},options);StyledElements.StyledElement.call(this,[]);this._list=document.createElement('div');this._list.className='widget_wallet_list';var input;var template=Wirecloud.currentTheme.templates[options.template];this.wrapperElement=builder.parse(template,Wirecloud.Utils.merge({searchinput:function(){input=new StyledElements.StyledTextField({'placeholder':'Keywords...'});input.inputElement.addEventListener('keypress',_onSearchInputKeyPress.bind(this,input));input.addEventListener('change',_onSearchInput.bind(this));return input;}.bind(this),list:this._list},options.extra_template_context)).elements[1];Object.defineProperties(this,{'inputField':{value:input},'search_scope':{value:options.scope,writable:true},'resourceButtonIconClass':{value:options.resourceButtonIconClass},'resourceButtonListener':{value:options.resourceButtonListener},'resourceButtonTooltip':{value:options.resourceButtonTooltip}});this.input=input;_search.call(this,'');};MACSearch.prototype=new StyledElements.StyledElement();MACSearch.prototype.refresh=function refresh(){_keywordTimeoutHandler.call(this,this.input);};MACSearch.prototype.focus=function focus(){this.inputField.focus();};Wirecloud.ui.MACSearch=MACSearch;})();(function(){"use strict";var buttontitle=function buttontitle(resource){if(resource.type==='widget'){return gettext('Add to workspace');}else{return gettext('Merge');}};var buttonlistener=function buttonlistener(resource){if(resource.type==='widget'){var local_widget=Wirecloud.LocalCatalogue.getResource(resource.vendor,resource.name,resource.version);Wirecloud.activeWorkspace.addInstance(local_widget);}else{Wirecloud.mergeWorkspace(resource,{onFailure:function(msg,details){var dialog;if(details!=null&&'missingDependencies'in details){dialog=new Wirecloud.ui.MissingDependenciesWindowMenu(null,details);}else{dialog=new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG);}
dialog.show();}});}};var MACWallet=function MACWallet(){};MACWallet.prototype.show=function show(){if(this.wallet!=null){return;}
this.wallet=new Wirecloud.ui.MACSearch({extra_template_context:{addmore:function(){var div=document.createElement('div');div.className='widget_wallet_addmore';var button=new StyledElements.StyledButton({text:gettext('Get more resources'),"class":"btn-success"});button.addEventListener('click',function(){LayoutManagerFactory.getInstance().changeCurrentView('marketplace');});button.insertInto(div);return div;},scope:function(){var pills=new StyledElements.Pills();pills.add('widget','Widgets');pills.add('mashup','Mashups');pills.switchPill('widget');pills.addEventListener('change',function(pills,enabled_pill){this.wallet.search_scope=enabled_pill;this.wallet.refresh();}.bind(this));return pills;}.bind(this),closebutton:function(){var button=new StyledElements.StyledButton({"class":"icon-remove",plain:true});button.addEventListener('click',function(){this.hide();}.bind(this));return button;}.bind(this)},resourceButtonIconClass:'icon-plus',resourceButtonTooltip:buttontitle,resourceButtonListener:buttonlistener,scope:'widget',template:'wallet'});Wirecloud.activeWorkspace.notebook.contentArea.appendChild(this.wallet.wrapperElement);Wirecloud.UserInterfaceManager._registerPopup(this);setTimeout(function(){this.wallet.focus();this.wallet.addClassName('in');}.bind(this),0);};var _hide=function _hide(){if(this.wallet!=null&&this.wallet.wrapperElement.parentNode){this.wallet.wrapperElement.parentNode.removeChild(this.wallet.wrapperElement);Wirecloud.UserInterfaceManager._unregisterPopup(this);}
this.wallet=null;};MACWallet.prototype.hide=function hide(instant){if(this.wallet!=null){if(instant!==true&&this.wallet.hasClassName('in')){this.wallet.wrapperElement.addEventListener('transitionend',_hide.bind(this));this.wallet.removeClassName('in');}else{_hide.call(this);}}};Wirecloud.ui.MACWallet=MACWallet;})();(function(){"use strict";var WorkspaceView=function WorkspaceView(id,options){options.id='workspace';StyledElements.Alternative.call(this,id,options);this.wsMenu=new StyledElements.PopupMenu();this.wsMenu.append(new Wirecloud.ui.WorkspaceListItems(function(context,workspace){Wirecloud.changeActiveWorkspace(workspace);}));this.wsMenu.appendSeparator();this.wsMenu.append(new Wirecloud.ui.WorkspaceViewItems(this));this.wallet=new Wirecloud.ui.MACWallet();this.walletButton=new StyledElements.StyledButton({'iconClass':'icon-plus','title':gettext('Add widget')});this.walletButton.addEventListener('click',function(){this.wallet.show();}.bind(this));this.wiringButton=new StyledElements.StyledButton({'iconClass':'icon-puzzle-piece','title':gettext('Wiring')});this.wiringButton.addEventListener('click',function(){LayoutManagerFactory.getInstance().changeCurrentView('wiring');});this.myresourcesButton=new StyledElements.StyledButton({'iconClass':'icon-archive','title':gettext('My Resources')});this.myresourcesButton.addEventListener('click',function(){LayoutManagerFactory.getInstance().changeCurrentView('myresources');});this.marketButton=new StyledElements.StyledButton({'iconClass':'icon-shopping-cart','title':gettext('Marketplace')});this.marketButton.addEventListener('click',function(){LayoutManagerFactory.getInstance().changeCurrentView('marketplace');});this.wiringErrorBadge=document.createElement('span');this.wiringErrorBadge.className='badge badge-important hidden';this.wiringButton.wrapperElement.appendChild(this.wiringErrorBadge);Wirecloud.events.activeworkspacechanged.addEventListener(function(workspace){this.wallet.hide(true);this._updateWiringErrors=function(){this.wiringErrorBadge.innerHTML=workspace.wiring.logManager.errorCount;if(workspace.wiring.logManager.errorCount!==0){this.wiringErrorBadge.classList.remove('hidden');}else{this.wiringErrorBadge.classList.add('hidden');}}.bind(this);workspace.wiring.addEventListener('load',this._updateWiringErrors);workspace.wiring.addEventListener('unloaded',this._updateWiringErrors);workspace.wiring.logManager.addEventListener('newentry',this._updateWiringErrors);this._updateWiringErrors();}.bind(this));};WorkspaceView.prototype=new StyledElements.Alternative();WorkspaceView.prototype.view_name='workspace';WorkspaceView.prototype.buildStateData=function buildStateData(){var currentState=Wirecloud.HistoryManager.getCurrentState();return{workspace_creator:currentState.workspace_creator,workspace_name:currentState.workspace_name,view:'workspace'};};WorkspaceView.prototype.getBreadcrum=function getBreadcrum(){var workspace_name,entries,current_state;current_state=Wirecloud.HistoryManager.getCurrentState();if('workspace_creator'in current_state){entries=[{'label':current_state.workspace_creator},{'label':current_state.workspace_name,}];}else{entries=[{'label':gettext('loading...')}];}
return entries;};WorkspaceView.prototype.getTitle=function getTitle(){var current_state=Wirecloud.HistoryManager.getCurrentState();if('workspace_creator'in current_state){return current_state.workspace_creator+'/'+current_state.workspace_name;}else{return gettext('loading...');}};WorkspaceView.prototype.getToolbarMenu=function getToolbarMenu(){var context,current_state,menu;current_state=Wirecloud.HistoryManager.getCurrentState();if('workspace_creator'in current_state){context=Wirecloud.contextManager;if(context&&context.get('username')!=='anonymous'){return this.wsMenu;}}
return null;};WorkspaceView.prototype.getToolbarButtons=function getToolbarButtons(){if(Wirecloud.contextManager&&Wirecloud.contextManager.get('username')!=='anonymous'){this.walletButton.setDisabled(Wirecloud.activeWorkspace==null||!Wirecloud.activeWorkspace.isAllowed('edit'));this.wiringButton.setDisabled(Wirecloud.activeWorkspace==null||!Wirecloud.activeWorkspace.isAllowed('edit'));return[this.walletButton,this.wiringButton,this.myresourcesButton,this.marketButton];}else{return[];}};WorkspaceView.prototype.onHistoryChange=function onHistoryChange(newState){var target_tab,current_tab,nextWorkspace,alert_msg;nextWorkspace=Wirecloud.workspacesByUserAndName[newState.workspace_creator][newState.workspace_name];if(nextWorkspace==null){if(Wirecloud.activeWorkspace!=null){Wirecloud.activeWorkspace.unload();Wirecloud.activeWorkspace=null;}
alert_msg=document.createElement('div');alert_msg.className='alert alert-info';alert_msg.textContent=gettext('The requested workspace is no longer available (it was deleted).');;LayoutManagerFactory.getInstance().viewsByName['workspace'].clear();LayoutManagerFactory.getInstance().viewsByName['workspace'].appendChild(alert_msg);LayoutManagerFactory.getInstance().header.refresh();}else if(Wirecloud.activeWorkspace==null||(nextWorkspace.id!==Wirecloud.activeWorkspace.id)){Wirecloud.changeActiveWorkspace(nextWorkspace,newState.tab,{replaceNavigationState:'leave'});}else if(newState.tab!=null){target_tab=Wirecloud.activeWorkspace.tabsByName[newState.tab];Wirecloud.activeWorkspace.notebook.goToTab(target_tab);document.title=newState.workspace_creator+'/'+newState.workspace_name;}else{document.title=newState.workspace_creator+'/'+newState.workspace_name;}};WorkspaceView.prototype.destroy=function destroy(){if(this.wsMenu){this.wsMenu.destroy();this.wsMenu=null;}
StyledElements.Alternative.destroy();};Wirecloud.ui.WorkspaceView=WorkspaceView;})();(function(){"use strict";var onTabRemove=function onTabRemove(tab){if(tab.getIWidgets().length!==0){var msg=gettext('Do you really want to delete the tab "%(tabName)s"?');msg=Wirecloud.Utils.interpolate(msg,{tabName:tab.getName()});var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(new StyledElements.Fragment(msg));dialog.setHandler(tab.workspace.removeTab.bind(tab.workspace,tab));dialog.show();}else{tab.workspace.removeTab(tab);}};var TabMenuItems=function TabMenuItems(tab){StyledElements.DynamicMenuItems.call(this);this.tab=tab;};TabMenuItems.prototype=new StyledElements.DynamicMenuItems();TabMenuItems.prototype.build=function build(){var items,item;items=[];items.push(new StyledElements.MenuItem(gettext("Rename"),function(){(new Wirecloud.ui.RenameWindowMenu(this,'updateInfo')).show();}.bind(this.tab)));if(!this.tab.tabInfo.visible){items.push(new StyledElements.MenuItem(gettext("Mark as Visible"),this.tab.markAsVisible.bind(this.tab)));}
item=new StyledElements.MenuItem(gettext("Remove"),onTabRemove.bind(null,this.tab));items.push(item);item.setDisabled(!this.tab.isAllowed('remove'));items.push(new StyledElements.MenuItem(gettext("Settings"),function(){this.getPreferencesWindow().show();}.bind(this.tab)));return items;};window.TabMenuItems=TabMenuItems;})();(function(){"use strict";var renameSuccess=function renameSuccess(transport){var currentState,layoutManager;layoutManager=LayoutManagerFactory.getInstance();delete this.tab.workspace.tabsByName[this.tab.getName()];this.tab.workspace.tabsByName[this.newName]=this.tab;this.tab.tabInfo.name=this.newName;this.tab.rename(this.newName);if(this.tab.workspace.getVisibleTab()===this.tab){var currentState=Wirecloud.HistoryManager.getCurrentState();var newState=Wirecloud.Utils.clone(currentState);newState.tab=this.newName;Wirecloud.HistoryManager.replaceState(newState);}
layoutManager.logSubTask(gettext('Tab renamed successfully'));layoutManager.logStep('');};var renameError=function renameError(transport,e){var msg=Wirecloud.GlobaLogManager.formatError(gettext("Error renaming tab: %(errorMsg)s."),transport,e);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();};var deleteSuccess=function deleteSuccess(transport){var iwidgets,i,layoutManager=LayoutManagerFactory.getInstance();iwidgets=this.getIWidgets();for(i=0;i<iwidgets.length;i++){iwidgets[i].remove(true);}
this.close();layoutManager.logSubTask(gettext('Tab deleted successfully'));layoutManager.logStep('');};var deleteError=function deleteError(transport,e){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error removing tab: %(errorMsg)s."),transport,e);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();};var preferencesChanged=function preferencesChanged(preferences,modifiedValues){var preferenceName;if('baselayout'in modifiedValues){this.dragboard._updateBaseLayout();}};var Tab=function Tab(id,notebook,options){var button,tabInfo=options.tab_info;options.name=tabInfo.name;options.closable=false;StyledElements.Tab.call(this,id,notebook,options);Object.defineProperty(this,'id',{value:tabInfo.id});Object.defineProperty(this,'workspace',{value:options.workspace});this.addEventListener('show',function(tab){var currentState=Wirecloud.HistoryManager.getCurrentState();var newState=Wirecloud.Utils.clone(currentState);newState.tab=tab.getName();if(currentState.tab!=null){if(currentState.tab!==newState.tab){Wirecloud.HistoryManager.pushState(newState);}}else{Wirecloud.HistoryManager.replaceState(newState);}
tab.paint();});if(!this.workspace.restricted){this.menu_button=new StyledElements.PopupButton({'class':'icon-tab-menu','plain':true,'menuOptions':{'position':['top-left','top-right']}});this.menu_button.getPopupMenu().append(new TabMenuItems(this));this.menu_button.insertInto(this.tabElement,this.tabElement.childNodes[0]);}
this.tabInfo=tabInfo;this.dragboardLayerName="dragboard_"+this.workspace.workspaceState.id+"_"+this.id;this.FloatingWidgetsMenu=null;this.preferences=Wirecloud.PreferenceManager.buildPreferences('tab',this.tabInfo.preferences,this);this.preferences.addEventListener('pre-commit',preferencesChanged.bind(this));this.readOnly=this.workspace.restricted;this.dragboard=new Dragboard(this,this.workspace,this.wrapperElement);this.markAsVisible=function markAsVisible(){var tabUrl=Wirecloud.URLs.TAB_ENTRY.evaluate({'workspace_id':this.workspace.workspaceState.id,'tab_id':this.id});Wirecloud.io.makeRequest(tabUrl,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({visible:"true"}),onSuccess:this.markAsVisibleSuccess,onFailure:this.markAsVisibleError,onException:this.markAsVisibleError});}.bind(this);this.markAsVisibleSuccess=function markAsVisibleSuccess(){for(var key in this.workspace.tabInstances){var tab=this.workspace.tabInstances[key];tab.tabInfo.visible=false;}
this.tabInfo.visible=true;}.bind(this);this.markAsVisibleError=function markAsVisibleError(transport,e){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error marking as first visible tab, changes will not be saved: %(errorMsg)s."),transport,e);}.bind(this);};Tab.prototype=new StyledElements.Tab();Tab.prototype.getName=function getName(){return this.tabInfo.name;};Tab.prototype.updateInfo=function updateInfo(tabName){var layoutManager,tabUrl,msg=null;tabName=tabName.trim();if(tabName===""){msg=interpolate(gettext("Error updating a tab: invalid name"),true);}else if(this.workspace.tabExists(tabName)){msg=interpolate(gettext("Error updating a tab: the name %(tabName)s is already in use in workspace %(wsName)s."),{tabName:tabName,wsName:this.workspace.workspaceState.name},true);}
if(msg!==null){Wirecloud.GlobalLogManager.log(msg);return;}
layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Renaming tab"),1);msg=gettext('Renaming "%(tabname)s" to "%(newname)s"');msg=interpolate(msg,{tabname:this.tabInfo.name,newname:tabName},true);layoutManager.logSubTask(msg);tabUrl=Wirecloud.URLs.TAB_ENTRY.evaluate({'workspace_id':this.workspace.workspaceState.id,'tab_id':this.id});Wirecloud.io.makeRequest(tabUrl,{method:'PUT',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify({'name':tabName}),onSuccess:renameSuccess.bind({tab:this,newName:tabName}),onFailure:renameError,onException:renameError,onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});};Tab.prototype.delete=function(){var layoutManager,tabUrl,msg;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Removing tab"),1);msg=gettext('Removing "%(tabname)s" from server');msg=interpolate(msg,{tabname:this.tabInfo.name},true);layoutManager.logSubTask(msg);tabUrl=Wirecloud.URLs.TAB_ENTRY.evaluate({'workspace_id':this.workspace.workspaceState.id,'tab_id':this.id});Wirecloud.io.makeRequest(tabUrl,{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:deleteSuccess.bind(this),onFailure:deleteError,onException:deleteError,onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});};Tab.prototype.paint=function paint(){this.getDragboard().paint();};Tab.prototype.getDragboard=function getDragboard(){return this.dragboard;};Tab.prototype.getIWidgets=function getIWidgets(){return this.dragboard.getIWidgets();};Tab.prototype.getHeader=function getHeader(){return this.workspace.getHeader();};Tab.prototype.hasIWidget=function hasIWidget(iWidgetIds){var i;for(i in iWidgetIds){if(this.dragboard.getIWidget(iWidgetIds[i])){return true;}}
return false;};Tab.prototype.hasReadOnlyIWidgets=function hasReadOnlyIWidgets(){return this.dragboard.hasReadOnlyIWidgets();};Tab.prototype.getPreferencesWindow=function getPreferencesWindow(){if(this.pref_window_menu==null){this.pref_window_menu=new Wirecloud.ui.PreferencesWindowMenu('tab',this.preferences);}
return this.pref_window_menu;};Tab.prototype.isAllowed=function isAllowed(action){switch(action){case"remove":return!this.readOnly&&Object.keys(this.workspace.tabInstances).length>1&&!this.hasReadOnlyIWidgets();default:return false;}};Tab.prototype.repaint=function repaint(temporal){StyledElements.Tab.prototype.repaint.call(this,temporal);if(!temporal){this.dragboard._notifyWindowResizeEvent();}};Tab.prototype.destroy=function destroy(){if(this.pref_window_menu!=null){this.pref_window_menu.destroy();this.pref_window_menu=null;}
this.preferences.destroy();this.preferences=null;if(this.menu_button){this.menu_button.destroy();this.menu_button=null;}
this.dragboard.destroy();this.dragboard=null;StyledElements.Alternative.prototype.destroy.call(this);};window.Tab=Tab;})();(function(){"use strict";var MyResourcesView=function MyResourcesView(id,options){var resource_extra_context;options.class='catalogue myresources';StyledElements.Alternative.call(this,id,options);this.catalogue=Wirecloud.LocalCatalogue;this.alternatives=new StyledElements.StyledAlternatives();this.appendChild(this.alternatives);this.viewsByName={'search':this.alternatives.createAlternative({alternative_constructor:CatalogueSearchView,containerOptions:{catalogue:this,resource_painter:Wirecloud.ui.ResourcePainter,resource_extra_context:resource_extra_context}}),'details':this.alternatives.createAlternative({alternative_constructor:Wirecloud.ui.WirecloudCatalogue.ResourceDetailsView,containerOptions:{catalogue:this}}),'developer':this.alternatives.createAlternative({alternative_constructor:Wirecloud.ui.WirecloudCatalogue.PublishView,containerOptions:{catalogue:this.catalogue,mainview:this}})};this.viewsByName.search.init();this.uploadButton=new StyledElements.StyledButton({'iconClass':'icon-cloud-upload','title':gettext('Upload')});this.uploadButton.addEventListener('click',function(){this.changeCurrentView('developer');}.bind(this));this.marketButton=new StyledElements.StyledButton({'iconClass':'icon-shopping-cart','title':gettext('Marketplace')});this.marketButton.addEventListener('click',function(){LayoutManagerFactory.getInstance().changeCurrentView('marketplace');});this.alternatives.addEventListener('preTransition',function(alternatives,out_alternative){LayoutManagerFactory.getInstance().header._notifyViewChange();});this.addEventListener('show',this.refresh_if_needed.bind(this));};MyResourcesView.prototype=new StyledElements.Alternative();MyResourcesView.prototype.view_name='myresources';MyResourcesView.prototype.buildStateData=function buildStateData(){var currentState,data,subview;currentState=Wirecloud.HistoryManager.getCurrentState();data={workspace_creator:currentState.workspace_creator,workspace_name:currentState.workspace_name,view:'myresources',subview:'search'};subview=this.alternatives.getCurrentAlternative();if(subview.view_name!=null){data.subview=subview.view_name;if('buildStateData'in subview){subview.buildStateData(data);}}
return data;};MyResourcesView.prototype.onHistoryChange=function onHistoryChange(state){var details,parts,currentResource;if(state.subview==='search'){this.changeCurrentView(state.subview,{});}else{parts=state.resource.split('/');details={vendor:parts[0],name:parts[1]};currentResource=this.viewsByName.details.currentEntry;if(currentResource!=null&&currentResource.vendor==details.vendor&&currentResource.name==details.name){details=currentResource;}
this.createUserCommand('showDetails',details,{tab:state.tab,version:parts[2]})();}};MyResourcesView.prototype.goUp=function goUp(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){LayoutManagerFactory.getInstance().changeCurrentView('workspace');}
this.changeCurrentView('search');};MyResourcesView.prototype.getBreadcrum=function getBreadcrum(){var breadcrum=[gettext('My Resources')];if(this.alternatives.getCurrentAlternative()===this.viewsByName.details&&this.viewsByName.details.currentEntry!=null){breadcrum.push(this.viewsByName.details.currentEntry.title);}
return breadcrum;};MyResourcesView.prototype.getTitle=function getTitle(){var currentResource;if(this.alternatives.getCurrentAlternative()===this.viewsByName.details){currentResource=this.viewsByName.details.currentEntry;if(currentResource!=null){return Wirecloud.Utils.interpolate(gettext('My Resources - %(resource)s'),{resource:currentResource.uri});}}
return gettext('My Resources');};MyResourcesView.prototype.getToolbarButtons=function getToolbarButtons(){return[this.uploadButton,this.marketButton];};MyResourcesView.prototype.search=function search(onSuccess,onError,options){return this.catalogue.search(onSuccess,onError,options);};MyResourcesView.prototype.changeCurrentView=function changeCurrentView(view_name,options){if(!(view_name in this.viewsByName)){throw new TypeError();}
if(options==null){options={onComplete:function(alternatives,out_alternative){this.refresh_if_needed();var new_status=this.buildStateData();Wirecloud.HistoryManager.pushState(new_status);LayoutManagerFactory.getInstance().header._notifyViewChange(this);}.bind(this)};}
this.alternatives.showAlternative(this.viewsByName[view_name],options);};MyResourcesView.prototype.home=function home(){this.changeCurrentView('search');};MyResourcesView.prototype.createUserCommand=function createUserCommand(command){return this.ui_commands[command].apply(this,Array.prototype.slice.call(arguments,1));};MyResourcesView.prototype.ui_commands={};MyResourcesView.prototype.ui_commands.install=function install(resource,catalogue_source){return function(){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Importing resource into local repository"),3);layoutManager.logSubTask(gettext('Uploading resource'));this.catalogue.addResourceFromURL(resource.description_url,{onSuccess:function(){LayoutManagerFactory.getInstance().logSubTask(gettext('Resource installed successfully'));LayoutManagerFactory.getInstance().logStep('');this.refresh_search_results();catalogue_source.home();catalogue_source.refresh_search_results();}.bind(this),onFailure:function(msg){(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(msg);},onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});}.bind(this);};MyResourcesView.prototype.ui_commands.uninstall=function uninstall(resource,catalogue_source){return function(){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Uninstalling resource"),3);layoutManager.logSubTask(gettext('Uninstalling resource'));this.catalogue.uninstallResource(resource,{onSuccess:function(){LayoutManagerFactory.getInstance().logSubTask(gettext('Resource uninstalled successfully'));LayoutManagerFactory.getInstance().logStep('');this.refresh_search_results();if(catalogue_source!=null){catalogue_source.home();catalogue_source.refresh_search_results();}}.bind(this),onFailure:function(msg){(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(msg);},onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});}.bind(this);};MyResourcesView.prototype.ui_commands.uninstallall=function uninstallall(resource,catalogue_source){return function(){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Uninstalling resource"),3);layoutManager.logSubTask(gettext('Uninstalling resource'));this.catalogue.uninstallResource(resource,{allversions:true,onSuccess:function(){LayoutManagerFactory.getInstance().logSubTask(gettext('Resource uninstalled successfully'));LayoutManagerFactory.getInstance().logStep('');this.refresh_search_results();if(catalogue_source!=null){catalogue_source.home();catalogue_source.refresh_search_results();}}.bind(this),onFailure:function(msg){(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(msg);},onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});}.bind(this);};MyResourcesView.prototype.ui_commands.publishOtherMarket=function publishOtherMarket(resource){return function(){var marketplaceview=LayoutManagerFactory.getInstance().viewsByName.marketplace;marketplaceview.waitMarketListReady({include_markets:true,onComplete:function(){var dialog,msg;if(marketplaceview.number_of_alternatives>0){dialog=new Wirecloud.ui.PublishResourceWindowMenu(resource);}else{msg=gettext("You have not configured any marketplace to upload this resource. Please, configure one on the Marketplace view.");dialog=new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.WARN_MSG);}
dialog.show();}});}.bind(this);};MyResourcesView.prototype.ui_commands.showDetails=function showDetails(resource,options){if(options==null){options={};}
return function(e){var onSuccess=function onSuccess(resource_details){if(options.version!=null){resource_details.changeVersion(options.version);}
this.viewsByName.details.paint(resource_details,{tab:options.tab});this.viewsByName.details.repaint();};var viewChanged=false,dataLoaded=false;var onComplete=function onComplete(){if(options.preventDefault!==true){var new_status=this.buildStateData();Wirecloud.HistoryManager.pushState(new_status);LayoutManagerFactory.getInstance().header._notifyViewChange(this);}
Wirecloud.Utils.callCallback(options.onComplete);};var onCompleteRequest=function onCompleteRequest(){this.viewsByName.details.enable();dataLoaded=true;if(viewChanged&&dataLoaded){onComplete.call(this);}};this.viewsByName.details.disable();this.changeCurrentView('details',{onComplete:function(){LayoutManagerFactory.getInstance().changeCurrentView('myresources',{onComplete:function(){viewChanged=true;if(viewChanged&&dataLoaded){onComplete.call(this);}}.bind(this)});}.bind(this)});if(resource instanceof Wirecloud.WirecloudCatalogue.ResourceDetails){onSuccess.call(this,resource);onCompleteRequest.call(this);}else{this.catalogue.getResourceDetails(resource.vendor,resource.name,{onSuccess:onSuccess.bind(this),onComplete:onCompleteRequest.bind(this)});}}.bind(this);};MyResourcesView.prototype.ui_commands.delete=function(resource){var success_callback,error_callback,doRequest,msg,context;success_callback=function(response){LayoutManagerFactory.getInstance()._notifyPlatformReady();this.home();this.refresh_search_results();}.bind(this);error_callback=function(msg){LayoutManagerFactory.getInstance()._notifyPlatformReady();(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();};doRequest=function(){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Deleting resource from catalogue"),3);layoutManager.logSubTask(gettext('Requesting server'));this.catalogue.deleteResource(resource,{onSuccess:success_callback,onFailure:error_callback});};msg=gettext('Do you really want to remove the "%(name)s" (vendor: "%(vendor)s", version: "%(version)s") resource?');context={vendor:resource.vendor,name:resource.name,version:resource.version.text};msg=interpolate(msg,context,true);return function(){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(doRequest.bind(this));dialog.show();}.bind(this);};MyResourcesView.prototype.ui_commands.deleteall=function deleteall(resource){var success_callback,error_callback,doRequest,msg,context;success_callback=function(response){LayoutManagerFactory.getInstance()._notifyPlatformReady();this.home();this.refresh_search_results();}.bind(this);error_callback=function(msg){LayoutManagerFactory.getInstance()._notifyPlatformReady();(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();};doRequest=function(){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Deleting all versions of the resource from catalogue"),3);layoutManager.logSubTask(gettext('Requesting server'));this.catalogue.deleteResource(resource,{allversions:true,onSuccess:success_callback,onFailure:error_callback});};msg=gettext('Do you really want to remove all versions of the (vendor: "%(vendor)s", name: "%(name)s") resource?');context={vendor:resource.vendor,name:resource.name};msg=interpolate(msg,context,true);return function(){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(doRequest.bind(this));dialog.show();}.bind(this);};MyResourcesView.prototype.refresh_if_needed=function refresh_if_needed(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){this.viewsByName.search.refresh_if_needed();}};MyResourcesView.prototype.refresh_search_results=function(){this.viewsByName.search.source.refresh();};Wirecloud.ui.MyResourcesView=MyResourcesView;})();(function(){"use strict";var MarketplaceView,onGetMarketsSuccess,onGetMarketsFailure,onGetMarketsComplete,auto_select_initial_market,notifyError,builder,ERROR_TEMPLATE;ERROR_TEMPLATE='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="alert alert-error"><t:message/></div></s:styledgui>';builder=new StyledElements.GUIBuilder();notifyError=function notifyError(message,context){var error_alert;message=builder.parse(builder.DEFAULT_OPENING+message+builder.DEFAULT_CLOSING,context);error_alert=builder.parse(ERROR_TEMPLATE,{'message':message});this.errorsAlternative.clear();this.errorsAlternative.appendChild(error_alert);this.alternatives.showAlternative(this.errorsAlternative);};auto_select_initial_market=function auto_select_initial_market(){var market_names=Object.keys(this.viewsByName);if(market_names.length>0){this.alternatives.showAlternative(this.viewsByName[market_names[0]]);}else{var msg=gettext("<p>WireCloud is not connected with any marketplace.</p>"+"<p>Suggestions:</p>"+"<ul>"+"<li>Connect WireCloud with a new marketplace.</li>"+"<li>Go to the my resources view instead</li>"+"</ul>");notifyError.call(this,msg);}};onGetMarketsSuccess=function onGetMarketsSuccess(options,view_info){var info,old_views,view_element,view_constructor,first_element=null;this.loading=false;old_views=this.viewsByName;this.viewsByName={};for(info in view_info){view_element=view_info[info];if(info in old_views){this.viewsByName[info]=old_views[info];delete old_views[info];}else{view_constructor=Wirecloud.MarketManager.getMarketViewClass(view_element.type);this.viewsByName[info]=this.alternatives.createAlternative({alternative_constructor:view_constructor,containerOptions:{catalogue:this,marketplace_desc:view_element}});}
this.number_of_alternatives+=1;if(first_element===null){first_element=this.viewsByName[info];}}
for(info in old_views){this.alternatives.removeAlternative(old_views[info]);old_views[info].destroy();}
if(this.isVisible()){if(this.temporalAlternatives.indexOf(this.alternatives.getCurrentAlternative())!==-1){auto_select_initial_market.call(this);}else{LayoutManagerFactory.getInstance().header.refresh();}}
if(typeof options.onSuccess==='function'){options.onSuccess();}};onGetMarketsFailure=function onGetMarketsFailure(options,msg){this.loading=false;this.errorsAlternative.clear();notifyError.call(this,msg);if(typeof options.onFailure==='function'){options.onFailure();}};onGetMarketsComplete=function onGetMarketsComplete(options){var i;for(i=0;i<this.callbacks.length;i+=1){try{this.callbacks[i]();}catch(e){}}
this.callbacks=[];if(typeof options.onComplete==='function'){options.onComplete();}};MarketplaceView=function MarketplaceView(id,options){options.id='marketplace';StyledElements.Alternative.call(this,id,options);this.viewsByName={};this.alternatives=new StyledElements.StyledAlternatives();this.emptyAlternative=this.alternatives.createAlternative();this.errorsAlternative=this.alternatives.createAlternative({containerOptions:{'class':'marketplace-error-view'}});this.temporalAlternatives=[this.emptyAlternative,this.errorsAlternative];this.alternatives.addEventListener('postTransition',function(alternatives,out_alternative,in_alternative){var new_status=this.buildStateData();if(this.temporalAlternatives.indexOf(out_alternative)!==-1){Wirecloud.HistoryManager.replaceState(new_status);}else{Wirecloud.HistoryManager.pushState(new_status);}
LayoutManagerFactory.getInstance().header.refresh();}.bind(this));this.appendChild(this.alternatives);this.marketMenu=new StyledElements.PopupMenu();this.marketMenu.append(new Wirecloud.ui.MarketplaceViewMenuItems(this));this.addEventListener('show',function(view){if(view.loading===null){Wirecloud.MarketManager.getMarkets(onGetMarketsSuccess.bind(view,{}),onGetMarketsFailure.bind(view,{}),onGetMarketsComplete.bind(view,{}));view.loading=true;}
if(view.loading===false&&!view.error){if(view.alternatives.getCurrentAlternative()===view.emptyAlternative){auto_select_initial_market.call(view);}else{view.alternatives.getCurrentAlternative().refresh_if_needed();}}});Object.defineProperty(this,'error',{get:function(){return this.alternatives.getCurrentAlternative()===this.errorsAlternative;}});this.myresourcesButton=new StyledElements.StyledButton({'iconClass':'icon-archive','title':gettext('My Resources')});this.myresourcesButton.addEventListener('click',function(){LayoutManagerFactory.getInstance().changeCurrentView('myresources');});this.number_of_alternatives=0;this.loading=null;this.callbacks=[];};MarketplaceView.prototype=new StyledElements.Alternative();MarketplaceView.prototype.view_name='marketplace';MarketplaceView.prototype.buildStateData=function buildStateData(){var currentState,data,subview;currentState=Wirecloud.HistoryManager.getCurrentState();data={workspace_creator:currentState.workspace_creator,workspace_name:currentState.workspace_name,view:'marketplace'};if(this.loading===false&&this.error===false&&this.alternatives.getCurrentAlternative()!==this.emptyAlternative){subview=this.alternatives.getCurrentAlternative().alternatives.getCurrentAlternative();if(subview.view_name!=null){data.subview=subview.view_name;if('buildStateData'in subview){subview.buildStateData(data);}}
data.market=this.alternatives.getCurrentAlternative().market_id;}
return data;};MarketplaceView.prototype.onHistoryChange=function onHistoryChange(state){this.changeCurrentMarket(state.market);if('onHistoryChange'in this.viewsByName[state.market]){this.viewsByName[state.market].onHistoryChange(state);}};MarketplaceView.prototype.goUp=function goUp(){var current_alternative,change=false;current_alternative=this.alternatives.getCurrentAlternative();if(this.temporalAlternatives.indexOf(current_alternative)===-1){change=this.alternatives.getCurrentAlternative().goUp();}
if(!change){LayoutManagerFactory.getInstance().changeCurrentView('workspace');}};MarketplaceView.prototype.getBreadcrum=function getBreadcrum(){var label,breadcrum,current_alternative;current_alternative=this.alternatives.getCurrentAlternative();if(current_alternative===this.emptyAlternative){return[gettext('loading marketplace view...')];}else if(current_alternative===this.errorsAlternative){return[gettext('marketplace list not available')];}else{breadcrum=['marketplace'];if(current_alternative.desc.user){breadcrum.push(current_alternative.desc.user);}
breadcrum.push(current_alternative.getLabel());if(current_alternative.alternatives.getCurrentAlternative().view_name==='details'){breadcrum.push({label:current_alternative.alternatives.getCurrentAlternative().currentEntry.title,'class':'resource_title'});}
return breadcrum;}};MarketplaceView.prototype.getTitle=function getTitle(){var current_alternative,marketname;current_alternative=this.alternatives.getCurrentAlternative();if(current_alternative===this.emptyAlternative||current_alternative===this.errorsAlternative){return gettext('Marketplace');}else{if(current_alternative.desc.user){marketname=current_alternative.desc.user+'/'+current_alternative.getLabel();}else{marketname=current_alternative.getLabel();}
return Wirecloud.Utils.interpolate(gettext('Marketplace - %(marketname)s'),{marketname:marketname});}};MarketplaceView.prototype.getToolbarMenu=function getToolbarMenu(){return this.marketMenu;};MarketplaceView.prototype.getToolbarButtons=function getToolbarButtons(){return[this.myresourcesButton];};MarketplaceView.prototype.waitMarketListReady=function waitMarketListReady(options){if(options==null||typeof options.onComplete!=='function'){throw new TypeError('missing onComplete callback');}
if(options.include_markets===true){options.onComplete=function(onComplete){var count=Object.keys(this.viewsByName).length;if(count===0){try{onComplete();}catch(e){}
return;}
var listener=function(){if(--count===0){onComplete();}};for(var key in this.viewsByName){this.viewsByName[key].wait_ready(listener);}}.bind(this,options.onComplete);}
if(this.loading===false){try{options.onComplete();}catch(e){}
return;}
this.callbacks.push(options.onComplete);if(this.loading===null){Wirecloud.MarketManager.getMarkets(onGetMarketsSuccess.bind(this,{}),onGetMarketsFailure.bind(this,{}),onGetMarketsComplete.bind(this,{}));this.loading=true;}};MarketplaceView.prototype.refreshViewInfo=function refreshViewInfo(options){if(this.loading===true){return;}
if(typeof options!=='object'){options={};}
this.loading=true;LayoutManagerFactory.getInstance().header.refresh();this.number_of_alternatives=0;Wirecloud.MarketManager.getMarkets(onGetMarketsSuccess.bind(this,options),onGetMarketsFailure.bind(this,options),onGetMarketsComplete.bind(this,options));};MarketplaceView.prototype.addMarket=function addMarket(market_info){var view_constructor=Wirecloud.MarketManager.getMarketViewClass(market_info.type);market_info.permissions={'delete':true};this.viewsByName[market_info.name]=this.alternatives.createAlternative({alternative_constructor:view_constructor,containerOptions:{catalogue:this,marketplace_desc:market_info}});this.number_of_alternatives+=1;this.alternatives.showAlternative(this.viewsByName[market_info.name]);};MarketplaceView.prototype.changeCurrentMarket=function changeCurrentMarket(market){this.alternatives.showAlternative(this.viewsByName[market]);};Wirecloud.ui.MarketplaceView=MarketplaceView;})();(function(){"use strict";var initEmptyCatalogueInfoBox=function initEmptyCatalogueInfoBox(){this.emptyBox=document.createElement('div');this.emptyBox.className='catalogueEmptyBox';var wrapper=document.createElement('div');wrapper.className='alert alert-info';var pTitle=document.createElement('h4');pTitle.textContent=gettext("Empty Marketplace!");wrapper.appendChild(pTitle);var message=document.createElement('p');message.innerHTML=gettext("This is an empty Marketplace. You can upload widgets or operators using the button to the right of the name of the marketplace");wrapper.appendChild(message);this.emptyBox.appendChild(wrapper);};var CatalogueSearchView=function CatalogueSearchView(id,options){var builder,context,extra_context,resource_template;options['class']='search_interface loading';this.catalogue=options.catalogue;StyledElements.Alternative.call(this,id,options);if(options.gui_template==null){options.gui_template='wirecloud_catalogue_search_interface';}
builder=new StyledElements.GUIBuilder();this.source=new StyledElements.PaginatedSource({'pageSize':30,'order_by':'-creation_date','keywords':'','scope':'all','requestFunc':this._search.bind(this),'processFunc':function(elements,search_info){var i,msg;this.resource_list.clear();if('corrected_query'in search_info){msg=gettext("<p>Showing results for <b><t:corrected_query/></b></p>");this.resource_list.appendChild(this.resource_painter.paintInfo(msg,{corrected_query:search_info.corrected_query}));}
for(i=0;i<elements.length;i+=1){this.resource_list.appendChild(this.resource_painter.paint(elements[i]));}}.bind(this)});this.source.addEventListener('optionsChanged',function(source,options){this.scopeSelect.setValue(options.scope);this.simple_search_input.setValue(options.keywords);update_resetbutton.call(this,options);}.bind(this));this.source.addEventListener('requestStart',this.disable.bind(this));this.source.addEventListener('requestEnd',function(pagination,error){var msg;if(error!=null){this.resource_painter.setError(gettext('Connection error: No resources retrieved.'));}
if(pagination.pCachedTotalCount===0&&pagination.pOptions.keywords.trim()===""&&pagination.pOptions.scope==='all'){this.resource_list.appendChild(this.emptyBox);}else if(pagination.pCachedTotalCount===0){msg=gettext("<p>We couldn't find anything for your search - <b>%(keywords)s.</b></p>"+"<p>Suggestions:</p>"+"<ul>"+"<li>Make sure all words are spelled correctly.</li>"+"<li>Try different keywords.</li>"+"<li>Try more general keywords.</li>"+"</ul>");msg=interpolate(msg,{keywords:Wirecloud.Utils.escapeHTML(pagination.pOptions.keywords.trim())},true);this.resource_painter.setError(new StyledElements.Fragment(msg));}
this.enable();}.bind(this));this.resource_list=new StyledElements.Container({'class':'resource_list'});this.simple_search_input=new StyledElements.StyledTextField({'class':'simple_search_text','placeholder':'Keywords...'});this.simple_search_input.inputElement.addEventListener('keypress',this._onSearchInputKeyPress.bind(this));this.simple_search_input.addEventListener('change',onSearchInput.bind(this));if('extra_context'in options){extra_context=options.extra_context;}else{extra_context={};}
context=Wirecloud.Utils.merge(extra_context,{'resourcelist':this.resource_list,'pagination':function(){return new StyledElements.PaginationInterface(this.source);}.bind(this),'reset_button':function(){var button=new StyledElements.StyledButton({text:gettext('Refresh')});button.addEventListener('click',function(){this.source.changeOptions({'correct_query':true,'keywords':'',scope:'all'});}.bind(this));this.view_allbutton=button;return button;}.bind(this),'orderby':function(){var select=new StyledElements.StyledSelect({'initialValue':'-creation_date','initialEntries':[{'label':gettext('Creation date'),'value':'-creation_date'},{'label':gettext('Title'),'value':'name'},{'label':gettext('Vendor'),'value':'vendor'}]});select.addEventListener('change',function(select){this.source.changeOptions({'order_by':select.getValue()});}.bind(this));return select;}.bind(this),'scope':function(){var select=new StyledElements.StyledSelect({'initialValue':'all','initialEntries':[{'label':gettext('All'),'value':'all'},{'label':gettext('Widgets'),'value':'widget'},{'label':gettext('Mashups'),'value':'mashup'},{'label':gettext('Operators'),'value':'operator'}]});select.addEventListener('change',function(select){this.source.changeOptions({'scope':select.getValue()});}.bind(this));this.scopeSelect=select;return select;}.bind(this),'searchinput':this.simple_search_input});var contents=builder.parse(Wirecloud.currentTheme.templates[options.gui_template],context);this.appendChild(contents);this.timeout=null;this._keywordTimeoutHandler=this._keywordTimeoutHandler.bind(this);this.initialized=false;this._last_search=false;if('resource_template'in options){resource_template=options.resource_template;}else{resource_template='catalogue_resource_template';}
this.resource_painter=new options.resource_painter(this.catalogue,Wirecloud.currentTheme.templates[resource_template],this.resource_list,options.resource_extra_context);this.addEventListener('show',this.refresh_if_needed.bind(this));initEmptyCatalogueInfoBox.call(this);};CatalogueSearchView.prototype=new StyledElements.Alternative();CatalogueSearchView.prototype.init=function init(){this.initialized=true;};CatalogueSearchView.prototype.view_name='search';CatalogueSearchView.prototype.mark_outdated=function mark_outdated(){this._last_search=false;};CatalogueSearchView.prototype.refresh_if_needed=function refresh_if_needed(){if(this.initialized&&(this._last_search===false||(this._last_search+(2*60*60*1000))<Date.now())){this.source.refresh();}};CatalogueSearchView.prototype._search=function _search(page,options,onSuccess,onError){options={'order_by':options.order_by,'search_criteria':options.keywords,'scope':options.scope,'pagenum':page,'maxresults':options.pageSize,'onSuccess':onSuccess,'onFailure':onError};if(typeof this.catalogue.getCurrentSearchContext==='function'){options=Wirecloud.Utils.merge(options,this.catalogue.getCurrentSearchContext());}
this._last_search=Date.now();this.catalogue.search(options);};CatalogueSearchView.prototype._keywordTimeoutHandler=function _keywordTimeoutHandler(){this.timeout=null;this.source.changeOptions({'correct_query':true,'keywords':this.simple_search_input.getValue()});};var update_resetbutton=function update_resetbutton(options){var filters_applied;filters_applied=options.keywords!==''||options.scope!=='all';if(filters_applied){this.view_allbutton.setLabel(gettext('Clear filters'));}else{this.view_allbutton.setLabel(gettext('Refresh'));}};var onSearchInput=function onSearchInput(event){if(this.timeout!==null){clearTimeout(this.timeout);}
this.timeout=setTimeout(this._keywordTimeoutHandler,700);};CatalogueSearchView.prototype._onSearchInputKeyPress=function _onSearchInputKeyPress(event){if(event.keyCode===13){if(this.timeout!==null){clearTimeout(this.timeout);}
this._keywordTimeoutHandler();}};window.CatalogueSearchView=CatalogueSearchView;})();(function(){"use strict";var CatalogueView=function CatalogueView(id,options){var resource_extra_context;options.class='catalogue';StyledElements.Alternative.call(this,id,options);Object.defineProperty(this,'desc',{value:options.marketplace_desc});if(this.desc.user!=null){this.market_id=this.desc.user+'/'+this.desc.name;}else{this.market_id=this.desc.name;}
this.catalogue=new Wirecloud.WirecloudCatalogue(options.marketplace_desc);this.alternatives=new StyledElements.StyledAlternatives();this.appendChild(this.alternatives);resource_extra_context={'mainbutton':function(options,context,resource){var button,local_catalogue_view;local_catalogue_view=LayoutManagerFactory.getInstance().viewsByName.myresources;if(Wirecloud.LocalCatalogue.resourceExists(resource)){button=new StyledElements.StyledButton({'class':'btn-danger','text':gettext('Uninstall')});button.addEventListener('click',local_catalogue_view.createUserCommand('uninstall',resource,this.catalogue));}else{button=new StyledElements.StyledButton({'class':'btn-success','text':gettext('Install')});button.addEventListener('click',local_catalogue_view.createUserCommand('install',resource,this.catalogue));}
button.addClassName('mainbutton');return button;}.bind(this)};this.viewsByName={'initial':this.alternatives.createAlternative(),'search':this.alternatives.createAlternative({alternative_constructor:CatalogueSearchView,containerOptions:{catalogue:this,resource_painter:Wirecloud.ui.ResourcePainter,resource_extra_context:resource_extra_context}}),'details':this.alternatives.createAlternative({alternative_constructor:Wirecloud.ui.WirecloudCatalogue.ResourceDetailsView,containerOptions:{catalogue:this}})};this.viewsByName.search.init();this.alternatives.addEventListener('preTransition',function(alternatives,out_alternative){LayoutManagerFactory.getInstance().header._notifyViewChange();});this.alternatives.addEventListener('postTransition',function(alternatives,out_alternative){var new_status=options.catalogue.buildStateData();if(out_alternative===this.viewsByName.initial){Wirecloud.HistoryManager.replaceState(new_status);}else{Wirecloud.HistoryManager.pushState(new_status);}
LayoutManagerFactory.getInstance().header.refresh();}.bind(this));this.addEventListener('show',function(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.initial){this.changeCurrentView('search');}
this.refresh_if_needed();}.bind(this));};CatalogueView.prototype=new StyledElements.Alternative();CatalogueView.prototype.getLabel=function getLabel(){return this.catalogue.name;};CatalogueView.prototype._onShow=function _onShow(){};CatalogueView.prototype.onHistoryChange=function onHistoryChange(state){var details,parts,currentResource;if(state.subview==='search'){this.changeCurrentView(state.subview);}else{parts=state.resource.split('/');details={vendor:parts[0],name:parts[1],version:parts[2]};currentResource=this.viewsByName.details.currentEntry;if(currentResource!=null&&currentResource.vendor==details.vendor&&currentResource.name==details.name){details=currentResource.changeVersion(details.version);}
this.createUserCommand('showDetails',details)();}};CatalogueView.prototype.goUp=function goUp(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){return false;}
this.changeCurrentView('search');return true;};CatalogueView.prototype.wait_ready=function wait_ready(onComplete){if(typeof onComplete!=='function'){throw new TypeError('missing onComplete callback');}
try{onComplete();}catch(e){}};CatalogueView.prototype.search=function search(onSuccess,onError,options){return this.catalogue.search(onSuccess,onError,options);};CatalogueView.prototype.getPublishEndpoints=function getPublishEndpoints(){return null;};CatalogueView.prototype.changeCurrentView=function changeCurrentView(view_name){if(!(view_name in this.viewsByName)){throw new TypeError();}
this.alternatives.showAlternative(this.viewsByName[view_name]);};CatalogueView.prototype.home=function home(){this.changeCurrentView('search');};CatalogueView.prototype.createUserCommand=function createUserCommand(command){return this.ui_commands[command].apply(this,Array.prototype.slice.call(arguments,1));};CatalogueView.prototype.ui_commands={};CatalogueView.prototype.ui_commands.install=function install(resource,catalogue_source){return function(){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Importing resource into local repository"),3);layoutManager.logSubTask(gettext('Uploading resource'));this.catalogue.addResourceFromURL(resource.description_url,{onSuccess:function(){LayoutManagerFactory.getInstance().logSubTask(gettext('Resource installed successfully'));LayoutManagerFactory.getInstance().logStep('');this.refresh_search_results();catalogue_source.home();catalogue_source.refresh_search_results();}.bind(this),onFailure:function(msg){(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(msg);},onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});}.bind(this);};CatalogueView.prototype.ui_commands.showDetails=function showDetails(resource,options){if(options==null){options={};}
return function(){var onSuccess=function(resource_details){this.viewsByName.details.paint(resource_details);this.viewsByName.details.repaint();};var onComplete=function onSuccess(){this.viewsByName.details.enable();options.onComplete();};this.viewsByName.details.disable();this.alternatives.showAlternative(this.viewsByName.details);if(resource instanceof Wirecloud.WirecloudCatalogue.ResourceDetails){onSuccess.call(this,resource);onComplete.call(this);}else{this.catalogue.getResourceDetails(resource.vendor,resource.name,{onSuccess:onSuccess.bind(this),onComplete:onComplete.bind(this)});}}.bind(this);};CatalogueView.prototype.ui_commands.delete=function(resource){var success_callback,error_callback,doRequest,msg,context;success_callback=function(response){LayoutManagerFactory.getInstance()._notifyPlatformReady();this.home();this.refresh_search_results();}.bind(this);error_callback=function(msg){LayoutManagerFactory.getInstance()._notifyPlatformReady();(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();};doRequest=function(){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Deleting resource from catalogue"),3);layoutManager.logSubTask(gettext('Requesting server'));this.catalogue.deleteResource(resource,{onSuccess:success_callback,onFailure:error_callback});};msg=gettext('Do you really want to remove the "%(name)s" (vendor: "%(vendor)s", version: "%(version)s") resource?');context={vendor:resource.vendor,name:resource.name,version:resource.version.text};msg=interpolate(msg,context,true);return function(){var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(doRequest.bind(this));dialog.show();}.bind(this);};CatalogueView.prototype.refresh_if_needed=function refresh_if_needed(){if(this.alternatives.getCurrentAlternative()===this.viewsByName.search){this.viewsByName.search.refresh_if_needed();}};CatalogueView.prototype.refresh_search_results=function(){this.viewsByName.search.source.refresh();};window.CatalogueView=CatalogueView;})();(function(){"use strict";var parseTab=function parseTab(tabInfo){var curIWidget,widget,layout,i;this.currentCode=1;this.iWidgets={};this.iWidgetsByCode={};if(this.tab.readOnly||this.workspace.restricted){this.readOnly=true;this.dragboardElement.classList.add("fixed");}
for(i=0;i<tabInfo.iwidgets.length;i++){curIWidget=tabInfo.iwidgets[i];widget=this.workspace.resources.getResourceId(curIWidget.widget);if(curIWidget.layout===0){layout=this.baseLayout;}else{layout=this.freeLayout;}
new IWidget(widget,curIWidget.id,curIWidget.name,layout,new Wirecloud.DragboardPosition(curIWidget.left,curIWidget.top),new Wirecloud.DragboardPosition(curIWidget.icon_left,curIWidget.icon_top),curIWidget.zIndex,curIWidget.width,curIWidget.height,curIWidget.fulldragboard,curIWidget.minimized,curIWidget.refused_version,curIWidget.readOnly,curIWidget);}};var Dragboard=function Dragboard(tab,workspace,dragboardElement){this.currentCode=1;this.scrollbarSpace=17;this.dragboardElement=null;this.dragboardWidth=800;this.dragboardHeight=600;this.baseLayout=null;this.freeLayout=null;this.widgetToMove=null;this.iWidgets={};this.iWidgetsByCode={};this.tab=tab;this.workspace=workspace;this.readOnly=false;this._commitChanges=function _commitChanges(keys){var onSuccess,onError;keys=keys||Object.keys(this.iWidgetsByCode);onSuccess=function(transport){};onError=function(transport,e){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error committing dragboard changes to persistence: %(errorMsg)s."),transport,e);};var iWidget,iWidgetInfo,uri,position,data,icon_position;data=[];for(var i=0;i<keys.length;i++){iWidget=this.iWidgetsByCode[keys[i]];iWidgetInfo={};position=iWidget.getPosition();iWidgetInfo.id=iWidget.id;iWidgetInfo.tab=this.tab.id;if(!this.workspace.restricted){iWidgetInfo.minimized=iWidget.isMinimized();}
if(!iWidget.isInFullDragboardMode()){iWidgetInfo.top=iWidget.position.y;iWidgetInfo.left=iWidget.position.x;iWidgetInfo.zIndex=iWidget.zPos;iWidgetInfo.width=iWidget.contentWidth;iWidgetInfo.height=iWidget.height;iWidgetInfo.fulldragboard=false;}else{iWidgetInfo.fulldragboard=true;}
iWidgetInfo.layout=iWidget.onFreeLayout()?1:0;icon_position=iWidget.getIconPosition();iWidgetInfo.icon_top=icon_position.y;iWidgetInfo.icon_left=icon_position.x;data.push(iWidgetInfo);}
uri=Wirecloud.URLs.IWIDGET_COLLECTION.evaluate({workspace_id:this.workspace.id,tab_id:this.tab.id});Wirecloud.io.makeRequest(uri,{method:'PUT',requestHeaders:{'Accept':'application/json'},contentType:'application/json',postBody:JSON.stringify(data),onSuccess:onSuccess,onFailure:onError});};Dragboard.prototype._buildLayoutFromPreferences=function _buildLayoutFromPreferences(description){var layoutInfo=this.tab.preferences.get('baselayout');switch(layoutInfo.type){case'columnlayout':if(layoutInfo.smart){return new Wirecloud.ui.SmartColumnLayout(this,layoutInfo.columns,layoutInfo.cellheight,layoutInfo.verticalmargin,layoutInfo.horizontalmargin);}else{return new Wirecloud.ui.ColumnLayout(this,layoutInfo.columns,layoutInfo.cellheight,layoutInfo.verticalmargin,layoutInfo.horizontalmargin);}
case'gridlayout':return new Wirecloud.ui.GridLayout(this,layoutInfo.columns,layoutInfo.rows,layoutInfo.verticalmargin,layoutInfo.horizontalmargin);}};Dragboard.prototype._updateBaseLayout=function _updateBaseLayout(){var newBaseLayout=this._buildLayoutFromPreferences();newBaseLayout.initialize();this.baseLayout.moveTo(newBaseLayout);this.baseLayout.destroy();this.baseLayout=newBaseLayout;};Dragboard.prototype.getWidth=function getWidth(){return this.dragboardWidth;};Dragboard.prototype.getHeight=function getHeight(){return this.dragboardHeight;};Dragboard.prototype.destroy=function destroy(){this.baseLayout.destroy();this.freeLayout.destroy();this.baseLayout=null;this.freeLayout=null;this.iWidgets=null;this.iWidgetsByCode=null;this.dragboardElement=null;};Dragboard.prototype.addInstance=function addInstance(widget,options_){var options={"iwidgetName":widget.title,"setDefaultValues":function(){}};Wirecloud.Utils.merge(options,options_);if(!(widget instanceof Wirecloud.Widget)){throw new TypeError();}
if(this.readOnly){var msg=gettext("The destination tab (%(tabName)s) is read only.");msg=interpolate(msg,{tabName:this.tab.tabInfo.name},true);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();return;}
var width=widget.default_width;var height=widget.default_height;var layout=this.tab.preferences.get('initiallayout')==="Free"?1:0;if(layout instanceof Wirecloud.ui.ColumnLayout){var maxColumns=layout.getColumns();if(width>maxColumns){width=maxColumns;}}
var url=Wirecloud.URLs.IWIDGET_COLLECTION.evaluate({tab_id:this.tab.id,workspace_id:this.workspace.id});var data=JSON.stringify({'widget':widget.id,'width':width,'height':height,'name':options.iwidgetName,'layout':layout});Wirecloud.io.makeRequest(url,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:data,onSuccess:function onSuccess(response){var iwidgetinfo,widget,layout,iwidget;iwidgetinfo=JSON.parse(response.responseText);widget=Wirecloud.LocalCatalogue.getResourceId(iwidgetinfo.widget);if(iwidgetinfo.layout===0){layout=this.baseLayout;}else{layout=this.freeLayout;}
iwidget=new IWidget(widget,iwidgetinfo.id,iwidgetinfo.name,layout,new Wirecloud.DragboardPosition(iwidgetinfo.left,iwidgetinfo.top),new Wirecloud.DragboardPosition(iwidgetinfo.icon_left,iwidgetinfo.icon_top),iwidgetinfo.zIndex,iwidgetinfo.width,iwidgetinfo.height,iwidgetinfo.fulldragboard,iwidgetinfo.minimized,iwidgetinfo.refused_version,iwidgetinfo.readOnly,iwidgetinfo);this.addIWidget(iwidget,iwidgetinfo,options);iwidget.paint();}.bind(this),onFailure:function(response){Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding iwidget to persistence: %(errorMsg)s."),response);}});};Dragboard.prototype.getIWidgets=function getIWidgets(){return Wirecloud.Utils.values(this.iWidgets);};Dragboard.prototype.getIWidget=function getIWidget(iWidgetId){return this.iWidgets[iWidgetId];};Dragboard.prototype.hasReadOnlyIWidgets=function hasReadOnlyIWidgets(){for(var key in this.iWidgets){if(this.iWidgets[key].internal_iwidget.readOnly){return true;}}
return false;};Dragboard.prototype._registerIWidget=function _registerIWidget(iWidget){if(iWidget.id){this.iWidgets[iWidget.id]=iWidget;}
iWidget.code=this.currentCode++;this.iWidgetsByCode[iWidget.code]=iWidget;var zpos=iWidget.getZPosition();if(zpos!==null){if(this.orderList[zpos]!==undefined){this.orderList.splice(zpos,1,this.orderList[zpos],iWidget);for(var i=zpos+1;i<this.orderList.length;i++){if(this.orderList[i]!==undefined){this.orderList[i].setZPosition(i);}}}else{this.orderList[zpos]=iWidget;}}else{zpos=this.orderList.length;iWidget.setZPosition(zpos);this.orderList[zpos]=iWidget;}};Dragboard.prototype._deregisterIWidget=function _deregisterIWidget(iWidget){delete this.iWidgets[iWidget.id];delete this.iWidgetsByCode[iWidget.code];var zpos=iWidget.getZPosition();this.orderList.splice(zpos,1);iWidget.setZPosition(null);for(var i=zpos;i<this.orderList.length;i++){this.orderList[i].setZPosition(i);}
iWidget.code=null;};Dragboard.prototype.addIWidget=function addIWidget(iWidget,iwidgetInfo,options){if(!this.iWidgetsByCode[iWidget.code]){throw new Error();}
var oldHeight=iWidget.getHeight();var oldWidth=iWidget.getWidth();this.workspace.addIWidget(this.tab,iWidget,iwidgetInfo,options);iWidget.layout._notifyResizeEvent(iWidget,oldWidth,oldHeight,iWidget.getWidth(),iWidget.getHeight(),false,true);this.iWidgets[iWidget.id]=iWidget;};Dragboard.prototype.fillFloatingWidgetsMenu=function fillFloatingWidgetsMenu(menu){this.freeLayout.fillFloatingWidgetsMenu(menu);};Dragboard.prototype.lowerToBottom=function lowerToBottom(iWidget){var zPos=iWidget.getZPosition();this.orderList.splice(zPos,1);this.orderList=[iWidget].concat(this.orderList);for(var i=0;i<this.orderList.length;i++){this.orderList[i].setZPosition(i);}
this._commitChanges();};Dragboard.prototype.lower=function lower(iWidget){var zPos=iWidget.getZPosition();if(zPos===0){return;}
var prevIWidget=this.orderList[zPos-1];this.orderList[zPos-1]=iWidget;this.orderList[zPos]=prevIWidget;iWidget.setZPosition(zPos-1);prevIWidget.setZPosition(zPos);this._commitChanges([iWidget.code,prevIWidget.code]);};Dragboard.prototype.raiseToTop=function raiseToTop(iWidget){var oldZPos=iWidget.getZPosition();var newZPos=this.orderList.length-1;if(oldZPos===newZPos){return;}
this.orderList.splice(oldZPos,1);this.orderList.push(iWidget);for(var i=oldZPos;i<this.orderList.length;i++){this.orderList[i].setZPosition(i);}
this._commitChanges();};Dragboard.prototype.raise=function raise(iWidget){var zPos=iWidget.getZPosition();if(zPos===(this.orderList.length-1)){return;}
var nextIWidget=this.orderList[zPos+1];this.orderList[zPos+1]=iWidget;this.orderList[zPos]=nextIWidget;iWidget.setZPosition(zPos+1);nextIWidget.setZPosition(zPos);this._commitChanges([iWidget.code,nextIWidget.code]);};this.dragboardElement=dragboardElement;this.orderList=[];this.painted=false;this.painting=false;this._notifyWindowResizeEvent=function _notifyWindowResizeEvent(){var oldWidth=this.dragboardWidth;var oldHeight=this.dragboardHeight;this._recomputeSize();var newWidth=this.dragboardWidth;var newHeight=this.dragboardHeight;var widthChanged=oldWidth!==newWidth;var heightChanged=oldHeight!==newHeight;if(widthChanged||heightChanged){this._updateIWidgetSizes(widthChanged,heightChanged);}}.bind(this);this.baseLayout=this._buildLayoutFromPreferences();this.freeLayout=new FreeLayout(this);this.fulldragboardLayout=new FullDragboardLayout(this);parseTab.call(this,tab.tabInfo);};Dragboard.prototype.paint=function paint(){var oldLength,i;if(this.painted||this.painting){return;}
this.painting=true;this.dragboardElement.innerHTML="";this._recomputeSize();this.baseLayout.initialize();this.freeLayout.initialize();this.fulldragboardLayout.initialize();oldLength=this.orderList.length;this.orderList=this.orderList.filter(function(iwidget){return iwidget!=null;});if(oldLength!==this.orderList.length){for(i=0;i<this.orderList.length;i+=1){this.orderList[i].setZPosition(i);}}
this.painted=true;};Dragboard.prototype._recomputeSize=function _recomputeSize(){var cssStyle=document.defaultView.getComputedStyle(this.dragboardElement,null);if(cssStyle.getPropertyValue("display")==="none"){return;}
this.topMargin=cssStyle.getPropertyCSSValue("padding-top").getFloatValue(CSSPrimitiveValue.CSS_PX);this.bottomMargin=cssStyle.getPropertyCSSValue("padding-bottom").getFloatValue(CSSPrimitiveValue.CSS_PX);this.leftMargin=cssStyle.getPropertyCSSValue("padding-left").getFloatValue(CSSPrimitiveValue.CSS_PX);this.rightMargin=cssStyle.getPropertyCSSValue("padding-right").getFloatValue(CSSPrimitiveValue.CSS_PX);this.dragboardWidth=parseInt(this.dragboardElement.offsetWidth,10)-this.leftMargin-this.rightMargin;this.dragboardHeight=parseInt(this.dragboardElement.parentNode.clientHeight,10)-this.topMargin-this.bottomMargin;};Dragboard.prototype._updateIWidgetSizes=function _updateIWidgetSizes(widthChanged,heightChanged){this.baseLayout._notifyWindowResizeEvent(widthChanged,heightChanged);this.freeLayout._notifyWindowResizeEvent(widthChanged,heightChanged);this.fulldragboardLayout._notifyWindowResizeEvent(widthChanged,heightChanged);};window.Dragboard=Dragboard;})();var EzWebEffectBase={};EzWebEffectBase.findDragboardElement=function(element){var tmp=element.parentNode;while(Wirecloud.Utils.XML.isElement(tmp)){var position=document.defaultView.getComputedStyle(tmp,null).getPropertyValue("position");switch(position){case"relative":case"absolute":case"fixed":return tmp;}
tmp=tmp.parentNode;}
return null;};function IWidgetIconDraggable(iWidget){var context={iWidget:iWidget,x:null,y:null};Wirecloud.ui.Draggable.call(this,iWidget.iconImg,context,IWidgetIconDraggable.prototype.startFunc,IWidgetIconDraggable.prototype.updateFunc,IWidgetIconDraggable.prototype.finishFunc,IWidgetIconDraggable.prototype.canBeDraggedFunc);}
IWidgetIconDraggable.prototype.canBeDraggedFunc=function(draggable,context){return true;};IWidgetIconDraggable.prototype.startFunc=function(draggable,context){context.x=null;context.y=null;context.oldZIndex=context.iWidget.getZPosition();context.iWidget.setZPosition("999999");context.dragboard=context.iWidget.layout.dragboard;return{dragboard:EzWebEffectBase.findDragboardElement(context.iWidget.element)};};IWidgetIconDraggable.prototype.updateFunc=function(event,draggable,context,x,y){context.x=x;context.y=y;return;};IWidgetIconDraggable.prototype.finishFunc=function(draggable,context){context.iWidget.setZPosition(context.oldZIndex);if(context.x){var position=context.iWidget.layout.getCellAt(context.x,context.y);if(position.y<0){position.y=0;}
if(position.x<0){position.x=0;}
context.iWidget.setIconPosition(position);context.iWidget.layout.dragboard._commitChanges([context.iWidget.code]);}else{context.iWidget.setMinimizeStatus(false);context.iWidget.layout.dragboard.raiseToTop(context.iWidget);}
context.dragboard._notifyWindowResizeEvent();};(function(){"use strict";var findTab=function findTab(curNode,maxRecursion){if(maxRecursion===0){return null;}
if(Wirecloud.Utils.XML.isElement(curNode)){for(var i=0;i<this.length;i++){if(this[i].tabElement==curNode){return this[i];}}}else{return null;}
var parentNode=curNode.parentNode;return findTab.call(this,parentNode,maxRecursion-1);};var IWidgetDraggable=function IWidgetDraggable(iWidget){var context={iWidget:iWidget};Wirecloud.ui.Draggable.call(this,iWidget.widgetMenu,context,IWidgetDraggable.prototype.startFunc,IWidgetDraggable.prototype.updateFunc,IWidgetDraggable.prototype.finishFunc,IWidgetDraggable.prototype.canBeDraggedFunc);this.setXOffset=function(xOffset){context.xOffset=xOffset;};this.setYOffset=function(yOffset){context.yOffset=yOffset;};};IWidgetDraggable.prototype.canBeDraggedFunc=function canBeDraggedFunc(draggable,context){return context.iWidget.isAllowed('move')&&!(context.iWidget.layout instanceof FullDragboardLayout);};IWidgetDraggable.prototype.startFunc=function startFunc(draggable,context){var key;context.selectedTab=null;context.layout=context.iWidget.layout;context.dragboard=context.layout.dragboard;context.dragboard.raiseToTop(context.iWidget);context.layout.initializeMove(context.iWidget,draggable);context.iWidget.element.classList.add('draganddrop');context.currentTab=context.dragboard.tab;context.tabs=[];for(key in context.dragboard.tab.workspace.tabInstances){if(context.dragboard.tab.workspace.tabInstances[key]!==context.currentTab){context.tabs.push(context.dragboard.tab.workspace.tabInstances[key]);}}
context.y=context.iWidget.element.style.top===""?0:parseInt(context.iWidget.element.style.top,10);context.x=context.iWidget.element.style.left===""?0:parseInt(context.iWidget.element.style.left,10);return{dragboard:EzWebEffectBase.findDragboardElement(context.iWidget.element)};};IWidgetDraggable.prototype.updateFunc=function updateFunc(event,draggable,context,xDelta,yDelta){var x,y,clientX,clientY,element=null;context.iWidget.element.style.left=(context.x+xDelta)+'px';context.iWidget.element.style.top=(context.y+yDelta)+'px';x=context.x+xDelta+context.xOffset;y=context.y+yDelta+context.yOffset;if('touches'in event){clientX=event.touches[0].clientX;clientY=event.touches[0].clientY;}else{clientX=event.clientX;clientY=event.clientY;}
element=document.elementFromPoint(clientX,clientY);if(element!=null){element=findTab.call(context.tabs,element,4);}
if(element!=null){if(context.selectedTab===element){return;}
if(context.selectedTab!=null){context.selectedTab.tabElement.classList.remove("selected");context.selectedTab.tabElement.classList.remove("target");}
context.selectedTab=element;context.selectedTab.tabElement.classList.add("selected");context.selectedTab.tabElement.classList.add("target");context.layout.disableCursor();return;}
var position=context.layout.getCellAt(x,y);if(position.y<0){position.y=0;}
if(position.x<0){position.x=0;}
if(context.selectedTab!=null){context.selectedTab.tabElement.classList.remove("selected");context.selectedTab.tabElement.classList.remove("target");}
context.selectedTab=null;context.layout.moveTemporally(position.x,position.y);return;};IWidgetDraggable.prototype.finishFunc=function finishFunc(draggable,context){var destDragboard,workspace,destLayout;context.iWidget.element.classList.remove('draganddrop');if(context.selectedTab!==null){context.layout.cancelMove();context.selectedTab.tabElement.classList.remove("selected");context.selectedTab.tabElement.classList.remove("target");workspace=context.dragboard.workspace;context.selectedTab.paint();destDragboard=context.selectedTab.getDragboard();if(context.iWidget.onFreeLayout()){destLayout=destDragboard.freeLayout;}else{destLayout=destDragboard.baseLayout;}
context.iWidget.moveToLayout(destLayout);workspace.highlightTab(context.selectedTab);context.selectedTab=null;}else{context.layout.acceptMove();}
context.dragboard=null;};Wirecloud.ui.IWidgetDraggable=IWidgetDraggable;})();(function(){"use strict";var DragboardPosition=function DragboardPosition(x,y){Object.defineProperties(this,{x:{get:function(){return x;},set:function(newValue){if(typeof newValue!='number'){throw new TypeError('value must be a number');}
x=newValue;}},y:{get:function(){return y;},set:function(newValue){if(typeof newValue!='number'){throw new TypeError('value must be a number');}
y=newValue;}}});Object.freeze(this);};DragboardPosition.prototype.equals=function equals(other_position){if(other_position==null){return false;}
if(!(other_position instanceof DragboardPosition)){throw new TypeError();}
return this.x===this.other_position&&this.y===this.other_position.y;};DragboardPosition.prototype.clone=function clone(){return new DragboardPosition(this.x,this.y);};Wirecloud.DragboardPosition=DragboardPosition;})();(function(){"use strict";var DragboardCursor=function DragboardCursor(iWidget){this.refIWidget=iWidget;var positiontmp=iWidget.getPosition();this.position=positiontmp.clone();this.code='cursor';this.layout=iWidget.layout;this.width=iWidget.getWidth();this.height=iWidget.getHeight();this.heightInPixels=iWidget.element.offsetHeight;this.widthInPixels=iWidget.element.offsetWidth;};DragboardCursor.prototype.getWidth=function getWidth(){return this.width;};DragboardCursor.prototype.getHeight=function getHeight(){return this.height;};DragboardCursor.prototype.paint=function paint(dragboard){var dragboardCursor=document.createElement("div");dragboardCursor.setAttribute("class","dragboardcursor");dragboardCursor.style.height=this.heightInPixels+"px";dragboardCursor.style.width=this.widthInPixels+"px";dragboardCursor.style.left=(this.layout.getColumnOffset(this.position.x)-2)+"px";dragboardCursor.style.top=(this.layout.getRowOffset(this.position.y)-2)+"px";dragboard.insertBefore(dragboardCursor,this.refIWidget.element);this.element=dragboardCursor;};DragboardCursor.prototype.destroy=function destroy(){if(Wirecloud.Utils.XML.isElement(this.element)){this.element.parentNode.removeChild(this.element);this.element=null;}};DragboardCursor.prototype.getPosition=IWidget.prototype.getPosition;DragboardCursor.prototype.setPosition=function setPosition(position){this.position=position;if(this.element!==null){this.element.style.left=(this.layout.getColumnOffset(position.x)-2)+"px";this.element.style.top=(this.layout.getRowOffset(position.y)-2)+"px";}};Wirecloud.ui.DragboardCursor=DragboardCursor;})();(function(){"use strict";var MultiValuedSize=function MultiValuedSize(inPixels,inLU){Object.defineProperties(this,{inPixels:{value:inPixels},inLU:{value:inLU}});};Wirecloud.ui.MultiValuedSize=MultiValuedSize;})();(function(){"use strict";var DragboardLayout=function DragboardLayout(dragboard){if(arguments.length===0){return;}
this.dragboard=dragboard;this.iWidgets={};};DragboardLayout.prototype._notifyWindowResizeEvent=function _notifyWindowResizeEvent(widthChanged,heightChanged){var iwidget_key,iWidget;for(iwidget_key in this.iWidgets){iWidget=this.iWidgets[iwidget_key];iWidget._notifyWindowResizeEvent();}};DragboardLayout.prototype._notifyResizeEvent=function(iWidget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){};DragboardLayout.prototype.getMenubarSize=function getMenubarSize(){var sizeInPixels=18;var sizeInLU=Math.ceil(this.fromPixelsToVCells(sizeInPixels));return new Wirecloud.ui.MultiValuedSize(sizeInPixels,sizeInLU);};DragboardLayout.prototype.getStatusbarSize=function getStatusbarSize(){var sizeInPixels=16;var sizeInLU=Math.ceil(this.fromPixelsToVCells(sizeInPixels));return new Wirecloud.ui.MultiValuedSize(sizeInPixels,sizeInLU);};DragboardLayout.prototype.getExtraSize=function getExtraSize(){var sizeInPixels=this.getMenubarSize().inPixels+
this.getStatusbarSize().inPixels;var sizeInLU=Math.ceil(this.fromPixelsToVCells(sizeInPixels));return new Wirecloud.ui.MultiValuedSize(sizeInPixels,sizeInLU);};DragboardLayout.prototype.adaptColumnOffset=function adaptColumnOffset(pixels){var msg=gettext("method \"%(method)s\" must be implemented.");msg=interpolate(msg,{method:"adaptColumnOffset"},true);throw new Error(msg);};DragboardLayout.prototype.adaptRowOffset=function adaptRowOffset(pixels){var msg=gettext("method \"%(method)s\" must be implemented.");msg=interpolate(msg,{method:"adaptRowOffset"},true);throw new Error(msg);};DragboardLayout.prototype.adaptHeight=function adaptHeight(contentHeight,fullSize,oldLayout){var msg=gettext("method \"%(method)s\" must be implemented.");msg=interpolate(msg,{method:"adaptHeight"},true);throw new Error(msg);};DragboardLayout.prototype.adaptWidth=function adaptWidth(contentWidth,fullSize,oldLayout){var msg=gettext("method \"%(method)s\" must be implemented.");msg=interpolate(msg,{method:"adaptWidth"},true);throw new Error(msg);};DragboardLayout.prototype.padWidth=function padWidth(width){return width;};DragboardLayout.prototype.padHeight=function padHeight(height){return height;};DragboardLayout.prototype.isInside=function isInside(x,y){return(x>=0)&&(x<this.getWidth())&&(y>=0);};DragboardLayout.prototype.getWidth=function getWidth(){return this.dragboard.getWidth();};DragboardLayout.prototype.getHeight=function getHeight(){return this.dragboard.getHeight();};Object.defineProperty(DragboardLayout.prototype,"dragboardTopMargin",{get:function(){return this.dragboard.topMargin;}});Object.defineProperty(DragboardLayout.prototype,"dragboardLeftMargin",{get:function(){return this.dragboard.leftMargin;}});DragboardLayout.prototype.addIWidget=function addIWidget(iWidget,affectsDragboard){if(iWidget.layout!=null){var msg=gettext("the iWidget could not be associated with this layout as it already has an associated layout.");throw new Error(msg);}
iWidget.layout=this;if(affectsDragboard){this.dragboard._registerIWidget(iWidget);if(iWidget.isVisible()){this.dragboard.dragboardElement.appendChild(iWidget.element);this.dragboard.dragboardElement.appendChild(iWidget.iconElement);}}
this.iWidgets[iWidget.code]=iWidget;if(iWidget.isVisible()){iWidget._recomputeSize();}};DragboardLayout.prototype._adaptIWidget=function _adaptIWidget(iWidget){if(iWidget.element!==null){this._ensureMinimalSize(iWidget,false);}};DragboardLayout.prototype._ensureMinimalSize=function _ensureMinimalSize(iWidget,persist){var minWidth=Math.ceil(this.fromPixelsToHCells(80));var minHeight=Math.ceil(this.fromPixelsToVCells(24));var sizeChange=false;var newWidth=iWidget.getContentWidth();var newHeight=iWidget.getContentHeight();if(newWidth<minWidth){sizeChange=true;newWidth=minWidth;}
if(newHeight<minHeight){sizeChange=true;newHeight=minHeight;}
if(sizeChange){iWidget.setContentSize(newWidth,newHeight,false,persist);}};DragboardLayout.prototype.removeIWidget=function removeIWidget(iWidget,affectsDragboard){delete this.iWidgets[iWidget.code];if(affectsDragboard){this.dragboard._deregisterIWidget(iWidget);if(iWidget.element!==null){this.dragboard.dragboardElement.removeChild(iWidget.element);}
if(iWidget.iconElement!==null){this.dragboard.dragboardElement.removeChild(iWidget.iconElement);}}
iWidget.layout=null;};DragboardLayout.prototype.moveTo=function moveTo(destLayout){var iwidget_key,iWidget;for(iwidget_key in this.iWidgets){iWidget=this.iWidgets[iwidget_key];iWidget.moveToLayout(destLayout);}};DragboardLayout.prototype.destroy=function destroy(){var iwidget_key;for(iwidget_key in this.iWidgets){this.iWidgets[iwidget_key].destroy();}
this.iWidgets=null;this.dragboard=null;};DragboardLayout.prototype.initializeMove=function initializeMove(iWidget,draggable){};DragboardLayout.prototype.moveTemporally=function moveTemporally(x,y){};DragboardLayout.prototype.acceptMove=function acceptMove(){};DragboardLayout.prototype.cancelMove=function cancelMove(){};DragboardLayout.prototype.disableCursor=function disableCursor(){};DragboardLayout.prototype.measure=function measure(testElement,units){var res,cssStyle;testElement.style.visibility="hidden";this.dragboard.dragboardElement.appendChild(testElement);res=[];cssStyle=document.defaultView.getComputedStyle(testElement,null);res[0]=cssStyle.getPropertyCSSValue("width").getFloatValue(units);res[1]=cssStyle.getPropertyCSSValue("height").getFloatValue(units);testElement.parentNode.removeChild(testElement);return res;};DragboardLayout.prototype.unitConvert=function unitConvert(value,newUnits){var testDiv=document.createElement("div");testDiv.style.height=value;testDiv.style.width=value;return this.measure(testDiv,newUnits);};Wirecloud.ui.DragboardLayout=DragboardLayout;})();function FreeLayout(dragboard,scrollbarSpace){if(arguments.length===0){return;}
this.initialized=false;this.iwidgetToMove=null;Wirecloud.ui.DragboardLayout.call(this,dragboard,scrollbarSpace);}
FreeLayout.prototype=new Wirecloud.ui.DragboardLayout();FreeLayout.prototype.MAX_HLU=1000000;FreeLayout.prototype.fromPixelsToVCells=function(pixels){return pixels;};FreeLayout.prototype.fromVCellsToPixels=function(cells){return cells;};FreeLayout.prototype.getWidthInPixels=function(cells){return this.fromHCellsToPixels(cells);};FreeLayout.prototype.getHeightInPixels=function(cells){return this.fromVCellsToPixels(cells);};FreeLayout.prototype.fromPixelsToHCells=function(pixels){return(pixels*this.MAX_HLU/this.getWidth());};FreeLayout.prototype.fromHCellsToPixels=function(cells){return Math.ceil((this.getWidth()*cells)/this.MAX_HLU);};FreeLayout.prototype.fromHCellsToPercentage=function(cells){return cells/(this.MAX_HLU/100);};FreeLayout.prototype.getColumnOffset=function(column){return Math.ceil((this.getWidth()*column)/this.MAX_HLU);};FreeLayout.prototype.getRowOffset=function(row){return row;};FreeLayout.prototype.adaptColumnOffset=function(pixels){var offsetInLU=Math.ceil(this.fromPixelsToHCells(pixels));return new Wirecloud.ui.MultiValuedSize(this.fromHCellsToPixels(offsetInLU),offsetInLU);};FreeLayout.prototype.adaptRowOffset=function(pixels){return new Wirecloud.ui.MultiValuedSize(pixels,pixels);};FreeLayout.prototype.adaptHeight=function(contentHeight,fullSize,oldLayout){return new Wirecloud.ui.MultiValuedSize(contentHeight,fullSize);};FreeLayout.prototype.adaptWidth=function(contentWidth,fullSize){var widthInLU=Math.floor(this.fromPixelsToHCells(fullSize));return new Wirecloud.ui.MultiValuedSize(this.fromHCellsToPixels(widthInLU),widthInLU);};FreeLayout.prototype._notifyWindowResizeEvent=function(widthChanged,heightChanged){if(widthChanged){Wirecloud.ui.DragboardLayout.prototype._notifyWindowResizeEvent.call(this,widthChanged,heightChanged);}};FreeLayout.prototype._notifyResizeEvent=function(iWidget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){if(resizeLeftSide){var widthDiff=newWidth-oldWidth;var position=iWidget.getPosition();position.x-=widthDiff;if(persist){iWidget.setPosition(position);}else{iWidget._notifyWindowResizeEvent();}}
if(persist){this.dragboard._commitChanges([iWidget.code]);}};FreeLayout.prototype.initialize=function(){var iWidget,key;for(key in this.iWidgets){iWidget=this.iWidgets[key];iWidget.paint(true);}
this.initialized=true;};FreeLayout.prototype.getCellAt=function(x,y){return new Wirecloud.DragboardPosition((x*this.MAX_HLU)/this.getWidth(),y);};FreeLayout.prototype.addIWidget=function(iWidget,affectsDragboard){Wirecloud.ui.DragboardLayout.prototype.addIWidget.call(this,iWidget,affectsDragboard);if(!this.initialized){return;}
var position=iWidget.getPosition();if(!(position instanceof Wirecloud.DragboardPosition)){position=new Wirecloud.DragboardPosition(0,0);}
iWidget.setPosition(position);this._adaptIWidget(iWidget);};FreeLayout.prototype.initializeMove=function(iwidget,draggable){var msg;draggable=draggable||null;if(this.iwidgetToMove!==null){msg=gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);this.cancelMove();}
this.iwidgetToMove=iwidget;this.newPosition=iwidget.getPosition().clone();if(draggable){draggable.setXOffset(0);draggable.setYOffset(0);}};FreeLayout.prototype.moveTemporally=function(x,y){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this.newPosition.x=x;this.newPosition.y=y;};FreeLayout.prototype.acceptMove=function(){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Function acceptMove called when there is not an started iwidget move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
if(this.newPosition.x>(this.MAX_HLU-1)){this.newPosition.x=(this.MAX_HLU-1);}
if(this.newPosition.y<0){this.newPosition.y=0;}
this.iwidgetToMove.setPosition(this.newPosition);this.dragboard._notifyWindowResizeEvent();this.iwidgetToMove._notifyWindowResizeEvent();this.dragboard._commitChanges([this.iwidgetToMove.code]);this.iwidgetToMove=null;this.newPosition=null;};FreeLayout.prototype.cancelMove=function(){var msg;if(!(this.iwidgetToMove instanceof IWidget)){msg=gettext("Trying to cancel an inexistant temporal move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this.iwidgetToMove._notifyWindowResizeEvent();this.iwidgetToMove=null;this.newPosition=null;};FreeLayout.prototype._raiseIWidgetCallback=function(){this.iwidget.setMinimizeStatus(false);this.iwidget.layout.dragboard.raiseToTop(this.iwidget);};FreeLayout.prototype.fillFloatingWidgetsMenu=function(menu){var i,iwidgetKeys,curIWidget,key;iwidgetKeys=this.iWidgets.keys();if(iwidgetKeys.length>0){for(i=0;i<iwidgetKeys.length;i++){key=iwidgetKeys[i];curIWidget=this.iWidgets[key];menu.addOption(null,curIWidget.name,this._raiseIWidgetCallback.bind({"iwidget":curIWidget}),i);}}else{menu.addOption(null,gettext("No Floating Widgets"),function(){},0);}};(function(){"use strict";var FullDragboardLayout=function FullDragboardLayout(dragboard,scrollbarSpace){if(arguments.length===0){return;}
this.initialized=false;Wirecloud.ui.DragboardLayout.call(this,dragboard,scrollbarSpace);};FullDragboardLayout.prototype=new Wirecloud.ui.DragboardLayout();FullDragboardLayout.prototype.fromPixelsToVCells=function fromPixelsToVCells(pixels){return 1;};FullDragboardLayout.prototype.fromVCellsToPixels=function fromVCellsToPixels(cells){return this.getHeight();};FullDragboardLayout.prototype.getWidthInPixels=function getWidthInPixels(cells){return this.getWidth();};FullDragboardLayout.prototype.getHeightInPixels=function getHeightInPixels(cells){return this.getHeight();};FullDragboardLayout.prototype.fromPixelsToHCells=function fromPixelsToHCells(pixels){return 1;};FullDragboardLayout.prototype.fromHCellsToPixels=function fromHCellsToPixels(cells){return this.getWidth();};FullDragboardLayout.prototype.fromHCellsToPercentage=function fromHCellsToPercentage(cells){return this.getHeight();};FullDragboardLayout.prototype.getColumnOffset=function getColumnOffset(column){return this.dragboard.dragboardElement.getBoundingClientRect().left;};FullDragboardLayout.prototype.getRowOffset=function getRowOffset(row){return this.dragboard.dragboardElement.getBoundingClientRect().top;};FullDragboardLayout.prototype.adaptColumnOffset=function adaptColumnOffset(pixels){return new Wirecloud.ui.MultiValuedSize(this.dragboard.dragboardElement.getBoundingClientRect().left,0);};FullDragboardLayout.prototype.adaptRowOffset=function adaptRowOffset(pixels){return new Wirecloud.ui.MultiValuedSize(this.dragboard.dragboardElement.getBoundingClientRect().top,0);};FullDragboardLayout.prototype.adaptHeight=function adaptHeight(contentHeight,fullSize,oldLayout){var diff=fullSize-contentHeight;return new Wirecloud.ui.MultiValuedSize(contentHeight-diff,1);};FullDragboardLayout.prototype.adaptWidth=function adaptWidth(contentWidth,fullSize){return new Wirecloud.ui.MultiValuedSize(this.getWidth(),1);};FullDragboardLayout.prototype.initialize=function initialize(){var iWidget,key;for(key in this.iWidgets){iWidget=this.iWidgets[key];iWidget.paint(true);}
this.initialized=true;};FullDragboardLayout.prototype.getCellAt=function getCellAt(x,y){return new Wirecloud.DragboardPosition(0,0);};FullDragboardLayout.prototype.addIWidget=function addIWidget(iWidget,affectsDragboard){iWidget.element.classList.add('fulldragboard');Wirecloud.ui.DragboardLayout.prototype.addIWidget.call(this,iWidget,affectsDragboard);if(!this.initialized){return;}
iWidget.setPosition(new Wirecloud.DragboardPosition(0,0));};FullDragboardLayout.prototype.removeIWidget=function removeIWidget(iWidget,affectsDragboard){iWidget.element.classList.remove('fulldragboard');Wirecloud.ui.DragboardLayout.prototype.removeIWidget.call(this,iWidget,affectsDragboard);};FullDragboardLayout.prototype.initializeMove=function initializeMove(iwidget,draggable){if(this.iwidgetToMove!==null){var msg=gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);this.cancelMove();}
this.iwidgetToMove=iwidget;};FullDragboardLayout.prototype.moveTemporally=function moveTemporally(x,y){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}};FullDragboardLayout.prototype.acceptMove=function acceptMove(){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Function acceptMove called when there is not an started iwidget move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this.iwidgetToMove=null;};FullDragboardLayout.prototype.cancelMove=function cancelMove(){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Trying to cancel an inexistant temporal move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this.iwidgetToMove._notifyWindowResizeEvent();this.iwidgetToMove=null;this.newPosition=null;};window.FullDragboardLayout=FullDragboardLayout;})();(function(){"use strict";function ColumnLayout(dragboard,columns,cellHeight,verticalMargin,horizontalMargin,scrollbarSpace){if(arguments.length===0){return;}
this.initialized=false;this._buffers={"base":{}};this.columns=columns;this.cellHeight=cellHeight;if((verticalMargin%2)===0){this.topMargin=verticalMargin/2;this.bottomMargin=verticalMargin/2;}else{this.topMargin=Math.floor(verticalMargin/2);this.bottomMargin=Math.floor(verticalMargin/2)+1;}
if((horizontalMargin%2)===0){this.leftMargin=horizontalMargin/2;this.rightMargin=horizontalMargin/2;}else{this.leftMargin=Math.floor(horizontalMargin/2);this.rightMargin=Math.floor(horizontalMargin/2)+1;}
this._clearMatrix();this._buffers["base"]={matrix:this.matrix,};this.dragboardCursor=null;this.iwidgetToMove=null;Wirecloud.ui.DragboardLayout.call(this,dragboard,scrollbarSpace);}
ColumnLayout.prototype=new Wirecloud.ui.DragboardLayout();ColumnLayout.prototype.getColumns=function(){return this.columns;};ColumnLayout.prototype.getRows=function(){var x,rows=0;for(x=0;x<this.columns;x+=1){rows=Math.max(rows,this.matrix[x].length);}
return rows;};ColumnLayout.prototype.getCellHeight=function(){return this.cellHeight;};ColumnLayout.prototype.fromPixelsToVCells=function(pixels){return pixels>0?(pixels/this.cellHeight):0;};ColumnLayout.prototype.fromVCellsToPixels=function(cells){return(cells*this.cellHeight);};ColumnLayout.prototype.getWidthInPixels=function(cells){return this.fromHCellsToPixels(cells)-this.leftMargin-this.rightMargin;};ColumnLayout.prototype.getHeightInPixels=function(cells){return this.fromVCellsToPixels(cells)-this.topMargin-this.bottomMargin;};ColumnLayout.prototype.fromPixelsToHCells=function(pixels){var cells=pixels/this.fromHCellsToPixels(1);var truncatedCells=Math.floor(cells);if(Math.ceil(this.fromHCellsToPixels(truncatedCells))===pixels){return truncatedCells;}else{return cells;}};ColumnLayout.prototype.fromHCellsToPixels=function(cells){return(this.getWidth()*this.fromHCellsToPercentage(cells))/100;};ColumnLayout.prototype.fromHCellsToPercentage=function(cells){return cells*(100/this.columns);};ColumnLayout.prototype.adaptColumnOffset=function(pixels){var halfColumnWidth=Math.floor(this.fromHCellsToPixels(1)/2);var offsetInLU=Math.floor(this.fromPixelsToHCells(pixels-this.leftMargin+halfColumnWidth));var offsetInPixels=this.fromHCellsToPixels(offsetInLU)+this.leftMargin;return new Wirecloud.ui.MultiValuedSize(offsetInPixels,offsetInLU);};ColumnLayout.prototype.adaptRowOffset=function(pixels){var halfRowHeight=Math.floor(this.fromVCellsToPixels(1)/2);var offsetInLU=Math.floor(this.fromPixelsToVCells(pixels-this.topMargin+halfRowHeight));var offsetInPixels=this.fromVCellsToPixels(offsetInLU)+this.topMargin;return new Wirecloud.ui.MultiValuedSize(offsetInPixels,offsetInLU);};ColumnLayout.prototype.adaptHeight=function(contentHeight,fullSize,oldLayout){oldLayout=oldLayout?oldLayout:this;fullSize=oldLayout.padHeight(fullSize);var paddedFullSizeInCells=Math.ceil(this.fromPixelsToVCells(fullSize));var paddedFullSize=this.fromVCellsToPixels(paddedFullSizeInCells);return new Wirecloud.ui.MultiValuedSize(contentHeight+(paddedFullSize-fullSize),paddedFullSizeInCells);};ColumnLayout.prototype.adaptWidth=function(contentWidth,fullSize,oldLayout){oldLayout=oldLayout?oldLayout:this;fullSize=oldLayout.padWidth(fullSize);var paddedFullSizeInCells=Math.ceil(this.fromPixelsToHCells(fullSize));var paddedFullSize=this.fromHCellsToPixels(paddedFullSizeInCells);return new Wirecloud.ui.MultiValuedSize(contentWidth+(paddedFullSize-fullSize),paddedFullSizeInCells);};ColumnLayout.prototype.padWidth=function(width){return width+this.leftMargin+this.rightMargin;};ColumnLayout.prototype.padHeight=function(height){return height+this.topMargin+this.bottomMargin;};ColumnLayout.prototype.getColumnOffset=function(column){var tmp=Math.floor((this.getWidth()*this.fromHCellsToPercentage(column))/100);tmp+=this.leftMargin+this.dragboardLeftMargin;return tmp;};ColumnLayout.prototype.getRowOffset=function(row){return this.dragboardTopMargin+this.fromVCellsToPixels(row)+this.topMargin;};ColumnLayout.prototype._getPositionOn=function _getPositionOn(buffer,widget){if(buffer===this.matrix||buffer==="base"){return widget.getPosition();}else{return this._buffers[buffer].positions[widget.code];}};ColumnLayout.prototype._setPositionOn=function _setPositionOn(buffer,widget,position){if(buffer===this.matrix||buffer==="base"){widget.setPosition(position);}else{this._buffers[buffer].positions[widget.code]=position;}};ColumnLayout.prototype._clearMatrix=function(){this.matrix=[];this._buffers["base"].matrix=this.matrix;for(var x=0;x<this.getColumns();x++){this.matrix[x]=[];}};ColumnLayout.prototype._hasSpaceFor=function(_matrix,positionX,positionY,width,height){var x,y;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){if(_matrix[positionX+x][positionY+y]!=null){return false;}}}
return true;};ColumnLayout.prototype._reserveSpace=function(_matrix,iWidget){var x,y;var position=this._getPositionOn(_matrix,iWidget);var width=iWidget.getWidth();var height=iWidget.getHeight();if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[position.x+x][position.y+y]=iWidget;}}};ColumnLayout.prototype._clearSpace=function(_matrix,iWidget){var x,y;var position=this._getPositionOn(_matrix,iWidget);var width=iWidget.getWidth();var height=iWidget.getHeight();if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[position.x+x][position.y+y];}}
this._compressColumns(_matrix,position.x,width);};ColumnLayout.prototype._compressColumns=function(_matrix,x,width){var i,y;for(i=0;i<width;i++){for(y=_matrix[x+i].length-1;y>=0;y--){if(_matrix[x+i][y]!=null){break;}
_matrix[x+i].pop();}}};ColumnLayout.prototype._searchInsertPoint=function _searchInsertPoint(_matrix,x,y,width,height){return y;};ColumnLayout.prototype._moveSpaceDown=function _moveSpaceDown(buffer,iWidget,offsetY){var affectedIWidgets,position,finalPosition,edgeY,iwidget,x,y,key,matrix;affectedIWidgets={};matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,iWidget);finalPosition=new Wirecloud.DragboardPosition(position.x,position.y+offsetY);edgeY=position.y+iWidget.getHeight();for(x=0;x<iWidget.getWidth();x++){for(y=0;y<offsetY;y++){iwidget=matrix[position.x+x][edgeY+y];if(iwidget!=null){affectedIWidgets[iwidget.code]=offsetY-y;break;}}}
for(key in affectedIWidgets){iwidget=this.iWidgets[key];this._moveSpaceDown(buffer,iwidget,affectedIWidgets[key]);}
this._clearSpace(buffer,iWidget);this._setPositionOn(buffer,iWidget,finalPosition);this._reserveSpace(buffer,iWidget);};ColumnLayout.prototype._moveSpaceUp=function(buffer,iWidget){var position,edgeY,offsetY,affectedIWidgets,finalPosition,iwidget,x,y,columnsize,key,matrix;matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,iWidget);edgeY=position.y+iWidget.getHeight();offsetY=1;while(((position.y-offsetY)>=0)&&this._hasSpaceFor(matrix,position.x,position.y-offsetY,iWidget.getWidth(),1)){offsetY+=1;}
offsetY-=1;if(offsetY>0){affectedIWidgets={};finalPosition=new Wirecloud.DragboardPosition(position.x,position.y-offsetY);for(x=0;x<iWidget.getWidth();x++){columnsize=matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){iwidget=matrix[position.x+x][y];if(iwidget!=null){affectedIWidgets[iwidget.code]=iwidget;break;}}}
this._clearSpace(buffer,iWidget);this._setPositionOn(buffer,iWidget,finalPosition);this._reserveSpace(buffer,iWidget);for(key in affectedIWidgets){this._moveSpaceUp(buffer,affectedIWidgets[key]);}
return true;}
return false;};ColumnLayout.prototype._removeFromMatrix=function(_matrix,iWidget){this._clearSpace(_matrix,iWidget);return false;};ColumnLayout.prototype._reserveSpace2=function(_matrix,iWidget,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[positionX+x][positionY+y]=iWidget;}}};ColumnLayout.prototype._clearSpace2=function(_matrix,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[positionX+x][positionY+y];}}
this._compressColumns(_matrix,positionX,width);};ColumnLayout.prototype._notifyResizeEvent=function(iWidget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){var x,y;var step2Width=oldWidth;var position=iWidget.getPosition();var step2X,iWidgetToMove,finalYPos,widthDiff;step2X=position.x;if(newWidth>oldWidth){step2Width=oldWidth;finalYPos=position.y+newHeight;if(resizeLeftSide){widthDiff=newWidth-oldWidth;for(x=position.x-widthDiff;x<position.x;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
position.x-=widthDiff;if(persist){iWidget.setPosition(position);}
this._reserveSpace2(this.matrix,iWidget,position.x,position.y,widthDiff,newHeight);}else{for(x=position.x+oldWidth;x<position.x+newWidth;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
this._reserveSpace2(this.matrix,iWidget,position.x+oldWidth,position.y,newWidth-oldWidth,newHeight);}}else if(newWidth<oldWidth){step2Width=newWidth;widthDiff=oldWidth-newWidth;if(resizeLeftSide){this._clearSpace2(this.matrix,position.x,position.y,widthDiff,oldHeight);position.x+=widthDiff;if(persist){iWidget.setPosition(position);}
step2X=position.x;}else{this._clearSpace2(this.matrix,position.x+newWidth,position.y,widthDiff,oldHeight);}}
if(newHeight>oldHeight){var limitY=position.y+newHeight;var limitX=step2X+step2Width;for(y=position.y+oldHeight;y<limitY;y++){for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceDown("base",this.matrix[x][y],limitY-y);}}}
this._reserveSpace2(this.matrix,iWidget,step2X,position.y+oldHeight,step2Width,newHeight-oldHeight);}else if(newHeight<oldHeight){this._clearSpace2(this.matrix,step2X,position.y+newHeight,step2Width,oldHeight-newHeight);}
this._notifyWindowResizeEvent(true,true);if(persist){this.dragboard._commitChanges();}};ColumnLayout.prototype._insertAt=function _insertAt(iWidget,x,y,buffer){var newPosition=new Wirecloud.DragboardPosition(x>0?x:0,y>0?y:0);var affectedwidget,offset,affectedY,matrix;var affectedWidgets=false;var lastX=newPosition.x+iWidget.getWidth();var lastY=newPosition.y+iWidget.getHeight();if(buffer==null){buffer="base";}
matrix=this._buffers[buffer].matrix;for(x=newPosition.x;x<lastX;x++){for(y=newPosition.y;y<lastY;y++){affectedwidget=matrix[x][y];if(affectedwidget!=null){affectedY=this._getPositionOn(buffer,affectedwidget).y;offset=lastY-affectedY;this._moveSpaceDown(buffer,affectedwidget,offset);affectedWidgets=true;break;}}}
this._setPositionOn(buffer,iWidget,newPosition);this._reserveSpace(buffer,iWidget);return affectedWidgets;};ColumnLayout.prototype._searchFreeSpace=function(width,height){var positionX=0,positionY=0;var columns=this.getColumns()-width+1;for(positionY=0;true;positionY++){for(positionX=0;positionX<columns;positionX++){if(this._hasSpaceFor(this.matrix,positionX,positionY,width,height)){return new Wirecloud.DragboardPosition(positionX,positionY);}}}};ColumnLayout.prototype.initialize=function(){var iWidget,i,key,position,iWidgetsToReinsert=[];this._clearMatrix();for(key in this.iWidgets){iWidget=this.iWidgets[key];position=iWidget.getPosition();iWidget.paint(true);if(iWidget.getWidth()>this.getColumns()){iWidget.contentWidth=this.getColumns();}
if(iWidget.getWidth()+position.x>this.getColumns()){iWidgetsToReinsert.push(iWidget);}else if(this._hasSpaceFor(this.matrix,position.x,position.y,iWidget.getWidth(),iWidget.getHeight())){this._reserveSpace(this.matrix,iWidget);}else{iWidgetsToReinsert.push(iWidget);}}
var modified=false;if(iWidgetsToReinsert.length>0){for(i=0;i<iWidgetsToReinsert.length;i++){position=this._searchFreeSpace(iWidgetsToReinsert[i].getWidth(),iWidgetsToReinsert[i].getHeight());iWidgetsToReinsert[i].setPosition(position);this._reserveSpace(this.matrix,iWidgetsToReinsert[i]);}
modified=true;}
this.initialized=true;return modified;};ColumnLayout.prototype.getCellAt=function(x,y){var columnWidth=this.getWidth()/this.getColumns();return new Wirecloud.DragboardPosition(Math.floor(x/columnWidth),Math.floor(y/this.getCellHeight()));};ColumnLayout.prototype.addIWidget=function(iWidget,affectsDragboard){var affectedWidgets=false;Wirecloud.ui.DragboardLayout.prototype.addIWidget.call(this,iWidget,affectsDragboard);if(!this.initialized){return;}
if(iWidget.getWidth()>this.getColumns()){iWidget.contentWidth=this.getColumns();if(iWidget.isVisible()){iWidget._recomputeSize(true);}}
var position=iWidget.getPosition();if(position){var diff=iWidget.getWidth()+position.x-this.getColumns();if(diff>0){position.x-=diff;}
affectedWidgets=this._insertAt(iWidget,position.x,position.y,"base");}else{position=this._searchFreeSpace(iWidget.getWidth(),iWidget.getHeight());iWidget.setPosition(position);this._reserveSpace(this.matrix,iWidget);}
this._adaptIWidget(iWidget);return affectedWidgets;};ColumnLayout.prototype.removeIWidget=function(iWidget,affectsDragboard){var affectedWidgets;affectedWidgets=this._removeFromMatrix("base",iWidget);Wirecloud.ui.DragboardLayout.prototype.removeIWidget.call(this,iWidget,affectsDragboard);return affectedWidgets;};ColumnLayout.prototype.moveTo=function(destLayout){var movedWidgets,orderedWidgets,x,y,i,columns,rows,iWidget;this._removeFromMatrix=ColumnLayout.prototype._removeFromMatrix;movedWidgets={};orderedWidgets=[];columns=this.getColumns();rows=this.getRows();for(y=0;y<rows;y+=1){for(x=0;x<columns;x+=1){var iwidget=this.matrix[x][y];if(iwidget!=null&&!(iwidget.id in movedWidgets)){orderedWidgets.push(iwidget);movedWidgets[iwidget.id]=true;}}}
for(i=0;i<orderedWidgets.length;i+=1){iWidget=orderedWidgets[i];iWidget.moveToLayout(destLayout);}
delete this._removeFromMatrix;};ColumnLayout.prototype._cloneMatrix=function _cloneMatrix(matrix){var i,cloned_matrix=[];for(i=0;i<this.columns;i++){cloned_matrix[i]=Wirecloud.Utils.clone(matrix[i]);}
return cloned_matrix;};ColumnLayout.prototype._clonePositions=function _clonePositions(buffer){var key,positions={};for(key in this.iWidgets){positions[key]=this._getPositionOn(buffer,this.iWidgets[key]).clone();}
return positions;};ColumnLayout.prototype.initializeMove=function(iwidget,draggable){var msg,key,i,lastWidget,lastY,tmp;draggable=draggable||null;if(this.iwidgetToMove!==null){msg=gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);this.cancelMove();}
this.iwidgetToMove=iwidget;this._buffers["backup"]={};this._buffers["backup"]["positions"]=this._clonePositions(this.matrix);this._buffers["shadow"]={"matrix":this.matrix};lastY=0;this._buffers["backup"]["matrix"]=this._cloneMatrix(this.matrix);this._removeFromMatrix("backup",iwidget);this.searchInsertPointCache=[];for(i=0;i<this.columns;i++){this.searchInsertPointCache[i]=[];lastWidget=this.matrix[i][this.matrix[i].length-1];if(!lastWidget){continue;}
tmp=lastWidget.getPosition().y+lastWidget.getHeight();if(tmp>lastY){lastY=tmp;}}
this.searchInsertPointYLimit=lastY+1;this.dragboardCursor=new Wirecloud.ui.DragboardCursor(iwidget);this.dragboardCursor.paint(this.dragboard.dragboardElement);if(draggable){draggable.setXOffset(this.fromHCellsToPixels(1)/2);draggable.setYOffset(this.getCellHeight());}};ColumnLayout.prototype._destroyCursor=function _destroyCursor(){if(this.dragboardCursor!==null){this.dragboardCursor.destroy();this.dragboardCursor=null;}};ColumnLayout.prototype.disableCursor=function(){this._destroyCursor();};ColumnLayout.prototype._setPositions=function _setPositions(){var key,curIWidget;for(key in this.iWidgets){curIWidget=this.iWidgets[key];if(curIWidget!==this.iwidgetToMove){curIWidget.setPosition(this._getPositionOn("shadow",curIWidget));}}
this.dragboardCursor.setPosition(this._getPositionOn("shadow",this.dragboardCursor));};ColumnLayout.prototype.moveTemporally=function moveTemporally(x,y){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var maxX=this.getColumns()-this.iwidgetToMove.getWidth();if(x>maxX){x=maxX;}
if(this.dragboardCursor!=null){var cursorpos=this.dragboardCursor.getPosition();if((cursorpos.y!==y)||(cursorpos.x!==x)){this._buffers["shadow"]["positions"]=this._clonePositions("backup");this._buffers["shadow"]["matrix"]=this._cloneMatrix(this._buffers["backup"]["matrix"]);this._insertAt(this.dragboardCursor,x,y,"shadow");this._setPositions();}}else{this._buffers["shadow"]["positions"]=this._clonePositions("backup");this._buffers["shadow"]["matrix"]=this._cloneMatrix(this._buffers["backup"]["matrix"]);this.dragboardCursor=new Wirecloud.ui.DragboardCursor(this.iwidgetToMove);this.dragboardCursor.paint(this.dragboard.dragboardElement);this._insertAt(this.dragboardCursor,x,y,"shadow");}};ColumnLayout.prototype.cancelMove=function(){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Trying to cancel an inexistant temporal move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this._destroyCursor();for(var key in this.iWidgets){this.iWidgets[key].setPosition(this.iWidgets[key].getPosition());}
this.iwidgetToMove=null;this.dragboardCursor=null;};ColumnLayout.prototype.acceptMove=function(){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Function acceptMove called when there is not an started iwidget move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var oldposition=this.iwidgetToMove.getPosition();var newposition=this.dragboardCursor.getPosition();this._destroyCursor();this.iwidgetToMove.setPosition(newposition);if(oldposition.y!==newposition.y||oldposition.x!==newposition.x){this.matrix=this._buffers["shadow"].matrix;this._buffers["base"].matrix=this.matrix;this._reserveSpace("base",this.iwidgetToMove);this.dragboard._commitChanges();}
this.dragboard._notifyWindowResizeEvent();this.iwidgetToMove=null;this.dragboardCursor=null;};Wirecloud.ui.ColumnLayout=ColumnLayout;})();(function(){"use strict";var SmartColumnLayout=function SmartColumnLayout(dragboard,columns,cellHeight,verticalMargin,horizontalMargin,scrollbarSpace){Wirecloud.ui.ColumnLayout.call(this,dragboard,columns,cellHeight,verticalMargin,horizontalMargin,scrollbarSpace);};SmartColumnLayout.prototype=new Wirecloud.ui.ColumnLayout();SmartColumnLayout.prototype._realSearchInsertPoint=function(_matrix,x,y,width,height){var widthDiff,lastY,offsetX;if(y===0){return 0;}else if((_matrix[x][y-1]!=null)&&(_matrix[x][y-1]!=_matrix[x][y])){return y;}else if(_matrix[x][y]){widthDiff=_matrix[x][y].getWidth()-width;widthDiff-=x-this._getPositionOn(_matrix,_matrix[x][y]).x;if(widthDiff>0){y=this._getPositionOn(_matrix,_matrix[x][y]).y-1;while((y>=0)&&(this._hasSpaceFor(_matrix,x,y,width,1))){y--;}
return++y;}else if(widthDiff!==0){for(;y>1;y--){for(offsetX=0;offsetX<width;offsetX++){if(_matrix[x+offsetX][y]!=_matrix[x+offsetX][y-1]){if(_matrix[x+offsetX][y-1]){return y;}}}}
return 0;}else{return this._getPositionOn(_matrix,_matrix[x][y]).y;}}
lastY=y;while((y>=0)&&(this._hasSpaceFor(_matrix,x,y,width,1))){y--;}
if(y!=lastY){y++;}else{for(;y>1;y--){for(offsetX=0;offsetX<width;offsetX++){if(_matrix[x+offsetX][y]!=_matrix[x+offsetX][y-1]){if(_matrix[x+offsetX][y-1]){return y;}}}}
return 0;}
return y;};SmartColumnLayout.prototype._searchInsertPoint=function(_matrix,x,y,width,height){if(y>this.searchInsertPointYLimit){y=this.searchInsertPointYLimit;}
if(!this.searchInsertPointCache[x][y]){this.searchInsertPointCache[x][y]=this._realSearchInsertPoint(_matrix,x,y,width,height);}
return this.searchInsertPointCache[x][y];};SmartColumnLayout.prototype.initialize=function(){var modified=Wirecloud.ui.ColumnLayout.prototype.initialize.call(this);var iWidget,key,keys=[];for(key in this.iWidgets){keys.push(key);iWidget=this.iWidgets[key];modified=modified||this._moveSpaceUp("base",iWidget);}
if(modified){this.dragboard._commitChanges(keys);}};SmartColumnLayout.prototype._notifyWindowResizeEvent=function(widthChanged,heightChanged){if(widthChanged){Wirecloud.ui.DragboardLayout.prototype._notifyWindowResizeEvent.call(this,widthChanged,heightChanged);}};SmartColumnLayout.prototype._notifyResizeEvent=function(iWidget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){var x,y;var step2Width=oldWidth;var position=iWidget.getPosition();var step2X,finalYPos,widthDiff,iWidgetToMove,limitX,limitY;step2X=position.x;if(newWidth>oldWidth){step2Width=oldWidth;finalYPos=position.y+newHeight;if(resizeLeftSide){widthDiff=newWidth-oldWidth;for(x=position.x-widthDiff;x<position.x;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
position.x-=widthDiff;if(persist){iWidget.setPosition(position);}
this._reserveSpace2(this.matrix,iWidget,position.x,position.y,widthDiff,newHeight);}else{for(x=position.x+oldWidth;x<position.x+newWidth;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
this._reserveSpace2(this.matrix,iWidget,position.x+oldWidth,position.y,newWidth-oldWidth,newHeight);}}else if(newWidth<oldWidth){step2Width=newWidth;widthDiff=oldWidth-newWidth;if(resizeLeftSide){this._clearSpace2(this.matrix,position.x,position.y,widthDiff,oldHeight);y=position.y+oldHeight;limitX=position.x+widthDiff;for(x=position.x;x<limitX;++x){if(this.matrix[x][y]!=null){this._moveSpaceUp("base",this.matrix[x][y]);}}
position.x+=widthDiff;if(persist){iWidget.setPosition(position);}
step2X=position.x;}else{this._clearSpace2(this.matrix,position.x+newWidth,position.y,widthDiff,oldHeight);y=position.y+oldHeight;limitX=position.x+oldWidth;for(x=position.x+newWidth;x<limitX;++x){if(this.matrix[x][y]!=null){this._moveSpaceUp("base",this.matrix[x][y]);}}}}
if(newHeight>oldHeight){limitY=position.y+newHeight;limitX=step2X+step2Width;for(y=position.y+oldHeight;y<limitY;y++){for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceDown("base",this.matrix[x][y],limitY-y);}}}
this._reserveSpace2(this.matrix,iWidget,step2X,position.y+oldHeight,step2Width,newHeight-oldHeight);}else if(newHeight<oldHeight){this._clearSpace2(this.matrix,step2X,position.y+newHeight,step2Width,oldHeight-newHeight);y=position.y+oldHeight;limitX=step2X+step2Width;for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceUp("base",this.matrix[x][y]);}}}
this._notifyWindowResizeEvent(true,true);if(persist){this._moveSpaceUp("base",iWidget);this.dragboard._commitChanges();}};SmartColumnLayout.prototype._insertAt=function(iWidget,x,y,buffer){var affectedWidgets=Wirecloud.ui.ColumnLayout.prototype._insertAt.call(this,iWidget,x,y,buffer);this._moveSpaceUp(buffer,iWidget);return affectedWidgets;};SmartColumnLayout.prototype._removeFromMatrix=function(buffer,iWidget){this._clearSpace(buffer,iWidget);var modified=false,affectedIWidgets={};var affectedwidget,x,y,columnsize;var position=this._getPositionOn(buffer,iWidget);var edgeY=position.y+iWidget.getHeight();var _matrix=this._buffers[buffer].matrix;for(x=0;x<iWidget.getWidth();x++){columnsize=_matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){affectedwidget=_matrix[position.x+x][y];if((affectedwidget!=null)&&(typeof affectedIWidgets[affectedwidget.code]!==true)){affectedIWidgets[affectedwidget.code]=true;modified=true;this._moveSpaceUp(buffer,affectedwidget);break;}}}
return modified;};Wirecloud.ui.SmartColumnLayout=SmartColumnLayout;})();(function(){"use strict";var GridLayout=function GridLayout(dragboard,columns,rows,verticalMargin,horizontalMargin){if(arguments.length===0){return;}
this.initialized=false;this._buffers={"base":{}};Object.defineProperties(this,{'columns':{value:columns},'rows':{value:rows}});if((verticalMargin%2)===0){this.topMargin=verticalMargin/2;this.bottomMargin=verticalMargin/2;}else{this.topMargin=Math.floor(verticalMargin/2);this.bottomMargin=Math.floor(verticalMargin/2)+1;}
if((horizontalMargin%2)===0){this.leftMargin=horizontalMargin/2;this.rightMargin=horizontalMargin/2;}else{this.leftMargin=Math.floor(horizontalMargin/2);this.rightMargin=Math.floor(horizontalMargin/2)+1;}
clearMatrix.call(this);this._buffers["base"]={matrix:this.matrix,};this.dragboardCursor=null;this.iwidgetToMove=null;Wirecloud.ui.DragboardLayout.call(this,dragboard);};GridLayout.prototype=new Wirecloud.ui.DragboardLayout();GridLayout.prototype.fromPixelsToVCells=function fromPixelsToVCells(pixels){var cells=pixels/this.fromVCellsToPixels(1);var truncatedCells=Math.floor(cells);if(Math.ceil(this.fromVCellsToPixels(truncatedCells))===pixels){return truncatedCells;}else{return cells;}};GridLayout.prototype.fromVCellsToPixels=function fromVCellsToPixels(rows){return(this.getHeight()*this.fromVCellsToPercentage(rows))/100;};GridLayout.prototype.fromVCellsToPercentage=function fromVCellsToPercentage(rows){return rows*(100/this.rows);};GridLayout.prototype.getWidthInPixels=function getWidthInPixels(cells){return this.fromHCellsToPixels(cells)-this.leftMargin-this.rightMargin;};GridLayout.prototype.getHeightInPixels=function getHeightInPixels(cells){return this.fromVCellsToPixels(cells)-this.topMargin-this.bottomMargin;};GridLayout.prototype.fromPixelsToHCells=function fromPixelsToHCells(pixels){var cells=pixels/this.fromHCellsToPixels(1);var truncatedCells=Math.floor(cells);if(Math.ceil(this.fromHCellsToPixels(truncatedCells))===pixels){return truncatedCells;}else{return cells;}};GridLayout.prototype.fromHCellsToPixels=function fromHCellsToPixels(columns){return(this.getWidth()*this.fromHCellsToPercentage(columns))/100;};GridLayout.prototype.fromHCellsToPercentage=function fromHCellsToPercentage(columns){return columns*(100/this.columns);};GridLayout.prototype.adaptColumnOffset=function(pixels){var halfColumnWidth=Math.floor(this.fromHCellsToPixels(1)/2);var offsetInLU=Math.floor(this.fromPixelsToHCells(pixels-this.leftMargin+halfColumnWidth));var offsetInPixels=this.fromHCellsToPixels(offsetInLU)+this.leftMargin;return new Wirecloud.ui.MultiValuedSize(offsetInPixels,offsetInLU);};GridLayout.prototype.adaptRowOffset=function(pixels){var halfRowHeight=Math.floor(this.fromVCellsToPixels(1)/2);var offsetInLU=Math.floor(this.fromPixelsToVCells(pixels-this.topMargin+halfRowHeight));var offsetInPixels=this.fromVCellsToPixels(offsetInLU)+this.topMargin;return new Wirecloud.ui.MultiValuedSize(offsetInPixels,offsetInLU);};GridLayout.prototype.adaptHeight=function(contentHeight,fullSize,oldLayout){oldLayout=oldLayout?oldLayout:this;fullSize=oldLayout.padHeight(fullSize);var paddedFullSizeInCells=Math.ceil(this.fromPixelsToVCells(fullSize));var paddedFullSize=this.fromVCellsToPixels(paddedFullSizeInCells);return new Wirecloud.ui.MultiValuedSize(contentHeight+(paddedFullSize-fullSize),paddedFullSizeInCells);};GridLayout.prototype.adaptWidth=function(contentWidth,fullSize,oldLayout){oldLayout=oldLayout?oldLayout:this;fullSize=oldLayout.padWidth(fullSize);var paddedFullSizeInCells=Math.ceil(this.fromPixelsToHCells(fullSize));var paddedFullSize=this.fromHCellsToPixels(paddedFullSizeInCells);return new Wirecloud.ui.MultiValuedSize(contentWidth+(paddedFullSize-fullSize),paddedFullSizeInCells);};GridLayout.prototype.padWidth=function(width){return width+this.leftMargin+this.rightMargin;};GridLayout.prototype.padHeight=function(height){return height+this.topMargin+this.bottomMargin;};GridLayout.prototype.getColumnOffset=function(column){var tmp=Math.floor((this.getWidth()*this.fromHCellsToPercentage(column))/100);tmp+=this.leftMargin+this.dragboardLeftMargin;return tmp;};GridLayout.prototype.getRowOffset=function(row){return this.dragboardTopMargin+this.fromVCellsToPixels(row)+this.topMargin;};GridLayout.prototype._getPositionOn=function _getPositionOn(buffer,widget){if(buffer===this.matrix||buffer==="base"){return widget.getPosition();}else{return this._buffers[buffer].positions[widget.code];}};GridLayout.prototype._setPositionOn=function _setPositionOn(buffer,widget,position){if(buffer===this.matrix||buffer==="base"){widget.setPosition(position);}else{this._buffers[buffer].positions[widget.code]=position;}};var clearMatrix=function clearMatrix(){this.matrix=[];this._buffers["base"].matrix=this.matrix;for(var x=0;x<this.columns;x++){this.matrix[x]=[];}};GridLayout.prototype._hasSpaceFor=function(_matrix,positionX,positionY,width,height){var x,y;if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){if(_matrix[positionX+x][positionY+y]!=null){return false;}}}
return true;};GridLayout.prototype._reserveSpace=function(_matrix,iWidget){var x,y;var position=this._getPositionOn(_matrix,iWidget);var width=iWidget.getWidth();var height=iWidget.getHeight();if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[position.x+x][position.y+y]=iWidget;}}};GridLayout.prototype._clearSpace=function(_matrix,iWidget){var x,y;var position=this._getPositionOn(_matrix,iWidget);var width=iWidget.getWidth();var height=iWidget.getHeight();if(typeof _matrix==="string"){_matrix=this._buffers[_matrix].matrix;}
for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[position.x+x][position.y+y];}}
this._compressColumns(_matrix,position.x,width);};GridLayout.prototype._compressColumns=function(_matrix,x,width){var i,y;for(i=0;i<width;i++){for(y=_matrix[x+i].length-1;y>=0;y--){if(_matrix[x+i][y]!=null){break;}
_matrix[x+i].pop();}}};GridLayout.prototype._searchInsertPoint=function _searchInsertPoint(_matrix,x,y,width,height){return y;};GridLayout.prototype._moveSpaceDown=function _moveSpaceDown(buffer,iWidget,offsetY){var affectedIWidgets,position,finalPosition,edgeY,iwidget,x,y,key,matrix;affectedIWidgets={};matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,iWidget);finalPosition=new Wirecloud.DragboardPosition(position.x,position.y+offsetY);edgeY=position.y+iWidget.getHeight();for(x=0;x<iWidget.getWidth();x++){for(y=0;y<offsetY;y++){iwidget=matrix[position.x+x][edgeY+y];if(iwidget!=null){affectedIWidgets[iwidget.code]=offsetY-y;break;}}}
for(key in affectedIWidgets){iwidget=this.iWidgets[key];this._moveSpaceDown(buffer,iwidget,affectedIWidgets[key]);}
this._clearSpace(buffer,iWidget);this._setPositionOn(buffer,iWidget,finalPosition);this._reserveSpace(buffer,iWidget);};GridLayout.prototype._moveSpaceUp=function(buffer,iWidget){var position,edgeY,offsetY,affectedIWidgets,finalPosition,iwidget,x,y,columnsize,key,matrix;matrix=this._buffers[buffer].matrix;position=this._getPositionOn(buffer,iWidget);edgeY=position.y+iWidget.getHeight();offsetY=1;while(((position.y-offsetY)>=0)&&this._hasSpaceFor(matrix,position.x,position.y-offsetY,iWidget.getWidth(),1)){offsetY+=1;}
offsetY-=1;if(offsetY>0){affectedIWidgets={};finalPosition=new Wirecloud.DragboardPosition(position.x,position.y-offsetY);for(x=0;x<iWidget.getWidth();x++){columnsize=matrix[position.x+x].length;for(y=edgeY;y<columnsize;y++){iwidget=matrix[position.x+x][y];if(iwidget!=null){affectedIWidgets[iwidget.code]=iwidget;break;}}}
this._clearSpace(buffer,iWidget);this._setPositionOn(buffer,iWidget,finalPosition);this._reserveSpace(buffer,iWidget);for(key in affectedIWidgets){this._moveSpaceUp(buffer,affectedIWidgets[key]);}
return true;}
return false;};GridLayout.prototype._removeFromMatrix=function(_matrix,iWidget){this._clearSpace(_matrix,iWidget);return false;};GridLayout.prototype._reserveSpace2=function(_matrix,iWidget,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){_matrix[positionX+x][positionY+y]=iWidget;}}};GridLayout.prototype._clearSpace2=function(_matrix,positionX,positionY,width,height){var x,y;for(x=0;x<width;x++){for(y=0;y<height;y++){delete _matrix[positionX+x][positionY+y];}}
this._compressColumns(_matrix,positionX,width);};GridLayout.prototype._notifyResizeEvent=function(iWidget,oldWidth,oldHeight,newWidth,newHeight,resizeLeftSide,persist){var x,y;var step2Width=oldWidth;var position=iWidget.getPosition();var step2X,iWidgetToMove,finalYPos,widthDiff;step2X=position.x;if(newWidth>oldWidth){step2Width=oldWidth;finalYPos=position.y+newHeight;if(resizeLeftSide){widthDiff=newWidth-oldWidth;for(x=position.x-widthDiff;x<position.x;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
position.x-=widthDiff;if(persist){iWidget.setPosition(position);}
this._reserveSpace2(this.matrix,iWidget,position.x,position.y,widthDiff,newHeight);}else{for(x=position.x+oldWidth;x<position.x+newWidth;++x){for(y=0;y<newHeight;++y){iWidgetToMove=this.matrix[x][position.y+y];if(iWidgetToMove!=null){this._moveSpaceDown("base",iWidgetToMove,finalYPos-iWidgetToMove.position.y);break;}}}
this._reserveSpace2(this.matrix,iWidget,position.x+oldWidth,position.y,newWidth-oldWidth,newHeight);}}else if(newWidth<oldWidth){step2Width=newWidth;widthDiff=oldWidth-newWidth;if(resizeLeftSide){this._clearSpace2(this.matrix,position.x,position.y,widthDiff,oldHeight);position.x+=widthDiff;if(persist){iWidget.setPosition(position);}
step2X=position.x;}else{this._clearSpace2(this.matrix,position.x+newWidth,position.y,widthDiff,oldHeight);}}
if(newHeight>oldHeight){var limitY=position.y+newHeight;var limitX=step2X+step2Width;for(y=position.y+oldHeight;y<limitY;y++){for(x=step2X;x<limitX;x++){if(this.matrix[x][y]!=null){this._moveSpaceDown("base",this.matrix[x][y],limitY-y);}}}
this._reserveSpace2(this.matrix,iWidget,step2X,position.y+oldHeight,step2Width,newHeight-oldHeight);}else if(newHeight<oldHeight){this._clearSpace2(this.matrix,step2X,position.y+newHeight,step2Width,oldHeight-newHeight);}
this._notifyWindowResizeEvent(true,true);if(persist){this.dragboard._commitChanges();}};GridLayout.prototype._insertAt=function _insertAt(iWidget,x,y,buffer){var newPosition=new Wirecloud.DragboardPosition(x>0?x:0,y>0?y:0);var affectedwidget,offset,affectedY,matrix;var affectedWidgets=false;var lastX=newPosition.x+iWidget.getWidth();var lastY=newPosition.y+iWidget.getHeight();if(buffer==null){buffer="base";}
matrix=this._buffers[buffer].matrix;for(x=newPosition.x;x<lastX;x++){for(y=newPosition.y;y<lastY;y++){affectedwidget=matrix[x][y];if(affectedwidget!=null){affectedY=this._getPositionOn(buffer,affectedwidget).y;offset=lastY-affectedY;this._moveSpaceDown(buffer,affectedwidget,offset);affectedWidgets=true;break;}}}
this._setPositionOn(buffer,iWidget,newPosition);this._reserveSpace(buffer,iWidget);return affectedWidgets;};GridLayout.prototype._searchFreeSpace=function(width,height){var positionX=0,positionY=0;var columns=this.columns-width+1;for(positionY=0;true;positionY++){for(positionX=0;positionX<columns;positionX++){if(this._hasSpaceFor(this.matrix,positionX,positionY,width,height)){return new Wirecloud.DragboardPosition(positionX,positionY);}}}};GridLayout.prototype.initialize=function(){var iWidget,i,key,position,iWidgetsToReinsert=[];clearMatrix.call(this);for(key in this.iWidgets){iWidget=this.iWidgets[key];position=iWidget.getPosition();iWidget.paint(true);if(iWidget.getWidth()>this.columns){iWidget.contentWidth=this.columns;}
if(iWidget.getWidth()+position.x>this.columns){iWidgetsToReinsert.push(iWidget);}else if(this._hasSpaceFor(this.matrix,position.x,position.y,iWidget.getWidth(),iWidget.getHeight())){this._reserveSpace(this.matrix,iWidget);}else{iWidgetsToReinsert.push(iWidget);}}
var modified=false;if(iWidgetsToReinsert.length>0){for(i=0;i<iWidgetsToReinsert.length;i++){position=this._searchFreeSpace(iWidgetsToReinsert[i].getWidth(),iWidgetsToReinsert[i].getHeight());iWidgetsToReinsert[i].setPosition(position);this._reserveSpace(this.matrix,iWidgetsToReinsert[i]);}
modified=true;}
this.initialized=true;return modified;};GridLayout.prototype.getCellAt=function getCellAt(x,y){var columnWidth=this.getWidth()/this.columns;var rowHeight=this.getHeight()/this.rows;return new Wirecloud.DragboardPosition(Math.floor(x/columnWidth),Math.floor(y/rowHeight));};GridLayout.prototype.addIWidget=function(iWidget,affectsDragboard){var affectedWidgets=false;Wirecloud.ui.DragboardLayout.prototype.addIWidget.call(this,iWidget,affectsDragboard);if(!this.initialized){return;}
if(iWidget.getWidth()>this.columns){iWidget.contentWidth=this.columns;if(iWidget.isVisible()){iWidget._recomputeSize(true);}}
var position=iWidget.getPosition();if(position){var diff=iWidget.getWidth()+position.x-this.columns;if(diff>0){position.x-=diff;}
affectedWidgets=this._insertAt(iWidget,position.x,position.y,"base");}else{position=this._searchFreeSpace(iWidget.getWidth(),iWidget.getHeight());iWidget.setPosition(position);this._reserveSpace(this.matrix,iWidget);}
this._adaptIWidget(iWidget);return affectedWidgets;};GridLayout.prototype.removeIWidget=function(iWidget,affectsDragboard){var affectedWidgets;affectedWidgets=this._removeFromMatrix("base",iWidget);Wirecloud.ui.DragboardLayout.prototype.removeIWidget.call(this,iWidget,affectsDragboard);return affectedWidgets;};GridLayout.prototype.moveTo=function(destLayout){var movedWidgets,orderedWidgets,x,y,i,iWidget;this._removeFromMatrix=GridLayout.prototype._removeFromMatrix;movedWidgets={};orderedWidgets=[];for(y=0;y<this.rows;y+=1){for(x=0;x<this.columns;x+=1){var iwidget=this.matrix[x][y];if(iwidget!=null&&!(iwidget.id in movedWidgets)){orderedWidgets.push(iwidget);movedWidgets[iwidget.id]=true;}}}
for(i=0;i<orderedWidgets.length;i+=1){iWidget=orderedWidgets[i];iWidget.moveToLayout(destLayout);}
delete this._removeFromMatrix;};GridLayout.prototype._cloneMatrix=function _cloneMatrix(matrix){var i,cloned_matrix=[];for(i=0;i<this.columns;i++){cloned_matrix[i]=Wirecloud.Utils.clone(matrix[i]);}
return cloned_matrix;};GridLayout.prototype._clonePositions=function _clonePositions(buffer){var key,positions={};for(key in this.iWidgets){positions[key]=this._getPositionOn(buffer,this.iWidgets[key]).clone();}
return positions;};GridLayout.prototype.initializeMove=function(iwidget,draggable){var msg,key,i,lastWidget,lastY,tmp;draggable=draggable||null;if(this.iwidgetToMove!==null){msg=gettext("There was a pending move that was cancelled because initializedMove function was called before it was finished.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);this.cancelMove();}
this.iwidgetToMove=iwidget;this._buffers["backup"]={};this._buffers["backup"]["positions"]=this._clonePositions(this.matrix);this._buffers["shadow"]={"matrix":this.matrix};lastY=0;this._buffers["backup"]["matrix"]=this._cloneMatrix(this.matrix);this._removeFromMatrix("backup",iwidget);this.searchInsertPointCache=[];for(i=0;i<this.columns;i++){this.searchInsertPointCache[i]=[];lastWidget=this.matrix[i][this.matrix[i].length-1];if(!lastWidget){continue;}
tmp=lastWidget.getPosition().y+lastWidget.getHeight();if(tmp>lastY){lastY=tmp;}}
this.searchInsertPointYLimit=lastY+1;this.dragboardCursor=new Wirecloud.ui.DragboardCursor(iwidget);this.dragboardCursor.paint(this.dragboard.dragboardElement);if(draggable){draggable.setXOffset(this.fromHCellsToPixels(1)/2);draggable.setYOffset(this.fromVCellsToPixels(1)/2);}};GridLayout.prototype._destroyCursor=function _destroyCursor(){if(this.dragboardCursor!==null){this.dragboardCursor.destroy();this.dragboardCursor=null;}};GridLayout.prototype.disableCursor=function(){this._destroyCursor();};GridLayout.prototype._setPositions=function _setPositions(){var key,curIWidget;for(key in this.iWidgets){curIWidget=this.iWidgets[key];if(curIWidget!==this.iwidgetToMove){curIWidget.setPosition(this._getPositionOn("shadow",curIWidget));}}
this.dragboardCursor.setPosition(this._getPositionOn("shadow",this.dragboardCursor));};GridLayout.prototype.moveTemporally=function moveTemporally(x,y){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Dragboard: You must call initializeMove function before calling to this function (moveTemporally).");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var maxX=this.columns-this.iwidgetToMove.getWidth();if(x>maxX){x=maxX;}
if(this.dragboardCursor!=null){var cursorpos=this.dragboardCursor.getPosition();if((cursorpos.y!==y)||(cursorpos.x!==x)){this._buffers["shadow"]["positions"]=this._clonePositions("backup");this._buffers["shadow"]["matrix"]=this._cloneMatrix(this._buffers["backup"]["matrix"]);this._insertAt(this.dragboardCursor,x,y,"shadow");this._setPositions();}}else{this._buffers["shadow"]["positions"]=this._clonePositions("backup");this._buffers["shadow"]["matrix"]=this._cloneMatrix(this._buffers["backup"]["matrix"]);this.dragboardCursor=new Wirecloud.ui.DragboardCursor(this.iwidgetToMove);this.dragboardCursor.paint(this.dragboard.dragboardElement);this._insertAt(this.dragboardCursor,x,y,"shadow");}};GridLayout.prototype.cancelMove=function(){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Trying to cancel an inexistant temporal move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
this._destroyCursor();for(var key in this.iWidgets){this.iWidgets[key].setPosition(this.iWidgets[key].getPosition());}
this.iwidgetToMove=null;this.dragboardCursor=null;};GridLayout.prototype.acceptMove=function(){if(!(this.iwidgetToMove instanceof IWidget)){var msg=gettext("Function acceptMove called when there is not an started iwidget move.");Wirecloud.GlobalLogManager.log(msg,Wirecloud.constants.LOGGING.WARN_MSG);return;}
var oldposition=this.iwidgetToMove.getPosition();var newposition=this.dragboardCursor.getPosition();this._destroyCursor();this.iwidgetToMove.setPosition(newposition);if(oldposition.y!==newposition.y||oldposition.x!==newposition.x){this.matrix=this._buffers["shadow"].matrix;this._buffers["base"].matrix=this.matrix;this._reserveSpace("base",this.iwidgetToMove);this.dragboard._commitChanges();}
this.iwidgetToMove=null;this.dragboardCursor=null;};Wirecloud.ui.GridLayout=GridLayout;})();(function(){"use strict";var market_types,MarketManager;market_types={'wirecloud':{label:'Wirecloud',view_class:CatalogueView}};MarketManager={};MarketManager.getMarkets=function getMarkets(callback,onFailureCallback,onCompleteCallback){Wirecloud.io.makeRequest(Wirecloud.URLs.MARKET_COLLECTION,{method:'GET',requestHeaders:{'Accept':'application/json'},onSuccess:function onSuccess(transport){var raw_data=JSON.parse(transport.responseText);for(var key in raw_data){if(raw_data[key].url==null){delete raw_data[key];}}
callback(raw_data);},onFailure:function onFailure(transport){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error retrieving market list from the server: %(errorMsg)s."),transport);if(typeof onFailureCallback==='function'){onFailureCallback(msg);}},onComplete:function onComplete(transport){if(typeof onCompleteCallback==='function'){onCompleteCallback();}}});};MarketManager.deleteMarket=function deleteMarket(marketplace,options){var url;if(typeof options!=='object'){options={};}
if(marketplace.user!=null){url=Wirecloud.URLs.MARKET_ENTRY.evaluate({user:marketplace.user,market:marketplace.name});}else{url=Wirecloud.URLs.GLOBAL_MARKET_ENTRY.evaluate({market:marketplace.name});}
Wirecloud.io.makeRequest(url,{method:'DELETE',requestHeaders:{'Accept':'application/json'},onSuccess:options.onSuccess,onFailure:function(transport){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error deleting marketplace: %(errorMsg)s."),transport);if(typeof options.onFailure==='function'){options.onFailure(msg);}},onComplete:options.onComplete});};MarketManager.addMarket=function addMarket(market_info,callback){LayoutManagerFactory.getInstance()._startComplexTask(gettext("Adding marketplace"),1);LayoutManagerFactory.getInstance().logSubTask(gettext('Adding marketplace'));Wirecloud.io.makeRequest(Wirecloud.URLs.MARKET_COLLECTION,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(market_info),onSuccess:function(transport){LayoutManagerFactory.getInstance().logSubTask(gettext('Marketplace added successfully'));LayoutManagerFactory.getInstance().logStep('');callback();},onFailure:function(transport){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error adding marketplace: %(errorMsg)s."),transport);(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();},onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});};MarketManager.addMarketType=function addMarketType(type,label,view_class){market_types[type]={label:label,view_class:view_class};};MarketManager.getMarketViewClass=function getMarketplaceViewClass(type){if(type in market_types){return market_types[type].view_class;}else{return null;}};MarketManager.getMarketTypes=function getMarketTypes(){var key,market_type,types=[];for(key in market_types){market_type=market_types[key];types.push({label:market_type.label,value:key});}
return types;};Wirecloud.MarketManager=MarketManager;})();(function(){"use strict";var MarketplaceViewMenuItems,clickCallback;MarketplaceViewMenuItems=function MarketplaceViewMenuItems(marketplace_view){this.market=marketplace_view;StyledElements.DynamicMenuItems.call(this);this._click_callback=function _click_callback(menu_context,menu_item_context){marketplace_view.alternatives.showAlternative(menu_item_context);};};MarketplaceViewMenuItems.prototype=new StyledElements.DynamicMenuItems();MarketplaceViewMenuItems.prototype.build=function build(context){var current_catalogue,key,items=[],item;current_catalogue=this.market.alternatives.getCurrentAlternative();if(this.market.number_of_alternatives>0){for(key in this.market.viewsByName){items.push(new StyledElements.MenuItem(this.market.viewsByName[key].getLabel(),this._click_callback,this.market.viewsByName[key]));}
items.push(new StyledElements.Separator());if(typeof current_catalogue.show_upload_view==='function'){items.push(new StyledElements.MenuItem(gettext('Upload'),function(){this.show_upload_view();}.bind(current_catalogue)));}}
if(!this.loading&&!this.error){items.push(new StyledElements.MenuItem(gettext('Add new marketplace'),function(){var menu,fields,type_entries;fields={'name':{'type':'text','label':gettext('Name'),'required':true},'url':{'type':'text','label':gettext('URL'),'required':true,'initialValue':'http://'},'type':{'type':'select','initialEntries':Wirecloud.MarketManager.getMarketTypes(),'label':gettext('Type'),'required':true}};if(Wirecloud.contextManager.get('issuperuser')){fields['public']={'type':'boolean','label':gettext('Public')}}
menu=new Wirecloud.ui.FormWindowMenu(fields,gettext('Add Marketplace'));menu.executeOperation=function(data){var market_info={"name":data.name,"options":{"name":data.name,"url":data.url,"type":data.type,}};if(data['public']===true){market_info.options['user']=null;}else{market_info.options['user']=Wirecloud.contextManager.get('username');}
Wirecloud.MarketManager.addMarket(market_info,this.market.addMarket.bind(this.market,market_info.options));}.bind(this);menu.show();}.bind(this)));item=new StyledElements.MenuItem(gettext('Delete marketplace'),function(){var msg=gettext('Do you really want to remove the marketplace "%(marketName)s"?');msg=Wirecloud.Utils.interpolate(msg,{'marketName':this.market.alternatives.getCurrentAlternative().getLabel()});var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(function(){LayoutManagerFactory.getInstance()._startComplexTask(gettext("Deleting marketplace"),1);LayoutManagerFactory.getInstance().logSubTask(gettext('Deleting marketplace'));Wirecloud.MarketManager.deleteMarket(this.market.alternatives.getCurrentAlternative().desc,{onSuccess:function(){LayoutManagerFactory.getInstance().logSubTask(gettext('Marketplace deleted successfully'));LayoutManagerFactory.getInstance().logStep('');this.market.refreshViewInfo({onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});}.bind(this),onFailure:function(msg){(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();Wirecloud.GlobalLogManager.log(msg);LayoutManagerFactory.getInstance()._notifyPlatformReady();}});}.bind(this));dialog.show();}.bind(this));item.setDisabled(current_catalogue==null||!current_catalogue.catalogue||!current_catalogue.catalogue.isAllow('delete'));items.push(item);}
return items;};Wirecloud.ui.MarketplaceViewMenuItems=MarketplaceViewMenuItems;})();(function(){"use strict";var ResourcePainter=function ResourcePainter(catalogue_view,resource_template,container,extra_context){if(arguments.length===0){return;}
this.builder=new StyledElements.GUIBuilder();this.catalogue_view=catalogue_view;this.structure_template=resource_template;this.error_template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="alert alert-error"><t:message/></div></s:styledgui>';this.info_template='<s:styledgui xmlns:s="http://wirecloud.conwet.fi.upm.es/StyledElements" xmlns:t="http://wirecloud.conwet.fi.upm.es/Template" xmlns="http://www.w3.org/1999/xhtml"><div class="alert alert-info"><t:message/></div></s:styledgui>';this.container=container;if(extra_context!=null&&(typeof extra_context==='object'||typeof extra_context==='function')){this.extra_context=extra_context;}else{this.extra_context={};}};ResourcePainter.prototype.paintInfo=function paintError(message,context){if(context!=null){message=this.builder.parse(this.builder.DEFAULT_OPENING+message+this.builder.DEFAULT_CLOSING,context);}
return this.builder.parse(this.info_template,{'message':message});};ResourcePainter.prototype.paintError=function paintError(message){return this.builder.parse(this.error_template,{'message':message});};ResourcePainter.prototype.setError=function setError(message){this.container.clear();this.container.appendChild(this.paintError(message));};ResourcePainter.prototype.paint=function paint(resource){var extra_context,i,context,resource_element,license_text;if(typeof this.extra_context==='function'){extra_context=this.extra_context(resource);}else{extra_context=Wirecloud.Utils.clone(this.extra_context);}
if(resource.license!=null&&resource.license!==''){license_text=resource.license;}else{license_text='N/A';}
context=Wirecloud.Utils.merge(extra_context,{'title':resource.title,'name':resource.name,'internalname':resource.uri,'vendor':resource.vendor,'version':resource.version.text,'authors':this.get_people_list.bind(null,resource.authors),'contributors':this.get_people_list.bind(null,resource.contributors),'description':resource.description,'longdescription':function(){return new StyledElements.Fragment(resource.longdescription);},'type':function(){var label=document.createElement('div');label.textContent=resource.type;label.className='label';switch(resource.type){case'widget':label.classList.add('label-success');break;case'operator':label.classList.add('label-warning');break;case'mashup':label.classList.add('label-important');break;case'pack':label.classList.add('label-info');break;}
return label;},'lastupdate':function(){return resource.date.strftime('%x');},'home':function(){var button;button=new StyledElements.StyledButton({'plain':true,'class':'icon-home','title':gettext('Home page')});if(resource.homepage!=null&&resource.homepage!==''){button.addEventListener('click',function(){window.open(resource.homepage,'_blank');});}else{button.disable();}
return button;},'license':license_text,'license_home':function(){var button;button=new StyledElements.StyledButton({'plain':true,'class':'icon-legal','title':gettext('License details')});if(resource.licenseurl!=null&&resource.licenseurl!==''){button.addEventListener('click',function(){window.open(resource.licenseurl,'_blank');});}else{button.disable();}
return button;},'rating':this.get_popularity_html.bind(this,resource.rating),'image':function(){var container=document.createElement('div');container.className="wc-resource-img-container";var image=document.createElement('img');image.className='wc-resource-img';image.onerror=function(event){event.target.src='/static/images/noimage.png';};image.src=resource.image;container.appendChild(image);return container;},'tags':function(options){return this.painter.renderTagList(this.resource,options.max);}.bind({painter:this,resource:resource}),'advancedops':this.renderAdvancedOperations.bind(this,resource),'size':this.format_size.bind(this,resource.size),'versions':function(){var versions=resource.getAllVersions().map(function(version){return'v'+version.text;});return versions.join(', ');}});resource_element=this.builder.parse(this.structure_template,context,resource);if(this.catalogue_view){for(i=0;i<resource_element.elements.length;i+=1){if(!Wirecloud.Utils.XML.isElement(resource_element.elements[i])){continue;}
this.create_simple_command(resource_element.elements[i],'.click_for_details','click',this.catalogue_view.createUserCommand('showDetails',resource));if(resource_element.elements[i].classList.contains('click_for_details')){resource_element.elements[i].addEventListener('click',this.catalogue_view.createUserCommand('showDetails',resource));}}}
return resource_element;};ResourcePainter.prototype.renderAdvancedOperations=function renderAdvancedOperations(resource){var button,fragment=new StyledElements.Fragment();button=new StyledElements.StyledButton({'text':gettext('Download')});button.addEventListener('click',function(){window.open(resource.description_url,'_blank');});fragment.appendChild(button);if(resource.type==='widget'){button=new StyledElements.StyledButton({'text':gettext('Add to workspace')});button.addEventListener('click',function(){LayoutManagerFactory.getInstance().changeCurrentView('workspace');var local_widget=Wirecloud.LocalCatalogue.getResource(resource.vendor,resource.name,resource.version);Wirecloud.activeWorkspace.addInstance(local_widget);});fragment.appendChild(button);}
if(this.catalogue_view.catalogue===Wirecloud.LocalCatalogue){button=new StyledElements.StyledButton({'text':gettext('Publish')});button.addEventListener('click',this.catalogue_view.createUserCommand('publishOtherMarket',resource));fragment.appendChild(button);}
if(Wirecloud.LocalCatalogue.resourceExists(resource)&&resource.isAllow('uninstall')){var local_catalogue_view=LayoutManagerFactory.getInstance().viewsByName.myresources;button=new StyledElements.StyledButton({'class':'btn-danger','text':gettext('Uninstall')});button.addEventListener('click',local_catalogue_view.createUserCommand('uninstall',resource,this.catalogue_view));fragment.appendChild(button);}
if((resource.getAllVersions().length>1)&&resource.isAllow('uninstall-all')){button=new StyledElements.StyledButton({'class':'btn-danger','text':gettext('Uninstall all versions')});button.addEventListener('click',this.catalogue_view.createUserCommand('uninstallall',resource,this.catalogue_view));fragment.appendChild(button);}
if(resource.isAllow('delete')){button=new StyledElements.StyledButton({'class':'btn-danger','text':gettext('Delete')});button.addEventListener('click',this.catalogue_view.createUserCommand('delete',resource));fragment.appendChild(button);}
if((resource.getAllVersions().length>1)&&resource.isAllow('delete-all')){button=new StyledElements.StyledButton({'class':'btn-danger','text':gettext('Delete all versions')});button.addEventListener('click',this.catalogue_view.createUserCommand('deleteall',resource));fragment.appendChild(button);}
return fragment;};ResourcePainter.prototype.renderTagList=function renderTagList(resource,listener,max){var i,fragment,tags,tag,tag_element,len;fragment=new StyledElements.Fragment();tags=resource.tags.slice();tags=tags.sort(function(a,b){return b.apparences-a.apparences;});if(typeof max==='undefined'){max=tags.length;}
len=Math.min(max,tags.length);for(i=0;i<len;i+=1){tag=tags[i];tag_element=document.createElement('a');tag_element.textContent=tag.value;fragment.appendChild(tag_element);}
return fragment;};ResourcePainter.prototype.create_simple_command=function(element,selector,_event,handler,required){var i,elements=element.querySelectorAll(selector);if(required&&elements.length<1){throw new Error();}
for(i=0;i<elements.length;i+=1){elements[i].addEventListener(_event,handler);}};ResourcePainter.prototype.get_people_list=function get_people_list(people){var i,fragment,dd;if(people.length===0){dd=document.createElement('dd');dd.textContent=gettext('N/A');return dd;}
fragment=new StyledElements.Fragment();for(i=0;i<people.length;i++){dd=document.createElement('dd');dd.textContent=people[i].name;fragment.appendChild(dd);}
return fragment;};var SIZE_UNITS=['bytes','KB','MB','GB','TB'];Object.freeze(SIZE_UNITS);ResourcePainter.prototype.format_size=function format_size(size){if(size==null){return gettext('N/A');}
for(var i=0;i<SIZE_UNITS.length;i++){if(size<1024){break;}
size=size/1024;}
return size.toFixed(2)+' '+SIZE_UNITS[i];};ResourcePainter.prototype.get_popularity_html=function get_popularity_html(popularity){var on_stars,md_star,off_stars,stars,star,i;if(popularity==null||popularity<1){popularity=0;}
on_stars=Math.floor(popularity);md_star=popularity-on_stars;off_stars=5-popularity;stars=document.createElement('div');stars.className='rating';if(popularity===0){stars.classList.add('disabled');}
for(i=0;i<on_stars;i+=1){star=document.createElement('span');star.className='on star';stars.appendChild(star);}
if(md_star){star=document.createElement('span');star.className='middle star';stars.appendChild(star);}
for(i=0;i<Math.floor(off_stars);i+=1){star=document.createElement('span');star.className='off star';stars.appendChild(star);}
return stars;};Wirecloud.ui.ResourcePainter=ResourcePainter;})();(function(){"use strict";var PublishView,upload_wgt_file;upload_wgt_file=function upload_wgt_file(){var monitor=LayoutManagerFactory.getInstance()._startComplexTask(gettext("Uploading packaged widget"),1);this.catalogue.addPackagedResource(new FormData(this.wrapperElement.getElementsByClassName("wgt_upload_form")[0]),{monitor:monitor,onSuccess:this._onUploadSuccess.bind(this),onFailure:this._onUploadFailure.bind(this)});};PublishView=function PublishView(id,options){options.class='publish_view';this.catalogue=options.catalogue;this.mainview=options.mainview;StyledElements.Alternative.call(this,id,options);var builder=new StyledElements.GUIBuilder();var contents=builder.parse(Wirecloud.currentTheme.templates.wirecloud_catalogue_publish_interface,{'back_button':function(){var button=new StyledElements.StyledButton({text:gettext('Close upload view')});button.addEventListener('click',this.mainview.home.bind(this.mainview));return button;}.bind(this),'upload_wgt_button':function(){var button=new StyledElements.StyledButton({text:gettext('Add')});button.addClassName('upload_wgt_button');button.addEventListener('click',upload_wgt_file.bind(this),true);return button;}.bind(this)});this.appendChild(contents);};PublishView.prototype=new StyledElements.Alternative();PublishView.prototype._onUploadSuccess=function _onUploadSuccess(){var layoutManager=LayoutManagerFactory.getInstance();layoutManager._notifyPlatformReady();this.mainview.home();this.mainview.refresh_search_results();};PublishView.prototype._onUploadFailure=function _onUploadFailure(msg){var layoutManager=LayoutManagerFactory.getInstance();layoutManager._notifyPlatformReady();(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();};Wirecloud.ui.WirecloudCatalogue={};Wirecloud.ui.WirecloudCatalogue.PublishView=PublishView;})();(function(){"use strict";var ResourceDetailsView=function ResourceDetailsView(id,options){var extra_context;this.mainview=options.catalogue;options['class']='details_interface loading';StyledElements.Alternative.call(this,id,options);extra_context=function(resource){return{'details':function(options,context){var details,i,entries,versions;details=new StyledElements.StyledNotebook();details.addEventListener('changed',function(notebook,oldTab,newTab,context){if(context==null||context.init!==true){var new_status=this.mainview.buildStateData();Wirecloud.HistoryManager.pushState(new_status);}
LayoutManagerFactory.getInstance().header.refresh();}.bind(this));var select=new StyledElements.StyledSelect({'class':'versions'});entries=[];versions=resource.getAllVersions();for(i=0;i<versions.length;i++){entries.push({'label':'v'+versions[i].text,'value':versions[i].text});}
select.addEntries(entries);details.addButton(select,'left');select.setDisabled(versions.length===1);select.setValue(resource.version.text);select.addEventListener('change',function(select){LayoutManagerFactory.getInstance().header._notifyViewChange();resource.changeVersion(select.getValue());this.mainview.createUserCommand('showDetails',resource,{onComplete:function(){var new_status=this.mainview.buildStateData();Wirecloud.HistoryManager.pushState(new_status);LayoutManagerFactory.getInstance().header.refresh();}.bind(this)})();}.bind(this));var main_description=details.createTab({'name':gettext('Main Info'),'closable':false});main_description.appendChild(this.main_details_painter.paint(resource));if(resource.doc){var documentation=details.createTab({'name':gettext('Documentation'),'containerOptions':{'class':'documentation loading'},'closable':false});documentation.addEventListener('show',function(tab){tab.disable();var doc_url=resource.catalogue.RESOURCE_USERGUIDE_ENTRY.evaluate(resource);Wirecloud.io.makeRequest(doc_url,{method:'GET',onSuccess:function(response){var article=document.createElement('article');article.className='markdown-body';article.innerHTML=response.responseText;documentation.clear();documentation.appendChild(article);}.bind(this),onComplete:function(){tab.enable();}});}.bind(this));}
if(resource.changelog){var changelog=details.createTab({'name':gettext('Change Log'),'containerOptions':{'class':'changelog loading'},'closable':false});changelog.addEventListener('show',function(tab){tab.disable();Wirecloud.io.makeRequest(this.mainview.catalogue.RESOURCE_CHANGELOG_ENTRY.evaluate(resource),{method:'GET',onSuccess:function(response){var article=document.createElement('article');article.className='markdown-body';article.innerHTML=response.responseText;changelog.clear();changelog.appendChild(article);}.bind(this),onComplete:function(){tab.enable();}});}.bind(this));}
this.currentNotebook=details;return details;}.bind(this)};}.bind(this);this.main_details_painter=new Wirecloud.ui.ResourcePainter(this.mainview,Wirecloud.currentTheme.templates.catalogue_main_resource_details_template,this);this.resource_details_painter=new Wirecloud.ui.ResourcePainter(this.mainview,Wirecloud.currentTheme.templates.catalogue_resource_details_template,this,extra_context);};ResourceDetailsView.prototype=new StyledElements.Alternative();ResourceDetailsView.prototype.view_name='details';ResourceDetailsView.prototype.buildStateData=function buildStateData(data){if(this.currentEntry!=null){data.resource=this.currentEntry.uri;if(this.currentNotebook){data.tab=this.currentNotebook.getVisibleTab().nameText;}}};ResourceDetailsView.prototype.paint=function paint(resource,options){if(options==null){options={};}
this.currentEntry=resource;this.clear();this.appendChild(this.resource_details_painter.paint(resource));if(options.tab!=null){this.currentNotebook.goToTab(this.currentNotebook.getTabByLabel(options.tab),{context:{init:true}});}};Wirecloud.ui.WirecloudCatalogue.ResourceDetailsView=ResourceDetailsView;})();(function(){"use strict";var builder=new StyledElements.GUIBuilder();var makeDraggable=function makeDraggable(handler){this.draggable=new Wirecloud.ui.Draggable(handler,{window_menu:this},function onStart(draggable,context){var position;context.y=context.window_menu.htmlElement.style.top===""?0:parseInt(context.window_menu.htmlElement.style.top,10);context.x=context.window_menu.htmlElement.style.left===""?0:parseInt(context.window_menu.htmlElement.style.left,10);},function onDrag(e,draggable,context,xDelta,yDelta){context.window_menu.setPosition({posX:context.x+xDelta,posY:context.y+yDelta});},function onFinish(draggable,context){var position=context.window_menu.getStylePosition();if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
context.window_menu.setPosition(position);},function(){return true;});};var WindowMenu=function WindowMenu(title,extra_class,events){var ui_fragment,i,element;if(arguments.length===0){return;}
this.childWindow=null;this._closeListener=this._closeListener.bind(this);ui_fragment=builder.parse(Wirecloud.currentTheme.templates['window_menu'],{'title':function(options){this.titleElement=document.createElement('h3');return this.titleElement;}.bind(this),'body':function(options){this.windowContent=document.createElement('div');if(options&&typeof options['class']==='string'){this.windowContent.className=options['class'];}
return this.windowContent;}.bind(this),'closebutton':function(options){var button=new StyledElements.StyledButton({plain:'true','class':'icon-remove'});button.addEventListener('click',this._closeListener);return button;}.bind(this),'footer':function(options){this.windowBottom=document.createElement('div');if(options&&typeof options['class']==='string'){this.windowBottom.className=options['class'];}
return this.windowBottom;}.bind(this)});for(i=0;i<ui_fragment.elements.length;i+=1){element=ui_fragment.elements[i];if(Wirecloud.Utils.XML.isElement(element)){this.htmlElement=element;break;}}
this.htmlElement.classList.add('window_menu');if(extra_class!=null){this.htmlElement.classList.add(extra_class);}
this.windowHeader=this.htmlElement.querySelector('.window_top');this.setTitle(title);makeDraggable.call(this,this.titleElement);};WindowMenu.prototype=new StyledElements.ObjectWithEvents();WindowMenu.prototype.setPosition=function setPosition(coordinates){this.htmlElement.style.left=coordinates.posX+'px';this.htmlElement.style.top=coordinates.posY+'px';};WindowMenu.prototype.getStylePosition=function getStylePosition(){return{posX:parseInt(this.htmlElement.style.left,10),posY:parseInt(this.htmlElement.style.top,10)};};WindowMenu.prototype.setTitle=function setTitle(title){this.titleElement.textContent=title;};WindowMenu.prototype._closeListener=function _closeListener(e){this.hide();};WindowMenu.prototype.calculatePosition=function calculatePosition(){if(!Wirecloud.Utils.XML.isElement(this.htmlElement.parentNode)){return;}
var coordenates=[];var windowHeight=window.innerHeight;var windowWidth=window.innerWidth;this.htmlElement.style.maxHeight='';this.htmlElement.style.maxWidth='';this.windowContent.style.maxHeight='';var menuWidth=this.htmlElement.offsetWidth;if(menuWidth>windowWidth){menuWidth=windowWidth;this.htmlElement.style.maxWidth=menuWidth+'px';}
var menuHeight=this.htmlElement.offsetHeight;coordenates[1]=(windowHeight-menuHeight)/2;coordenates[0]=(windowWidth-menuWidth)/2;if(windowHeight<menuHeight){this.htmlElement.style.maxHeight=windowHeight+'px';this.htmlElement.style.top='0px';this.windowContent.style.maxHeight=(windowHeight-this.windowHeader.offsetHeight-this.windowBottom.offsetHeight)+'px';}else{this.htmlElement.style.top=coordenates[1]+"px";}
this.htmlElement.style.left=coordenates[0]+"px";if(this.childWindow!=null){this.childWindow.calculatePosition();}};WindowMenu.prototype.show=function show(parentWindow){this._parentWindowMenu=parentWindow;if(this._parentWindowMenu!=null){this._parentWindowMenu._addChildWindow(this);Wirecloud.UserInterfaceManager._registerPopup(this);}else{Wirecloud.UserInterfaceManager._registerRootWindowMenu(this);}
document.body.appendChild(this.htmlElement);this.calculatePosition();this.htmlElement.style.display="block";this.setFocus();};WindowMenu.prototype.hide=function hide(){if(!Wirecloud.Utils.XML.isElement(this.htmlElement.parentNode)){return;}
this.htmlElement.parentNode.removeChild(this.htmlElement);if(this.msgElement!=null){this.msgElement.textContent='';}
if(this.childWindow!=null){this.childWindow.hide();}
if(this._parentWindowMenu!=null){this._parentWindowMenu._removeChildWindow(this);Wirecloud.UserInterfaceManager._unregisterPopup(this);this._parentWindowMenu=null;}else{Wirecloud.UserInterfaceManager._unregisterRootWindowMenu(this);}};WindowMenu.prototype._addChildWindow=function _addChildWindow(windowMenu){if(windowMenu!==this){this.childWindow=windowMenu;}else{throw new TypeError('Window menus cannot be its own child');}};WindowMenu.prototype._removeChildWindow=function _removeChildWindow(windowMenu){if(this.childWindow===windowMenu){this.childWindow=null;}};WindowMenu.prototype.setFocus=function setFocus(){};WindowMenu.prototype.destroy=function destroy(){this.hide();this._closeListener=null;};Wirecloud.ui.WindowMenu=WindowMenu;})();(function(){"use strict";var AlertWindowMenu=function AlertWindowMenu(options){Wirecloud.ui.WindowMenu.call(this,gettext('Warning'),'wc-alert-dialog');this.msgElement=document.createElement('div');this.msgElement.className="msg";this.windowContent.appendChild(this.msgElement);options=Wirecloud.Utils.merge({acceptLabel:gettext('Yes'),cancelLabel:gettext('No')},options);this.acceptButton=new StyledElements.StyledButton({text:options.acceptLabel,'class':'btn-danger'});this._acceptListener=this._acceptListener.bind(this);this.acceptButton.addEventListener("click",this._acceptListener);this.acceptButton.insertInto(this.windowBottom);this.cancelButton=new StyledElements.StyledButton({text:options.cancelLabel,'class':'btn-primary'});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);this.acceptHandler=null;this.cancelHandler=null;};AlertWindowMenu.prototype=new Wirecloud.ui.WindowMenu();AlertWindowMenu.prototype.setMsg=function setMsg(msg){if(msg instanceof StyledElements.StyledElement){this.msgElement.innerHTML='';msg.insertInto(this.msgElement);}else{this.msgElement.textContent=msg;}
this.calculatePosition();};AlertWindowMenu.prototype.setHTMLMsg=function setHTMLMsg(msg){this.msgElement.innerHTML=msg;if(Wirecloud.Utils.XML.isElement(this.htmlElement.parentNode)){this.calculatePosition();}};AlertWindowMenu.prototype._acceptListener=function _acceptListener(e){this.acceptHandler();this.hide();};AlertWindowMenu.prototype._closeListener=function _closeListener(e){Wirecloud.ui.WindowMenu.prototype._closeListener.call(this,e);if(this.cancelHandler){this.cancelHandler();}};AlertWindowMenu.prototype.setHandler=function setHandler(acceptHandler,cancelHandler){this.acceptHandler=acceptHandler;this.cancelHandler=cancelHandler;};AlertWindowMenu.prototype.setFocus=function setFocus(){this.cancelButton.focus();};Wirecloud.ui.AlertWindowMenu=AlertWindowMenu;})();(function(){"use strict";var detect_close_finish,open_external_window;detect_close_finish=function detect_close(){if(this.external_window.closed){this.external_window=null;clearInterval(this.interval);this.interval=null;this.start_button.enable();this.start_button.focus();}else if('href'in this.external_window.location&&this.options.return_uri(this.external_window.location.href)){if(typeof this.options.onSuccess==='function'){try{this.options.onSuccess(this.external_window.location.href);}catch(e){}}
this.hide();}};open_external_window=function open_external_window(url){this.external_window=window.open(url,'_blank');this.interval=setInterval(detect_close_finish.bind(this),200);};var ExternalProcessWindowMenu=function ExternalProcessWindowMenu(title,url,msg,options){Wirecloud.ui.WindowMenu.call(this,title);if(options!=null){this.options=options;}else{this.options={};}
this.url=url;this.msgElement=document.createElement('div');this.msgElement.className="msg";this.msgElement.textContent=msg;this.windowContent.appendChild(this.msgElement);if(this.options.return_uri==null){this.options.return_uri=function return_uri(uri){return uri!=='about:blank';};}else if(typeof this.options.return_uri!=='function'){var base_uri=this.options.return_uri;this.options.return_uri=function return_uri(uri){return Wirecloud.Utils.startsWith(uri,base_uri);};}
this.start_button=new StyledElements.StyledButton({text:gettext('Start'),'class':'btn-primary'});this.start_button.insertInto(this.windowBottom);this.start_button.addEventListener("click",function(){this.start_button.disable();this.cancel_button.focus();open_external_window.call(this,this.url);}.bind(this));this.cancel_button=new StyledElements.StyledButton({text:gettext('Cancel'),'class':'btn-danger'});this.cancel_button.insertInto(this.windowBottom);this.cancel_button.addEventListener("click",this._closeListener);};ExternalProcessWindowMenu.prototype=new Wirecloud.ui.WindowMenu();ExternalProcessWindowMenu.prototype.setFocus=function setFocus(){this.start_button.focus();};ExternalProcessWindowMenu.prototype._closeListener=function _closeListener(){if(typeof this.options.onCancel==='function'){try{this.options.onCancel();}catch(e){}}
Wirecloud.ui.WindowMenu.prototype._closeListener.call(this);};ExternalProcessWindowMenu.prototype.hide=function hide(){Wirecloud.ui.WindowMenu.prototype.hide.call(this);if(this.external_window){this.external_window.close();this.external_window=null;}
if(this.interval){clearInterval(this.interval);this.interval=null;}};ExternalProcessWindowMenu.prototype.show=function show(parentWindow){Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};Wirecloud.ui.ExternalProcessWindowMenu=ExternalProcessWindowMenu;})();(function(){"use strict";var HTMLWindowMenu=function HTMLWindowMenu(url,title,extra_class,options){if(arguments.length===0){return;}
this.url=url;if(extra_class!=null){extra_class='wc-html-window-menu '+extra_class;}else{extra_class='wc-html-window-menu';}
Wirecloud.ui.WindowMenu.call(this,title,extra_class);this.button=new StyledElements.StyledButton({text:gettext('Close'),'class':'btn-primary'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);};HTMLWindowMenu.prototype=new Wirecloud.ui.WindowMenu();HTMLWindowMenu.prototype.show=function show(){this.windowContent.innerHTML='';this.windowContent.classList.add('disabled');Wirecloud.ui.WindowMenu.prototype.show.apply(this,arguments);Wirecloud.io.makeRequest(this.url,{method:'GET',onSuccess:function(response){this.windowContent.innerHTML=response.responseText;this.calculatePosition();}.bind(this),onFailure:function(response){this.windowContent.innerHTML='<div class="alert alert-danger">Error processing resource documentation</div>';},onComplete:function(){this.windowContent.classList.remove('disabled');}.bind(this)});};Wirecloud.ui.HTMLWindowMenu=HTMLWindowMenu;})();(function(){"use strict";var PreferencesWindowMenu=function PreferencesWindowMenu(css_class){Wirecloud.ui.WindowMenu.call(this,gettext('Widget Settings'),css_class);};PreferencesWindowMenu.prototype=new Wirecloud.ui.WindowMenu();PreferencesWindowMenu.prototype._savePrefs=function _savePrefs(form,new_values){var oldValue,newValue,varName,details;for(varName in new_values){oldValue=this._current_iwidget.preferences[varName].value;newValue=new_values[varName];if(newValue!==oldValue){this._current_iwidget.preferences[varName].value=newValue;}else{delete new_values[varName];}}
this.hide();Wirecloud.io.makeRequest(Wirecloud.URLs.IWIDGET_PREFERENCES.evaluate({workspace_id:this._current_iwidget.workspace.id,tab_id:this._current_iwidget.tab.id,iwidget_id:this._current_iwidget.id}),{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(new_values)});if(typeof this._current_iwidget.prefCallback==='function'){try{this._current_iwidget.prefCallback(new_values);}catch(error){details=this._current_iwidget.logManager.formatException(error);this._current_iwidget.logManager.log(gettext('Exception catched while processing preference changes'),{details:details});}}};PreferencesWindowMenu.prototype.show=function show(iwidget,parentWindow){var i,prefs,pref,fields;fields={};prefs=iwidget.preferenceList;for(i=0;i<prefs.length;i++){pref=prefs[i];if(!pref.hidden){fields[pref.meta.name]=pref.getInterfaceDescription();}}
this._current_iwidget=iwidget;this._current_form=new Form(fields,{setdefaultsButton:true,buttonArea:this.windowBottom});this._current_form.insertInto(this.windowContent);this._current_form.addEventListener('submit',this._savePrefs.bind(this));this._current_form.addEventListener('cancel',this.hide.bind(this));Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};Wirecloud.Widget.PreferencesWindowMenu=PreferencesWindowMenu;})();(function(){"use strict";var onContinue=function onContinue(next){};var MissingDependenciesWindowMenu=function MissingDependenciesWindowMenu(next,details){var list,i,item;Wirecloud.ui.WindowMenu.call(this,gettext('Missing dependencies'),'missing_dependencies');this.msg1Element=document.createElement('p');this.windowContent.appendChild(this.msg1Element);this.msg1Element.textContent=gettext('The following dependencies are missing:');list=document.createElement('ul');for(i=0;i<details.missingDependencies.length;i++){item=document.createElement('li');item.textContent=details.missingDependencies[i];list.appendChild(item);}
this.windowContent.appendChild(list);this.msg2Element=document.createElement('p');this.windowContent.appendChild(this.msg2Element);this.msg2Element.textContent=gettext('You will be able to continue after installing all the required dependencies.');this.continueButton=new StyledElements.StyledButton({text:gettext('Continue'),});this.continueButton.addEventListener("click",onContinue.bind(this,next));this.continueButton.insertInto(this.windowBottom);this.continueButton.disable();this.cancelButton=new StyledElements.StyledButton({'class':'btn-primary',text:gettext('Cancel')});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);};MissingDependenciesWindowMenu.prototype=new Wirecloud.ui.WindowMenu();MissingDependenciesWindowMenu.prototype.setFocus=function setFocus(){this.continueButton.focus();};MissingDependenciesWindowMenu.prototype.destroy=function destroy(){this.hide();this.continueButton.destroy();this.cancelButton.destroy();};Wirecloud.ui.MissingDependenciesWindowMenu=MissingDependenciesWindowMenu;})();(function(){"use strict";var FormWindowMenu=function FormWindowMenu(fields,title,extra_class,options){if(arguments.length===0){return;}
Wirecloud.ui.WindowMenu.call(this,title,extra_class);options=Wirecloud.Utils.merge({factory:Wirecloud.ui.InputInterfaceFactory,autoHide:true},options);options.buttonArea=this.windowBottom;this.form=new Form(fields,options);this.form.insertInto(this.windowContent);this.form.addEventListener('submit',function(form,data){this.form.acceptButton.disable();this.form.cancelButton.disable();try{this.executeOperation(data);}catch(e){}
if(options.autoHide===true){this.hide();}}.bind(this));this.form.addEventListener('cancel',this._closeListener);};FormWindowMenu.prototype=new Wirecloud.ui.WindowMenu();FormWindowMenu.prototype.setValue=function setValue(newValue){this.form.setData(newValue);};FormWindowMenu.prototype.show=function show(parentWindow){this.form.reset();this.form.acceptButton.enable();this.form.cancelButton.enable();Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);this.form.repaint();};Wirecloud.ui.FormWindowMenu=FormWindowMenu;})();(function(){"use strict";var LEVEL_CLASS=['alert-error','alert-warning','alert-info'];var onfade=function onfade(){this.fadeTimeout=null;for(var i=0;i<this.windowContent.childNodes.length;i++){var classList=this.windowContent.childNodes[i].classList;if(classList.contains('in')){break;}
classList.add('in');}};var print_entry=function print_entry(entry){var entry_element,dateElement,expander;entry_element=document.createElement('div');entry_element.className='fade alert '+LEVEL_CLASS[entry.level-1];dateElement=document.createElement('strong');dateElement.textContent=entry.date.strftime('%x %X');entry_element.appendChild(dateElement);entry_element.appendChild(document.createTextNode(entry.msg));if(entry.details!=null){expander=new StyledElements.Expander({title:gettext('Details')});expander.insertInto(entry_element);if(typeof entry.details==='string'){expander.appendChild(new StyledElements.Fragment(entry.details));}else{expander.appendChild(entry.details);}}
this.windowContent.insertBefore(entry_element,this.windowContent.firstChild);if(this.fadeTimeout!=null){clearTimeout(this.fadeTimeout);}
this.fadeTimeout=setTimeout(this._onfade,200);};var onnewentry=function _onnewentry(logManager,entry){print_entry.call(this,entry);};var LogWindowMenu=function LogWindowMenu(logManager){Wirecloud.ui.WindowMenu.call(this,logManager.buildTitle(),'logwindowmenu');Object.defineProperty(this,'logManager',{value:logManager});this._onfade=onfade.bind(this);this._onnewentry=onnewentry.bind(this);this.button=new StyledElements.StyledButton({text:gettext('Close'),'class':'btn-primary'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);};LogWindowMenu.prototype=new Wirecloud.ui.WindowMenu();LogWindowMenu.prototype.show=function show(parentWindow){var i;for(i=0;i<this.logManager.entries.length;i++){print_entry.call(this,this.logManager.entries[i]);}
this.logManager.addEventListener('newentry',this._onnewentry);Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};LogWindowMenu.prototype.hide=function hide(parentWindow){this.windowContent.innerHTML='';this.logManager.removeEventListener('newentry',this._onnewentry);Wirecloud.ui.WindowMenu.prototype.hide.call(this,parentWindow);};LogWindowMenu.prototype.setFocus=function setFocus(){this.button.focus();};Wirecloud.ui.LogWindowMenu=LogWindowMenu;})();(function(){"use strict";var EmbedCodeWindowMenu=function EmbedCodeWindowMenu(title,msg){Wirecloud.ui.WindowMenu.call(this,title,'embed-code-window-menu');this.code=new StyledElements.StyledTextArea();this.code.insertInto(this.windowContent);this.button=new StyledElements.StyledButton({text:gettext('Accept'),'class':'btn-primary'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);this.setMsg(msg);};EmbedCodeWindowMenu.prototype=new Wirecloud.ui.WindowMenu();EmbedCodeWindowMenu.prototype.setMsg=function setMsg(msg){this.code.setValue(msg);this.calculatePosition();};EmbedCodeWindowMenu.prototype.setFocus=function setFocus(){this.code.select();};Wirecloud.ui.EmbedCodeWindowMenu=EmbedCodeWindowMenu;})();(function(){"use strict";var MACSelectionWindowMenu=function MACSelectionWindowMenu(title,options){Wirecloud.ui.WindowMenu.call(this,title,'mac_selection_dialog');Object.defineProperty(this,'events',{value:{'select':new StyledElements.Event()}});Object.freeze(this.events);this.macsearch=new Wirecloud.ui.MACSearch({scope:options.scope,resourceButtonIconClass:'icon-ok',resourceButtonTooltip:gettext('Select'),resourceButtonListener:function(resource){this._closeListener();this.events.select.dispatch(resource);}.bind(this)});this.macsearch.insertInto(this.windowContent);this.button=new StyledElements.StyledButton({text:gettext('Close'),'class':'btn-primary'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);};MACSelectionWindowMenu.prototype=new Wirecloud.ui.WindowMenu();MACSelectionWindowMenu.prototype.addEventListener=StyledElements.ObjectWithEvents.prototype.addEventListener;MACSelectionWindowMenu.prototype.removeEventListener=StyledElements.ObjectWithEvents.prototype.removeEventListener;MACSelectionWindowMenu.prototype.setFocus=function setFocus(){this.macsearch.focus();};Wirecloud.ui.MACSelectionWindowMenu=MACSelectionWindowMenu;})();(function(){"use strict";var titles=['',gettext('Error'),gettext('Warning'),gettext('Info')];var MessageWindowMenu=function MessageWindowMenu(message,type){Wirecloud.ui.WindowMenu.call(this,'','message');this.msgElement=document.createElement('div');this.msgElement.className="msg";this.windowContent.appendChild(this.msgElement);this.button=new StyledElements.StyledButton({text:gettext('Accept'),'class':'btn-primary'});this.button.insertInto(this.windowBottom);this.button.addEventListener("click",this._closeListener);this.setMsg(message);this.setType(type);};MessageWindowMenu.prototype=new Wirecloud.ui.WindowMenu();MessageWindowMenu.prototype.setMsg=function setMsg(msg){if(msg instanceof StyledElements.StyledElement){this.msgElement.innerHTML='';msg.insertInto(this.msgElement);}else{this.msgElement.textContent=msg;}
this.calculatePosition();};MessageWindowMenu.prototype.setFocus=function setFocus(){this.button.focus();};MessageWindowMenu.prototype.setType=function setType(type){this.setTitle(titles[type]);};Wirecloud.ui.MessageWindowMenu=MessageWindowMenu;})();(function(){"use strict";var retry=function retry(data){Wirecloud.createWorkspace({name:data.name,mashup:data.mashup,onSuccess:function(workspace){Wirecloud.changeActiveWorkspace(workspace);},onFailure:function(msg,details){var dialog=new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG);dialog.show();}});};var NewWorkspaceWindowMenu=function NewWorkspaceWindowMenu(){var fields={'name':{label:gettext('Name'),type:'text'},'mashup':{label:gettext('Template'),type:'mac',scope:'mashup',dialog_title:gettext('Select a mashup template'),required:false,parent_dialog:this}};Wirecloud.ui.FormWindowMenu.call(this,fields,gettext('Create Workspace'),'new_workspace');};NewWorkspaceWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();NewWorkspaceWindowMenu.prototype.setFocus=function setFocus(){this.form.fieldInterfaces.name.focus();};NewWorkspaceWindowMenu.prototype.executeOperation=function executeOperation(data){Wirecloud.createWorkspace({name:data.name,mashup:data.mashup,onSuccess:function(workspace){Wirecloud.changeActiveWorkspace(workspace);},onFailure:function(msg,details){var dialog;if(details!=null&&'missingDependencies'in details){dialog=new Wirecloud.ui.MissingDependenciesWindowMenu(retry.bind(null,data),details);}else{dialog=new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG);}
dialog.show();}});};Wirecloud.ui.NewWorkspaceWindowMenu=NewWorkspaceWindowMenu;})();(function(){"use strict";var ParametrizeWindowMenu=function ParametrizeWindowMenu(inputInterface){var fields,sourceOptions,statusOptions;statusOptions=[{label:gettext('Normal'),value:'normal'},{label:gettext('Read Only'),value:'readonly'}];if(inputInterface.canBeHidden){statusOptions.push({label:gettext('Hidden'),value:'hidden'});}
sourceOptions=[{label:gettext('Current value'),value:'current'},{label:gettext('Default value'),value:'default'},{label:gettext('Parametrized value'),value:'custom'}];fields={'status':{label:gettext('Status'),type:'select',initialEntries:statusOptions,required:true},'source':{label:gettext('Value source'),type:'select',initialEntries:sourceOptions,required:true},'separator':{type:'separator'},'value':{label:gettext('Value'),type:'parametrizedText',variable:inputInterface.variable}};Wirecloud.ui.FormWindowMenu.call(this,fields,gettext('Parametrization'),'variable_parametrization');this.inputInterface=inputInterface;var valueInput=this.form.fieldInterfaces.value;var sourceInput=this.form.fieldInterfaces.source.inputElement;var updateFunc=function(){this.valueInput.setDisabled(this.sourceInput.getValue()!=='custom');}.bind({valueInput:valueInput,sourceInput:sourceInput});valueInput.update=updateFunc;sourceInput.inputElement.addEventListener('change',updateFunc);};ParametrizeWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();ParametrizeWindowMenu.prototype.setFocus=function setFocus(){this.form.fieldInterfaces.status.focus();};ParametrizeWindowMenu.prototype.executeOperation=function executeOperation(newValue){this.inputInterface.setValue(newValue);};Wirecloud.ui.ParametrizeWindowMenu=ParametrizeWindowMenu;})();(function(){"use strict";var build_pref_label=function build_pref_label(preference){var label=document.createElement("label");label.appendChild(document.createTextNode(preference.label));label.setAttribute("title",gettext(preference.description));return label;};var build_inherit_input=function build_inherit_input(preference){return Wirecloud.ui.InputInterfaceFactory.createInterface('inherit-'+preference.name,{'type':'boolean'});};var build_pref_input=function build_pref_input(preference){return Wirecloud.ui.InputInterfaceFactory.createInterface(preference.name,preference.options);};var build_form=function build_form(){var table=document.createElement('table');table.classList.add('styled_form');table.setAttribute('cellspacing','0');table.setAttribute('cellpadding','0');var tbody=document.createElement('tbody');table.appendChild(tbody);Object.defineProperty(this,'interfaces',{value:{}});for(var key in this.manager.meta.preferences){var preference=this.manager.meta.preferences[key];if(preference.hidden){continue;}
var input_interface=build_pref_input(preference);this.interfaces[preference.name]={'base':input_interface};if(!preference.inheritable){var row=tbody.insertRow(-1);var columnLabel=row.insertCell(-1);columnLabel.className="label-cell";var columnValue=row.insertCell(-1);columnLabel.appendChild(build_pref_label(preference));input_interface.insertInto(columnValue);}else{var complexRow=tbody.insertRow(-1);var complexCell=complexRow.insertCell(-1);complexCell.style.padding="0";complexCell.colSpan="2";var complexTable=document.createElement('table');complexTable.classList.add('complexTable');complexTable.setAttribute('cellspacing','0');complexTable.setAttribute('cellpadding','0');complexCell.appendChild(complexTable);var complexTBody=document.createElement('tbody');complexTable.appendChild(complexTBody);var labelRow=complexTBody.insertRow(-1);var columnLabel=labelRow.insertCell(-1);columnLabel.className="label-cell";columnLabel.colSpan="2";var prefRow=complexTBody.insertRow(-1);var inheritCell=prefRow.insertCell(-1);inheritCell.classList.add('inheritCell');var inheritInput=build_inherit_input(preference);this.interfaces[preference.name].inherit=inheritInput;inheritInput.insertInto(inheritCell);inheritCell.appendChild(document.createTextNode(gettext('Inherit')));inheritInput.inputElement.addEventListener('change',function(){this.input_interface.setDisabled(this.inherit_interface.getValue());}.bind({input_interface:input_interface,inherit_interface:inheritInput}));var columnValue=prefRow.insertCell(-1);columnLabel.appendChild(build_pref_label(preference));input_interface.insertInto(columnValue);}}
this.windowContent.insertBefore(table,this.msgElement);};var save_preferences=function save_preferences(){var modifiedValues={};var newInheritanceSetting;for(var pref_name in this.manager.preferences){var preference=this.manager.preferences[pref_name];var inputs=this.interfaces[pref_name];var inheritSettingChange=false;if('inherit'in inputs){newInheritanceSetting=inputs.inherit.getValue();inheritSettingChange=newInheritanceSetting!=preference.inherit;}
var newValue=inputs.base.getValue();var valueChange=preference.value!=newValue;if(!inheritSettingChange&&!valueChange){continue;}
var changes={};if(inheritSettingChange){changes.inherit=newInheritanceSetting;}
if(newInheritanceSetting===false||valueChange){changes.value=newValue;}
modifiedValues[pref_name]=changes;}
this.manager.set(modifiedValues);};var _executeOperation=function _executeOperation(){var validationManager=new ValidationErrorManager();for(var pref_name in this.manager.preferences){validationManager.validate(this.interfaces[pref_name].base);}
var errorMsg=validationManager.toHTML();if(errorMsg.length!==0){this.setMsg(errorMsg[0]);}else{save_preferences.call(this);this.hide();}};var PreferencesWindowMenu=function PreferencesWindowMenu(scope,manager){Wirecloud.ui.WindowMenu.call(this,'',scope+'_preferences');Object.defineProperty(this,'manager',{value:manager});this.resetButton=new StyledElements.StyledButton({text:gettext('Set Defaults'),});this.resetButton.addEventListener("click",function(){var pref_name,preference;for(pref_name in this.manager.preferences){preference=this.manager.preferences[pref_name].meta;this.interfaces[pref_name].base.setValue(preference['default']);if('inherit'in this.interfaces[pref_name]){this.interfaces[pref_name].inherit.setValue(preference.inheritByDefault);this.interfaces[pref_name].base.setDisabled(preference.inheritByDefault);}}}.bind(this));this.resetButton.insertInto(this.windowBottom);this.acceptButton=new StyledElements.StyledButton({text:gettext('Save'),'class':'btn-primary'});this.acceptButton.addEventListener("click",_executeOperation.bind(this));this.acceptButton.insertInto(this.windowBottom);this.cancelButton=new StyledElements.StyledButton({text:gettext('Cancel')});this.cancelButton.addEventListener("click",this._closeListener);this.cancelButton.insertInto(this.windowBottom);};PreferencesWindowMenu.prototype=new Wirecloud.ui.WindowMenu();PreferencesWindowMenu.prototype.setCancelable=function setCancelable(cancelable){this.cancelButton.setDisabled(!cancelable);};PreferencesWindowMenu.prototype.show=function show(parentWindow){var pref_name;this.setTitle(this.manager.buildTitle());if(!('interfaces'in this)){build_form.call(this);}
for(pref_name in this.manager.preferences){this.interfaces[pref_name].base.setValue(this.manager.preferences[pref_name].value);if('inherit'in this.interfaces[pref_name]){this.interfaces[pref_name].inherit.setValue(this.manager.preferences[pref_name].inherit);this.interfaces[pref_name].base.setDisabled(this.manager.preferences[pref_name].inherit);}}
Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);for(pref_name in this.manager.preferences){this.interfaces[pref_name].base.repaint();}};PreferencesWindowMenu.prototype.destroy=function destroy(){this.acceptButton.destroy();this.cancelButton.destroy();Wirecloud.ui.WindowMenu.prototype.destroy.call(this);};Wirecloud.ui.PreferencesWindowMenu=PreferencesWindowMenu;})();(function(){"use strict";var OperatorPreferencesWindowMenu=function OperatorPreferencesWindowMenu(css_class){Wirecloud.ui.WindowMenu.call(this,gettext('Operator Settings'),css_class);};OperatorPreferencesWindowMenu.prototype=new Wirecloud.ui.WindowMenu();OperatorPreferencesWindowMenu.prototype._savePrefs=function _savePrefs(form,new_values){var key,details;for(key in new_values){if(this._current_ioperator.preferences[key].value!==new_values[key]){this._current_ioperator.preferences[key].value=new_values[key];}else{delete new_values[key];}}
if(typeof this._current_ioperator.prefCallback==='function'){try{this._current_ioperator.prefCallback(new_values);}catch(error){details=this._current_ioperator.logManager.formatException(error);this._current_ioperator.logManager.log(gettext('Exception catched while processing preference changes'),{details:details});}}
this.hide();};OperatorPreferencesWindowMenu.prototype.show=function show(ioperator,parentWindow){var i,prefs,pref,fields;fields={};prefs=ioperator.preferenceList;for(i=0;i<prefs.length;i++){pref=prefs[i];if(!pref.hidden){fields[pref.meta.name]=pref.getInterfaceDescription();}}
this._current_ioperator=ioperator;this._current_form=new Form(fields,{setdefaultsButton:true,buttonArea:this.windowBottom});this._current_form.insertInto(this.windowContent);this._current_form.addEventListener('submit',this._savePrefs.bind(this));this._current_form.addEventListener('cancel',this.hide.bind(this));Wirecloud.ui.WindowMenu.prototype.show.call(this,parentWindow);};Wirecloud.ui.OperatorPreferencesWindowMenu=OperatorPreferencesWindowMenu;})();(function(){"use strict";var PublishWorkspaceWindowMenu=function PublishWorkspaceWindowMenu(workspace){var fields,user_name,marketFields;user_name=Wirecloud.contextManager.get('username');fields=[{'type':'group','shortTitle':gettext('General info'),'fields':[{name:'name',label:gettext('Mashup Name'),type:'text',required:true,initialValue:workspace.getName(),defaultValue:workspace.getName()},{name:'vendor',label:gettext('Vendor'),type:'text',required:true},{name:'version',label:gettext('Version'),type:'version',required:true},{name:'email',label:gettext('Email'),type:'text',required:true},{name:'description',label:gettext('Description'),type:'longtext'},{name:'doc',label:gettext('Homepage'),type:'text'},{name:'authors',label:gettext('Author'),type:'text',initialValue:user_name,defaultValue:user_name}]},{'type':'group','shortTitle':gettext('Media'),'fields':[{name:'image',label:gettext('Image shown in catalogue (170x80 px)'),type:'file'}]},{'type':'group','shortTitle':gettext('Advanced'),'fields':[{name:'readOnlyWidgets',label:gettext('Block widgets'),type:'boolean'},{name:'readOnlyConnectables',label:gettext('Block connections'),type:'boolean'},{name:'embedmacs',label:gettext('Embed used widgets/operators'),type:'boolean'}]}];Wirecloud.ui.FormWindowMenu.call(this,fields,gettext('Upload workspace to local catalogue'),'publish_workspace',{autoHide:false});var warning=document.createElement('div');warning.className='alert';warning.innerHTML=gettext("<strong>Warning!</strong> Configured and stored data in your workspace (properties and preferences except passwords) will be shared by default!");this.windowContent.insertBefore(warning,this.form.wrapperElement);};PublishWorkspaceWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();PublishWorkspaceWindowMenu.prototype._addVariableParametrization=function _addVariableParametrization(workspace,fields){var key,tab_field;this.workspace=workspace;for(key in workspace.tabInstances){tab_field=this._parseTab(workspace.tabInstances[key]);if(tab_field!==null){fields.push(tab_field);}}};PublishWorkspaceWindowMenu.prototype._parseTab=function _parseTab(tab){var i,j,iwidget,iwidgets,iwidget_params,pref_params,prop_params,var_elements,fields;iwidgets=tab.getDragboard().getIWidgets();fields=[];for(i=0;i<iwidgets.length;i++){iwidget=iwidgets[i].internal_iwidget;pref_params=[];for(j=0;j<iwidget.preferenceList.length;j+=1){pref_params.push({label:iwidget.preferenceList[j].label,type:'parametrizableValue',variable:iwidget.preferenceList[j],canBeHidden:true,parentWindow:this});}
prop_params=[];for(j=0;j<iwidget.propertyList.length;j+=1){prop_params.push({label:iwidget.preferenceList[i].label,type:'parametrizableValue',variable:iwidget.propertyList[j],parentWindow:this});}
var_elements={};if(pref_params.length!==0){var_elements.pref={label:gettext('Preferences'),type:'fieldset',fields:pref_params};}
if(prop_params.length!==0){var_elements.props={label:gettext('Properties'),type:'fieldset',fields:prop_params.sort(this._sortVariables)};}
if(pref_params.length+prop_params.length!==0){fields.push({name:iwidget.id,label:iwidget.name,type:'fieldset',nested:true,fields:var_elements});}}
if(fields.length>0){return{'shortTitle':tab.tabInfo.name,'fields':fields,'nested':true,'name':'tab-'+tab.tabInfo.name};}else{return null;}};PublishWorkspaceWindowMenu.prototype._sortVariables=function _sortVariables(var1,var2){return var1.variable.vardef.order-var2.variable.vardef.order;};PublishWorkspaceWindowMenu.prototype.setFocus=function setFocus(){this.form.fieldInterfaces.name.focus();};PublishWorkspaceWindowMenu.prototype.executeOperation=function executeOperation(data){var key;data.parametrization={iwidgets:{},ioperators:{}};for(key in data){if(Wirecloud.Utils.startsWith(key,'tab-')){Wirecloud.Utils.merge(data.parametrization.iwidgets,data[key]);delete data[key];}}
Wirecloud.activeWorkspace.publish(data,{onFailure:function(msg){this.form.pSetMsgs([msg]);}.bind(this),onSuccess:function(){this.hide();}.bind(this),onComplete:function(){this.form.acceptButton.enable();this.form.cancelButton.enable();}.bind(this)});};Wirecloud.ui.PublishWorkspaceWindowMenu=PublishWorkspaceWindowMenu;})();(function(){"use strict";var PublishResourceWindowMenu=function PublishResourceWindowMenu(resource){this.resource=resource;var fields=this._loadAvailableMarkets();Wirecloud.ui.FormWindowMenu.call(this,fields,gettext('Upload resource'),'publish_resource',{legend:false});};PublishResourceWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();PublishResourceWindowMenu.prototype._loadAvailableMarkets=function _loadAvailableMarkets(){var views=LayoutManagerFactory.getInstance().viewsByName.marketplace.viewsByName;var key,endpoints,secondInput,buttons=[];for(key in views){endpoints=views[key].getPublishEndpoints();if(endpoints!=null&&endpoints.length>0){endpoints.forEach(function(endpoint){endpoint.value=key+'#'+endpoint.value;});secondInput=new StyledElements.StyledSelect({initialEntries:endpoints});}else{secondInput=null;}
buttons.push({'label':key,'value':key,'secondInput':secondInput});}
return[{'name':'marketplaces','type':'buttons','label':'Upload to','kind':'checkbox','buttons':buttons}];};PublishResourceWindowMenu.prototype.show=function show(parentWindow){Wirecloud.ui.FormWindowMenu.prototype.show.call(this,parentWindow);};PublishResourceWindowMenu.prototype.setFocus=function setFocus(){this.form.cancelButton.focus();};PublishResourceWindowMenu.prototype.executeOperation=function executeOperation(data){var url=Wirecloud.URLs.PUBLISH_ON_OTHER_MARKETPLACE;data.marketplaces=data.marketplaces.map(function(endpoint){var parts=endpoint.split('#',2);var result={'market':parts[0]};if(parts.length===2){result.store=parts[1];}
return result;});data.resource=this.resource.uri;var layoutManager;layoutManager=LayoutManagerFactory.getInstance();layoutManager._startComplexTask(gettext("Publishing resource"),3);layoutManager.logSubTask(gettext('Publishing resource'));Wirecloud.io.makeRequest(url,{method:'POST',contentType:'application/json',requestHeaders:{'Accept':'application/json'},postBody:JSON.stringify(data),onSuccess:function(){layoutManager.logSubTask(gettext('Resource published successfully'));layoutManager.getInstance().logStep('');},onFailure:function(response){var msg=Wirecloud.GlobalLogManager.formatAndLog(gettext("Error publishing resource: %(errorMsg)s."),response,null);var dialog=new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG);dialog.msgElement.textContent=msg;var response_data=JSON.parse(response.responseText);if('details'in response_data){var expander=new StyledElements.Expander({title:gettext('Details')});expander.insertInto(dialog.msgElement);for(var key in response_data.details){expander.appendChild(new StyledElements.Fragment('<p><b>'+key+'</b>'+response_data.details[key]+'</p>'));}}
dialog.show();},onComplete:function(){LayoutManagerFactory.getInstance()._notifyPlatformReady();}});};Wirecloud.ui.PublishResourceWindowMenu=PublishResourceWindowMenu;})();(function(){"use strict";var RenameWindowMenu=function RenameWindowMenu(what,rename_method){var fields={'name':{label:gettext('New Name'),type:'text',required:true,initialValue:what.getName()}};this.what=what;this.rename_method=rename_method;Wirecloud.ui.FormWindowMenu.call(this,fields,gettext('Rename Workspace'));};RenameWindowMenu.prototype=new Wirecloud.ui.FormWindowMenu();RenameWindowMenu.prototype.setFocus=function setFocus(){this.form.fieldInterfaces.name.focus();};RenameWindowMenu.prototype.executeOperation=function executeOperation(data){this.what[this.rename_method](data.name);};Wirecloud.ui.RenameWindowMenu=RenameWindowMenu;})();if(!Wirecloud.ui){Wirecloud.ui={};}
(function(){"use strict";var WiringEditor=function WiringEditor(id,options){if(id==null){return;}
options['class']='wiring_editor';StyledElements.Alternative.call(this,id,options);var events=['operatorremoved','widgetremoved','widgetadded','operatoradded','widgetaddfail','operatoraddfail'];for(var i=0;i<events.length;i++){this.events[events[i]]=new StyledElements.Event();}
this.addEventListener('show',renewInterface.bind(this));this.addEventListener('hide',clearInterface.bind(this));this.layout=new StyledElements.BorderLayout({class:'containerLayer'});this.appendChild(this.layout);this.layout.getWestContainer().addClassName('menubar');this.accordion=new StyledElements.Accordion();this.mini_widget_section=this.accordion.createContainer({title:'Widgets'});this.mini_operator_section=this.accordion.createContainer({title:'Operators'});this.layout.getWestContainer().appendChild(this.accordion);this.layout.getCenterContainer().addClassName('grid');this.layout.getCenterContainer().wrapperElement.addEventListener("scroll",this.scrollHandler.bind(this),false);this.entitiesNumber=0;this.emptyBox=document.createElement('div');this.emptyBox.classList.add('wiringEmptyBox');this.emptyBox.classList.add('alert');this.emptyBox.classList.add('alert-info');this.emptyBox.classList.add('alert-block');var pTitle=document.createElement('h4');pTitle.textContent=gettext("Welcome to the Wiring Editor view!");this.emptyBox.appendChild(pTitle);var message=document.createElement('p');message.innerHTML=gettext("Please drag some widgets and operators from the stencil on the left, and drop them into this area. <br/>Then, link outputs with inputs to wire the resources.");this.emptyBox.appendChild(message);this.layout.getCenterContainer().wrapperElement.appendChild(this.emptyBox);this.emptyBox.classList.add('hidden');this.canvas=new Wirecloud.ui.WiringEditor.Canvas();this.canvasElement=this.canvas.getHTMLElement();this.layout.getCenterContainer().appendChild(this.canvasElement);this.canvas.addEventListener('arrowadded',function(canvas,arrow){this.arrows.push(arrow);}.bind(this));this.canvas.addEventListener('arrowremoved',function(canvas,arrow){var pos;if(arrow.startMulti!=null){this.multiconnectors[arrow.startMulti].removeArrow(arrow);}
if(arrow.endMulti!=null){this.multiconnectors[arrow.endMulti].removeArrow(arrow);}
if(arrow.multiId!=null){this.removeMulticonnector(this.multiconnectors[arrow.multiId]);}
pos=this.arrows.indexOf(arrow);if(pos!=-1){this.arrows.splice(pos,1);}}.bind(this));this.canvas.addEventListener('unselectall',function(){this.ChangeObjectEditing(null);}.bind(this));this.enableAnchors=this.enableAnchors.bind(this);this.disableAnchors=this.disableAnchors.bind(this);this.arrowCreator=new Wirecloud.ui.WiringEditor.ArrowCreator(this.canvas,this,function(){},function(){},this.enableAnchors);this._startdrag_map_func=function(anchor){anchor.addEventListener('startdrag',this.disableAnchors);}.bind(this);this._keydownListener=keydownListener.bind(this);this._keyupListener=keyupListener.bind(this);this.addEventListener('operatorremoved',function(entity){this.removeIOperator(entity);}.bind(this));this.addEventListener('widgetremoved',function(entity){this.removeIWidget(entity);}.bind(this));};WiringEditor.prototype=new StyledElements.Alternative();WiringEditor.prototype.view_name='wiring';WiringEditor.prototype.buildStateData=function buildStateData(){var currentState,data;currentState=Wirecloud.HistoryManager.getCurrentState();data={workspace_creator:currentState.workspace_creator,workspace_name:currentState.workspace_name,view:'wiring'};return data;};WiringEditor.prototype.goUp=function goUp(){LayoutManagerFactory.getInstance().changeCurrentView('workspace');};var keydownListener=function keydownListener(event){if(event.keyCode==17){this.ctrlPushed=true;this.layout.getCenterContainer().addClassName('selecting');}};var keyupListener=function keyupListener(event){if(event.keyCode==17){this.ctrlPushed=false;this.layout.getCenterContainer().removeClassName('selecting');}};var findAnchor=function findAnchor(desc,workspace){var iwidget_interface,iwidget,endPointPos,entity;switch(desc.type){case'iwidget':if(this.iwidgets[desc.id]!=null){entity=this.iwidgets[desc.id];}else{iwidget=workspace.getIWidget(desc.id);if(iwidget!=null){endPointPos={'sources':[],'targets':[]};iwidget_interface=this.addIWidget(this,iwidget,endPointPos);iwidget_interface.setPosition({posX:0,posY:0});this.mini_widgets[iwidget.id].disable();entity=iwidget_interface;}else{throw new Error('Widget not found');}}
break;case'ioperator':if(this.currentlyInUseOperators[desc.id]!=null){entity=this.currentlyInUseOperators[desc.id];}else{throw new Error('Operator not found. Id: '+desc.id);}
break;}
return entity.getAnchor(desc.endpoint);};var normalizeWiringStatus=function normalizeWiringStatus(WiringStatus){var i;if(WiringStatus==null){WiringStatus={};}
if(!Array.isArray(WiringStatus.connections)){WiringStatus.connections=[];}
if(typeof WiringStatus.operators!=="object"){WiringStatus.operators={};}
if(!Array.isArray(WiringStatus.views)){WiringStatus.views=[{label:'default',iwidgets:{},operators:{},multiconnectors:{},connections:[]}];}
for(i=0;i<WiringStatus.views.length;i+=1){if(WiringStatus.views[i].widgets==null){WiringStatus.views[i].widgets={};}
if(WiringStatus.views[i].operators==null){WiringStatus.views[i].operators={};}
if(WiringStatus.views[i].multiconnectors==null){WiringStatus.views[i].multiconnectors={};}
if(!Array.isArray(WiringStatus.views[i].connections)){WiringStatus.views[i].connections=[];}}
return WiringStatus;};var generateMiniWidget=function generateMiniWidget(iwidget){var miniwidget_interface;try{miniwidget_interface=new Wirecloud.ui.WiringEditor.WidgetInterface(this,iwidget,this,true);this.mini_widgets[iwidget.id]=miniwidget_interface;this.mini_widget_section.appendChild(miniwidget_interface);}catch(e){throw new Error('WiringEditor error (critical). Creating MiniWidget: '+e.message);}};var generateMiniOperator=function generateMiniOperator(operator){var operator_interface,comp,versionInfo;try{versionInfo=this.operatorVersions[operator.vendor+'/'+operator.name];if(!versionInfo){operator_interface=new Wirecloud.ui.WiringEditor.OperatorInterface(this,operator,this,true);this.mini_operator_section.appendChild(operator_interface);this.operatorVersions[operator.vendor+'/'+operator.name]={'lastVersion':operator.version,'currentVersion':operator.version,'versions':[{'version':operator.version,'operatorInterface':operator_interface}],'miniOperator':operator_interface};}else{comp=versionInfo.lastVersion.compareTo(operator.version);if(comp<0){this.mini_operator_section.removeChild(versionInfo.miniOperator);operator_interface=new Wirecloud.ui.WiringEditor.OperatorInterface(this,operator,this,true);this.mini_operator_section.appendChild(operator_interface);this.operatorVersions[operator.vendor+'/'+operator.name].lastVersion=operator.version;this.operatorVersions[operator.vendor+'/'+operator.name].currentVersion=operator.version;this.operatorVersions[operator.vendor+'/'+operator.name].versions.push({'version':operator.version,'operatorInterface':operator_interface});this.operatorVersions[operator.vendor+'/'+operator.name].miniOperator=operator_interface;}else if(comp>0){operator_interface=new Wirecloud.ui.WiringEditor.OperatorInterface(this,operator,this,true);this.operatorVersions[operator.vendor+'/'+operator.name].versions.push({'version':operator.version,'operatorInterface':operator_interface});}else{return;}}}catch(e){throw new Error('WiringEditor error (critical). Creating MiniOperator: '+e.message);}};var generateWidget=function generateWidget(iwidget,widgetView){var widget_interface;try{widget_interface=this.addIWidget(this,iwidget,widgetView.endPointsInOuts);if('position'in widgetView){widget_interface.setPosition(widgetView.position);}}catch(e){throw new Error('WiringEditor error (critical). Creating Widget: '+e.message);;}};var generateGhostWidget=function generateGhostWidget(view,id){var ghostName,iwidget,widget_interface;try{if(view.iwidgets[id].name!=null){ghostName=view.iwidgets[id].name;}else{ghostName=gettext("unknown name");}
iwidget={'id':id,'name':ghostName,'ghost':true,'widget':{'id':view.iwidgets[id].name,'uri':view.iwidgets[id].name}};iwidget.meta=iwidget.widget;widget_interface=this.addIWidget(this,iwidget,view.iwidgets[id].endPointsInOuts);if('position'in view.iwidgets[id]){widget_interface.setPosition(view.iwidgets[id].position);}}catch(e){throw new Error('WiringEditor error (critical). Creating GhostWidget: [id: '+id+'; name: '+ghostName+'] '+e.message);}};var generateOperator=function generateOperator(id,operator,reallyInUseOperators,availableOperators){var operator_instance,op_id,i,endpoint_order,position,is_minimized,operator_interface;try{operator_instance=reallyInUseOperators[id];op_id=parseInt(operator_instance.id,10);if(this.nextOperatorId<=op_id){this.nextOperatorId=op_id+1;}
endpoint_order={'sources':[],'targets':[]};position=null;for(i=0;i<this.wiringStatus.views.length;i++){if(id in this.wiringStatus.views[i].operators){if('endPointsInOuts'in this.wiringStatus.views[i].operators[id]){endpoint_order=this.wiringStatus.views[i].operators[id].endPointsInOuts;}
is_minimized=true;if('minimized'in this.wiringStatus.views[i].operators[id]){is_minimized=this.wiringStatus.views[i].operators[id].minimized;}
position=this.wiringStatus.views[i].operators[id].position;break;}}
operator_interface=this.addIOperator(operator_instance,endpoint_order);if(position!=null){operator_interface.setPosition(position);}
if(is_minimized){operator_interface.minimize(true);}}catch(e){var errorMainmsg,detailmsg,msg;errorMainmsg='WiringEditor error (critical).'
detailmsg=' [id: '+id+'; name: '+operator_instance+';] ';if(operator_instance.ghost){msg=' Operator Not Found. GhostOperator creation Failed';throw new Error(errorMainmsg+msg+detailmsg+e.message);}else{msg=' Operator creation Failed';throw new new Error(errorMainmsg+msg+detailmsg+e.message);}}};var generateMulticonnector=function generateMulticonnector(multi){var anchor,multiInstance;try{if(this.nextMulticonnectorId<=multi.id){this.nextMulticonnectorId=parseInt(multi.id,10)+1;}
if(multi.objectType=='ioperator'){anchor=this.currentlyInUseOperators[multi.objectId].getAnchor(multi.sourceName);}else{anchor=this.iwidgets[multi.objectId].getAnchor(multi.sourceName);}
if(!anchor){return;}
multiInstance=new Wirecloud.ui.WiringEditor.Multiconnector(multi.id,multi.objectId,multi.sourceName,this.layout.getCenterContainer().wrapperElement,this,anchor,multi.pos,multi.height);multiInstance=this.addMulticonnector(multiInstance);multiInstance.addMainArrow(multi.pullerStart,multi.pullerEnd);}catch(e){throw new Error('WiringEditor error. Creating Multiconnector: [id: '+multi.id+'] '+e.message);}};var insertGhostEndpoint=function insertGhostEndpoint(connection,isSource){var entity,theEndpoint,anchor;if(isSource){theEndpoint=connection.source;}else{theEndpoint=connection.target;}
if(theEndpoint.type=='ioperator'){entity=this.currentlyInUseOperators[theEndpoint.id];}else{entity=this.iwidgets[theEndpoint.id];}
anchor=entity.addGhostEndpoint(theEndpoint,isSource);this.recommendations.add_anchor_to_recommendations(anchor);this._startdrag_map_func(anchor);};var loadWiring=function loadWiring(workspace,WiringStatus){var iwidgets,iwidget,reallyInUseOperators,connectionView,multiconnectors,key,operators,k,i,availableOperators;this.wiringStatus=normalizeWiringStatus(WiringStatus);this.targetsOn=true;this.sourcesOn=true;this.targetAnchorList=[];this.sourceAnchorList=[];this.arrows=[];this.iwidgets={};this.multiconnectors={};this.mini_widgets={};this.currentlyInUseOperators={};this.selectedOps={};this.selectedOps.length=0;this.selectedWids={};this.selectedWids.length=0;this.selectedMulti={};this.selectedMulti.length=0;this.selectedCount=0;this.menubarWidth=document.getElementsByClassName('menubar')[0].offsetWidth;this.headerHeight=document.getElementById('wirecloud_header').offsetHeight;this.ctrlPushed=false;this.nextOperatorId=0;this.nextMulticonnectorId=0;this.EditingObject=null;this.entitiesNumber=0;this.recommendationsActivated=false;this.recommendations=new Wirecloud.ui.RecommendationManager();this.operatorVersions={};this.gridFullHeight=parseFloat(this.layout.getCenterContainer().wrapperElement.style.height);this.gridFullWidth=parseFloat(this.layout.getCenterContainer().wrapperElement.style.width);this.fullHeaderHeight=LayoutManagerFactory.getInstance().mainLayout.getNorthContainer().wrapperElement.getBoundingClientRect().height;this.layout.getCenterContainer().wrapperElement.style.fontSize='1em';iwidgets=workspace.getIWidgets();availableOperators=Wirecloud.wiring.OperatorFactory.getAvailableOperators();for(i=0;i<iwidgets.length;i++){iwidget=iwidgets[i];generateMiniWidget.call(this,iwidget);for(k=0;k<this.wiringStatus.views.length;k++){if(iwidget.id in this.wiringStatus.views[k].iwidgets){this.mini_widgets[iwidget.id].disable();generateWidget.call(this,iwidget,this.wiringStatus.views[k].iwidgets[iwidget.id]);break;}}}
for(k=0;k<this.wiringStatus.views.length;k++){for(key in this.wiringStatus.views[k].iwidgets){if(!this.iwidgets[key]){generateGhostWidget.call(this,this.wiringStatus.views[k],key);}}}
for(key in availableOperators){generateMiniOperator.call(this,availableOperators[key]);}
reallyInUseOperators=workspace.wiring.ioperators;operators=this.wiringStatus.operators;for(key in operators){generateOperator.call(this,key,operators[key],reallyInUseOperators,availableOperators);}
multiconnectors=this.wiringStatus.views[0].multiconnectors;for(key in multiconnectors){generateMulticonnector.call(this,multiconnectors[key]);}
for(i=0;i<this.wiringStatus.connections.length;i+=1){connectionView={};for(k=0;k<this.wiringStatus.views.length;k++){if(i in this.wiringStatus.views[k].connections){connectionView=this.wiringStatus.views[k].connections[i];break;}}
this.generateConnection(workspace,this.wiringStatus.connections[i],connectionView);}
this.activateCtrlMultiSelect();this.valid=true;if(this.entitiesNumber===0){this.emptyBox.classList.remove('hidden');}
this.recommendations.init(iwidgets,availableOperators);this.removeClassName('disabled');};var renewInterface=function renewInterface(){var workspace,wiringStatus,layoutManager,msg,dialog;layoutManager=LayoutManagerFactory.getInstance();this.valid=false;try{workspace=Wirecloud.activeWorkspace;wiringStatus=workspace.wiring.status;loadWiring.call(this,workspace,wiringStatus);}catch(err){try{clearInterface.call(this);}catch(e1){msg=gettext('Unrecoverable error while loading wiring data into the wiring editor');(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();}
var yesHandler=function(){wiringStatus=Wirecloud.Utils.clone(wiringStatus);delete wiringStatus.views;try{loadWiring.call(this,workspace,wiringStatus);}catch(e2){setTimeout(function(){try{clearInterface.call(this);}catch(e1){msg=gettext('Fatal error loading wiring data');(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();}
var yesHandler2=function(){wiringStatus=null;try{loadWiring.call(this,workspace,wiringStatus);}catch(e4){try{clearInterface.call(this);}catch(e5){}
setTimeout(function(){msg=gettext('Fatal error loading wiring data');(new Wirecloud.ui.MessageWindowMenu(msg,Wirecloud.constants.LOGGING.ERROR_MSG)).show();},0);}}.bind(this);var noHandler2=function(){layoutManager.changeCurrentView('workspace');}.bind(this);var msg=gettext("Unrecoverable error while loading wiring data. Do you want to start with an empty wiring?");var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(yesHandler2,noHandler2);dialog.show();}.bind(this),0);}}.bind(this);var noHandler=function(){layoutManager.changeCurrentView('workspace');};var msg=new StyledElements.Fragment(gettext("<p>There was an error loading the wiring status. Do you want WireCloud to try to recover the state of your connections automatically?</p>"));var details=new StyledElements.Expander({title:gettext('Details')});msg.appendChild(details);details.appendChild(document.createTextNode(err.message));var dialog=new Wirecloud.ui.AlertWindowMenu();dialog.setMsg(msg);dialog.setHandler(yesHandler,noHandler);dialog.show();}};var clearInterface=function clearInterface(){var key,workspace;this.addClassName('disabled');workspace=Wirecloud.activeWorkspace;if(this.valid){workspace.wiring.load(this.serialize());workspace.wiring.save();}
for(key in this.iwidgets){this.layout.getCenterContainer().removeChild(this.iwidgets[key]);this.iwidgets[key].destroy();}
for(key in this.currentlyInUseOperators){this.layout.getCenterContainer().removeChild(this.currentlyInUseOperators[key]);this.currentlyInUseOperators[key].destroy();}
for(key in this.multiconnectors){this.layout.getCenterContainer().removeChild(this.multiconnectors[key]);this.multiconnectors[key].destroy();}
this.deactivateCtrlMultiSelect();this.canvas.clear();this.mini_widget_section.clear();this.mini_operator_section.clear();this.arrows=[];this.mini_widgets={};this.iwidgets={};this.currentlyInUseOperators={};this.multiconnectors={};this.recommendations.destroy();};var setEntityMaxWidth=function setEntityMaxWidth(theInterface){var auxDiv,titleSpan,virginDimensions;var currentSize=parseFloat(this.layout.getCenterContainer().wrapperElement.style.fontSize);var defaultMaxWidgetWidth=22*currentSize;auxDiv=document.createElement('div');theInterface.insertInto(auxDiv);auxDiv.classList.add('calculateEntitySizeDiv');titleSpan=theInterface.wrapperElement.getElementsByClassName('header')[0].getElementsByTagName('span')[0];auxDiv.style.width='10000px';auxDiv.style.height='10000px';this.layout.getCenterContainer().appendChild(auxDiv);theInterface.wrapperElement.style.maxWidth='';theInterface.wrapperElement.style.minWidth='';resetMaxWidth(theInterface);virginDimensions=theInterface.getBoundingClientRect();theInterface.wrapperElement.style.maxWidth=defaultMaxWidgetWidth+'em';if(theInterface.getBoundingClientRect().height!=virginDimensions.height){setSourceTargetMaxWidths.call(this,theInterface,defaultMaxWidgetWidth)}
theInterface.wrapperElement.style.minWidth='';if(titleSpan.offsetWidth<titleSpan.scrollWidth){titleSpan.style.textAlign='left'}else{titleSpan.style.textAlign='center'}
this.layout.getCenterContainer().removeChild(auxDiv);};var setSourceTargetMaxWidths=function setSourceTargetMaxWidths(theInterface,maxWidth){var sources,targets,sourcesVirginDims,targetsVirginDims,currentFontSize;currentFontSize=parseFloat(this.layout.getCenterContainer().wrapperElement.style.fontSize)*parseInt(getComputedStyle(this.wrapperElement).fontSize);sources=theInterface.wrapperElement.getElementsByClassName('sources')[0];sourcesVirginDims=sources.getBoundingClientRect();targets=theInterface.wrapperElement.getElementsByClassName('targets')[0];targetsVirginDims=targets.getBoundingClientRect();if((sourcesVirginDims.width/currentFontSize>maxWidth/2)&&(targetsVirginDims.width/currentFontSize>maxWidth/2)){setMaxWidth.call(this,sources,maxWidth/2,currentFontSize);setMaxWidth.call(this,targets,maxWidth/2,currentFontSize);}else if(sourcesVirginDims.width/currentFontSize<=maxWidth/2){setMaxWidth.call(this,targets,maxWidth-(sourcesVirginDims.width/currentFontSize),currentFontSize);}else if(targetsVirginDims.width/currentFontSize<=maxWidth/2){setMaxWidth.call(this,sources,maxWidth-(targetsVirginDims.width/currentFontSize),currentFontSize);}};var setMaxWidth=function setMaxWidth(theDiv,width,currentFontSize){var theSpans,i,balancedWidth,acumulatedPaddings,theDivComputed,theSpanParentComputed;theSpans=theDiv.getElementsByTagName('span');theDivComputed=getComputedStyle(theDiv);theSpanParentComputed=getComputedStyle(theSpans[0].parentElement);acumulatedPaddings=0;acumulatedPaddings+=(parseFloat(theDivComputed.paddingRight)+parseFloat(theDivComputed.paddingLeft))/currentFontSize;acumulatedPaddings+=(parseFloat(theDivComputed.marginRight)+parseFloat(theDivComputed.marginLeft))/currentFontSize;acumulatedPaddings+=(parseFloat(theSpanParentComputed.paddingRight)+parseFloat(theSpanParentComputed.paddingLeft))/currentFontSize;acumulatedPaddings+=(parseFloat(theSpanParentComputed.marginRight)+parseFloat(theSpanParentComputed.marginLeft))/currentFontSize;balancedWidth=width-acumulatedPaddings;for(i=0;i<theSpans.length;i++){if(theSpans[i].offsetWidth/currentFontSize>balancedWidth){theSpans[i].style.width=balancedWidth+'em';}}};var resetMaxWidth=function resetMaxWidth(theInterface){var theSourcesSpans,theTargetSpans,targets,sources,i;sources=theInterface.wrapperElement.getElementsByClassName('sources')[0];theSourcesSpans=sources.getElementsByTagName('span');targets=theInterface.wrapperElement.getElementsByClassName('targets')[0];theTargetSpans=targets.getElementsByTagName('span');for(i=0;i<theSourcesSpans.length;i++){theSourcesSpans[i].style.width='';}
for(i=0;i<theTargetSpans.length;i++){theTargetSpans[i].style.width='';}};WiringEditor.prototype.setOperatorVersion=function setOperatorVersion(miniOperator,versionInfo){var versionIndex;versionIndex=miniOperator.ioperator.vendor+'/'+miniOperator.ioperator.name;if(this.operatorVersions[versionIndex].currentVersion.compareTo(versionInfo.version)==0){return;}
this.mini_operator_section.removeChild(miniOperator);if(this.operatorVersions[versionIndex].lastVersion.compareTo(versionInfo.version)>0){versionInfo.operatorInterface.wrapperElement.classList.add('old');}
this.mini_operator_section.appendChild(versionInfo.operatorInterface);this.operatorVersions[versionIndex].currentVersion=versionInfo.version;this.operatorVersions[versionIndex].miniOperator=versionInfo.operatorInterface;return;};WiringEditor.prototype.getGridElement=function getGridElement(){return this.layout.getCenterContainer().wrapperElement;};WiringEditor.prototype.generateConnection=function generateConnection(workspace,connection,connectionView){var startAnchor,endAnchor,readOnly,extraclass,arrow,multi,pos,msg,iwidget,entity,isGhost;startAnchor=findAnchor.call(this,connection.source,workspace);endAnchor=findAnchor.call(this,connection.target,workspace);if(startAnchor!==null&&endAnchor!==null){try{if(connection.readOnly){readOnly=true;extraclass='readOnly';startAnchor.context.iObject.incReadOnlyConnectionsCount();endAnchor.context.iObject.incReadOnlyConnectionsCount();}else{readOnly=false;extraclass=null;}
isGhost=startAnchor.context.data instanceof Wirecloud.wiring.GhostSourceEndpoint||endAnchor.context.data instanceof Wirecloud.wiring.GhostTargetEndpoint;arrow=this.canvas.drawArrow(startAnchor.getCoordinates(this.layout.getCenterContainer().wrapperElement),endAnchor.getCoordinates(this.layout.getCenterContainer().wrapperElement),extraclass,readOnly,isGhost);arrow.startAnchor=startAnchor;startAnchor.addArrow(arrow);arrow.endAnchor=endAnchor;endAnchor.addArrow(arrow);arrow.addClassName('arrow');arrow.setPullerStart(connectionView.pullerStart);arrow.setPullerEnd(connectionView.pullerEnd);if(connectionView.startMulti!=null){multi=this.multiconnectors[connectionView.startMulti];if(multi){arrow.startMulti=connectionView.startMulti;pos=multi.getCoordinates(this.layout);arrow.setStart(pos);multi.addArrow(arrow);}}
if(connectionView.endMulti!=null){multi=this.multiconnectors[connectionView.endMulti];if(multi){arrow.endMulti=connectionView.endMulti;pos=multi.getCoordinates(this.layout);arrow.setEnd(pos);multi.addArrow(arrow);}}
arrow.redraw();}catch(e){msg='Creating connection. betwen ['+startAnchor.context.data.id+'] and ['+endAnchor.context.data.id+']. ';throw new Error('WiringEditor error.'+msg+e.message);}}else{if(!startAnchor){insertGhostEndpoint.call(this,connection,true);}
if(!endAnchor){insertGhostEndpoint.call(this,connection,false);}
this.generateConnection(workspace,connection,connectionView);}};WiringEditor.prototype.activateCtrlMultiSelect=function activateCtrlMultiSelect(){document.addEventListener("keydown",this._keydownListener,false);document.addEventListener("keyup",this._keyupListener,false);};WiringEditor.prototype.deactivateCtrlMultiSelect=function deactivateCtrlMultiSelect(){document.removeEventListener("keydown",this._keydownListener,false);document.removeEventListener("keyup",this._keyupListener,false);this.ctrlPushed=false;this.layout.getCenterContainer().removeClassName('selecting');};WiringEditor.prototype.serialize=function serialize(){var pos,i,key,widget,arrow,operator_interface,ioperator,WiringStatus,multiconnector,height,inOutPos,positions,name,is_minimized,pref;WiringStatus={views:[{label:'default',iwidgets:{},operators:{},multiconnectors:{},connections:[]}],operators:{},connections:[]};for(key in this.iwidgets){widget=this.iwidgets[key];pos=widget.getStylePosition();inOutPos=widget.getInOutPositions();positions={'position':pos,'endPointsInOuts':inOutPos,'name':widget.iwidget.widget.id};WiringStatus.views[0].iwidgets[key]=positions;}
for(key in this.currentlyInUseOperators){is_minimized=this.currentlyInUseOperators[key].isMinimized;if(is_minimized){this.currentlyInUseOperators[key].restore(true);}
operator_interface=this.currentlyInUseOperators[key];pos=operator_interface.getStylePosition();inOutPos=operator_interface.getInOutPositions();positions={'minimized':is_minimized,'position':pos,'endPointsInOuts':inOutPos};ioperator=operator_interface.getIOperator();WiringStatus.operators[key]={'id':key,'name':ioperator.meta.uri,'preferences':{}};for(pref in ioperator.preferences){WiringStatus.operators[key].preferences[pref]={"readOnly":ioperator.preferences[pref].readOnly,"hidden":ioperator.preferences[pref].hidden,"value":ioperator.preferences[pref].value};}
WiringStatus.views[0].operators[key]=positions;}
for(key in this.multiconnectors){multiconnector=this.multiconnectors[key];pos=multiconnector.getStylePosition();height=parseFloat(multiconnector.wrapperElement.style.height);WiringStatus.views[0].multiconnectors[key]={'id':key,'pos':pos,'height':height,'objectId':multiconnector.objectId,'sourceName':multiconnector.sourceName,'objectType':multiconnector.context.iObject.className,'pullerStart':multiconnector.mainArrow.getPullerStart(),'pullerEnd':multiconnector.mainArrow.getPullerEnd()};}
for(i=0;i<this.arrows.length;i++){arrow=this.arrows[i];if(!arrow.hasClassName('full')&&!arrow.hasClassName('hollow')){WiringStatus.connections.push({'readOnly':arrow.hasClassName('readOnly'),'source':arrow.startAnchor.serialize(),'target':arrow.endAnchor.serialize(),'isGhost':arrow.isGhost});WiringStatus.views[0].connections.push({'pullerStart':arrow.getPullerStart(),'pullerEnd':arrow.getPullerEnd(),'startMulti':arrow.startMulti,'endMulti':arrow.endMulti});}}
return WiringStatus;};WiringEditor.prototype.addSelectedObject=function addSelectedObject(object){if(object instanceof Wirecloud.ui.WiringEditor.WidgetInterface){this.selectedWids[object.getId()]=object;this.selectedWids.length+=1;}else if(object instanceof Wirecloud.ui.WiringEditor.OperatorInterface){this.selectedOps[object.getId()]=object;this.selectedOps.length+=1;}else if(object instanceof Wirecloud.ui.WiringEditor.Multiconnector){this.selectedMulti[object.getId()]=object;this.selectedMulti.length+=1;}
this.selectedCount+=1;};WiringEditor.prototype.removeSelectedObject=function removeSelectedObject(object){if(object instanceof Wirecloud.ui.WiringEditor.WidgetInterface){delete this.selectedWids[object.getId()];this.selectedWids.length-=1;}else if(object instanceof Wirecloud.ui.WiringEditor.OperatorInterface){delete this.selectedOps[object.getId()];this.selectedOps.length-=1;}else if(object instanceof Wirecloud.ui.WiringEditor.Multiconnector){delete this.selectedMulti[object.getId()];this.selectedMulti.length-=1;}
if(this.selectedCount>0){this.selectedCount-=1;}else{}};WiringEditor.prototype.resetSelection=function resetSelection(){var key;for(key in this.selectedOps){if(key!='length'){this.selectedOps[key].unselect(false);}}
for(key in this.selectedWids){if(key!='length'){this.selectedWids[key].unselect(false);}}
for(key in this.selectedMulti){if(key!='length'){this.selectedMulti[key].unselect(false);}}
if((this.selectedOps.length!==0)||(this.selectedWids.length!==0)||(this.selectedMulti.length!==0)){}};WiringEditor.prototype.withinGrid=function withinGrid(event){var clientX,clientY,box;box=this.layout.getCenterContainer().getBoundingClientRect();if('touches'in event){clientX=event.changedTouches[0].clientX;clientY=event.changedTouches[0].clientY;}else{clientX=event.clientX;clientY=event.clientY;}
return(clientX>box.left)&&(clientX<box.right)&&(clientY>box.top)&&(clientY<box.bottom);};WiringEditor.prototype.addIWidget=function addIWidget(wiringEditor,iwidget,enpPointPos){var widget_interface,i,anchor;widget_interface=new Wirecloud.ui.WiringEditor.WidgetInterface(wiringEditor,iwidget,this.arrowCreator,false,enpPointPos);this.iwidgets[iwidget.id]=widget_interface;setEntityMaxWidth.call(this,widget_interface);this.layout.getCenterContainer().appendChild(widget_interface);this.events.widgetadded.dispatch();for(i=0;i<widget_interface.sourceAnchors.length;i+=1){anchor=widget_interface.sourceAnchors[i];this.recommendations.add_anchor_to_recommendations(anchor);}
for(i=0;i<widget_interface.targetAnchors.length;i+=1){anchor=widget_interface.targetAnchors[i];this.recommendations.add_anchor_to_recommendations(anchor);}
widget_interface.sourceAnchors.map(this._startdrag_map_func);widget_interface.targetAnchors.map(this._startdrag_map_func);this.targetAnchorList=this.targetAnchorList.concat(widget_interface.targetAnchors);this.sourceAnchorList=this.sourceAnchorList.concat(widget_interface.sourceAnchors);widget_interface.wrapperElement.style.minWidth=widget_interface.getBoundingClientRect().width+'px';this.entitiesNumber+=1;this.emptyBox.classList.add('hidden');return widget_interface;};WiringEditor.prototype.addIOperator=function addIOperator(ioperator,enpPointPos){var instantiated_operator,operator_interface,i,anchor;if(ioperator instanceof Wirecloud.wiring.OperatorMeta){instantiated_operator=ioperator.instantiate(this.nextOperatorId,null,this);this.nextOperatorId++;}else{instantiated_operator=ioperator;}
operator_interface=new Wirecloud.ui.WiringEditor.OperatorInterface(this,instantiated_operator,this.arrowCreator,false,enpPointPos);setEntityMaxWidth.call(this,operator_interface);this.layout.getCenterContainer().appendChild(operator_interface);this.events.operatoradded.dispatch();for(i=0;i<operator_interface.sourceAnchors.length;i+=1){anchor=operator_interface.sourceAnchors[i];this.recommendations.add_anchor_to_recommendations(anchor);}
for(i=0;i<operator_interface.targetAnchors.length;i+=1){anchor=operator_interface.targetAnchors[i];this.recommendations.add_anchor_to_recommendations(anchor);}
operator_interface.sourceAnchors.map(this._startdrag_map_func);operator_interface.targetAnchors.map(this._startdrag_map_func);this.targetAnchorList=this.targetAnchorList.concat(operator_interface.targetAnchors);this.sourceAnchorList=this.sourceAnchorList.concat(operator_interface.sourceAnchors);operator_interface.wrapperElement.style.minWidth=operator_interface.getBoundingClientRect().width+'px';this.currentlyInUseOperators[operator_interface.getId()]=operator_interface;this.entitiesNumber+=1;this.emptyBox.classList.add('hidden');return operator_interface;};WiringEditor.prototype.onStarDragSelected=function starDragSelected(){var key,pos;if(this.selectedCount<=1){return;}
for(key in this.selectedOps){if(key!='length'){pos=this.selectedOps[key].initPos;pos.y=this.selectedOps[key].wrapperElement.style.top===""?0:parseInt(this.selectedOps[key].wrapperElement.style.top,10);pos.x=this.selectedOps[key].wrapperElement.style.left===""?0:parseInt(this.selectedOps[key].wrapperElement.style.left,10);}}
for(key in this.selectedWids){if(key!='length'){pos=this.selectedWids[key].initPos;pos.y=this.selectedWids[key].wrapperElement.style.top===""?0:parseInt(this.selectedWids[key].wrapperElement.style.top,10);pos.x=this.selectedWids[key].wrapperElement.style.left===""?0:parseInt(this.selectedWids[key].wrapperElement.style.left,10);}}
for(key in this.selectedMulti){if(key!='length'){pos=this.selectedMulti[key].initPos;pos.y=this.selectedMulti[key].wrapperElement.style.top===""?0:parseInt(this.selectedMulti[key].wrapperElement.style.top,10);pos.x=this.selectedMulti[key].wrapperElement.style.left===""?0:parseInt(this.selectedMulti[key].wrapperElement.style.left,10);}}};WiringEditor.prototype.onDragSelectedObjects=function dragSelectedObjects(xDelta,yDelta){var key;if(this.selectedCount<=1){return;}
for(key in this.selectedOps){if(key!='length'){this.selectedOps[key].setPosition({posX:this.selectedOps[key].initPos.x+xDelta,posY:this.selectedOps[key].initPos.y+yDelta});this.selectedOps[key].repaint();}}
for(key in this.selectedWids){if(key!='length'){this.selectedWids[key].setPosition({posX:this.selectedWids[key].initPos.x+xDelta,posY:this.selectedWids[key].initPos.y+yDelta});this.selectedWids[key].repaint();}}
for(key in this.selectedMulti){if(key!='length'){this.selectedMulti[key].setPosition({posX:this.selectedMulti[key].initPos.x+xDelta,posY:this.selectedMulti[key].initPos.y+yDelta});this.selectedMulti[key].repaint();}}};WiringEditor.prototype.onFinishSelectedObjects=function onFinishSelectedObjects(){var key,position,desp;if(this.selectedCount<=1){return;}
desp={'x':0,'y':0};for(key in this.selectedOps){if(key!='length'){position=this.selectedOps[key].getStylePosition();if(position.posX<0){if(position.posX<desp.x){desp.x=position.posX;}}
if(position.posY<0){if(position.posY<desp.y){desp.y=position.posY;}}}}
for(key in this.selectedWids){if(key!='length'){position=this.selectedWids[key].getStylePosition();if(position.posX<0){if(position.posX<desp.x){desp.x=position.posX;}}
if(position.posY<0){if(position.posY<desp.y){desp.y=position.posY;}}}}
for(key in this.selectedMulti){if(key!='length'){position=this.selectedMulti[key].getStylePosition();if(position.posX<0){if(position.posX<desp.x){desp.x=position.posX;}}
if(position.posY<0){if(position.posY<desp.y){desp.y=position.posY;}}}}
if((desp.y>=0)&&(desp.x>=0)){return;}
if(desp.y>=0){desp.y=0;}else{desp.y-=8;}
if(desp.x>=0){desp.x=0;}else{desp.x-=8;}
for(key in this.selectedOps){if(key!='length'){position=this.selectedOps[key].getStylePosition();position.posX-=desp.x;position.posY-=desp.y;this.selectedOps[key].setPosition(position);this.selectedOps[key].repaint();}}
for(key in this.selectedWids){if(key!='length'){position=this.selectedWids[key].getStylePosition();position.posX-=desp.x;position.posY-=desp.y;this.selectedWids[key].setPosition(position);this.selectedWids[key].repaint();}}
for(key in this.selectedMulti){if(key!='length'){position=this.selectedMulti[key].getStylePosition();position.posX-=desp.x;position.posY-=desp.y;this.selectedMulti[key].setPosition(position);this.selectedMulti[key].repaint();}}};WiringEditor.prototype.ChangeObjectEditing=function ChangeObjectEditing(obj){this.resetSelection();if(obj==null){if(this.EditingObject!=null){this.EditingObject.editPos();this.EditingObject=null;}}else{if(this.EditingObject===obj){this.EditingObject.editPos();this.EditingObject=null;}else{obj.editPos();if(this.EditingObject!=null){this.EditingObject.editPos();}
this.EditingObject=obj;}}};WiringEditor.prototype.enableAnchors=function enableAnchors(){var i;if(!this.sourcesOn){for(i=0;i<this.sourceAnchorList.length;i++){this.sourceAnchorList[i].enable();this.sourcesOn=true;}}else if(!this.targetsOn){for(i=0;i<this.targetAnchorList.length;i++){this.targetAnchorList[i].enable();this.targetsOn=true;}}};WiringEditor.prototype.disableAnchors=function disableAnchors(anchor){var i,anchorList,anchor_aux;anchorList=[];if(anchor instanceof Wirecloud.ui.WiringEditor.Multiconnector){anchor_aux=anchor.initAnchor;}else{anchor_aux=anchor;}
if(anchor_aux instanceof Wirecloud.ui.WiringEditor.TargetAnchor){anchorList=this.targetAnchorList;this.targetsOn=false;}else{anchorList=this.sourceAnchorList;this.sourcesOn=false;}
for(i=0;i<anchorList.length;i++){anchorList[i].disable();}};WiringEditor.prototype.removeIWidget=function removeIWidget(widget_interface){var i,anchor;widget_interface.unselect(false);delete this.iwidgets[widget_interface.getIWidget().id];this.layout.getCenterContainer().removeChild(widget_interface);for(i=0;i<widget_interface.sourceAnchors.length;i+=1){anchor=widget_interface.sourceAnchors[i];this.sourceAnchorList.splice(this.sourceAnchorList.indexOf(anchor),1);this.recommendations.remove_anchor_to_recommendations(anchor);}
for(i=0;i<widget_interface.targetAnchors.length;i+=1){anchor=widget_interface.targetAnchors[i];this.targetAnchorList.splice(this.targetAnchorList.indexOf(anchor),1);this.recommendations.remove_anchor_to_recommendations(anchor);}
widget_interface.destroy();if(widget_interface.getIWidget().id in this.mini_widgets){this.mini_widgets[widget_interface.getIWidget().id].enable();}
this.entitiesNumber-=1;if(this.entitiesNumber===0){this.emptyBox.classList.remove('hidden');}};WiringEditor.prototype.removeIOperator=function removeIOperator(operator_interface){var i,anchor;operator_interface.unselect(false);delete this.currentlyInUseOperators[operator_interface.getIOperator().id];this.layout.getCenterContainer().removeChild(operator_interface);for(i=0;i<operator_interface.sourceAnchors.length;i+=1){anchor=operator_interface.sourceAnchors[i];this.sourceAnchorList.splice(this.sourceAnchorList.indexOf(anchor),1);this.recommendations.remove_anchor_to_recommendations(anchor);}
for(i=0;i<operator_interface.targetAnchors.length;i+=1){anchor=operator_interface.targetAnchors[i];this.targetAnchorList.splice(this.targetAnchorList.indexOf(anchor),1);this.recommendations.remove_anchor_to_recommendations(anchor);}
operator_interface.destroy();this.entitiesNumber-=1;if(this.entitiesNumber===0){this.emptyBox.classList.remove('hidden');}};WiringEditor.prototype.addMulticonnector=function addMulticonnector(multiconnector){var id;if(multiconnector.id==null){id=this.nextMulticonnectorId;this.nextMulticonnectorId=parseInt(id,10)+1;}else{id=multiconnector.id;}
this.layout.getCenterContainer().appendChild(multiconnector);this.multiconnectors[id]=multiconnector;this._startdrag_map_func(multiconnector);if(multiconnector.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){this.targetAnchorList=this.targetAnchorList.concat(multiconnector);}else{this.sourceAnchorList=this.sourceAnchorList.concat(multiconnector);}
return this.multiconnectors[id];};WiringEditor.prototype.removeMulticonnector=function removeMulticonnector(multiConnector){this.layout.getCenterContainer().removeChild(multiConnector);if(multiConnector.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){this.targetAnchorList.splice(this.targetAnchorList.indexOf(multiConnector),1);}else{this.sourceAnchorList.splice(this.sourceAnchorList.indexOf(multiConnector),1);}
multiConnector.destroy(true);delete this.multiconnectors[multiConnector.id];};WiringEditor.prototype.getBreadcrum=function getBreadcrum(){var i,workspace_breadcrum=LayoutManagerFactory.getInstance().viewsByName.workspace.getBreadcrum();for(i=0;i<workspace_breadcrum.length;i+=1){delete workspace_breadcrum[i].menu;}
workspace_breadcrum.push({'label':'wiring'});return workspace_breadcrum;};WiringEditor.prototype.getTitle=function getTitle(){var workspace_title=LayoutManagerFactory.getInstance().viewsByName.workspace.getTitle();return Wirecloud.Utils.interpolate(gettext('%(workspace_title)s - Wiring'),{workspace_title:workspace_title});};WiringEditor.prototype.scrollHandler=function scrollHandler(){var oc,scrollX,scrollY,param;oc=this.layout.getCenterContainer();scrollX=parseInt(oc.wrapperElement.scrollLeft,10);scrollY=parseInt(oc.wrapperElement.scrollTop,10);param="translate("+(-scrollX)+" "+(-scrollY)+")";this.canvas.canvasElement.generalLayer.setAttribute('transform',param);this.canvas.canvasElement.style.top=scrollY+'px';this.canvas.canvasElement.style.left=scrollX+'px';};WiringEditor.prototype.setZoomLevel=function setZoomLevel(percent){var key,invertPercent,calculatedHeight,calculatedWidth,calculatedLeft,top,left,currentSize;currentSize=parseFloat(this.layout.getCenterContainer().wrapperElement.style.fontSize);changeZoom(this.layout.getCenterContainer().wrapperElement,percent);for(key in this.currentlyInUseOperators){this.layout.getCenterContainer().removeChild(this.currentlyInUseOperators[key]);setEntityMaxWidth.call(this,this.currentlyInUseOperators[key]);this.layout.getCenterContainer().appendChild(this.currentlyInUseOperators[key]);this.currentlyInUseOperators[key].wrapperElement.style.minWidth=this.currentlyInUseOperators[key].getBoundingClientRect().width+'px';top=parseFloat(this.currentlyInUseOperators[key].wrapperElement.style.top);left=parseFloat(this.currentlyInUseOperators[key].wrapperElement.style.left);this.currentlyInUseOperators[key].wrapperElement.style.top=((top/currentSize)*percent)+'px';this.currentlyInUseOperators[key].wrapperElement.style.left=((left/currentSize)*percent)+'px';this.currentlyInUseOperators[key].repaint();}
for(key in this.iwidgets){this.layout.getCenterContainer().removeChild(this.iwidgets[key]);setEntityMaxWidth.call(this,this.iwidgets[key]);this.layout.getCenterContainer().appendChild(this.iwidgets[key]);this.iwidgets[key].wrapperElement.style.minWidth=this.iwidgets[key].getBoundingClientRect().width+'px';top=parseFloat(this.iwidgets[key].wrapperElement.style.top);left=parseFloat(this.iwidgets[key].wrapperElement.style.left);this.iwidgets[key].wrapperElement.style.top=((top/currentSize)*percent)+'px';this.iwidgets[key].wrapperElement.style.left=((left/currentSize)*percent)+'px';this.iwidgets[key].repaint();}
for(key in this.multiconnectors){top=parseFloat(this.multiconnectors[key].wrapperElement.style.top);left=parseFloat(this.multiconnectors[key].wrapperElement.style.left);this.multiconnectors[key].wrapperElement.style.top=((top/currentSize)*percent)+'px';this.multiconnectors[key].wrapperElement.style.left=((left/currentSize)*percent)+'px';this.multiconnectors[key].repaint();}};var changeZoom=function changeZoom(element,level){element.style.fontSize=level+'em';};Wirecloud.ui.WiringEditor=WiringEditor;})();(function(){"use strict";var Anchor=function Anchor(extending,arrowCreator,isGhost){if(extending===true){return;}
StyledElements.StyledElement.call(this,['startdrag','enddrag']);this.arrows=[];this.wrapperElement=document.createElement("div");this.wrapperElement.classList.add('anchor');if(isGhost){this.wrapperElement.classList.add('icon-exclamation-sign');}else{this.wrapperElement.classList.add('icon-circle');}
this.menu=new StyledElements.PopupMenu({'position':['bottom-left','top-left','bottom-right','top-right']});this._mousedown_callback=function _mousedown_callback(e){var arrow,end,start;if(e.button==2){if(this.menu.isVisible()){this.menu.hide();}else{this.menu.show(this.wrapperElement.getBoundingClientRect());}
return;}
e.stopPropagation();if(this.enabled&&e.button===0){arrow=this.hasSelectedArrow();if(arrow!=null){if(arrow.readOnly||arrow.hasClassName('hollow')||arrow.startAnchor.isSubAnchor){return;}
if(arrow.hasClassName('multiconnector_arrow')){arrow.canvas.unselectArrow();}else{if(arrow.startAnchor===this){if(arrow.endMulti==null){arrow.endAnchor.arrowCreator.startdrag(e,arrow.endAnchor);this.events.startdrag.dispatch(arrow.endAnchor);arrow.destroy();}else{arrow.destroy();end=this.context.iObject.wiringEditor.multiconnectors[arrow.endMulti];end.arrowCreator.startdrag(e,end);end.events.startdrag.dispatch(end);}}else if(arrow.endAnchor===this){if(arrow.startMulti==null){arrow.startAnchor.arrowCreator.startdrag(e,arrow.startAnchor);this.events.startdrag.dispatch(arrow.startAnchor);arrow.destroy();}else{arrow.destroy();start=this.context.iObject.wiringEditor.multiconnectors[arrow.startMulti];start.arrowCreator.startdrag(e,start);start.events.startdrag.dispatch(start);}}else{if((arrow.startMulti!=null)&&(arrow.endMulti!=null)){var multi;start=this.context.iObject.wiringEditor.multiconnectors[arrow.startMulti];end=this.context.iObject.wiringEditor.multiconnectors[arrow.endMulti];arrow.destroy();if(start===this){multi=end;}else{multi=start;}
multi.arrowCreator.startdrag(e,multi);multi.events.startdrag.dispatch(multi);}else if(arrow.startMulti!=null){end=arrow.endAnchor;end.arrowCreator.startdrag(e,end);end.events.startdrag.dispatch(end);arrow.destroy();}else{start=arrow.startAnchor;start.arrowCreator.startdrag(e,start);start.events.startdrag.dispatch(start);arrow.destroy();}}
return;}
return;}
arrowCreator.startdrag(e,this);this.events.startdrag.dispatch(this);}}.bind(this);this.wrapperElement.addEventListener('mousedown',this._mousedown_callback,false);this.wrapperElement.addEventListener('contextmenu',function(e){e.stopPropagation();e.preventDefault();});this._mouseup_callback=function _mouseup_callback(e){if(this.enabled&&e.button===0){if(arrowCreator.initAnchor!=null){e.stopPropagation();arrowCreator.enddrag(e,this);this.events.enddrag.dispatch(this);this.removeClassName('pointed');}}}.bind(this);this.wrapperElement.addEventListener('mouseup',this._mouseup_callback,false);this._mouseover_callback=function _mouseover_callback(e){if(this.enabled&&e.button===0){var pos;if(arrowCreator.initAnchor!=null){this.addClassName('pointed');document.removeEventListener("mousemove",arrowCreator.drag,false);e.stopPropagation();if(this instanceof Wirecloud.ui.WiringEditor.Multiconnector){pos=this.stick();}else{pos=this.getCoordinates(arrowCreator.layer);}
if(!arrowCreator.invert){arrowCreator.theArrow.setEnd(pos);if(!arrowCreator.theArrow.isGhost&&this.context.data instanceof Wirecloud.wiring.GhostTargetEndpoint){arrowCreator.theArrow.isGhost=true;arrowCreator.theArrow.addClassName('ghost');}}else{arrowCreator.theArrow.setStart(pos);if(!arrowCreator.theArrow.isGhost&&this.context.data instanceof Wirecloud.wiring.GhostSourceEndpoint){arrowCreator.theArrow.isGhost=true;arrowCreator.theArrow.addClassName('ghost');}}
arrowCreator.theArrow.redraw();}}}.bind(this);this._mouseout_callback=function _mouseout_callback(e){var initEndpoint;if(this.enabled&&e.button===0){if(arrowCreator.initAnchor!=null){e.stopPropagation();this.removeClassName('pointed');document.addEventListener("mousemove",arrowCreator.drag,false);if(this instanceof Wirecloud.ui.WiringEditor.Multiconnector){this.unstick();}
initEndpoint=arrowCreator.initAnchor.context.data;if(arrowCreator.theArrow.isGhost&&!(initEndpoint instanceof Wirecloud.wiring.GhostSourceEndpoint||initEndpoint instanceof Wirecloud.wiring.GhostTargetEndpoint)){arrowCreator.theArrow.isGhost=false;arrowCreator.theArrow.removeClassName('ghost');}}}}.bind(this);this.wrapperElement.addEventListener('mouseover',this._mouseover_callback,false);this.wrapperElement.addEventListener('mouseout',this._mouseout_callback,false);};Anchor.prototype=new StyledElements.StyledElement();Anchor.prototype.getCoordinates=function getCoordinates(baseElement){var anchor_bcr,base_bcr,coordinates;anchor_bcr=this.wrapperElement.getBoundingClientRect();base_bcr=baseElement.getBoundingClientRect();coordinates={posX:anchor_bcr.left-base_bcr.left+baseElement.scrollLeft,posY:anchor_bcr.top-base_bcr.top+baseElement.scrollTop};return{posX:Math.round(coordinates.posX+(this.wrapperElement.offsetWidth/2)),posY:Math.round(coordinates.posY+(this.wrapperElement.offsetWidth/2))};};Anchor.prototype.getArrows=function getArrows(){return this.arrows;};Anchor.prototype.isConnected=function isConnected(){return this.connectionArrows.length>0;};Anchor.prototype.addArrow=function addArrow(theArrow){this.arrows.push(theArrow);};Anchor.prototype.removeArrow=function removeArrow(theArrow){var index=this.arrows.indexOf(theArrow);if(index!==-1){this.arrows.splice(index,1);}};Anchor.prototype.highlightArrows=function highlightArrows(){var i;for(i=0;i<this.arrows.length;i+=1){this.arrows[i].highlight();}};Anchor.prototype.unhighlightArrows=function unhighlightArrows(){var i;for(i=0;i<this.arrows.length;i+=1){this.arrows[i].unhighlight();}};Anchor.prototype.serialize=function serialize(){if(!this.context.iObject.isGhost){return this.context.data.serialize();}else{return{'type':this.context.iObject.className,'id':this.context.iObject[this.context.iObject.className].id,'endpoint':this.context.data.name};}};Anchor.prototype.hasSelectedArrow=function hasSelectedArrow(){var arrow,i;for(i=0;i<this.arrows.length;i++){arrow=this.arrows[i];if(arrow.hasClassName('selected')){return arrow;}}
return null;};Anchor.prototype.isHighlighted=function isHighlighted(){return this.context.iObject.highlighted;};Anchor.prototype.isEmphasize=function isEmphasize(){return this.context.iObject.selected;};Anchor.prototype.destroy=function destroy(){StyledElements.StyledElement.prototype.destroy.call(this);this.wrapperElement.removeEventListener('mousedown',this._mousedown_callback,false);this.wrapperElement.removeEventListener('mouseup',this._mouseup_callback,false);this.wrapperElement=null;};Wirecloud.ui.WiringEditor.Anchor=Anchor;})();(function(){"use strict";var Arrow=function Arrow(canvas){this.highlight_counter=2;this.emphasize_counter=0;this.canvas=canvas;this.wrapperElement=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:g");this.arrowBodyElement=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:g");this.wrapperElement.appendChild(this.arrowBodyElement);this.arrowElementBorder=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:path");this.arrowElementBorder.setAttribute('class','arrowborder');this.arrowBodyElement.appendChild(this.arrowElementBorder);this.arrowElement=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:path");this.arrowElement.setAttribute('class','arrowbody');this.arrowBodyElement.appendChild(this.arrowElement);this.arrowBodyElement.addEventListener('click',function(e){if(e.button!==0){return;}
e.stopPropagation();if(canvas.getSelectedArrow()===this){canvas.unselectArrow();}else{canvas.selectArrow(this);}}.bind(this),true);this.closerElement=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:circle");this.closerElement.setAttribute('class','closer');this.closerElement.addEventListener('click',function(e){if(e.button!==0){return;}
if(this.readOnly){e.stopPropagation();return;}
if(!this.controlledDestruction()){this.destroy();}
e.stopPropagation();}.bind(this));this.pullerStartElement=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:circle");this.pullerStartElement.setAttribute("r",'0.4em');this.pullerStartElement.addEventListener("click",Wirecloud.Utils.stopPropagationListener,false);this.pullerEndElement=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:circle");this.pullerEndElement.setAttribute("r",'0.4em');this.pullerEndElement.addEventListener("click",Wirecloud.Utils.stopPropagationListener,false);this.pullerStartElement.setAttribute('class','pullerBall');this.pullerEndElement.setAttribute('class','pullerBall');this.pullerStartLine=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:path");this.pullerStartLine.setAttribute('class','pullerLine');this.pullerEndLine=canvas.canvasElement.generalLayer.ownerDocument.createElementNS(canvas.SVG_NAMESPACE,"svg:path");this.pullerEndLine.setAttribute('class','pullerLine');this.pullerStartDraggable=new Wirecloud.ui.Draggable(this.pullerStartElement,{arrow:this},function onStart(draggable,data){data.refPos=data.arrow.getPullerStart();},function onDrag(e,draggable,data,x,y){data.arrow.setPullerStart({posX:data.refPos.posX+x,posY:data.refPos.posY+y});data.arrow.redraw();},function onFinish(draggable,data){data.arrow.redraw();},function(){return true;});this.pullerEndDraggable=new Wirecloud.ui.Draggable(this.pullerEndElement,{arrow:this},function onStart(draggable,data){data.refPos=data.arrow.getPullerEnd();},function onDrag(e,draggable,data,x,y){data.arrow.setPullerEnd({posX:data.refPos.posX+x,posY:data.refPos.posY+y});data.arrow.redraw();},function onFinish(draggable,data){data.arrow.redraw();},function(){return true;});this.wrapperElement.appendChild(this.closerElement);this.wrapperElement.appendChild(this.pullerStartLine);this.wrapperElement.appendChild(this.pullerEndLine);this.wrapperElement.appendChild(this.pullerStartElement);this.wrapperElement.appendChild(this.pullerEndElement);this.pullerStart=null;this.pullerEnd=null;this.start=null;this.end=null;this.startAnchor=null;this.endAnchor=null;this.endMulti=null;this.startMulti=null;this.multiId=null;this.readOnly=false;this.isGhost=false;};Arrow.prototype.insertInto=function insertInto(element){element.appendChild(this.wrapperElement);};Arrow.prototype.setStart=function setStart(start,anchor){this.start=start;this.setStartAnchor(anchor);};Arrow.prototype.setStartAnchor=function setStartAnchor(anchor){if(anchor!=null){this.startAnchor=anchor;}};Arrow.prototype.setEnd=function setEnd(end,anchor){this.end=end;this.setEndAnchor(anchor);};Arrow.prototype.setEndAnchor=function setEndAnchor(anchor){if(anchor!=null){this.endAnchor=anchor;}};Arrow.prototype.getPullerStart=function getPullerStart(absolute){var from,to,difX,difY,result;from=this.start;to=this.end;if(from==null||to==null){return;}
if(this.pullerStart==null){difX=Math.abs(from.posX-to.posX);difY=Math.abs(from.posY-to.posY);if(difX>150){difX=150;}
if(difX<25){difX=25;}
result={posX:difX,posY:0};}else{result=this.pullerStart;}
if(absolute){return{posX:from.posX+result.posX,posY:from.posY+result.posY};}else{return result;}};Arrow.prototype.getPullerEnd=function getPullerEnd(absolute){var from,to,difX,difY,result;from=this.start;to=this.end;if(from==null||to==null){return;}
if(this.pullerEnd==null){difX=Math.abs(from.posX-to.posX);difY=Math.abs(from.posY-to.posY);if(difX>150){difX=150;}
if(difX<25){difX=25;}
result={posX:-difX,posY:0};}else{result=this.pullerEnd;}
if(absolute){return{posX:to.posX+result.posX,posY:to.posY+result.posY};}else{return result;}};Arrow.prototype.setPullerStart=function setPullerStart(pStart){this.pullerStart=pStart;};Arrow.prototype.setPullerEnd=function setPullerEnd(pEnd){this.pullerEnd=pEnd;};Arrow.prototype.redraw=function redraw(){var posCloser,startPuller,endPuller,from,to;from=this.start;to=this.end;startPuller=this.getPullerStart(true);this.pullerStartLine.setAttribute("d","M "+from.posX+","+from.posY+" "+startPuller.posX+","+startPuller.posY);this.pullerStartElement.setAttribute("cx",startPuller.posX);this.pullerStartElement.setAttribute("cy",startPuller.posY);endPuller=this.getPullerEnd(true);this.pullerEndLine.setAttribute("d","M "+to.posX+","+to.posY+" "+endPuller.posX+","+endPuller.posY);this.pullerEndElement.setAttribute("cx",endPuller.posX);this.pullerEndElement.setAttribute("cy",endPuller.posY);this.arrowElementBorder.setAttribute("d","M "+from.posX+","+from.posY+" "+"C "+startPuller.posX+","+startPuller.posY+" "+endPuller.posX+","+endPuller.posY+" "+
to.posX+","+to.posY);this.arrowElement.setAttribute("d","M "+from.posX+","+from.posY+" "+"C "+startPuller.posX+","+startPuller.posY+" "+endPuller.posX+","+endPuller.posY+" "+
to.posX+","+to.posY);try{posCloser=this.calculateMid();this.closerElement.setAttribute("cx",posCloser.posX);this.closerElement.setAttribute("cy",posCloser.posY);this.closerElement.setAttribute("r",'0.65em');}
catch(err){}};Arrow.prototype.calculateMid=function calculateMid(){var B1,B2,B3,B4,getBercier;B1=function B1(t){return t*t*t;};B2=function B2(t){return 3*t*t*(1-t);};B3=function B3(t){return 3*t*(1-t)*(1-t);};B4=function B4(t){return(1-t)*(1-t)*(1-t);};getBercier=function getBezier(percent,C1,C2,C3,C4){var X=C1.posX*B1(percent)+C2.posX*B2(percent)+C3.posX*B3(percent)+C4.posX*B4(percent);var Y=C1.posY*B1(percent)+C2.posY*B2(percent)+C3.posY*B3(percent)+C4.posY*B4(percent);return{posX:X,posY:Y};};return getBercier(0.5,this.start,this.getPullerStart(true),this.getPullerEnd(true),this.end);};Arrow.prototype.select=function select(){this.addClassName('selected');};Arrow.prototype.unselect=function unselect(){this.removeClassName('selected');};Arrow.prototype.emphasize=function emphasize(){if(this.emphasize_counter<2){this.emphasize_counter+=1;this.addClassName('emphasize');}else if(this.emphasize_counter==2){return;}};Arrow.prototype.deemphasize=function deemphasize(){this.emphasize_counter-=1;if(this.emphasize_counter===0){this.removeClassName('emphasize');}else if(this.emphasize_counter<0){this.emphasize_counter=0;return;}};Arrow.prototype.calculateEmphasize=function calculateEmphasize(){this.emphasize_counter=0;if(this.endAnchor.isEmphasize()){this.emphasize();}
if(this.startAnchor.isEmphasize()){this.emphasize();}
this.redraw();};Arrow.prototype.addClassName=function addClassName(className){this.wrapperElement.classList.add(className);};Arrow.prototype.removeClassName=function removeClassName(className){this.wrapperElement.classList.remove(className);};Arrow.prototype.hasClassName=function hasClassName(className){return this.wrapperElement.classList.contains(className);};Arrow.prototype.controlledDestruction=function controlledDestruction(){if(this.wrapperElement==null){return true;}
if(this.hasClassName('hollow')){return true;}
if(this.hasClassName('subdataConnection')){if(this.hasClassName('full')){this.startAnchor.context.iObject.removeSubdataConnection(this.startAnchor.context.data.name.split("/")[0],this.startAnchor.context.data.name,this);return true;}else{if(this.startAnchor.isSubAnchor){this.startAnchor.context.iObject.removeSubdataConnection(this.startAnchor.context.data.name.split("/")[0],this.startAnchor.context.data.name,this);return true;}}}
return false;};Arrow.prototype.destroy=function destroy(){this.disconnect();if(this.canvas!==null){this.canvas.removeArrow(this);this.canvas=null;}
if(this.wrapperElement==null){return;}
if(this.wrapperElement.parentNode){this.wrapperElement.parentNode.removeChild(this.wrapperElement);}
this.wrapperElement=null;this.pullerStartElement=null;this.pullerEndElement=null;this.closerElement=null;this.start=null;this.end=null;};Arrow.prototype.disconnect=function disconnect(){if(this.startAnchor!==null){this.startAnchor.removeArrow(this);this.startAnchor=null;}
if(this.endAnchor!==null){this.endAnchor.removeArrow(this);this.endAnchor=null;}};Arrow.prototype.hide=function hide(){this.addClassName('hidden');};Arrow.prototype.show=function show(){this.removeClassName('hidden');};Wirecloud.ui.WiringEditor.Arrow=Arrow;})();(function(){"use strict";var _cancel=function(){return false;};var ArrowCreator=function ArrowCreator(canvas,data,onStart,onDrag,onFinish){var theArrow;var draggable=this;var currentSource,currentTarget;var layer=canvas.getHTMLElement().parentNode;this.layer=layer;this.startdrag=function startdrag(e,initAnchor){var tmpPos,xStart,yStart,endpoint,isGhost;if(e.button!==0){return;}
this.initAnchor=initAnchor;if(initAnchor instanceof Wirecloud.ui.WiringEditor.Multiconnector){initAnchor.context.iObject.wiringEditor.recommendations.emphasize(initAnchor.initAnchor,true);}else{initAnchor.context.iObject.wiringEditor.recommendations.emphasize(initAnchor,true);}
document.oncontextmenu=_cancel;document.onmousedown=_cancel;document.onselectstart=_cancel;document.addEventListener('mouseup',this.enddrag,false);xStart=parseInt(e.clientX,10);yStart=parseInt(e.clientY,10);tmpPos=initAnchor.getCoordinates(layer);endpoint=initAnchor.context.data;if(endpoint instanceof Wirecloud.wiring.GhostSourceEndpoint||endpoint instanceof Wirecloud.wiring.GhostTargetEndpoint){isGhost=true;}
theArrow=canvas.drawArrow(tmpPos,tmpPos,"arrow",false,isGhost);this.initAnchor.context.iObject.potentialArrow=theArrow;if(initAnchor.context.iObject.isMinimized){initAnchor.context.iObject.restore();this.initWasMinimized=true;}else{this.initWasMinimized=false;}
this.theArrow=theArrow;theArrow.emphasize();if(initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){this.invert=true;currentSource=null;currentTarget=initAnchor;theArrow.setEnd(tmpPos,initAnchor);}else if(initAnchor instanceof Wirecloud.ui.WiringEditor.SourceAnchor){this.invert=false;currentSource=initAnchor;currentTarget=null;theArrow.setStart(tmpPos,initAnchor);}else if(initAnchor instanceof Wirecloud.ui.WiringEditor.Multiconnector){if(initAnchor.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){this.invert=true;currentSource=null;currentTarget=initAnchor;theArrow.setEnd(tmpPos,initAnchor.initAnchor);theArrow.endMulti=initAnchor.id;}else if(initAnchor.initAnchor instanceof Wirecloud.ui.WiringEditor.SourceAnchor){this.invert=false;currentSource=initAnchor;currentTarget=null;theArrow.startMulti=initAnchor.id;theArrow.setStart(tmpPos,initAnchor.initAnchor);}}
document.addEventListener("mousemove",this.drag,false);onStart(draggable,data);return false;};this.drag=function drag(e){e=e||window.event;var x=parseInt(e.clientX,10);var y=parseInt(e.clientY,10);if(!this.invert){theArrow.setEnd(getRelativeScreenPosition(x,y,layer));}else{theArrow.setStart(getRelativeScreenPosition(x,y,layer));}
theArrow.redraw();onDrag(e,draggable,data,x,y);}.bind(this);this.enddrag=function enddrag(e,fAnchor){if(e.button!==0){return;}
this.initAnchor.context.iObject.potentialArrow=null;if(fAnchor!==this.initAnchor){if(fAnchor!=null){if(fAnchor instanceof Wirecloud.ui.WiringEditor.Multiconnector){if(!this.invert){currentTarget=fAnchor.initAnchor;theArrow.setEnd(fAnchor.getCoordinates(layer),fAnchor.initAnchor);theArrow.endMulti=fAnchor.id;}else{currentSource=fAnchor.initAnchor;theArrow.setStart(fAnchor.getCoordinates(layer),fAnchor.initAnchor);theArrow.startMulti=fAnchor.id;}}else{if(!this.invert){currentTarget=fAnchor;theArrow.setEnd(fAnchor.getCoordinates(layer),fAnchor);}else{currentSource=fAnchor;theArrow.setStart(fAnchor.getCoordinates(layer),fAnchor);}}
theArrow.deemphasize();if(isVal(currentSource,currentTarget)){theArrow.calculateEmphasize();theArrow.redraw();this.initAnchor.addArrow(theArrow);if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.Multiconnector){this.initAnchor.initAnchor.addArrow(theArrow);}else if(fAnchor instanceof Wirecloud.ui.WiringEditor.Multiconnector){fAnchor.initAnchor.addArrow(theArrow);}
fAnchor.addArrow(theArrow);if(currentSource.isSubAnchor){currentSource.context.iObject.addSubdataConnection(currentSource.context.data.name.split("/")[0],currentSource.context.data.name,theArrow,currentSource,currentTarget,false);theArrow.addClassName('subdataConnection');}else if(currentTarget.isSubAnchor){currentTarget.context.iObject.addSubdataConnection(currentTarget.context.data.name.split("/")[0],currentTarget.context.data.name,theArrow,currentSource,currentTarget,false);theArrow.addClassName('subdataConnection');}
if(this.initWasMinimized){this.initAnchor.context.iObject.minimize();}}else{theArrow.destroy();}}else{theArrow.destroy();if(this.initWasMinimized){this.initAnchor.context.iObject.minimize();}}}else{theArrow.destroy();}
if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.Multiconnector){this.initAnchor.context.iObject.wiringEditor.recommendations.deemphasize(this.initAnchor.initAnchor,true);}else{this.initAnchor.context.iObject.wiringEditor.recommendations.deemphasize(this.initAnchor,true);}
document.removeEventListener("mouseup",this.enddrag,false);document.removeEventListener("mousemove",this.drag,false);onFinish(draggable,data);document.onmousedown=null;document.onselectstart=null;document.oncontextmenu=null;currentTarget=null;currentSource=null;this.initAnchor=null;this.invert=null;return theArrow;}.bind(this);};var isVal=function isVal(currentSource,currentTarget){var arrows,i,source,target;source=currentSource;target=currentTarget;if(source instanceof Wirecloud.ui.WiringEditor.Multiconnector){source=currentSource.initAnchor;if(source.isSubAnchor||target.isSubAnchor){return false;}}
if(target instanceof Wirecloud.ui.WiringEditor.Multiconnector){target=currentTarget.initAnchor;if(source.isSubAnchor||target.isSubAnchor){return false;}}
if(source===target){return false;}
if(!(source instanceof Wirecloud.ui.WiringEditor.SourceAnchor)||!(target instanceof Wirecloud.ui.WiringEditor.TargetAnchor)){return false;}
if(target.context.iObject===source.context.iObject){return false;}
if(source.isSubAnchor){arrows=source.context.iObject.sourceAnchorsByName[source.context.data.name.split('/')[0]].getArrows();}else{arrows=source.getArrows();}
for(i=0;i<arrows.length;i++){if(arrows[i].endAnchor===target){return false;}}
return true;};var getRelativeScreenPosition=function getRelativeScreenPosition(x,y,element){var bounding_box=element.getBoundingClientRect();return{posX:x-bounding_box.left+element.scrollLeft,posY:y-bounding_box.top+element.scrollTop};};Wirecloud.ui.WiringEditor.ArrowCreator=ArrowCreator;})();(function(){"use strict";var Canvas=function Canvas(){StyledElements.ObjectWithEvents.call(this,['arrowadded','arrowremoved','unselectall']);this.canvasElement=document.createElementNS(this.SVG_NAMESPACE,'svg:svg');this.canvasElement.generalLayer=document.createElementNS(this.SVG_NAMESPACE,'svg:g');this.canvasElement.appendChild(this.canvasElement.generalLayer);this.canvasElement.setAttribute('class','canvas');this.selectedArrow=null;this.canvasElement.addEventListener('click',function(){this.unselectArrow();this.events.unselectall.dispatch();}.bind(this),false);};Canvas.prototype=new StyledElements.ObjectWithEvents();Canvas.prototype.SVG_NAMESPACE="http://www.w3.org/2000/svg";Canvas.prototype.addClassName=function addClassName(className){var atr;atr=this.canvasElement.getAttribute('class');if(atr==null){atr='';}
this.canvasElement.setAttribute('class',Wirecloud.Utils.appendWord(atr,className));};Canvas.prototype.drawArrow=function drawArrow(from,to,extraClass,readOnly,isGhost){var arrow=new Wirecloud.ui.WiringEditor.Arrow(this);arrow.addClassName(extraClass);if(readOnly){arrow.readOnly=true;}
if(isGhost){arrow.isGhost=true;arrow.addClassName('ghost');}
arrow.setStart(from);arrow.setEnd(to);arrow.redraw();arrow.insertInto(this.canvasElement.generalLayer);if((extraClass!='multiconnector_arrow')&&extraClass!='arrow hollow'){this.events.arrowadded.dispatch(this,arrow);}
return arrow;};Canvas.prototype.removeArrow=function removeArrow(arrow){if(this.selectedArrow===arrow){this.unselectArrow();}
if(arrow.multiId==null){arrow.wrapperElement.parentNode.removeChild(arrow.wrapperElement);}
this.events.arrowremoved.dispatch(this,arrow);};Canvas.prototype.clear=function clear(){this.canvasElement.classList.remove("elevated");while(this.canvasElement.generalLayer.childNodes.length>0){this.canvasElement.generalLayer.removeChild(this.canvasElement.generalLayer.firstChild);}};Canvas.prototype.getHTMLElement=function getHTMLElement(){return this.canvasElement;};Canvas.prototype.selectArrow=function selectArrow(arrow){this.unselectArrow();arrow.select();this.selectedArrow=arrow;};Canvas.prototype.getSelectedArrow=function getSelectedArrow(){return this.selectedArrow;};Canvas.prototype.unselectArrow=function unselectArrow(){if(this.selectedArrow!==null){this.selectedArrow.unselect();this.selectedArrow=null;}};Wirecloud.ui.WiringEditor.Canvas=Canvas;})();(function(){"use strict";var updateErrorInfo=function updateErrorInfo(){var label,errorCount=this.entity.logManager.getErrorCount();this.log_button.setDisabled(errorCount===0);label=ngettext("%(errorCount)s error","%(errorCount)s errors",errorCount);label=interpolate(label,{errorCount:errorCount},true);this.log_button.setTitle(label);};var GenericInterface=function GenericInterface(extending,wiringEditor,entity,title,manager,className,isGhost){if(extending===true){return;}
var del_button,log_button,type,msg,ghostNotification;StyledElements.Container.call(this,{'class':className},[]);Object.defineProperty(this,'entity',{value:entity});this.editingPos=false;this.targetAnchorsByName={};this.sourceAnchorsByName={};this.targetAnchors=[];this.sourceAnchors=[];this.wiringEditor=wiringEditor;this.title=title;this.className=className;this.initPos={'x':0,'y':0};this.draggableSources=[];this.draggableTargets=[];this.activatedTree=null;this.hollowConnections={};this.fullConnections={};this.subdataConnections={};this.isMinimized=false;this.minWidth='';this.movement=false;this.numberOfSources=0;this.numberOfTargets=0;this.potentialArrow=null;this.initialPos=null;this.isGhost=isGhost;this.readOnlyEndpoints=0;this.readOnly=false;if(manager instanceof Wirecloud.ui.WiringEditor.ArrowCreator){this.isMiniInterface=false;this.arrowCreator=manager;}else{this.isMiniInterface=true;this.arrowCreator=null;}
if(!this.isMiniInterface){if(className=='iwidget'){type='widget';this.version=this.entity.version;this.vendor=this.entity.vendor;this.name=this.entity.name;}else{type='operator';this.version=this.entity.meta.version;this.vendor=this.entity.meta.vendor;this.name=this.entity.meta.name;}
this.resourcesDiv=new StyledElements.BorderLayout({'class':"geContainer"});this.sourceDiv=this.resourcesDiv.getEastContainer();this.sourceDiv.addClassName("sources");this.targetDiv=this.resourcesDiv.getWestContainer();this.targetDiv.addClassName("targets");this.header=this.resourcesDiv.getNorthContainer();this.header.addClassName('header');this.wrapperElement.appendChild(this.resourcesDiv.wrapperElement);if(isGhost){this.vendor=this.entity.name.split('/')[0];this.name=this.entity.name.split('/')[1];this.version=new Wirecloud.Version(this.entity.name.split('/')[2].trim());this.wrapperElement.classList.add('ghost');ghostNotification=document.createElement("span");ghostNotification.classList.add('ghostNotification');msg=gettext('Warning: %(type)s not found!');msg=interpolate(msg,{type:type},true);ghostNotification.textContent=msg;this.header.appendChild(ghostNotification);}
if(type=='operator'&&this.wiringEditor.operatorVersions[this.vendor+'/'+this.name]&&this.wiringEditor.operatorVersions[this.vendor+'/'+this.name].lastVersion.compareTo(this.version)>0){this.versionStatus=document.createElement("span");this.versionStatus.classList.add('status');this.versionStatus.classList.add('icon-exclamation-sign');this.versionStatus.setAttribute('title','Outdated Version ('+this.version.text+')');this.header.appendChild(this.versionStatus);this.wrapperElement.classList.add('old')}
this.nameElement=document.createElement("span");this.nameElement.textContent=title;this.nameElement.title=title;this.header.appendChild(this.nameElement);del_button=new StyledElements.StyledButton({'title':gettext("Remove"),'class':'closebutton icon-remove','plain':true});del_button.insertInto(this.header);del_button.addEventListener('click',function(){if(this.readOnly==true){return;}
if(className=='iwidget'){this.wiringEditor.events.widgetremoved.dispatch(this);}else{this.wiringEditor.events.operatorremoved.dispatch(this);}}.bind(this));this.log_button=new StyledElements.StyledButton({'plain':true,'class':'logbutton icon-warning-sign'});if(!isGhost){this.log_button.addEventListener("click",function(){var dialog=new Wirecloud.ui.LogWindowMenu(this.entity.logManager);dialog.show();}.bind(this));updateErrorInfo.call(this);this.entity.logManager.addEventListener('newentry',updateErrorInfo.bind(this));}else{this.log_button.disable();}
this.log_button.insertInto(this.header);this.iconAux=document.createElement("div");this.iconAux.classList.add("specialIcon");this.iconAux.classList.add("icon-cogs");this.iconAux.setAttribute('title',title);this.resourcesDiv.wrapperElement.appendChild(this.iconAux);this.iconAux.addEventListener('click',function(){if(!this.movement){this.restore();}}.bind(this));this.menu_button=new StyledElements.PopupButton({'title':gettext("Menu"),'class':'editPos_button icon-cog','plain':true});this.menu_button.insertInto(this.header);this.menu_button.popup_menu.append(new Wirecloud.ui.WiringEditor.GenericInterfaceSettingsMenuItems(this));}else{this.header=document.createElement("div");this.header.classList.add('header');this.wrapperElement.appendChild(this.header);this.nameElement=document.createElement("span");this.nameElement.textContent=title;this.header.appendChild(this.nameElement);this.miniStatus=document.createElement("span");this.miniStatus.classList.add('status');this.miniStatus.classList.add('icon-exclamation-sign');this.miniStatus.setAttribute('title',gettext('Warning! this is an old version of the operator, click to change the version'));this._miniwidgetMenu_button_callback=function _miniwidgetMenu_button_callback(e){e.stopPropagation();if(this.contextmenu.isVisible()){this.contextmenu.hide();}else{this.contextmenu.show(this.wrapperElement.getBoundingClientRect());}
return;}.bind(this);this.miniStatus.addEventListener('mousedown',Wirecloud.Utils.stopPropagationListener,false);this.miniStatus.addEventListener('click',this._miniwidgetMenu_button_callback,false);this.miniStatus.addEventListener('contextmenu',this._miniwidgetMenu_button_callback,false);this.header.appendChild(this.miniStatus);if(className=='ioperator'){this.contextmenu=new StyledElements.PopupMenu({'position':['bottom-left','top-left']});this._miniwidgetMenu_callback=function _miniwidgetMenu_callback(e){e.stopPropagation();if(e.button===2){if(this.contextmenu.isVisible()){this.contextmenu.hide();}else{this.contextmenu.show(this.wrapperElement.getBoundingClientRect());}
return;}}.bind(this);this.wrapperElement.addEventListener('mousedown',this._miniwidgetMenu_callback,false);this.contextmenu.append(new Wirecloud.ui.WiringEditor.MiniInterfaceSettingsMenuItems(this));}
this.wrapperElement.addEventListener('contextmenu',Wirecloud.Utils.preventDefaultListener);}
if(!this.isMiniInterface){this.makeDraggable();}else{this.draggable=new Wirecloud.ui.Draggable(this.wrapperElement,{iObject:this},function onStart(draggable,context){var miniwidget_clon,pos_miniwidget,headerHeight;headerHeight=context.iObject.wiringEditor.getBoundingClientRect().top;pos_miniwidget=context.iObject.getBoundingClientRect();context.y=pos_miniwidget.top-(headerHeight);context.x=pos_miniwidget.left;if(context.iObject instanceof Wirecloud.ui.WiringEditor.WidgetInterface){miniwidget_clon=new Wirecloud.ui.WiringEditor.WidgetInterface(context.iObject.wiringEditor,context.iObject.iwidget,context.iObject.wiringEditor,true);}else{miniwidget_clon=new Wirecloud.ui.WiringEditor.OperatorInterface(context.iObject.wiringEditor,context.iObject.ioperator,context.iObject.wiringEditor,true);}
miniwidget_clon.addClassName('clon');miniwidget_clon.setBoundingClientRect(pos_miniwidget,{top:-headerHeight,left:0,width:-2,height:-10});context.iObject.wiringEditor.layout.wrapperElement.appendChild(miniwidget_clon.wrapperElement);context.iObjectClon=miniwidget_clon;},function onDrag(e,draggable,context,xDelta,yDelta){context.iObjectClon.setPosition({posX:context.x+xDelta,posY:context.y+yDelta});context.iObjectClon.repaint();},this.onFinish.bind(this),function(){return this.enabled&&!this.wrapperElement.classList.contains('clon');}.bind(this));}};GenericInterface.prototype=new StyledElements.Container({'extending':true});var getElementPos=function getElementPos(elemList,elem){var i;for(i=0;i<elemList.length;i++){if(elem===elemList[i]){return i;}}};var isEmpty=function isEmpty(obj){for(var key in obj){return false;}
return true;};var createMulticonnector=function createMulticonnector(name,anchor){var multiconnector;multiconnector=new Wirecloud.ui.WiringEditor.Multiconnector(this.wiringEditor.nextMulticonnectorId,this.getId(),name,this.wiringEditor.layout.getCenterContainer().wrapperElement,this.wiringEditor,anchor,null,null);this.wiringEditor.nextMulticonnectorId=parseInt(this.wiringEditor.nextMulticonnectorId,10)+1;this.wiringEditor.addMulticonnector(multiconnector);multiconnector.addMainArrow();};var OutputSubendpoint=function OutputSubendpoint(name,description,iwidget,type){var nameList,subdata,i;this.iwidget=iwidget;this.name=name;this.subdata=description.subdata;this.variable=description;this.type=type;this.friendcode=description.friendcode;nameList=name.split('/');subdata=JSON.parse(description.subdata);for(i=1;i<nameList.length;i++){if(nameList[0]==nameList[1]){break;}
subdata=subdata[nameList[i]];this.friendcode=subdata.semanticType;subdata=subdata.subdata;}};OutputSubendpoint.prototype.serialize=function serialize(){return{'type':this.type,'id':this.iwidget.id,'endpoint':this.name};};var setlabelActionListeners=function setlabelActionListeners(labelActionLayer,checkbox){labelActionLayer.addEventListener('mouseover',function(thecheckbox){this.wiringEditor.recommendations.emphasize(thecheckbox);}.bind(this,checkbox),false);labelActionLayer.addEventListener('mouseout',function(thecheckbox){this.wiringEditor.recommendations.deemphasize(thecheckbox);}.bind(this,checkbox),false);checkbox.wrapperElement.addEventListener('mouseover',function(thecheckbox){this.wiringEditor.recommendations.emphasize(thecheckbox);}.bind(this,checkbox),false);checkbox.wrapperElement.addEventListener('mouseout',function(thecheckbox){this.wiringEditor.recommendations.deemphasize(thecheckbox);}.bind(this,checkbox),false);labelActionLayer.addEventListener('mouseover',checkbox._mouseover_callback,false);labelActionLayer.addEventListener('mouseout',checkbox._mouseout_callback,false);labelActionLayer.addEventListener('mouseup',checkbox._mouseup_callback,false);};var formatTree=function(treeDiv,entityWidth){var heightPerLeaf,branchList,i,j,nleafsAux,desp,checkbox,label,height,firstFrame,firstTree,width,diff,treeWidth,actionLayer,bounding,treeBounding,leafs,lastTop,subtrees;firstFrame=treeDiv.getElementsByClassName("labelsFrame")[0];firstTree=treeDiv.getElementsByClassName("tree")[0];diff=(firstTree.getBoundingClientRect().top-firstFrame.getBoundingClientRect().top);if(diff==-10){return;}
firstFrame.style.top=diff+10+'px';height=firstFrame.getBoundingClientRect().height+10;width=firstFrame.getBoundingClientRect().width;firstTree.style.height=height+10+'px';treeWidth=treeDiv.getBoundingClientRect().width;if(treeWidth<entityWidth-14){treeDiv.style.width=entityWidth-14+'px';treeDiv.style.left=7+'px';}
treeDiv.style.height=height+'px';leafs=treeDiv.getElementsByClassName('leaf');heightPerLeaf=height/leafs.length;branchList=treeDiv.getElementsByClassName("dataTree branch");for(i=0;i<branchList.length;i++){nleafsAux=branchList[i].getElementsByClassName('leaf').length;desp=-(((nleafsAux/2)*heightPerLeaf)-(heightPerLeaf/2));label=branchList[i].getElementsByClassName('labelTree')[branchList[i].getElementsByClassName('labelTree').length-1];checkbox=branchList[i].getElementsByClassName('subAnchor')[branchList[i].getElementsByClassName('subAnchor').length-1];label.style.top=desp+'px';checkbox.style.top=desp+'px';treeBounding=branchList[i].getBoundingClientRect();if(i==0){lastTop=treeBounding.top;}
actionLayer=branchList[i].nextElementSibling;bounding=label.getBoundingClientRect();actionLayer.style.height=bounding.height+'px';actionLayer.style.width=bounding.width+'px';actionLayer.style.left=(bounding.left-treeBounding.left)+'px';actionLayer.style.top=Math.abs(lastTop-bounding.top)+'px';lastTop=treeBounding.top+1;setLeafActionLayers(branchList[i].parentNode.children);if(branchList[i].getElementsByClassName("dataTree branch").length==0){subtrees=branchList[i].getElementsByClassName('subTree');for(j=0;j<subtrees.length;j++){setLeafActionLayers(subtrees[j].getElementsByClassName('labelsFrame')[0].children);}}}};var setLeafActionLayers=function setLeafActionLayers(brothers){var acumulatedTop,j,treeBounding,bounding,actionLayer;acumulatedTop=5;for(j=0;j<brothers.length;j+=2){treeBounding=brothers[j].getBoundingClientRect();if(brothers[j].hasClassName('dataTree leaf')){bounding=brothers[j].getElementsByClassName('labelTree')[0].getBoundingClientRect();actionLayer=brothers[j].nextElementSibling;actionLayer.style.height=bounding.height+'px';actionLayer.style.width=bounding.width+'px';actionLayer.style.left=(bounding.left-treeBounding.left)+'px';actionLayer.style.top=acumulatedTop+'px';}
acumulatedTop+=treeBounding.height;}};GenericInterface.prototype.makeDraggable=function makeDraggable(){this.draggable=new Wirecloud.ui.Draggable(this.wrapperElement,{iObject:this},function onStart(draggable,context){context.y=context.iObject.wrapperElement.style.top===""?0:parseInt(context.iObject.wrapperElement.style.top,10);context.x=context.iObject.wrapperElement.style.left===""?0:parseInt(context.iObject.wrapperElement.style.left,10);context.preselected=context.iObject.selected;context.iObject.select(true);context.iObject.wiringEditor.onStarDragSelected();},function onDrag(e,draggable,context,xDelta,yDelta){context.iObject.setPosition({posX:context.x+xDelta,posY:context.y+yDelta});context.iObject.repaint();context.iObject.wiringEditor.onDragSelectedObjects(xDelta,yDelta);},function onFinish(draggable,context){context.iObject.wiringEditor.onFinishSelectedObjects();var position=context.iObject.getStylePosition();if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
context.iObject.setPosition(position);context.iObject.repaint();if((Math.abs(context.x-position.posX)<2)&&(Math.abs(context.y-position.posY)<2)){if(context.preselected){context.iObject.unselect(true);}
context.iObject.movement=false;}else{if(!context.preselected){context.iObject.unselect(true);}
context.iObject.movement=true;}},function(){return true;});};GenericInterface.prototype.makeSlotsDraggable=function makeSlotsDraggable(){var i;for(i=0;i<this.draggableSources.length;i++){this.makeSlotDraggable(this.draggableSources[i],this.wiringEditor.layout.center,'source_clon');}
for(i=0;i<this.draggableTargets.length;i++){this.makeSlotDraggable(this.draggableTargets[i],this.wiringEditor.layout.center,'target_clon');}};GenericInterface.prototype.makeSlotDraggable=function makeSlotDraggable(element,place,className){element.draggable=new Wirecloud.ui.Draggable(element.wrapperElement,{iObject:element,genInterface:this,wiringEditor:this.wiringEditor},function onStart(draggable,context){var clon,pos_miniwidget,gridbounds,childsN,childPos;pos_miniwidget=context.iObject.wrapperElement.getBoundingClientRect();gridbounds=context.wiringEditor.getGridElement().getBoundingClientRect();context.y=pos_miniwidget.top-gridbounds.top;context.x=pos_miniwidget.left-gridbounds.left;context.iObject.wrapperElement.classList.add('moving');clon=context.iObject.wrapperElement.cloneNode(true);clon.classList.add(className);place.wrapperElement.appendChild(clon);clon.style.height=(pos_miniwidget.height)+'px';clon.style.left=(context.x)+'px';clon.style.top=(context.y)+'px';clon.style.width=(pos_miniwidget.width)+'px';context.iObjectClon=clon;context.refHeigth=context.iObject.wrapperElement.getBoundingClientRect().height+2;context.refHeigthUp=context.refHeigth;context.refHeigthDown=context.refHeigth;childsN=context.iObject.wrapperElement.parentNode.childElementCount;childPos=getElementPos(context.iObject.wrapperElement.parentNode.children,context.iObject.wrapperElement);context.maxUps=childPos;context.maxDowns=childsN-(childPos+1);},function onDrag(e,draggable,context,xDelta,yDelta){var top;context.iObjectClon.style.left=(context.x+xDelta)+'px';context.iObjectClon.style.top=(context.y+yDelta)+'px';top=parseInt(context.iObjectClon.style.top,10);if(((context.y-top)>context.refHeigthUp)&&(context.maxUps>0)){context.maxDowns+=1;context.maxUps-=1;context.refHeigthUp+=context.refHeigth;context.refHeigthDown-=context.refHeigth;context.genInterface.up(context.iObject);}else if(((top-context.y)>context.refHeigthDown)&&(context.maxDowns>0)){context.maxUps+=1;context.maxDowns-=1;context.refHeigthDown+=context.refHeigth;context.refHeigthUp-=context.refHeigth;context.genInterface.down(context.iObject);}},function onFinish(draggable,context){context.iObject.wrapperElement.classList.remove('moving');if(context.iObjectClon.parentNode){context.iObjectClon.parentNode.removeChild(context.iObjectClon);}
context.iObjectClon=null;},function(){return true;});};GenericInterface.prototype.getPosition=function getPosition(){var coordinates={posX:this.wrapperElement.offsetLeft,posY:this.wrapperElement.offsetTop};return coordinates;};GenericInterface.prototype.getStylePosition=function getStylePosition(){var coordinates;coordinates={posX:parseInt(this.wrapperElement.style.left,10),posY:parseInt(this.wrapperElement.style.top,10)};return coordinates;};GenericInterface.prototype.getAnchor=function getAnchor(name){if(name in this.sourceAnchorsByName){return this.sourceAnchorsByName[name];}else if(name in this.targetAnchorsByName){return this.targetAnchorsByName[name];}else{return null;}};GenericInterface.prototype.addGhostEndpoint=function addGhostEndpoint(theEndpoint,isSource){var context;if(isSource){context={'data':new Wirecloud.wiring.GhostSourceEndpoint(theEndpoint,this.entity),'iObject':this};this.addSource(theEndpoint.endpoint,'',theEndpoint.endpoint,context,true);return this.sourceAnchorsByName[theEndpoint.endpoint];}else{context={'data':new Wirecloud.wiring.GhostTargetEndpoint(theEndpoint,this.entity),'iObject':this};this.addTarget(theEndpoint.endpoint,'',theEndpoint.endpoint,context,true);return this.targetAnchorsByName[theEndpoint.endpoint];}};GenericInterface.prototype.setPosition=function setPosition(coordinates){this.wrapperElement.style.left=coordinates.posX+'px';this.wrapperElement.style.top=coordinates.posY+'px';};GenericInterface.prototype.setBoundingClientRect=function setBoundingClientRect(BoundingClientRect,move){this.wrapperElement.style.height=(BoundingClientRect.height+move.height)+'px';this.wrapperElement.style.left=(BoundingClientRect.left+move.left)+'px';this.wrapperElement.style.top=(BoundingClientRect.top+move.top)+'px';this.wrapperElement.style.width=(BoundingClientRect.width+move.width)+'px';};GenericInterface.prototype.setMenubarPosition=function setMenubarPosition(menubarPosition){this.menubarPosition=menubarPosition;};GenericInterface.prototype.getMenubarPosition=function getMenubarPosition(){return this.menubarPosition;};GenericInterface.prototype.incReadOnlyConnectionsCount=function incReadOnlyConnectionsCount(){this.readOnlyEndpoints+=1;this.readOnly=true;};GenericInterface.prototype.reduceReadOnlyConnectionsCount=function reduceReadOnlyConnectionsCount(){this.readOnlyEndpoints-=1;if(this.readOnlyEndpoints==0){this.readOnly=false;}};GenericInterface.prototype.repaint=function repaint(temporal){var key;StyledElements.Container.prototype.repaint.apply(this,arguments);for(key in this.sourceAnchorsByName){this.sourceAnchorsByName[key].repaint(temporal);}
for(key in this.targetAnchorsByName){this.targetAnchorsByName[key].repaint(temporal);}};GenericInterface.prototype.generateSubTree=function generateSubTree(anchorContext,subAnchors){var treeFrame,key,lab,checkbox,subdata,subTree,labelsFrame,context,name,labelActionLayer,entity,type;treeFrame=document.createElement("div");treeFrame.classList.add('subTree');labelsFrame=document.createElement("div");labelsFrame.classList.add('labelsFrame');treeFrame.appendChild(labelsFrame);if(!isEmpty(subAnchors.subdata)){for(key in subAnchors.subdata){lab=document.createElement("span");lab.classList.add("labelTree");lab.textContent=subAnchors.subdata[key].label;name=anchorContext.data.name+"/"+key;if(anchorContext.data.iwidget!=null){entity=anchorContext.data.iwidget;type='iwidget';}else{entity=anchorContext.data.operator;type='ioperator';}
context={'data':new OutputSubendpoint(name,anchorContext.data,entity,type),'iObject':this};checkbox=new Wirecloud.ui.WiringEditor.SourceAnchor(context,anchorContext.iObject.arrowCreator,subAnchors.subdata[key]);checkbox.wrapperElement.classList.add("subAnchor");checkbox.wrapperElement.classList.add("icon-circle");this.sourceAnchorsByName[name]=checkbox;this.sourceAnchors.push(checkbox);subdata=document.createElement("div");subdata.classList.add("dataTree");labelActionLayer=document.createElement("div");labelActionLayer.classList.add("labelActionLayer");setlabelActionListeners.call(this,labelActionLayer,checkbox);subTree=this.generateSubTree(context,subAnchors.subdata[key],checkbox);if(subTree!==null){subdata.appendChild(subTree);subdata.classList.add("branch");}else{subdata.classList.add("leaf");}
subdata.appendChild(lab);subdata.appendChild(checkbox.wrapperElement);labelsFrame.appendChild(subdata);labelsFrame.appendChild(labelActionLayer);}
return treeFrame;}else{return null;}};GenericInterface.prototype.generateTree=function generateTree(anchor,name,anchorContext,subtree,label,closeHandler){var subAnchors,treeFrame,lab,checkbox,subdata,key,subTree,subTreeFrame,type,labelsFrame,labelMain,close_button,context,name,labelActionLayer,entity,treeDiv;treeDiv=document.createElement("div");treeDiv.classList.add('anchorTree');treeDiv.addEventListener('click',function(e){e.stopPropagation();}.bind(this),false);treeDiv.addEventListener('mousedown',function(e){e.stopPropagation();}.bind(this),false);treeFrame=document.createElement("div");treeFrame.classList.add('tree');treeFrame.classList.add('sources');close_button=new StyledElements.StyledButton({'title':gettext("Hide"),'class':'hideTreeButton icon-off','plain':true});close_button.insertInto(treeFrame);close_button.addEventListener('click',function(){closeHandler();},false);subAnchors=JSON.parse(subtree);subTreeFrame=null;labelsFrame=document.createElement("div");labelsFrame.classList.add('labelsFrame');if(subAnchors!==null){subTreeFrame=document.createElement("div");subTreeFrame.classList.add('subTree');for(key in subAnchors){lab=document.createElement("span");lab.classList.add("labelTree");lab.textContent=subAnchors[key].label;name=anchorContext.data.name+"/"+key;if(anchorContext.data.iwidget!=null){entity=anchorContext.data.iwidget;type='iwidget';}else{entity=anchorContext.data.operator;type='ioperator';}
context={'data':new OutputSubendpoint(name,anchorContext.data,entity,type),'iObject':this};checkbox=new Wirecloud.ui.WiringEditor.SourceAnchor(context,anchorContext.iObject.arrowCreator,subAnchors[key]);checkbox.wrapperElement.classList.add("subAnchor");checkbox.wrapperElement.classList.add("icon-circle");this.sourceAnchorsByName[name]=checkbox;this.sourceAnchors.push(checkbox);subdata=document.createElement("div");subdata.classList.add("dataTree");labelActionLayer=document.createElement("div");labelActionLayer.classList.add("labelActionLayer");setlabelActionListeners.call(this,labelActionLayer,checkbox);subTree=this.generateSubTree(context,subAnchors[key],checkbox);if(subTree!==null){subdata.appendChild(subTree);subdata.classList.add("branch");}else{subdata.classList.add("leaf");}
subdata.appendChild(lab);subdata.appendChild(checkbox.wrapperElement);labelsFrame.appendChild(subdata);labelsFrame.appendChild(labelActionLayer);subTreeFrame.appendChild(labelsFrame);}}
lab=document.createElement("span");lab.classList.add("labelTree");lab.textContent=label;name=anchorContext.data.name+"/"+anchorContext.data.name;if(anchorContext.data.iwidget!=null){entity=anchorContext.data.iwidget;type='iwidget';}else{entity=anchorContext.data.operator;type='ioperator';}
context={'data':new OutputSubendpoint(name,anchorContext.data,entity,type),'iObject':this};checkbox=new Wirecloud.ui.WiringEditor.SourceAnchor(context,anchorContext.iObject.arrowCreator,subAnchors);checkbox.wrapperElement.classList.add("subAnchor");checkbox.wrapperElement.classList.add("icon-circle");this.sourceAnchorsByName[name]=checkbox;this.sourceAnchors.push(checkbox);subdata=document.createElement("div");subdata.classList.add("dataTree");labelActionLayer=document.createElement("div");labelActionLayer.classList.add("labelActionLayer");setlabelActionListeners.call(this,labelActionLayer,checkbox);if(subTreeFrame!==null){subdata.appendChild(subTreeFrame);subdata.classList.add("branch");}else{subdata.classList.add("leaf");}
subdata.appendChild(lab);subdata.appendChild(checkbox.wrapperElement);labelMain=document.createElement("div");labelMain.classList.add('labelsFrame');labelMain.appendChild(subdata);labelMain.appendChild(labelActionLayer);treeFrame.appendChild(labelMain);treeDiv.appendChild(treeFrame);this.wrapperElement.appendChild(treeDiv);anchor.menu.append(new StyledElements.MenuItem(gettext("Unfold data structure"),this.subdataHandler.bind(this,treeDiv,name)));};GenericInterface.prototype.subdataHandler=function subdataHandler(treeDiv,name){var initialHeiht,initialWidth,key,i,externalRep,layer,subDataArrow,firstIndex,mainEndpoint,mainSubEndPoint,theArrow,mainEndpointArrows;if(treeDiv==null){this.wiringEditor.canvas.canvasElement.classList.remove("elevated");this.activatedTree.classList.remove('activated');this.activatedTree=null;this.wrapperElement.classList.remove('subdataMode');if(!isEmpty(this.subdataConnections[name])){for(key in this.subdataConnections[name]){firstIndex=this.subdataConnections[name][key].length-1;for(i=firstIndex;i>=0;i-=1){externalRep=this.subdataConnections[name][key][i].externalRep;subDataArrow=this.subdataConnections[name][key][i].subDataArrow;externalRep.show();if(externalRep.hasClassName('hollow')){subDataArrow.hide();}else{subDataArrow.destroy();this.subdataConnections[name][key].splice(i,1);this.fullConnections[name][key].splice(this.fullConnections[name][key].indexOf(externalRep),1);}}}}}else{this.wiringEditor.canvas.canvasElement.classList.add("elevated");initialWidth=this.wrapperElement.getBoundingClientRect().width;treeDiv.classList.add('activated');this.activatedTree=treeDiv;formatTree(treeDiv,initialWidth);this.wrapperElement.classList.add('subdataMode');layer=this.wiringEditor.arrowCreator.layer;mainEndpoint=this.sourceAnchorsByName[name];mainSubEndPoint=this.sourceAnchorsByName[name+"/"+name];mainEndpointArrows=mainEndpoint.getArrows();for(i=0;i<mainEndpointArrows.length;i+=1){if(!mainEndpointArrows[i].hasClassName('hollow')){theArrow=this.wiringEditor.canvas.drawArrow(mainSubEndPoint.getCoordinates(layer),mainEndpointArrows[i].endAnchor.getCoordinates(layer),"arrow subdataConnection full");theArrow.setEndAnchor(mainEndpointArrows[i].endAnchor);theArrow.setStartAnchor(mainSubEndPoint);mainSubEndPoint.addArrow(theArrow);mainEndpointArrows[i].endAnchor.addArrow(theArrow);if(this.subdataConnections[name]==null){this.subdataConnections[name]={};}
if(this.subdataConnections[name][name+"/"+name]==null){this.subdataConnections[name][name+"/"+name]=[];}
this.subdataConnections[name][name+"/"+name].push({'subDataArrow':theArrow,'externalRep':mainEndpointArrows[i]});if(this.fullConnections[name]==null){this.fullConnections[name]={};}
if(this.fullConnections[name][name+"/"+name]==null){this.fullConnections[name][name+"/"+name]=[];}
this.fullConnections[name][name+"/"+name].push(mainEndpointArrows[i]);}}
for(key in this.subdataConnections[name]){for(i=0;i<this.subdataConnections[name][key].length;i+=1){this.subdataConnections[name][key][i].externalRep.hide();this.subdataConnections[name][key][i].subDataArrow.show();}}}
this.repaint();this.wiringEditor.activatedTree=this.activatedTree;};GenericInterface.prototype.addSubdataConnection=function addSubdataConnection(endpoint,subdatakey,connection,sourceAnchor,targetAnchor,isLoadingWiring){var theArrow,mainEndpoint,layer;if(this.subdataConnections[endpoint]==null){this.subdataConnections[endpoint]={};}
if(this.subdataConnections[endpoint][subdatakey]==null){this.subdataConnections[endpoint][subdatakey]=[];}
layer=this.wiringEditor.arrowCreator.layer;mainEndpoint=this.sourceAnchorsByName[endpoint];if((endpoint+"/"+endpoint)==subdatakey){if(this.fullConnections[endpoint]==null){this.fullConnections[endpoint]={};}
if(this.fullConnections[endpoint][subdatakey]==null){this.fullConnections[endpoint][subdatakey]=[];}
connection.addClassName('full');theArrow=this.wiringEditor.canvas.drawArrow(mainEndpoint.getCoordinates(layer),targetAnchor.getCoordinates(layer),"arrow");this.fullConnections[endpoint][subdatakey].push(theArrow);}else{if(this.hollowConnections[endpoint]==null){this.hollowConnections[endpoint]={};}
if(this.hollowConnections[endpoint][subdatakey]==null){this.hollowConnections[endpoint][subdatakey]=[];}
theArrow=this.wiringEditor.canvas.drawArrow(mainEndpoint.getCoordinates(layer),targetAnchor.getCoordinates(layer),"arrow hollow");this.hollowConnections[endpoint][subdatakey].push(theArrow);}
theArrow.setEndAnchor(targetAnchor);theArrow.setStartAnchor(mainEndpoint);mainEndpoint.addArrow(theArrow);targetAnchor.addArrow(theArrow);if(isLoadingWiring){connection.hide();}else{theArrow.hide();}
this.subdataConnections[endpoint][subdatakey].push({'subDataArrow':connection,'externalRep':theArrow});};GenericInterface.prototype.removeSubdataConnection=function removeSubdataConnection(endpoint,subdatakey,connection){var i,externalRep;if((endpoint+"/"+endpoint)==subdatakey){if(this.fullConnections[endpoint]!=null&&this.fullConnections[endpoint][subdatakey]!=null){for(i=0;i<this.subdataConnections[endpoint][subdatakey].length;i+=1){if(this.subdataConnections[endpoint][subdatakey][i].subDataArrow==connection){externalRep=this.subdataConnections[endpoint][subdatakey][i].externalRep;this.fullConnections[endpoint][subdatakey].splice(this.fullConnections[endpoint][subdatakey].indexOf(externalRep),1);externalRep.destroy();connection.destroy();this.subdataConnections[endpoint][subdatakey].splice(i,1);break;}}}else{}}else{if(this.hollowConnections[endpoint]!=null&&this.hollowConnections[endpoint][subdatakey]!=null){for(i=0;i<this.subdataConnections[endpoint][subdatakey].length;i+=1){if(this.subdataConnections[endpoint][subdatakey][i].subDataArrow==connection){externalRep=this.subdataConnections[endpoint][subdatakey][i].externalRep;this.hollowConnections[endpoint][subdatakey].splice(this.hollowConnections[endpoint][subdatakey].indexOf(externalRep),1);externalRep.destroy();connection.destroy();this.subdataConnections[endpoint][subdatakey].splice(i,1);break;}}}else{}}};GenericInterface.prototype.addSource=function addSource(label,desc,name,anchorContext,isGhost){var anchor,anchorDiv,labelDiv,anchorLabel,treeDiv,subAnchors;this.numberOfSources+=1;anchorDiv=document.createElement("div");if(desc===''){desc=label;}
if(isGhost){anchorDiv.setAttribute('title',gettext("Mismatch endpoint! ")+label);}else{anchorDiv.setAttribute('title',label+': '+desc);}
anchorDiv.classList.add('anchorDiv');if(isGhost){anchorDiv.classList.add('ghost');}
anchorLabel=document.createElement("span");anchorLabel.textContent=label;labelDiv=document.createElement("div");anchorDiv.appendChild(labelDiv);labelDiv.setAttribute('class','labelDiv');labelDiv.appendChild(anchorLabel);if(!this.isMiniInterface){anchor=new Wirecloud.ui.WiringEditor.SourceAnchor(anchorContext,this.arrowCreator,null,isGhost);labelDiv.appendChild(anchor.wrapperElement);anchor.menu.append(new StyledElements.MenuItem(gettext('Add multiconnector'),createMulticonnector.bind(this,name,anchor)));subAnchors=anchorContext.data.subdata;if(subAnchors!=null){this.generateTree(anchor,name,anchorContext,subAnchors,label,this.subdataHandler.bind(this,null,name));}
labelDiv.addEventListener('mouseover',function(){this.wiringEditor.recommendations.emphasize(anchor);}.bind(this));labelDiv.addEventListener('mouseout',function(){this.wiringEditor.recommendations.deemphasize(anchor);}.bind(this));anchorDiv.addEventListener('mouseover',function(e){anchor._mouseover_callback(e);}.bind(this));anchorDiv.addEventListener('mouseout',function(e){anchor._mouseout_callback(e);}.bind(this));anchorDiv.addEventListener('mouseup',function(e){anchor._mouseup_callback(e);}.bind(this));this.sourceAnchorsByName[name]=anchor;this.sourceAnchors.push(anchor);}
this.sourceDiv.appendChild(anchorDiv);this.draggableSources.push({'wrapperElement':anchorDiv,'context':anchorContext});};GenericInterface.prototype.addTarget=function addTarget(label,desc,name,anchorContext,isGhost){var anchor,anchorDiv,labelDiv,anchorLabel;this.numberOfTargets+=1;anchorDiv=document.createElement("div");if(desc===''){desc=label;}
if(isGhost){anchorDiv.setAttribute('title',gettext('Mismatch endpoint! ')+label);}else{anchorDiv.setAttribute('title',label+': '+desc);}
anchorDiv.classList.add('anchorDiv');if(isGhost){anchorDiv.classList.add('ghost');}
anchorLabel=document.createElement("span");anchorLabel.textContent=label;labelDiv=document.createElement("div");anchorDiv.appendChild(labelDiv);labelDiv.setAttribute('class','labelDiv');labelDiv.appendChild(anchorLabel);if(!this.isMiniInterface){anchor=new Wirecloud.ui.WiringEditor.TargetAnchor(anchorContext,this.arrowCreator,isGhost);labelDiv.appendChild(anchor.wrapperElement);anchor.menu.append(new StyledElements.MenuItem(gettext('Add multiconnector'),createMulticonnector.bind(this,name,anchor)));labelDiv.addEventListener('mouseover',function(){if(!this.wiringEditor.recommendationsActivated){this.wiringEditor.recommendations.emphasize(anchor);}}.bind(this));labelDiv.addEventListener('mouseout',function(){if(!this.wiringEditor.recommendationsActivated){this.wiringEditor.recommendations.deemphasize(anchor);}}.bind(this));anchorDiv.addEventListener('mouseover',function(e){anchor._mouseover_callback(e);}.bind(this));anchorDiv.addEventListener('mouseout',function(e){anchor._mouseout_callback(e);}.bind(this));anchorDiv.addEventListener('mouseup',function(e){anchor._mouseup_callback(e);}.bind(this));this.targetAnchorsByName[name]=anchor;this.targetAnchors.push(anchor);}
this.targetDiv.appendChild(anchorDiv);this.draggableTargets.push({'wrapperElement':anchorDiv,'context':anchorContext});};GenericInterface.prototype.addClassName=function addClassName(className){var atr;if(className==null){return;}
atr=this.wrapperElement.getAttribute('class');if(atr==null){atr='';}
this.wrapperElement.setAttribute('class',Wirecloud.Utils.appendWord(atr,className));};GenericInterface.prototype.removeClassName=function removeClassName(className){var atr;if(className==null){return;}
atr=this.wrapperElement.getAttribute('class');if(atr==null){atr='';}
this.wrapperElement.setAttribute('class',Wirecloud.Utils.removeWord(atr,className));};GenericInterface.prototype.select=function select(withCtrl){var i,j,arrows;if(this.hasClassName('disabled')){return;}
if(this.hasClassName('selected')){return;}
if(!(this.wiringEditor.ctrlPushed)&&(this.wiringEditor.selectedCount>0)&&(withCtrl)){this.wiringEditor.resetSelection();}
this.selected=true;this.addClassName('selected');for(i=0;i<this.targetAnchors.length;i+=1){arrows=this.targetAnchors[i].arrows;for(j=0;j<arrows.length;j+=1){arrows[j].emphasize();}}
for(i=0;i<this.sourceAnchors.length;i+=1){arrows=this.sourceAnchors[i].arrows;for(j=0;j<arrows.length;j+=1){arrows[j].emphasize();}}
this.wiringEditor.addSelectedObject(this);};GenericInterface.prototype.unselect=function unselect(withCtrl){var i,j,arrows;this.selected=false;this.removeClassName('selected');for(i=0;i<this.targetAnchors.length;i+=1){arrows=this.targetAnchors[i].arrows;for(j=0;j<arrows.length;j+=1){arrows[j].deemphasize();}}
for(i=0;i<this.sourceAnchors.length;i+=1){arrows=this.sourceAnchors[i].arrows;for(j=0;j<arrows.length;j+=1){arrows[j].deemphasize();}}
this.wiringEditor.removeSelectedObject(this);if(!(this.wiringEditor.ctrlPushed)&&(this.wiringEditor.selectedCount>0)&&(withCtrl)){this.wiringEditor.resetSelection();}};GenericInterface.prototype.destroy=function destroy(){var i,j,arrows;this.unselect();if(this.editingPos===true){this.disableEdit();}
StyledElements.Container.prototype.destroy.call(this);for(i=0;i<this.sourceAnchors.length;i+=1){arrows=this.sourceAnchors[i].arrows.slice(0);for(j=0;j<arrows.length;j+=1){if(!arrows[j].controlledDestruction()){arrows[j].destroy();}}
this.sourceAnchors[i].destroy();}
for(i=0;i<this.targetAnchors.length;i+=1){arrows=this.targetAnchors[i].arrows.slice(0);for(j=0;j<arrows.length;j+=1){if(!arrows[j].controlledDestruction()){arrows[j].destroy();}}
this.targetAnchors[i].destroy();}
this.draggable.destroy();this.draggable=null;this.draggableSources=null;this.draggableTargets=null;this.wrapperElement=null;this.hollowConnections=null;this.subdataConnections=null;};GenericInterface.prototype.editPos=function editPos(){var obj;obj=null;if((this.targetAnchors.length<=1)&&(this.sourceAnchors.length<=1)){return;}
if(this.editingPos===true){this.disableEdit();}else{this.enableEdit();obj=this;}
this.repaint();return obj;};GenericInterface.prototype.enableEdit=function enableEdit(){this.draggable.destroy();this.editingPos=true;this.sourceDiv.wrapperElement.classList.add("editing");this.targetDiv.wrapperElement.classList.add("editing");this.addClassName("editing");this.makeSlotsDraggable();};GenericInterface.prototype.disableEdit=function disableEdit(){var i;this.makeDraggable();this.editingPos=false;this.sourceDiv.wrapperElement.classList.remove("editing");this.targetDiv.wrapperElement.classList.remove("editing");this.removeClassName("editing");for(i=0;i<this.draggableSources.length;i++){this.draggableSources[i].draggable.destroy();}
for(i=0;i<this.draggableTargets.length;i++){this.draggableTargets[i].draggable.destroy();}};GenericInterface.prototype.up=function up(element){element.wrapperElement.parentNode.insertBefore(element.wrapperElement,element.wrapperElement.previousElementSibling);this.repaint();};GenericInterface.prototype.down=function down(element){if(element.wrapperElement.nextElementSibling!==null){element.wrapperElement.parentNode.insertBefore(element.wrapperElement,element.wrapperElement.nextElementSibling.nextElementSibling);this.repaint();}};GenericInterface.prototype.getInOutPositions=function getInOutPositions(){var i,sources,targets;sources=[];targets=[];for(i=0;i<this.sourceDiv.wrapperElement.childNodes.length;i++){sources[i]=this.getNameForSort(this.sourceDiv.wrapperElement.childNodes[i],'source');}
for(i=0;i<this.targetDiv.wrapperElement.childNodes.length;i++){targets[i]=this.getNameForSort(this.targetDiv.wrapperElement.childNodes[i],'target');}
return{'sources':sources,'targets':targets};};GenericInterface.prototype.getNameForSort=function getNameForSort(node,type){var i,collection;if(type==='source'){collection=this.draggableSources;}else{collection=this.draggableTargets;}
for(i=0;collection.length;i++){if(collection[i].wrapperElement===node){return collection[i].context.data.name;}}};GenericInterface.prototype.minimize=function minimize(omitEffects){var position,oc,scrollX,scrollY;if(!omitEffects){this.resizeTransitStart();}
this.initialPos=this.wrapperElement.getBoundingClientRect();this.minWidth=this.wrapperElement.style.minWidth;this.wrapperElement.classList.add('reducedInt');this.wrapperElement.style.minWidth='55px';oc=this.wiringEditor.layout.getCenterContainer();scrollX=parseInt(oc.wrapperElement.scrollLeft,10);scrollY=parseInt(oc.wrapperElement.scrollTop,10);this.wrapperElement.style.top=(this.initialPos.top+scrollY-this.wiringEditor.headerHeight)+((this.initialPos.height-8)/2)-12+'px';this.wrapperElement.style.left=(this.initialPos.left+scrollX-this.wiringEditor.menubarWidth)+(this.initialPos.width/2)-32+'px';position=this.getStylePosition();if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
this.setPosition(position);this.isMinimized=true;this.repaint();};GenericInterface.prototype.restore=function restore(omitEffects){var currentPos,position,oc,scrollX,scrollY;if(!omitEffects){this.resizeTransitStart();}
oc=this.wiringEditor.layout.getCenterContainer();scrollX=parseInt(oc.wrapperElement.scrollLeft,10)+1;scrollY=parseInt(oc.wrapperElement.scrollTop,10);currentPos=this.wrapperElement.getBoundingClientRect();this.wrapperElement.style.top=(currentPos.top+scrollY-this.wiringEditor.headerHeight)-((this.initialPos.height+8)/2)+'px';this.wrapperElement.style.left=(currentPos.left+scrollX-this.wiringEditor.menubarWidth)-(this.initialPos.width/2)+32+'px';position=this.getStylePosition();if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
this.setPosition(position);this.wrapperElement.style.minWidth=this.minWidth;this.wrapperElement.classList.remove('reducedInt');this.isMinimized=false;this.repaint();};GenericInterface.prototype.resizeTransitStart=function resizeTransitStart(){var interval;this.wrapperElement.classList.add('flex');interval=setInterval(this.animateArrows.bind(this),20);setTimeout(function(){clearInterval(interval);},400);setTimeout(function(){this.resizeTransitEnd();}.bind(this),450);};GenericInterface.prototype.resizeTransitEnd=function resizeTransitEnd(){this.wrapperElement.classList.remove('flex');this.repaint();};GenericInterface.prototype.animateArrows=function animateArrows(){var key,layer;for(key in this.sourceAnchorsByName){this.sourceAnchorsByName[key].repaint();}
for(key in this.targetAnchorsByName){this.targetAnchorsByName[key].repaint();}
if(this.potentialArrow!=null){layer=this.wiringEditor.canvas.getHTMLElement().parentNode;if(this.potentialArrow.startAnchor!=null){this.potentialArrow.setStart(this.potentialArrow.startAnchor.getCoordinates(layer));}else{this.potentialArrow.setEnd(this.potentialArrow.endAnchor.getCoordinates(layer));}}};Wirecloud.ui.WiringEditor.GenericInterface=GenericInterface;})();(function(){"use strict";var WidgetInterface=function WidgetInterface(wiringEditor,iwidget,manager,isMenubarRef,endPointPos){var outputs,inputs,desc,label,key,anchorContext,i,isGhost;outputs=[];inputs=[];if('internal_iwidget'in iwidget){iwidget=iwidget.internal_iwidget;}
this.iwidget=iwidget;this.wiringEditor=wiringEditor;if('ghost'in iwidget){isGhost=true;for(i=0;i<endPointPos.sources.length;i+=1){outputs[i]={'description':'','label':endPointPos.sources[i],'name':endPointPos.sources[i],'friendcode':'ghost'};}
for(i=0;i<endPointPos.targets.length;i+=1){inputs[i]={'description':'','label':endPointPos.targets[i],'name':endPointPos.targets[i],'friendcode':'ghost'};}}else{isGhost=false;}
Wirecloud.ui.WiringEditor.GenericInterface.call(this,false,wiringEditor,iwidget,this.iwidget.name,manager,'iwidget',isGhost);if(!isMenubarRef){if(!isGhost){if((endPointPos.sources.length>0)||(endPointPos.targets.length>0)){for(i=0;i<endPointPos.sources.length;i+=1){if(iwidget.outputs[endPointPos.sources[i]]){outputs.push(iwidget.outputs[endPointPos.sources[i]]);}else{outputs=iwidget.widget.outputList.map(function(output){return iwidget.outputs[output.name]});break;}}
for(i=0;i<endPointPos.targets.length;i+=1){if(iwidget.inputs[endPointPos.targets[i]]){inputs.push(iwidget.inputs[endPointPos.targets[i]]);}else{inputs=iwidget.widget.inputList.map(function(input){return iwidget.inputs[input.name]});break;}}}else{inputs=iwidget.widget.inputList.map(function(input){return iwidget.inputs[input.name]});outputs=iwidget.widget.outputList.map(function(output){return iwidget.outputs[output.name]});}}
for(i=0;i<outputs.length;i++){desc=outputs[i].description;label=outputs[i].label;anchorContext={'data':outputs[i],'iObject':this};this.addSource(label,desc,outputs[i].name,anchorContext);}
for(i=0;i<inputs.length;i++){desc=inputs[i].description;label=inputs[i].label;anchorContext={'data':inputs[i],'iObject':this};this.addTarget(label,desc,inputs[i].name,anchorContext);}}};WidgetInterface.prototype=new Wirecloud.ui.WiringEditor.GenericInterface(true);WidgetInterface.prototype.onFinish=function onFinish(draggable,data,e){var position,iwidget_interface,endPointPos,oc,scrollX,scrollY;position={posX:0,posY:0};position=data.iObjectClon.getPosition();if(!this.wiringEditor.withinGrid(e)){this.wiringEditor.layout.wrapperElement.removeChild(data.iObjectClon.wrapperElement);this.wiringEditor.events.widgetaddfail.dispatch();return;}
oc=this.wiringEditor.layout.getCenterContainer();scrollX=parseInt(oc.wrapperElement.scrollLeft,10);scrollY=parseInt(oc.wrapperElement.scrollTop,10);position.posX+=scrollX;position.posY+=scrollY;endPointPos={'sources':[],'targets':[]};iwidget_interface=this.wiringEditor.addIWidget(this.wiringEditor,this.iwidget,endPointPos);position.posX-=this.wiringEditor.getGridElement().getBoundingClientRect().left;if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
iwidget_interface.setPosition(position);this.wiringEditor.layout.wrapperElement.removeChild(data.iObjectClon.wrapperElement);this.disable();};WidgetInterface.prototype.getIWidget=function getIWidget(){return this.iwidget;};WidgetInterface.prototype.getId=function getId(){return this.iwidget.id;};Wirecloud.ui.WiringEditor.WidgetInterface=WidgetInterface;})();(function(){"use strict";var OperatorInterface=function OperatorInterface(wiringEditor,ioperator,manager,isMenubarRef,endPointPos){var outputs,inputs,desc,label,key,anchorContext,i,isGhost;outputs={};inputs={};this.ioperator=ioperator;this.wiringEditor=wiringEditor;isGhost=ioperator instanceof Wirecloud.wiring.GhostOperator;Wirecloud.ui.WiringEditor.GenericInterface.call(this,false,wiringEditor,ioperator,this.ioperator.title,manager,'ioperator',isGhost);if(!isMenubarRef){if((endPointPos.sources.length>0)||(endPointPos.targets.length>0)){for(i=0;i<endPointPos.sources.length;i+=1){if(ioperator.outputs[endPointPos.sources[i]]){outputs[endPointPos.sources[i]]=ioperator.outputs[endPointPos.sources[i]];}else{outputs=ioperator.outputs;break;}}
for(i=0;i<endPointPos.targets.length;i+=1){if(ioperator.inputs[endPointPos.targets[i]]){inputs[endPointPos.targets[i]]=ioperator.inputs[endPointPos.targets[i]];}else{inputs=ioperator.inputs;break;}}}else{inputs=ioperator.inputs;outputs=ioperator.outputs;}
for(key in outputs){desc=outputs[key].description;label=outputs[key].label;anchorContext={'data':outputs[key],'iObject':this};this.addSource(label,desc,outputs[key].name,anchorContext);}
for(key in inputs){desc=inputs[key].description;label=inputs[key].label;anchorContext={'data':inputs[key],'iObject':this};this.addTarget(label,desc,inputs[key].name,anchorContext);}}};OperatorInterface.prototype=new Wirecloud.ui.WiringEditor.GenericInterface(true);OperatorInterface.prototype.onFinish=function onFinish(draggable,data,e){var operator_interface,position,endPointPos,oc,scrollX,scrollY;position={posX:0,posY:0};position=data.iObjectClon.getPosition();oc=this.wiringEditor.layout.getCenterContainer();scrollX=parseInt(oc.wrapperElement.scrollLeft,10);scrollY=parseInt(oc.wrapperElement.scrollTop,10);position.posX+=scrollX;position.posY+=scrollY;if(!this.wiringEditor.withinGrid(e)){this.wiringEditor.layout.wrapperElement.removeChild(data.iObjectClon.wrapperElement);this.wiringEditor.events.operatoraddfail.dispatch();return;}
endPointPos={'sources':[],'targets':[]};operator_interface=this.wiringEditor.addIOperator(this.ioperator,endPointPos);position.posX-=this.wiringEditor.getGridElement().getBoundingClientRect().left;if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
operator_interface.setPosition(position);this.wiringEditor.layout.wrapperElement.removeChild(data.iObjectClon.wrapperElement);};OperatorInterface.prototype.getIOperator=function getIOperator(){return this.ioperator;};OperatorInterface.prototype.getId=function getId(){return this.ioperator.id;};OperatorInterface.prototype.getName=function getName(){return this.ioperator.name;};Wirecloud.ui.WiringEditor.OperatorInterface=OperatorInterface;})();(function(){"use strict";var SourceAnchor=function SourceAnchor(context,arrowCreator,subAnchors,isGhost){this.context=context;Wirecloud.ui.WiringEditor.Anchor.call(this,false,arrowCreator,isGhost);this.arrowCreator=arrowCreator;if(subAnchors!=null){this.isSubAnchor=true;this.subAnchors=subAnchors;}else{this.isSubAnchor=false;this.subAnchors=null;}};SourceAnchor.prototype=new Wirecloud.ui.WiringEditor.Anchor(true);SourceAnchor.prototype.repaint=function repaint(){var i,coordinates;coordinates=this.getCoordinates(this.context.iObject.wiringEditor.getGridElement());for(i=0;i<this.arrows.length;i+=1){if(this.arrows[i].startMulti==null){this.arrows[i].setStart(coordinates);this.arrows[i].redraw();}
if(this.arrows[i].endMulti!=null){this.context.iObject.wiringEditor.multiconnectors[this.arrows[i].endMulti].repaint();}}};Wirecloud.ui.WiringEditor.SourceAnchor=SourceAnchor;})();(function(){"use strict";var TargetAnchor=function TargetAnchor(context,arrowCreator,isGhost){this.context=context;Wirecloud.ui.WiringEditor.Anchor.call(this,false,arrowCreator,isGhost);this.arrowCreator=arrowCreator;};TargetAnchor.prototype=new Wirecloud.ui.WiringEditor.Anchor(true);TargetAnchor.prototype.repaint=function repaint(){var i,coordinates;coordinates=this.getCoordinates(this.context.iObject.wiringEditor.getGridElement());for(i=0;i<this.arrows.length;i+=1){if(this.arrows[i].endMulti==null){this.arrows[i].setEnd(coordinates);this.arrows[i].redraw();}
if(this.arrows[i].startMulti!=null){this.context.iObject.wiringEditor.multiconnectors[this.arrows[i].startMulti].repaint();}}};Wirecloud.ui.WiringEditor.TargetAnchor=TargetAnchor;})();(function(){"use strict";var Multiconnector=function Multiconnector(id,objectId,sourceName,layer,wiringEditor,initAnchor,endPos,height){var coord,mainAnchor;this.id=id;this.objectId=objectId;this.sourceName=sourceName;this.wiringEditor=wiringEditor;this.initAnchor=initAnchor;this.mainElement=document.createElement("div");this.mainElement.classList.add('mainElement');this.statusBar=document.createElement("div");this.statusBar.classList.add('statusBar');this.menuBar=document.createElement("div");this.menuBar.classList.add('menuBar');this.arrows=[];this.layer=layer;this.height=height;this.arrowPositions=[];this.type=null;this.initPos={'x':0,'y':0};this.sticky=null;if(height==null||height>=26){height=30;}else{height=height/0.054;}
this.height=height;if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){Wirecloud.ui.WiringEditor.TargetAnchor.call(this,initAnchor.context,initAnchor.context.iObject.arrowCreator);this.type='target';}else{Wirecloud.ui.WiringEditor.SourceAnchor.call(this,initAnchor.context,initAnchor.context.iObject.arrowCreator);this.type='source';}
this.wrapperElement.appendChild(this.menuBar);this.wrapperElement.appendChild(this.mainElement);this.wrapperElement.appendChild(this.statusBar);this.addClassName('multiconnector');this.removeClassName('icon-circle');if(endPos==null){coord=this.initAnchor.getCoordinates(this.wiringEditor.layout.getCenterContainer().wrapperElement);}else{coord=endPos;}
if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){if(endPos==null){coord.posX-=(60+30);}
this.wrapperElement.classList.add('target');mainAnchor=new Wirecloud.ui.WiringEditor.TargetAnchor(initAnchor.context,initAnchor.context.iObject.arrowCreator);}else{if(endPos==null){coord.posX+=60;}
this.wrapperElement.classList.add('source');mainAnchor=new Wirecloud.ui.WiringEditor.SourceAnchor(initAnchor.context,initAnchor.context.iObject.arrowCreator);}
mainAnchor.wrapperElement.classList.add('main');mainAnchor.wrapperElement.style.top=((height-20)/2)+'px';this.mainElement.appendChild(mainAnchor.wrapperElement);this.mainAnchor=mainAnchor;this.mainAnchor.disable();this.movZone=new StyledElements.StyledButton({'title':gettext("Drag & Drop"),'class':'dragZone icon-move','plain':true});this.movZone.wrapperElement.style.top=(((height-20)/2)+2)+'px';this.mainElement.appendChild(this.movZone.wrapperElement);if(endPos==null){coord.posY-=(height/2);}
this.wrapperElement.style.height=(height*0.054)+'em';this.wrapperElement.style.width='1.63em';this.setPosition(coord);this.draggable=new Wirecloud.ui.Draggable(this.movZone.wrapperElement,{iObject:this},function onStart(draggable,context){context.y=context.iObject.wrapperElement.style.top===""?0:parseInt(context.iObject.wrapperElement.style.top,10);context.x=context.iObject.wrapperElement.style.left===""?0:parseInt(context.iObject.wrapperElement.style.left,10);context.iObject.disable();context.preselected=context.iObject.selected;context.iObject.select(true);context.iObject.wiringEditor.onStarDragSelected();},function onDrag(e,draggable,context,xDelta,yDelta){context.iObject.setPosition({posX:context.x+xDelta,posY:context.y+yDelta});context.iObject.repaint();context.iObject.wiringEditor.onDragSelectedObjects(xDelta,yDelta);},function onFinish(draggable,context){context.iObject.wiringEditor.onFinishSelectedObjects();var position=context.iObject.getStylePosition();if(position.posX<0){position.posX=8;}
if(position.posY<0){position.posY=8;}
context.iObject.setPosition(position);context.iObject.repaint();if((Math.abs(context.x-position.posX)<2)&&(Math.abs(context.y-position.posY)<2)){if(context.preselected){context.iObject.unselect(true);}}else{if(!context.preselected){context.iObject.unselect(true);}}
context.iObject.enable();},function(){return true;});};Multiconnector.prototype=new Wirecloud.ui.WiringEditor.Anchor(true);Multiconnector.prototype.addMainArrow=function addMainArrow(pullerStart,pullerEnd){var arrow;if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){arrow=this.wiringEditor.canvas.drawArrow(this.mainAnchor.getCoordinates(this.layer),this.initAnchor.getCoordinates(this.layer),'multiconnector_arrow');arrow.startAnchor=this.mainAnchor;this.mainAnchor.addArrow(arrow);arrow.endAnchor=this.initAnchor;this.initAnchor.addArrow(arrow);arrow.multiId=this.id;}else{arrow=this.wiringEditor.canvas.drawArrow(this.initAnchor.getCoordinates(this.layer),this.mainAnchor.getCoordinates(this.layer),'multiconnector_arrow');arrow.startAnchor=this.initAnchor;this.initAnchor.addArrow(arrow);arrow.endAnchor=this.mainAnchor;this.mainAnchor.addArrow(arrow);arrow.multiId=this.id;}
arrow.addClassName('arrow');if(pullerStart!=null){arrow.setPullerStart(pullerStart);}
if(pullerEnd!=null){arrow.setPullerEnd(pullerEnd);}
this.mainArrow=arrow;this.mainArrow.redraw();this.calculatePosibleAnchors();};Multiconnector.prototype.addArrow=function addArrow(theArrow){this.arrows.push(theArrow);this.reorganizeArrows();};Multiconnector.prototype.getId=function getId(){return this.id;};var coord;Multiconnector.prototype.calculatePosibleAnchors=function calculatePosibleAnchors(){var i,currentSize;currentSize=parseFloat(this.layer.style.fontSize);this.mainAnchor.wrapperElement.style.top=(((this.height-20)/2)*currentSize)+'px';this.movZone.wrapperElement.style.top=((((this.height-20)/2)+2)*currentSize)+'px';coord=this.mainAnchor.getCoordinates(this.wiringEditor.layout.getCenterContainer().wrapperElement);coord.posY-=(this.height/2)*currentSize;this.arrowPositions=[];if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){coord.posX-=58*currentSize;}else{coord.posX-=3*currentSize;}
if(this.height*currentSize<(40*currentSize)){this.arrowPositions.push({'coord':{'posX':(coord.posX+30*currentSize),'posY':coord.posY+15*currentSize},'free':true});return;}
for(i=coord.posY+15*currentSize;i<=(coord.posY+((this.height-10)*currentSize));i+=15*currentSize){this.arrowPositions.push({'coord':{'posX':(coord.posX+30*currentSize),'posY':i},'free':true});}};Multiconnector.prototype.reorganizeArrows=function reorganizeArrows(){var i,j,arrow,pos,arrowsAux,totalPos,lastMax,highestArrow;pos=0;totalPos=this.arrowPositions.length;arrowsAux=[];if(this.arrows.length===0){return;}
lastMax=99999;highestArrow=-1;for(i=0;i<this.arrows.length;i+=1){highestArrow=this.searchMaxYArrow(lastMax,arrowsAux);if(highestArrow!=null){arrowsAux.push(this.arrows[highestArrow]);if(this.type=='source'){lastMax=this.arrows[highestArrow].end.posY;}else if(this.type=='target'){lastMax=this.arrows[highestArrow].start.posY;}}}
for(j=0;j<arrowsAux.length;j+=1){arrow=arrowsAux[arrowsAux.length-1-j];pos=this.arrowPositions[j].coord;this.arrowPositions[j].free=false;if(this.type=='source'){arrow.setStart(pos);}else if(this.type=='target'){arrow.setEnd(pos);}
arrow.redraw();}};Multiconnector.prototype.searchMaxYArrow=function searchMaxArrow(lastMax,findedArrows){var maxY,i,y,highestArrow;maxY=-1000;for(i=0;i<this.arrows.length;i+=1){if(this.type=='source'){y=this.arrows[i].end.posY;if((y>maxY)&&(y<lastMax)){maxY=y;highestArrow=i;}else if((y==lastMax)&&(findedArrows.indexOf(this.arrows[i])==-1)){maxY=y;highestArrow=i;}}else if(this.type=='target'){y=this.arrows[i].start.posY;if((y>maxY)&&(y<lastMax)){maxY=y;highestArrow=i;}else if((y==lastMax)&&(findedArrows.indexOf(this.arrows[i])==-1)){maxY=y;highestArrow=i;}}else{highestArrow=null;}}
return highestArrow;};Multiconnector.prototype.stick=function stick(){return this.getCoordinates(null,true);};Multiconnector.prototype.unstick=function unstick(){if(this.sticky!=null){this.arrowPositions[this.sticky].free=true;this.sticky=null;this.resize(-15);}else{}};Multiconnector.prototype.getCoordinates=function getCoordinates(layer,sticky){var i;for(i=0;i<this.arrowPositions.length;i+=1){if(this.sticky!=null){i=this.sticky;this.sticky=null;return this.arrowPositions[i].coord;}
if(this.arrowPositions[i].free){this.arrowPositions[i].free=false;if(sticky){this.sticky=i;return this.arrowPositions[i].coord;}
return this.arrowPositions[i].coord;}}
this.resize(15);return this.getCoordinates(layer,sticky);};Multiconnector.prototype.resize=function resize(dif){if(this.wrapperElement==null||(this.height+dif)<30){return;}
this.height+=dif;this.wrapperElement.style.height=(this.height*0.054)+'em';this.wrapperElement.style.top=(parseInt(this.wrapperElement.style.top,10)-dif)+'px';this.movZone.wrapperElement.style.top=((this.height-20)/2)+'px';this.mainAnchor.wrapperElement.style.top=((this.height-20)/2)+'px';this.repaint();};Multiconnector.prototype.removeArrow=function removeArrow(theArrow){var index=this.arrows.indexOf(theArrow);if(index!==-1){this.arrows.splice(index,1);this.freeAnchor(theArrow);}else{this.freeAnchor(theArrow);}};Multiconnector.prototype.freeAnchor=function freeAnchor(theArrow){var pos,i;if(theArrow.startMulti==this.id){pos=theArrow.start;}else if(theArrow.endMulti==this.id){pos=theArrow.end;}else{return;}
for(i=0;i<this.arrowPositions.length;i+=1){if(this.arrowPositions[i].coord.posY==pos.posY&&this.arrowPositions[i].coord.posX==pos.posX){this.arrowPositions[i].free=true;if(this.height>40){this.resize(-15);}
return;}}
return;};Multiconnector.prototype.getStylePosition=function getStylePosition(){var coordinates;coordinates={posX:parseInt(this.wrapperElement.style.left,10),posY:parseInt(this.wrapperElement.style.top,10)};return coordinates;};Multiconnector.prototype.repaint=function repaint(special){var i,entity;if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){this.mainArrow.setStart(this.mainAnchor.getCoordinates(this.layer));}else{this.mainArrow.setEnd(this.mainAnchor.getCoordinates(this.layer));}
this.mainArrow.redraw();this.calculatePosibleAnchors();this.reorganizeArrows();if(!special){for(i=0;i<this.arrows.length;i+=1){if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){entity=this.arrows[i].startMulti;}else if(this.initAnchor instanceof Wirecloud.ui.WiringEditor.SourceAnchor){entity=this.arrows[i].endMulti;}
if(entity!=null){this.wiringEditor.multiconnectors[entity].repaint(true);}}}};Multiconnector.prototype.getPosition=function getPosition(){var coordinates={posX:this.wrapperElement.offsetLeft,posY:this.wrapperElement.offsetTop};return coordinates;};Multiconnector.prototype.getStylePosition=function getStylePosition(){var coordinates;coordinates={posX:parseInt(this.wrapperElement.style.left,10),posY:parseInt(this.wrapperElement.style.top,10)};return coordinates;};Multiconnector.prototype.setPosition=function setPosition(coordinates){this.wrapperElement.style.left=coordinates.posX+'px';this.wrapperElement.style.top=coordinates.posY+'px';};Multiconnector.prototype.addClassName=function addClassName(className){var atr;if(className==null){return;}
atr=this.wrapperElement.getAttribute('class');if(atr==null){atr='';}
this.wrapperElement.setAttribute('class',Wirecloud.Utils.appendWord(atr,className));};Multiconnector.prototype.removeClassName=function removeClassName(className){var atr;if(className==null){return;}
atr=this.wrapperElement.getAttribute('class');if(atr==null){atr='';}
this.wrapperElement.setAttribute('class',Wirecloud.Utils.removeWord(atr,className));};Multiconnector.prototype.select=function select(withCtrl){var i;if(this.hasClassName('selected')){return;}
if(!(this.wiringEditor.ctrlPushed)&&(this.wiringEditor.selectedCount>0)&&(withCtrl)){this.wiringEditor.resetSelection();}
this.selected=true;this.addClassName('selected');this.mainArrow.emphasize();for(i=0;i<this.arrows.length;i+=1){this.arrows[i].emphasize();}
this.wiringEditor.addSelectedObject(this);};Multiconnector.prototype.unselect=function unselect(withCtrl){var i;this.selected=false;this.removeClassName('selected');this.mainArrow.deemphasize();for(i=0;i<this.arrows.length;i+=1){this.arrows[i].deemphasize();}
this.wiringEditor.removeSelectedObject(this);if(!(this.wiringEditor.ctrlPushed)&&(this.wiringEditor.selectedCount>0)&&(withCtrl)){this.wiringEditor.resetSelection();}};Multiconnector.prototype.destroy=function destroy(totally){var i;Wirecloud.ui.WiringEditor.Anchor.prototype.destroy.call(this);this.wrapperElement=null;this.mainElement=null;this.statusBar=null;this.menuBar=null;this.mainArrow.canvas=null;this.mainArrow.destroy();if(totally){for(i=this.arrows.length-1;i>=0;i-=1){this.arrows[i].destroy();}}};Wirecloud.ui.WiringEditor.Multiconnector=Multiconnector;})();(function(){"use strict";var GenericInterfaceSettingsMenuItems,clickCallback;GenericInterfaceSettingsMenuItems=function GenericInterfaceSettingsMenuItems(geinterface){this.geinterface=geinterface;if(this.geinterface.ioperator){this.instance=this.geinterface.ioperator;}else{this.instance=this.geinterface.iwidget;}};GenericInterfaceSettingsMenuItems.prototype=new StyledElements.DynamicMenuItems();GenericInterfaceSettingsMenuItems.prototype.build=function build(context){var label;var item,items=[];item=new StyledElements.MenuItem(gettext('Reorder endpoints'),function(){this.wiringEditor.ChangeObjectEditing(this);}.bind(this.geinterface));item.setDisabled(this.geinterface.sourceAnchors.length<=1&&this.geinterface.targetAnchors.length<=1);items.push(item);item=new StyledElements.MenuItem(gettext('Settings'),function(){var window_menu;if(this.ioperator){window_menu=new Wirecloud.ui.OperatorPreferencesWindowMenu();window_menu.show(this.ioperator);}else{window_menu=new Wirecloud.Widget.PreferencesWindowMenu();window_menu.show(this.iwidget);}}.bind(this.geinterface));item.setDisabled(this.instance.meta.preferenceList.length===0);items.push(item);item=new StyledElements.MenuItem(gettext('Logs'),function(){var dialog=new Wirecloud.ui.LogWindowMenu(this.entity.logManager);dialog.show();}.bind(this.geinterface));items.push(item);if(this.geinterface.ioperator){label='Minimize';items.push(new StyledElements.MenuItem(gettext(label),function(){var interval;if(this.isMinimized){this.restore();}else{this.minimize();}}.bind(this.geinterface)));}
return items;};Wirecloud.ui.WiringEditor.GenericInterfaceSettingsMenuItems=GenericInterfaceSettingsMenuItems;})();(function(){"use strict";var MiniInterfaceSettingsMenuItems,clickCallback;MiniInterfaceSettingsMenuItems=function MiniInterfaceSettingsMenuItems(geinterface){this.geinterface=geinterface;if(this.geinterface.ioperator){this.instance=this.geinterface.ioperator;}else{this.instance=this.geinterface.iwidget;}};MiniInterfaceSettingsMenuItems.prototype=new StyledElements.DynamicMenuItems();MiniInterfaceSettingsMenuItems.prototype.build=function build(context){var items,item,label,versions,versionInfo,i,msg,color,allVersions,sortedItems;items={};allVersions=[];if(!this.geinterface.ioperator){return items;}
versionInfo=this.geinterface.wiringEditor.operatorVersions[this.instance.vendor+'/'+this.instance.name];versions=versionInfo.versions;for(i=0;i<versions.length;i++){msg='Version '+versions[i].version.text;color='';if(versionInfo.currentVersion.compareTo(versions[i].version)==0){msg+='*';color='red';}
if(versionInfo.lastVersion.compareTo(versions[i].version)==0){color='blue';}
item=new StyledElements.MenuItem(gettext(msg),function(version){this.wiringEditor.setOperatorVersion(this,version);}.bind(this.geinterface,versions[i]));item.wrapperElement.style.color=color;items[versions[i].version.text]=item;allVersions.push(versions[i].version);}
allVersions=allVersions.sort(function(version1,version2){return-version1.compareTo(version2);});sortedItems=[];for(i=0;i<allVersions.length;i++){sortedItems.push(items[allVersions[i].text]);}
return sortedItems;};Wirecloud.ui.WiringEditor.MiniInterfaceSettingsMenuItems=MiniInterfaceSettingsMenuItems;})();(function(){"use strict";var WiringPreview=function WiringPreview(){this.workspace=Wirecloud.activeWorkspace;this.tab=this.workspace.getVisibleTab();this.wrapperElement=document.createElement('div');this.wrapperElement.classList.add('wiringPreview');this.shapeLayer=document.createElement('div');this.shapeLayer.classList.add('shapeLayer');this.wrapperElement.appendChild(this.shapeLayer);this.tab.wrapperElement.appendChild(this.wrapperElement);this.closeButton=document.createElement('div');this.closeButton.classList.add('closeButton');this.closeButton.classList.add('icon-remove');this.wrapperElement.appendChild(this.closeButton);this.closeButton.addEventListener('click',this.hideWiringPreview.bind(this),false);this.tab.wrapperElement.addEventListener("scroll",scrollHandler.bind(this),false);};var calculateVisibleConnections=function calculateVisibleConnections(widgets,connections){var i,connection;var connectionId=0;for(i=0;i<connections.length;i+=1){connection=connections[i];if(connection.source.type=='iwidget'&&connection.target.type=='iwidget'){if(this.iwidgets[connection.source.id]&&this.iwidgets[connection.target.id]){this.wiringConnections[connectionId]=connection;connectionId++;}}else{}}};var addWidgetShape=function addWidgetShape(iwidget,id,position){var shape,headerTop;headerTop=this.tab.getBoundingClientRect().top;iwidget.contentWrapper.classList.add('blurred');shape=document.createElement('div');shape.classList.add('widgetShape');this.shapeLayer.appendChild(shape);shape.style.top=(position.top-headerTop)+'px';shape.style.left=position.left+'px';shape.style.height=(position.height-13)+'px';shape.style.width=(position.width-14)+'px';this.widgetShapes[id]={'wrapperElement':shape,'iwidget':iwidget.widget,};};var addConnection=function addConnection(connectionId,connection){var source,target,sourceEndpoint,targetEndpoint;targetEndpoint=connection.target.endpoint;if(this.activeAnchors[connection.target.id]&&this.activeAnchors[connection.target.id][targetEndpoint]){target=this.activeAnchors[connection.target.id][targetEndpoint];}else{if(!this.activeAnchors[connection.target.id]){this.activeAnchors[connection.target.id]={};}
if(!this.activeAnchors[connection.target.id][targetEndpoint]){target=addEndpoint.call(this,connectionId,connection.target.id,targetEndpoint,'target');this.activeAnchors[connection.target.id][targetEndpoint]=target;}}
sourceEndpoint=connection.source.endpoint;if(this.activeAnchors[connection.source.id]&&this.activeAnchors[connection.source.id][sourceEndpoint]){source=this.activeAnchors[connection.source.id][sourceEndpoint];}else{if(!this.activeAnchors[connection.source.id]){this.activeAnchors[connection.source.id]={};}
if(!this.activeAnchors[connection.source.id][sourceEndpoint]){source=addEndpoint.call(this,connectionId,connection.source.id,sourceEndpoint,'source');this.activeAnchors[connection.source.id][sourceEndpoint]=source;}}
source['connectionIds'].push(connectionId);target['connectionIds'].push(connectionId);this.subBoxesByConnectionId[connectionId]=[];this.labelsByConnectionId[connectionId]=[];this.arrowsToDraw[connectionId]={'source':source,'target':target};this.connectionsCounter+=1;};var addEndpoint=function addEndpoint(connectionId,widgetId,endpoint,type){var theElement,label,ball,shape,labelText,newEndpoint;shape=this.widgetShapes[widgetId];label=document.createElement('span');label.classList.add('label');ball=document.createElement('div');theElement=document.createElement('div');theElement.classList.add('endpoint');theElement.classList.add(type);if(type=='source'){theElement.appendChild(label);theElement.appendChild(ball);labelText=getEndpointLabel(endpoint,shape.iwidget.outputs);}else if(type=='target'){theElement.appendChild(ball);theElement.appendChild(label);labelText=getEndpointLabel(endpoint,shape.iwidget.inputs);}
label.textContent=labelText;shape.wrapperElement.appendChild(theElement);newEndpoint={'wrapperElement':theElement,'name':endpoint,'label':labelText,'anchor':ball,'type':type,'widgetId':widgetId,'connectionIds':[]};label.addEventListener('mouseover',function(newEndpoint){var i,typeSearched;if(newEndpoint.type=='source'){typeSearched='target';}else{typeSearched='source';}
for(i=0;i<newEndpoint.connectionIds.length;i+=1){emphasize(this.arrowsToDraw[newEndpoint.connectionIds[i]][typeSearched]);subBoxOverHandler.call(this,newEndpoint.connectionIds[i]);}}.bind(this,newEndpoint),false);label.addEventListener('mouseout',function(newEndpoint){var i,typeSearched;if(newEndpoint.type=='source'){typeSearched='target';}else{typeSearched='source';}
for(i=0;i<newEndpoint.connectionIds.length;i+=1){deemphasize(this.arrowsToDraw[newEndpoint.connectionIds[i]][typeSearched]);subBoxOutHandler.call(this,newEndpoint.connectionIds[i]);}}.bind(this,newEndpoint),false);return newEndpoint;};var emphasize=function emphasize(endpoint){endpoint.wrapperElement.classList.add('emphasized');};var deemphasize=function deemphasize(endpoint){endpoint.wrapperElement.classList.remove('emphasized');};var getEndpointLabel=function getEndpointLabel(endpointName,endpoints){var i;for(i=0;i<endpoints.length;i+=1){if(endpoints[i].name==endpointName){return endpoints[i].label;}}
return null;};var calculateAnchorColors=function calculateAnchorColors(connectionsCounter){var endpoints,key,endpoint,connectionIds,i;for(key in this.activeAnchors){endpoints=this.activeAnchors[key];for(key in endpoints){endpoint=endpoints[key];connectionIds=endpoint.connectionIds;generateColorSmartBox.call(this,connectionIds,endpoint);}}};var generateColorSmartBox=function generateColorSmartBox(connectionIds,endpoint){var anchorDiv,type,subBoxesListById,subBox,i;type=endpoint.type;anchorDiv=endpoint.anchor;subBoxesListById=new Wirecloud.ui.ColorSmartBox(connectionIds,anchorDiv,type);for(i=0;i<connectionIds.length;i+=1){subBox=subBoxesListById[connectionIds[i]];subBox.addEventListener('mouseover',subBoxOverHandler.bind(this,connectionIds[i]),false);subBox.addEventListener('mouseout',subBoxOutHandler.bind(this,connectionIds[i]),false);this.subBoxesByConnectionId[connectionIds[i]].push(subBox);this.labelsByConnectionId[connectionIds[i]].push(endpoint);}};var subBoxOverHandler=function subBoxOverHandler(connectionId){var theBoxes,theLabels,i;theBoxes=this.subBoxesByConnectionId[connectionId];for(i=0;i<theBoxes.length;i+=1){theBoxes[i].classList.add('highlighted');}
theLabels=this.labelsByConnectionId[connectionId];for(i=0;i<theLabels.length;i+=1){emphasize(theLabels[i])}};var subBoxOutHandler=function subBoxOutHandler(connectionId){var theBoxes,theLabels,i;theBoxes=this.subBoxesByConnectionId[connectionId];for(i=0;i<theBoxes.length;i+=1){theBoxes[i].classList.remove('highlighted');}
theLabels=this.labelsByConnectionId[connectionId];for(i=0;i<theLabels.length;i+=1){deemphasize(theLabels[i])}};var placeAnchors=function placeAnchors(){var key,subkey,anchors,anchor,sourceList,targetList;for(key in this.activeAnchors){anchors=this.activeAnchors[key];sourceList=[];targetList=[];for(subkey in this.activeAnchors[key]){anchor=this.activeAnchors[key][subkey];if(anchor.type=='source'){sourceList.push(anchor);}else{targetList.push(anchor);}}
moveEndpoints.call(this,key,sourceList,targetList);}};var moveEndpoints=function moveEndpoints(shapeId,sourceList,targetList){var i,theShape,height,heightForEachSourceEndpoint,heightForEachTargetEndpoint,halfEndpointHeight;theShape=this.widgetShapes[shapeId];height=theShape.wrapperElement.getBoundingClientRect().height;heightForEachSourceEndpoint=height;heightForEachTargetEndpoint=height;if(sourceList.length>0){heightForEachSourceEndpoint=height/sourceList.length;halfEndpointHeight=sourceList[0].wrapperElement.getBoundingClientRect().height/2;}
if(targetList.length>0){heightForEachTargetEndpoint=height/targetList.length;halfEndpointHeight=targetList[0].wrapperElement.getBoundingClientRect().height/2;}
for(i=0;i<sourceList.length;i+=1){sourceList[i].wrapperElement.style.top=((i)*heightForEachSourceEndpoint)+
(heightForEachSourceEndpoint/2)-
halfEndpointHeight+'px';}
for(i=0;i<targetList.length;i+=1){targetList[i].wrapperElement.style.top=((i)*heightForEachTargetEndpoint)+
(heightForEachTargetEndpoint/2)-
halfEndpointHeight+'px';}};var scrollHandler=function scrollHandler(){var oc,scrollY,param;oc=this.tab.wrapperElement;scrollY=parseInt(oc.scrollTop,10);this.wrapperElement.style.height=this.initialHeight+scrollY+'px';};WiringPreview.prototype.showWiringPreview=function ShowWiringPreview(){var key,i,pos;this.wrapperElement.classList.add('on');this.widgetShapes={};this.wiringConnections={};this.activeAnchors={};this.arrowsToDraw={};this.subBoxesByConnectionId={};this.labelsByConnectionId={};this.connectionsCounter=0;this.iwidgets=this.tab.dragboard.iWidgets.toJSON();calculateVisibleConnections.call(this,this.iwidgets,this.workspace.wiring.status.connections);this.initialHeight=this.tab.wrapperElement.getBoundingClientRect().height-4;for(key in this.iwidgets){pos=this.iwidgets[key].contentWrapper.getBoundingClientRect();addWidgetShape.call(this,this.iwidgets[key],key,pos);}
for(key in this.wiringConnections){addConnection.call(this,key,this.wiringConnections[key]);}
placeAnchors.call(this);calculateAnchorColors.call(this,this.connectionsCounter);};WiringPreview.prototype.hideWiringPreview=function HideWiringPreview(){var key;this.wrapperElement.classList.remove('on');for(key in this.widgetShapes){this.shapeLayer.removeChild(this.widgetShapes[key].wrapperElement);this.iwidgets[key].contentWrapper.classList.remove('blurred');}};Wirecloud.ui.WiringPreview=WiringPreview;})();(function(){"use strict";var ColorSmartBox=function ColorSmartBox(connections,mainDiv,type){var i,newBox,subBoxesList,width,leftDiv,rightDiv,southDiv,northDiv,subBox,subBoxesByConnectionId;this.wrapperElement=mainDiv;this.wrapperElement.classList.add('smartBox');subBoxesList=[];subBoxesByConnectionId={};for(i=0;i<connections.length;i+=1){newBox=document.createElement('div');newBox.classList.add('subSmartBox');newBox.textContent=connections[i];newBox.classList.add('previewColor'+(connections[i]%12));subBoxesList.push(newBox);subBoxesByConnectionId[connections[i]]=newBox;}
if(subBoxesList.length==1){subBoxesList[0].classList.add('full');this.wrapperElement.appendChild(subBoxesList[0]);}else if(subBoxesList.length==2){this.wrapperElement.appendChild(subBoxesList[0]);subBoxesList[0].classList.add('half');this.wrapperElement.appendChild(subBoxesList[1]);subBoxesList[1].classList.add('half');}else{if((subBoxesList.length%2)==1){subBox=subBoxesList.pop();this.wrapperElement.appendChild(subBox);subBox.classList.add('half');}
rightDiv=document.createElement('div');rightDiv.classList.add('rightDiv');this.wrapperElement.appendChild(rightDiv);northDiv=document.createElement('div');northDiv.classList.add("northDiv");rightDiv.appendChild(northDiv);southDiv=document.createElement('div');southDiv.classList.add("southDiv");rightDiv.appendChild(southDiv);for(i=subBoxesList.length-1;i>=0;i-=1){if((i%2)===1){northDiv.appendChild(subBoxesList[i]);}else{southDiv.appendChild(subBoxesList[i]);}}}
return subBoxesByConnectionId;};Wirecloud.ui.ColorSmartBox=ColorSmartBox;})();(function(){"use strict";var BasicRecommendations=function BasicRecommendations(){this.sourceAnchorsByFriendCode={};this.targetAnchorsByFriendCode={};};var highlightAnchorLabel=function highlightAnchorLabel(anchor){anchor.wrapperElement.parentNode.classList.add('highlight');};var unhighlightAnchorLabel=function unhighlightAnchorLabel(anchor){anchor.wrapperElement.parentNode.classList.remove('highlight');};BasicRecommendations.prototype.add_anchor_to_recommendations=function(anchor){var friendCode;friendCode=anchor.context.data.friendcode;if(anchor instanceof Wirecloud.ui.WiringEditor.SourceAnchor){if(this.sourceAnchorsByFriendCode[friendCode]==null){this.sourceAnchorsByFriendCode[friendCode]=[];}
this.sourceAnchorsByFriendCode[friendCode].push(anchor);}else{if(this.targetAnchorsByFriendCode[friendCode]==null){this.targetAnchorsByFriendCode[friendCode]=[];}
this.targetAnchorsByFriendCode[friendCode].push(anchor);}};BasicRecommendations.prototype.remove_anchor_to_recommendations=function(anchor){var anchorList;if(anchor instanceof Wirecloud.ui.WiringEditor.SourceAnchor){anchorList=this.sourceAnchorsByFriendCode[anchor.context.data.friendcode];anchorList.splice(anchorList.indexOf(anchor),1);}else{anchorList=this.targetAnchorsByFriendCode[anchor.context.data.friendcode];anchorList.splice(anchorList.indexOf(anchor),1);}};BasicRecommendations.prototype.emphasize=function emphasize(anchor){var friendCode,anchors,i;anchor.wrapperElement.parentNode.classList.add('highlight_main');friendCode=anchor.context.data.friendcode;if(anchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){anchors=this.sourceAnchorsByFriendCode[friendCode];}else{anchors=this.targetAnchorsByFriendCode[friendCode];}
if(anchors!=null){for(i=0;i<anchors.length;i+=1){if(anchor.context.iObject.getId()!=anchors[i].context.iObject.getId()){highlightAnchorLabel(anchors[i]);}}}};BasicRecommendations.prototype.deemphasize=function deemphasize(anchor){var friendCode,anchors,i;anchor.wrapperElement.parentNode.classList.remove('highlight_main');friendCode=anchor.context.data.friendcode;if(anchor instanceof Wirecloud.ui.WiringEditor.TargetAnchor){anchors=this.sourceAnchorsByFriendCode[friendCode];}else{anchors=this.targetAnchorsByFriendCode[friendCode];}
if(anchors!=null){for(i=0;i<anchors.length;i+=1){if(anchor.context.iObject.getId()!=anchors[i].context.iObject.getId()){unhighlightAnchorLabel(anchors[i]);}}}};BasicRecommendations.prototype.destroy=function destroy(){this.sourceAnchorsByFriendCode={};this.targetAnchorsByFriendCode={};};Wirecloud.ui.BasicRecommendations=BasicRecommendations;})();(function(){"use strict";var RecommendationManager=function RecommendationManager(){this.basic=new Wirecloud.ui.BasicRecommendations();this.fullAnchorList=[];this.recommendations=this.basic;this.semanticAvailable=false;this.recommendationsActivated=false;};RecommendationManager.prototype.init=function init(iwidgets,availableOperators){var i,url,entitiesIds,iwidget,onSuccess,onFailure;this.semanticStatus={};this.initIwidgets=iwidgets;this.initAvailableOperators=availableOperators;this.semanticAvailable=false;if(Wirecloud.URLs.SEMANTIC_MATCHING_SERVICE){url=Wirecloud.URLs.SEMANTIC_MATCHING_SERVICE+Wirecloud.contextManager.get('username');onSuccess=function(res){this.semanticStatus=JSON.parse(res.responseText);this.semantic=new Wirecloud.ui.SemanticRecommendations(this.semanticStatus,this.initIwidgets,this.initAvailableOperators);for(i=0;i<this.fullAnchorList.length;i+=1){this.semantic.add_anchor_to_recommendations(this.fullAnchorList[i]);}
this.semanticAvailable=true;this.recommendations=this.semantic;};onFailure=function onFailure(){};Wirecloud.io.makeRequest(url,{method:'GET',requestHeaders:{'Accept':'application/json'},contentType:'application/json',onSuccess:onSuccess.bind(this),onFailure:onFailure.bind(this)});}};RecommendationManager.prototype.add_anchor_to_recommendations=function add_anchor_to_recommendations(anchor){this.fullAnchorList.push(anchor);this.basic.add_anchor_to_recommendations(anchor);if(this.semanticAvailable){this.semantic.add_anchor_to_recommendations(anchor);}};RecommendationManager.prototype.remove_anchor_to_recommendations=function remove_anchor_to_recommendations(anchor){this.fullAnchorList.splice(this.fullAnchorList.indexOf(anchor),1);this.basic.remove_anchor_to_recommendations(anchor);if(this.semanticAvailable){this.semantic.remove_anchor_to_recommendations(anchor);}};RecommendationManager.prototype.emphasize=function emphasize(anchor,isCreatingArrow){if(!this.recommendationsActivated){this.recommendations.emphasize(anchor);if(isCreatingArrow){this.recommendationsActivated=true;}}};RecommendationManager.prototype.deemphasize=function deemphasize(anchor,createArrowEnded){if(createArrowEnded){this.recommendationsActivated=false;}
if(!this.recommendationsActivated){this.recommendations.deemphasize(anchor);}};RecommendationManager.prototype.changeToBasicRecommendations=function changeToBasicRecommendations(){this.recommendations=this.basic;};RecommendationManager.prototype.changeToSemanticRecommendations=function changeToSemanticRecommendations(){if(this.semanticAvailable){this.recommendations=this.semantic;}};RecommendationManager.prototype.destroy=function destroy(){this.fullAnchorList=[];this.recommendations=null;this.basic.destroy();if(this.semanticAvailable){this.semantic.destroy();}};Wirecloud.ui.RecommendationManager=RecommendationManager;})();(function(){"use strict";var Tutorial=function Tutorial(label,instructions){this.label=label;this.stepActive=null;this.steps=[];this.controlLayer=document.createElement("div");this.controlLayerUp=document.createElement("div");this.controlLayerDown=document.createElement("div");this.controlLayerLeft=document.createElement("div");this.controlLayerRight=document.createElement("div");this.controlLayerCenter=document.createElement("div");this.controlLayer.className="controlLayer";this.controlLayerUp.className="controlLayerUp";this.controlLayerDown.className="controlLayerDown";this.controlLayerLeft.className="controlLayerLeft";this.controlLayerRight.className="controlLayerRight";this.controlLayerCenter.className="controlLayerCenter";this.controlLayer.appendChild(this.controlLayerUp);this.controlLayer.appendChild(this.controlLayerDown);this.controlLayer.appendChild(this.controlLayerLeft);this.controlLayer.appendChild(this.controlLayerRight);this.controlLayer.appendChild(this.controlLayerCenter);this.instructions=instructions;};Tutorial.prototype.start=function start(){var i;var mapping={'simpleDescription':Wirecloud.ui.Tutorial.SimpleDescription,'userAction':Wirecloud.ui.Tutorial.UserAction,'formAction':Wirecloud.ui.Tutorial.FormAction,'autoAction':Wirecloud.ui.Tutorial.AutoAction};document.body.appendChild(this.controlLayer);this.resetControlLayer(true);this.msgLayer=document.createElement("div");this.msgLayer.classList.add("msgLayer");document.body.appendChild(this.msgLayer);for(i=0;i<this.instructions.length;i++){var Constructor=mapping[this.instructions[i].type];this.steps[i]=new Constructor(this,this.instructions[i]);if(i==(this.instructions.length-1)){this.steps[i].setLast();}else{this.steps[i].setNext();}}
this.stepActive=this.steps[0];this.steps[0].activate();};Tutorial.prototype.nextStep=function nextStep(){var current_step_index=this.steps.indexOf(this.stepActive);if(current_step_index<(this.steps.length-1)){this.stepActive.destroy();this.stepActive=this.steps[current_step_index+1];setTimeout(this.stepActive.activate.bind(this.stepActive),200);}else{this.destroy();}};Tutorial.prototype.resetControlLayer=function resetControlLayer(isTransparent){this.controlLayer.classList.remove("hidden");if(isTransparent===true){this.controlLayer.classList.add('transparent');}else if(isTransparent===false){this.controlLayer.classList.remove('transparent');}
this.controlLayerUp.style.height='50%';this.controlLayerUp.style.width='100%';this.controlLayerUp.style.top='0';this.controlLayerUp.style.left='0';this.controlLayerDown.style.height='50%';this.controlLayerDown.style.width='100%';this.controlLayerDown.style.top='50%';this.controlLayerDown.style.left='0';this.controlLayerRight.style.height='0';this.controlLayerRight.style.width='50%';this.controlLayerRight.style.top='50%';this.controlLayerRight.style.left='50%';this.controlLayerLeft.style.height='0';this.controlLayerLeft.style.width='50%';this.controlLayerLeft.style.top='50%';this.controlLayerLeft.style.left='0';this.controlLayerCenter.style.height='0';this.controlLayerCenter.style.width='0';this.controlLayerCenter.style.top='50%';this.controlLayerCenter.style.left='50%';};Tutorial.prototype.setControlLayer=function setControlLayer(element,disable_center){var pos;if(typeof element!=='object'){return;}
this.controlLayer.classList.remove("hidden");this.controlLayer.classList.remove('transparent');pos=element.getBoundingClientRect();this.controlLayerUp.style.height=pos.top+'px';this.controlLayerUp.style.width='100%';this.controlLayerDown.style.top=(pos.top+pos.height)+'px';this.controlLayerDown.style.width='100%';this.controlLayerDown.style.height='100%';this.controlLayerRight.style.left=(pos.left+pos.width)+'px';this.controlLayerRight.style.top=pos.top+'px';this.controlLayerRight.style.height=pos.height+'px';this.controlLayerRight.style.width='100%';this.controlLayerLeft.style.width=pos.left+'px';this.controlLayerLeft.style.height=pos.height+'px';this.controlLayerLeft.style.top=pos.top+'px';if(disable_center===true){this.controlLayerCenter.style.left=pos.left+'px';this.controlLayerCenter.style.top=pos.top+'px';this.controlLayerCenter.style.height=pos.height+'px';this.controlLayerCenter.style.width=pos.width+'px';this.controlLayerCenter.style.display='block';}else{this.controlLayerCenter.style.display='none';}};Tutorial.prototype.deactivateLayer=function deactivateLayer(){this.controlLayer.classList.add("hidden");};Tutorial.prototype.findElementByTextContent=function findElementByTextContent(nodes,text){var i;for(i=0;i<nodes.length;i++){if(nodes[i].textContent.toLowerCase()==text.toLowerCase()){return nodes[i];}}
return null;};Tutorial.prototype.destroy=function destroy(){var stepActivePos,i;stepActivePos=this.steps.indexOf(this.stepActive);for(i=stepActivePos;i<this.steps.length;i++){this.steps[i].destroy();}
document.body.removeChild(this.controlLayer);document.body.removeChild(this.msgLayer);this.msgLayer=null;this.steps=[];};Wirecloud.ui.Tutorial=Tutorial;})();(function(){"use strict";var tutorials=[];var tutorialsById={};var TutorialCatalogue={};TutorialCatalogue.add=function add(id,tutorial){if(!(tutorial instanceof Wirecloud.ui.Tutorial)){throw new TypeError('tutorial must be an instance of Wirecloud.ui.Tutorial');}
tutorials.push(tutorial);tutorialsById[id]=tutorial;};Object.defineProperty(TutorialCatalogue,'tutorials',{get:function(){return tutorials;}});Object.defineProperty(TutorialCatalogue,'get',{value:function get(id){return tutorialsById[id];}});Object.defineProperty(TutorialCatalogue,'buildTutorialReferences',{value:function buildTutorialReferences(tutorial_list){var wrapper_text=document.createElement('p');wrapper_text.textContent=gettext('If you prefer, you can follow some of these tutorials:');var list=document.createElement('ul');for(var i=0;i<tutorial_list.length;i++){var tutorial=this.get(tutorial_list[i]);var item=document.createElement('li');var link=document.createElement('a');link.textContent=tutorial.label;link.addEventListener('click',function(e){e.stopPropagation();e.preventDefault();this.start();}.bind(tutorial));item.appendChild(link);list.appendChild(item);}
wrapper_text.appendChild(list);return wrapper_text;}});Object.freeze(TutorialCatalogue);Wirecloud.TutorialCatalogue=TutorialCatalogue;})();(function(){"use strict";var TutorialSubMenu=function TutorialSubMenu(){var i,tutorial;StyledElements.SubMenuItem.call(this,gettext('Tutorials'));for(i=0;i<Wirecloud.TutorialCatalogue.tutorials.length;i++){tutorial=Wirecloud.TutorialCatalogue.tutorials[i];this.append(new StyledElements.MenuItem(tutorial.label,tutorial.start.bind(tutorial)));}};TutorialSubMenu.prototype=new StyledElements.SubMenuItem();Wirecloud.ui.TutorialSubMenu=TutorialSubMenu;})();(function(){"use strict";var PopUp=function PopUp(element,options){StyledElements.ObjectWithEvents.call(this,['close']);this.element=element;this.options=options;if(options.highlight===true){if(element instanceof StyledElements.StyledElement){element.addClassName('tuto_highlight');}else{element.classList.add('tuto_highlight');}}
this.wrapperElement=document.createElement("div");this.wrapperElement.className='popup alert alert-info';if(options.closable){this.cancelButton=new StyledElements.StyledButton({'class':'button icon-remove','plain':true});this.cancelButton.addEventListener('click',function(){this.destroy();this.events.close.dispatch(this);}.bind(this));this.cancelButton.insertInto(this.wrapperElement);}
this.textElement=document.createElement("div");if(options.msg==null){this.wrapperElement.classList.add("empty");}else{this.textElement.innerHTML=options.msg;}
this.warningIco=document.createElement("span");this.warningIco.className='warningIco icon-warning-sign';this.wrapperElement.appendChild(this.warningIco);this.wrapperElement.appendChild(this.textElement);this.arrow=document.createElement("div");this.arrow.className="popUpArrowDiv icon-hand-up";this.wrapperElement.appendChild(this.arrow);this.arrow.classList.add(options.position);};PopUp.prototype=new StyledElements.ObjectWithEvents();PopUp.prototype.repaint=function repaint(){var pos=this.element.getBoundingClientRect();var wrapperPos=this.wrapperElement.getBoundingClientRect();switch(this.options.position){default:case'downRight':this.wrapperElement.style.top=(pos.top+pos.height+22)+'px';this.wrapperElement.style.left=(pos.left+pos.width+22)+'px';this.arrow.style.top='-28px';this.arrow.style.left='-19px';break;case'downLeft':this.wrapperElement.style.top=(pos.top+pos.height+22)+'px';this.wrapperElement.style.left=(pos.left-wrapperPos.width-22)+'px';this.arrow.style.top='-24px';this.arrow.style.right='-24px';break;case'topRight':this.wrapperElement.style.top=(pos.top-wrapperPos.height-22)+'px';this.wrapperElement.style.left=(pos.left+pos.width+20)+'px';this.arrow.style.top=(wrapperPos.height-16)+'px';this.arrow.style.left='-23px';break;case'topLeft':this.wrapperElement.style.top=(pos.top-wrapperPos.height-22)+'px';this.wrapperElement.style.left=(pos.left-wrapperPos.width-31)+'px';this.arrow.style.top=(wrapperPos.height-12)+'px';this.arrow.style.right='-27px';break;}};PopUp.prototype.destroy=function destroy(){if(this.wrapperElement==null){return;}
if(this.options.highlight){if(this.element instanceof StyledElements.StyledElement){this.element.removeClassName('tuto_highlight');}else{this.element.classList.remove('tuto_highlight');}}
if(this.wrapperElement.parentNode){this.wrapperElement.parentNode.removeChild(this.wrapperElement);}
this.wrapperElement=null;this.textElement=null;this.arrow=null;};Wirecloud.ui.Tutorial.PopUp=PopUp;var WidgetElement=function WidgetElement(widget,element){this.widget=widget;this.element=element;this.classList={'add':function(){this.add.apply(this,arguments);}.bind(this.element.classList),'remove':function(){this.remove.apply(this,arguments);}.bind(this.element.classList)};Object.freeze(this.classList);Object.freeze(this);};WidgetElement.prototype.getBoundingClientRect=function getBoundingClientRect(){var widget_box=this.widget.content.getBoundingClientRect();var element_box=this.element.getBoundingClientRect();return{'left':widget_box.left+element_box.left,'top':widget_box.top+element_box.top,'width':element_box.width,'height':element_box.height};};WidgetElement.prototype.addEventListener=function(){this.element.addEventListener.apply(this.element,arguments);};WidgetElement.prototype.removeEventListener=function(){this.element.removeEventListener.apply(this.element,arguments);};Wirecloud.ui.Tutorial.WidgetElement=WidgetElement;})();(function(){"use strict";var setDialogPosition=function setDialogPosition(ref_pos,pos){switch(pos){case'up':this.htmlElement.style.top=(ref_pos.top-this.htmlElement.offsetHeight-20)+'px';this.htmlElement.style.left=(ref_pos.left+(ref_pos.width-this.htmlElement.offsetWidth)/2)+'px';break;case'right':this.htmlElement.style.top=(ref_pos.top+(ref_pos.height-this.htmlElement.offsetHeight)/2)+'px';this.htmlElement.style.left=(ref_pos.right+20)+'px';break;case'left':this.htmlElement.style.top=(ref_pos.top+(ref_pos.height-this.htmlElement.offsetHeight)/2)+'px';this.htmlElement.style.left=(ref_pos.left-this.htmlElement.offsetWidth-20)+'px';break;case'down':this.htmlElement.style.top=(ref_pos.bottom+20)+'px';this.htmlElement.style.left=(ref_pos.left+(ref_pos.width-this.htmlElement.offsetWidth)/2)+'px';break;}};var standsOut=function standsOut(){var parent_box=document.body.getBoundingClientRect();var element_box=this.htmlElement.getBoundingClientRect();var visible_width=element_box.width-Math.max(element_box.right-parent_box.right,0)-Math.max(parent_box.left-element_box.left,0);var visible_height=element_box.height-Math.max(element_box.bottom-parent_box.bottom,0)-Math.max(parent_box.top-element_box.top,0);var element_area=element_box.width*element_box.height;var visible_area=visible_width*visible_height;return element_area-visible_area;};var fixPosition=function fixPosition(refPosition,weights,positions){var best_weight=Math.min.apply(Math,weights);var index=weights.indexOf(best_weight);var position=positions[index];setDialogPosition.call(this,refPosition,position);};var SimpleDescription=function SimpleDescription(tutorial,options){this.options=options;this.element=options.elem;this.tutorial=tutorial;this.layer=tutorial.msgLayer;this.last=false;this.pos=options.pos;this.title=options.title;this.nextButtonText=gettext('Next');if(options.nextButtonText){this.nextButtonText=options.nextButtonText;}
Wirecloud.ui.WindowMenu.call(this,this.title,'simpleDescription');this.windowContent.innerHTML=options.msg;this.nextButton=new StyledElements.StyledButton({'class':'nextButton btn-primary','text':gettext(this.nextButtonText),});this.nextButton.insertInto(this.windowBottom);this.cancelButton=new StyledElements.StyledButton({'class':'cancelButton','text':gettext("Cancel"),});this.cancelButton.insertInto(this.windowBottom);this.cancelButton.addEventListener('click',this._closeListener);this.layer.appendChild(this.htmlElement);this.wrapperElement=this.htmlElement;};SimpleDescription.prototype=new Wirecloud.ui.WindowMenu();SimpleDescription.prototype._closeListener=function _closeListener(e){Wirecloud.ui.WindowMenu.prototype._closeListener.call(this,e);this.tutorial.destroy();};SimpleDescription.prototype.getStylePosition=function getStylePosition(){var coordinates;coordinates={posX:parseInt(this.htmlElement.style.left,10),posY:parseInt(this.htmlElement.style.top,10)};return coordinates;};SimpleDescription.prototype.setPosition=function setPosition(coordinates){this.htmlElement.style.left=coordinates.posX+'px';this.htmlElement.style.top=coordinates.posY+'px';};SimpleDescription.prototype.setLast=function setLast(buttonLabel,optionalHandler){this.last=true;Wirecloud.Utils.removeFromParent(this.nextButton.wrapperElement);if(buttonLabel==null){buttonLabel=gettext('Close');}
this.cancelButton.setLabel(gettext(buttonLabel));if(optionalHandler!=null){this.cancelButton.removeEventListener('click',this._closeListener);this.cancelButton.addEventListener('click',optionalHandler.bind(this));}};SimpleDescription.prototype.setNext=function setNext(){this.nextButton.addEventListener('click',function(){if(this.element!=null){this.element.classList.remove('tuto_highlight');}
this.tutorial.nextStep();}.bind(this));};var _activate=function _activate(){var i=0,ref_pos,weights,positions;this.htmlElement.classList.add("activeStep");if(typeof this.element==='function'){this.element=this.element();this.tutorial.setControlLayer(this.element,true);this.element.classList.add('tuto_highlight');}else{this.tutorial.resetControlLayer(false);}
if(this.element!=null){ref_pos=this.element.getBoundingClientRect();weights=[];positions=['down','left','top','right'];do{setDialogPosition.call(this,ref_pos,positions[i]);weights.push(standsOut.call(this));i+=1;}while(weights[i-1]>0&&i<positions.length);if(weights[i-1]>0){fixPosition.call(this,ref_pos,weights,positions);}}else{this.htmlElement.style.top=((window.innerHeight/2)-(this.htmlElement.offsetHeight/2))+'px';this.htmlElement.style.left=((window.innerWidth/2)-(this.htmlElement.offsetWidth/2))+'px';}
this.nextButton.focus();};SimpleDescription.prototype.activate=function activate(){if(this.options.asynchronous){this.element(_activate.bind(this));}else{_activate.call(this);}};Wirecloud.ui.Tutorial.SimpleDescription=SimpleDescription;})();(function(){"use strict";var build_disable_elements_list=function build_disable_elements_list(list){var i,elements,result=[];for(i=0;i<list.length;i++){if(typeof list[i]==='object'){result.push(list[i]);}else if(typeof list[i]==='function'){elements=list[i]();if(elements instanceof NodeList){result=result.concat([].slice.call(elements));}else if(Array.isArray(elements)){result=result.concat(elements);}else{result.push(elements);}}}
return result;};var get_simple_element=function get_simple_element(element,fallback){if(element==null){element=fallback;}
if(typeof element==='function'){return element();}else{return element;}};var configure_next_step_phase=function configure_next_step_phase(){var msg;if(this.popup){this.popup.destroy();}
this.next_element=get_simple_element(this.options.elemToApplyNextStepEvent,this.element);this.next_element.addEventListener(this.event,this.nextHandler,this.options.eventCapture);if(this.start_element!=null){this.tutorial.deactivateLayer();}else{this.tutorial.setControlLayer(this.next_element);}
if(this.start_element!=null&&this.options.nextStepMsg){msg=this.options.nextStepMsg;}else if(this.start_element==null&&this.options.msg){msg=this.options.msg;}
if(msg){this.popup=new Wirecloud.ui.Tutorial.PopUp(this.next_element,{highlight:true,msg:msg,position:this.nextPosition,closable:!this.withoutCloseButton});this.layer.appendChild(this.popup.wrapperElement);this.popup.repaint();this.popup.addEventListener('close',this.tutorial.destroy.bind(this.tutorial));}};var configure_start_phase=function configure_start_phase(){if(this.popup){this.popup.destroy();}
this.start_element=get_simple_element(this.options.elemToApplyDeactivateLayerEvent,this.element);this.start_element.addEventListener(this.eventToDeactivateLayer,this.deactivateLayer,true);this.isWaitingForDeactivateLayerEvent=true;this.tutorial.setControlLayer(this.start_element);this.popup=new Wirecloud.ui.Tutorial.PopUp(this.start_element,{highlight:true,msg:this.options.msg,position:this.position,closable:!this.withoutCloseButton});this.layer.appendChild(this.popup.wrapperElement);this.popup.repaint();this.popup.addEventListener('close',this.tutorial.destroy.bind(this.tutorial));};var clear_restart_handlers=function clear_restart_handlers(){var i,restart_handler;for(i=0;i<this.restart_handlers.length;i++){restart_handler=this.restart_handlers[i];restart_handler.element.removeEventListener(restart_handler.event,restart_handler.func,true);}
this.restart_handlers=[];};var restartStep=function restartStep(){var i;this.next_element.removeEventListener(this.event,this.nextHandler,this.options.eventCapture);this.next_element=null;for(i=0;i<this.disableLayer.length;i++){this.layer.removeChild(this.disableLayer[i]);}
this.disableLayer=[];clear_restart_handlers.call(this);configure_start_phase.call(this);};var UserAction=function UserAction(tutorial,options){this.options=options;this.options.asynchronous=!!this.options.asynchronous;this.layer=tutorial.msgLayer;this.last=false;this.tutorial=tutorial;this.element=options.elem;this.position=options.pos;this.nextPosition=options.secondPos?options.secondPos:this.position;if(options.event){this.event=options.event;}else{this.event='click';}
this.activeLayer=true;this.deactivateLayer=this.deactivateLayer.bind(this);this.restartStep=restartStep.bind(this);this.disableElems=options.disableElems;if(this.disableElems==null){this.disableElems=[];}
this.restart_handlers=[];this.disableLayer=[];if(options.eventCapture!=null){options.eventCapture=!!options.eventCapture;}else{options.eventCapture=true;}
if(!Array.isArray(options.restartHandlers)){options.restartHandlers=[];}
this.eventToDeactivateLayer=options.eventToDeactivateLayer;this.isWaitingForDeactivateLayerEvent=false;if(typeof this.options.eventFilterFunction!=='function'){this.options.eventFilterFunction=function(){return true;};}
this.nextHandler=function(){if(this.options.eventFilterFunction.apply(null,arguments)){this.tutorial.destroy();}}.bind(this);};UserAction.prototype.setLast=function setLast(){this.last=true;};UserAction.prototype.setNext=function setNext(){this.nextHandler=function(){if(this.options.eventFilterFunction.apply(null,arguments)){nextHandler.call(this);}}.bind(this);};UserAction.prototype.deactivateLayer=function deactivateLayer(){var i,restart_handler,element;this.isWaitingForDeactivateLayerEvent=false;this.start_element.removeEventListener(this.eventToDeactivateLayer,this.deactivateLayer,true);for(i=0;i<this.options.restartHandlers.length;i++){restart_handler=this.options.restartHandlers[i];element=get_simple_element(restart_handler.element);element.addEventListener(restart_handler.event,this.restartStep,true);this.restart_handlers.push({'element':element,'event':restart_handler.event,'func':this.restartStep});}
var disableElems=build_disable_elements_list(this.disableElems);for(i=0;i<disableElems.length;i++){this.disableLayer[i]=this.disable(disableElems[i]);}
configure_next_step_phase.call(this);};UserAction.prototype.disable=function disable(elem){var pos,disableLayer;pos=elem.getBoundingClientRect();disableLayer=document.createElement("div");disableLayer.className='disableLayer';disableLayer.style.top=pos.top+'px';disableLayer.style.left=pos.left+'px';disableLayer.style.width=pos.width+'px';disableLayer.style.height=pos.height+'px';this.layer.appendChild(disableLayer);return disableLayer;};var nextHandler=function nextHandler(){if(this.isWaitingForDeactivateLayerEvent){return;}
this.next_element.removeEventListener(this.event,this.nextHandler,this.options.eventCapture);this.next_element=null;this.tutorial.nextStep();};var _activate=function _activate(element,withoutCloseButton){if(element!=null){this.start_element=element;}
this.withoutCloseButton=withoutCloseButton;if(this.options.eventToDeactivateLayer!=null){configure_start_phase.call(this);}else{configure_next_step_phase.call(this);}};UserAction.prototype.activate=function activate(withoutCloseButton){if(this.options.asynchronous){this.element(_activate.bind(this));}else{_activate.call(this,null,withoutCloseButton);}};UserAction.prototype.destroy=function destroy(){var i;if(this.start_element){this.start_element.removeEventListener(this.eventToDeactivateLayer,this.deactivateLayer,true);this.start_element=null;}
if(this.next_element){this.next_element.removeEventListener(this.event,this.nextHandler,this.options.eventCapture);this.next_element=null;}
for(i=0;i<this.disableLayer.length;i++){this.layer.removeChild(this.disableLayer[i]);}
this.disableLayer=null;clear_restart_handlers.call(this);if(this.popup!=null){this.popup.destroy();}
this.textElement=null;this.arrow=null;};Wirecloud.ui.Tutorial.UserAction=UserAction;})();(function(){"use strict";var FormAction=function FormAction(tutorial,options){this.options=options;this.options.asynchronous=!!this.options.asynchronous;this.layer=tutorial.msgLayer;this.last=false;this.tutorial=tutorial;this.mainTitle=options.mainTitle;this.mainMsg=options.mainMsg;this.mainPos=options.mainPos;this.actionElements=options.actionElements;this.actionElementsPos=options.actionElementsPos;this.actionElementsValidators=options.actionElementsValidators;this.actionMsgs=options.actionMsgs;this.disableElems=options.disableElems;this.endElement=options.endElement;this.endElementMsg=options.endElementMsg;this.endElementPos=options.endElementPos;this.form=options.form;this.mainPos=options.mainPos;this.subSteps=[];this.disableLayer=[];this.invalidcounter=0;if(!Array.isArray(this.disableElems)){this.disableElems=[];}
if(this.mainMsg){this.mainStep=new Wirecloud.ui.Tutorial.SimpleDescription(tutorial,{'type':'simpleDescription','title':gettext(this.mainTitle),'msg':gettext(this.mainMsg),'elem':null});this.mainStep.setLast();}};FormAction.prototype.setLast=function setLast(){this.last=true;};FormAction.prototype.setNext=function setNext(){this.nextHandler=nextHandler.bind(this);};var nextHandler=function nextHandler(){this.tutorial.nextStep();};var _activate=function _activate(form){var pos,i,tempElem;this.element=form;if(this.mainStep){this.mainStep.wrapperElement.classList.add("activeStep");pos=form.getBoundingClientRect();switch(this.mainPos){case'up':this.mainStep.wrapperElement.style.top=(pos.top-this.mainStep.wrapperElement.offsetHeight-20)+'px';break;case'right':this.mainStep.wrapperElement.style.left=(pos.right+20)+'px';break;case'left':this.mainStep.wrapperElement.style.left=(pos.left-this.mainStep.wrapperElement.offsetWidth-20)+'px';break;case'down':this.mainStep.wrapperElement.style.top=(pos.bottom+20)+'px';break;default:break;}}
this.endAction=new Wirecloud.ui.Tutorial.UserAction(this.tutorial,{'type':'userAction','msg':this.endElementMsg,'elem':form.acceptButton,'pos':this.endElementPos});this.endAction.setNext();var withoutCloseButton=true;this.endAction.activate(withoutCloseButton);var activateSubFormAction=function(index){this.subSteps[index].wrapperElement.classList.add('activate');validateInput.call(this,index);};var deActivateSubFormAction=function(index){this.subSteps[index].wrapperElement.classList.remove('activate');};var validateInput=function(index){if(!this.actionElementsValidators[index](this.actionElements[index]())&&!this.subSteps[index].wrapperElement.classList.contains('invalid')){this.subSteps[index].wrapperElement.classList.add('invalid');this.form.acceptButton.disable();this.invalidcounter++;}else if(this.actionElementsValidators[index](this.actionElements[index]())&&this.subSteps[index].wrapperElement.classList.contains('invalid')){this.subSteps[index].wrapperElement.classList.remove('invalid');this.invalidcounter--;if(this.invalidcounter===0){this.form.acceptButton.enable();}}};for(i=0;i<this.actionElements.length;i++){this.subSteps[i]=new Wirecloud.ui.Tutorial.PopUp(this.actionElements[i](),{highlight:false,msg:this.actionMsgs[i],position:this.actionElementsPos[i],closable:false});this.layer.appendChild(this.subSteps[i].wrapperElement);this.subSteps[i].wrapperElement.classList.add('subFormAction');this.subSteps[i].repaint();tempElem=this.actionElements[i]();tempElem.addEventListener('keyup',validateInput.bind(this,i),true);tempElem.addEventListener('focus',activateSubFormAction.bind(this,i),true);tempElem.addEventListener('blur',deActivateSubFormAction.bind(this,i),true);}
if(this.actionElements!=null){activateSubFormAction.call(this,0);}
for(i=0;i<this.disableElems.length;i++){this.disableLayer[i]=this.disable(this.disableElems[i]());}
form.cancelButton.disable();this.tutorial.resetControlLayer();this.tutorial.deactivateLayer();};FormAction.prototype.activate=function activate(){if(this.options.asynchronous){this.form(_activate.bind(this));}else{_activate.call(this,this.form());}};FormAction.prototype.disable=function disable(elem){var pos,disableLayer;pos=elem.getBoundingClientRect();disableLayer=document.createElement("div");disableLayer.classList.add('disableLayer');disableLayer.style.top=pos.top+'px';disableLayer.style.left=pos.left+'px';disableLayer.style.width=pos.width+'px';disableLayer.style.height=pos.height+'px';this.layer.appendChild(disableLayer);return disableLayer;};FormAction.prototype.destroy=function destroy(){var i;for(i=0;i<this.disableLayer.length;i++){this.layer.removeChild(this.disableLayer[i]);}
for(i=0;i<this.subSteps.length;i++){this.subSteps[i].destroy();}
if(this.mainStep!=null){this.mainStep.destroy();this.mainStep=null;}
if(this.endAction!=null){this.endAction.destroy();this.endAction=null;}};Wirecloud.ui.Tutorial.FormAction=FormAction;})();(function(){"use strict";var AutoAction=function AutoAction(tutorial,options){this.options=options;this.options.asynchronous=!!this.options.asynchronous;this.layer=tutorial.msgLayer;this.last=false;this.tutorial=tutorial;this.element=options.elem;this.position=options.pos;this.event=options.event;this.action=options.action;};AutoAction.prototype.setLast=function setLast(){this.last=true;};AutoAction.prototype.setNext=function setNext(){this.nextHandler=nextHandler.bind(this);};var nextHandler=function nextHandler(){if(this.element!=null){this.element.classList.remove('tuto_highlight');}
this.tutorial.nextStep();};var _activate=function _activate(element,withoutCloseButton){if(element!=null){this.element=element;}
if(element!=null){this.popup=new Wirecloud.ui.Tutorial.PopUp(this.element,{highlight:true,msg:this.options.msg,position:this.position,closable:!withoutCloseButton});this.layer.appendChild(this.popup.wrapperElement);this.popup.repaint();this.popup.addEventListener('close',this.tutorial.destroy.bind(this.tutorial,true));this.tutorial.setControlLayer(element,true);}else{this.tutorial.resetControlLayer();}
this.action(this,this.element);};AutoAction.prototype.activate=function activate(withoutCloseButton){if(this.element==null){_activate.call(this,null,withoutCloseButton);}else if(this.options.asynchronous){this.element(_activate.bind(this));}else{_activate.call(this,this.element(),withoutCloseButton);}};AutoAction.prototype.destroy=function destroy(){if(typeof this.element==='function'){this.element=null;}else if(this.element!=null){this.element.removeEventListener('click',this.nextHandler,true);}
if(this.popup){this.popup.destroy();}
this.textElement=null;this.arrow=null;};Wirecloud.ui.Tutorial.AutoAction=AutoAction;})();(function(){"use strict";var anchor_element=document.createElement('a');anchor_element.href=Wirecloud.URLs.LOCAL_REPOSITORY;var base_url=anchor_element.href;if(base_url[base_url.length-1]!=='/'){base_url+='/';}
base_url+='static/';var create_workspace=function create_workspace(autoAction){LayoutManagerFactory.getInstance().changeCurrentView('workspace');Wirecloud.createWorkspace({name:'Basic concepts tutorial',allow_renaming:true,onSuccess:function(workspace){Wirecloud.changeActiveWorkspace(workspace,null,{onSuccess:function(){autoAction.nextHandler();},onFailure:function(){autoAction.fail();}});}});};var build_static_url=function build_static_url(path){return base_url+path;};var install_input_box=function install_input_box(autoAction){if(!Wirecloud.LocalCatalogue.resourceExistsId('CoNWeT/input-box/1.0')){Wirecloud.LocalCatalogue.addResourceFromURL(build_static_url('tutorial-data/CoNWeT_input-box_1.0.wgt'),{onSuccess:autoAction.nextHandler.bind(autoAction)});}else{autoAction.nextHandler();}};var install_youtubebrowser=function install_youtubebrowser(autoAction){if(!Wirecloud.LocalCatalogue.resourceExistsId('CoNWeT/youtube-browser/2.99.0')){Wirecloud.LocalCatalogue.addResourceFromURL(build_static_url('tutorial-data/CoNWeT_youtube-browser_2.99.0.wgt'),{onSuccess:autoAction.nextHandler.bind(autoAction)});}else{autoAction.nextHandler();}};var ResizeButton=function(){return document.getElementsByClassName("rightResizeHandle")[0];};var widget=function(index){var widget=Wirecloud.activeWorkspace.getIWidgets()[index];return widget.element;};var widget_title=function(index){var widget=Wirecloud.activeWorkspace.getIWidgets()[index];return widget.element.getElementsByClassName("widget_menu")[0].getElementsByTagName('span')[0];};var findElementByTextContent=function findElementByTextContent(nodes,text){var i;for(i=0;i<nodes.length;i++){if(nodes[i].textContent.toLowerCase()==text.toLowerCase()){return nodes[i];}}
return null;};var getDocument=function(){return document;};var wirecloud_header=function wirecloud_header(){return document.getElementById('wirecloud_header');};var append_character=function append_character(element,character){element.value+=character;};Wirecloud.ui.Tutorial.utils={basic_actions:{sleep:function sleep(milliseconds,autoAction){setTimeout(function(){autoAction.nextHandler();},milliseconds);},input:function input(text,autoAction,element){var timeout,i;if(element.tagName!=='input'){element=element.querySelector('input');}
element.value="";timeout=0;for(i=0;i<text.length;i++){timeout+=300;setTimeout(append_character.bind(null,element,text[i]),timeout);}
setTimeout(function(){var evt=document.createEvent("KeyboardEvent");if(evt.initKeyEvent!=null){evt.initKeyEvent("keypress",true,true,window,false,false,false,false,13,0);}else{Object.defineProperty(evt,'keyCode',{get:function(){return 13;}});evt.initKeyboardEvent("keypress",true,true,window,0,0,0,0,0,13);}
element.dispatchEvent(evt);},timeout);timeout+=1600;setTimeout(function(){autoAction.nextHandler();},timeout);}},basic_selectors:{back_button:function back_button(){return document.querySelector("#wirecloud_header .icon-caret-left").parentElement;},toolbar_button:function toolbar_button(button_class){return document.querySelector("#wirecloud_header .wirecloud_toolbar").getElementsByClassName(button_class)[0].parentElement;},mac_wallet_close_button:function mac_wallet_close_button(){return document.querySelector('.widget_wallet .icon-remove');},mac_wallet_input:function mac_wallet_input(){return document.querySelector('.widget_wallet .se-text-field');},mac_wallet_resource_mainbutton:function mac_wallet_resource_mainbutton(resource_title){var resources,widget,element;resources=document.querySelectorAll('.widget_wallet .widget_wallet_list .resource_name');widget=findElementByTextContent(resources,resource_title);element=widget.parentNode.getElementsByClassName("mainbutton")[0];return element;}}};var BS=Wirecloud.ui.Tutorial.utils.basic_selectors;var BA=Wirecloud.ui.Tutorial.utils.basic_actions;var get_menubar=function get_menubar(){var wiring_editor=document.getElementsByClassName('wiring_editor')[0];return wiring_editor.getElementsByClassName('menubar')[0];};var getMenuWorkspaceButton=function(){return document.getElementById('wirecloud_breadcrum').getElementsByClassName('icon-menu')[0];};var getAdminButton=function(){var header=document.getElementById('wirecloud_header');var elements=header.getElementsByClassName('user_menu_wrapper');if(elements.length==0){elements=header.getElementsByClassName('nav pull-right');}
return elements[0];};var get_close_buttons=function get_close_buttons(){var workspace=document.getElementById('workspace');return workspace.getElementsByClassName('icon-remove');};var widget_menu=function widget_menu(index){var iwidget=Wirecloud.activeWorkspace.getIWidgets()[index];return iwidget.element.getElementsByClassName('icon-cogs')[0];};var get_mini_widget=function get_mini_widget(index){var widget_id=Wirecloud.activeWorkspace.getIWidgets()[index].id;return LayoutManagerFactory.getInstance().viewsByName.wiring.mini_widgets[widget_id].wrapperElement;};var deploy_tutorial_menu=function deploy_tutorial_menu(autoAction){var header=document.getElementById('wirecloud_header');var button=header.getElementsByClassName('arrow-down-settings')[0];if(button==null){button=header.getElementsByClassName('btn-success')[0].firstChild;}
button.click();autoAction.nextHandler();};var get_menu_item=function get_menu_item(label){var popup_menu=document.getElementsByClassName('se-popup-menu')[0];return findElementByTextContent(popup_menu.getElementsByClassName('se-popup-menu-item'),label);};var get_endpoint=function get_endpoint(index,name){var widget_id=Wirecloud.activeWorkspace.getIWidgets()[index].id;var wiringEditor=LayoutManagerFactory.getInstance().viewsByName["wiring"];return wiringEditor.iwidgets[widget_id].getAnchor(name).wrapperElement;};var get_full_endpoint=function get_endpoint(index,name){var widget_id=Wirecloud.activeWorkspace.getIWidgets()[index].id;var wiringEditor=LayoutManagerFactory.getInstance().viewsByName["wiring"];return wiringEditor.iwidgets[widget_id].getAnchor(name).wrapperElement.parentElement;};var get_wiring_canvas=function get_wiring_canvas(){var wiringEditor=LayoutManagerFactory.getInstance().viewsByName["wiring"];return wiringEditor.canvas;};var get_wiring=function get_wiring(){return LayoutManagerFactory.getInstance().viewsByName["wiring"];};var input_box_input=function input_box_input(){var widget=Wirecloud.activeWorkspace.getIWidgets()[1];return new Wirecloud.ui.Tutorial.WidgetElement(widget,widget.content.contentDocument.getElementsByTagName('input')[0]);};var enter_keypress=function(e){return e.keyCode===13;};var windowForm=function(callback){var layoutManager,element,interval;layoutManager=LayoutManagerFactory.getInstance();interval=setInterval(function(){if('_current_form'in layoutManager.currentMenu){clearInterval(interval);callback(layoutManager.currentMenu._current_form);}},200);};function getField(inputName){var layoutManager;layoutManager=LayoutManagerFactory.getInstance();return layoutManager.currentMenu._current_form.fieldInterfaces[inputName].inputElement.inputElement;};var isNotEmpty=function(input){return input.value!='';};Wirecloud.TutorialCatalogue.add('basic-concepts',new Wirecloud.ui.Tutorial(gettext('Basic concepts'),[{type:'simpleDescription',title:gettext('WireCloud Basic Tutorial'),msg:gettext("<p>Welcome to WireCloud!!</p><p>This tutorial will show you the basic concepts behind WireCloud.</p>")},{type:'autoAction',action:create_workspace},{type:'simpleDescription',title:gettext('WireCloud Basic Tutorial'),msg:gettext('<p>This is the <em>Editor</em> view. In this view, you can use and modify your workspaces. Currently you are in a newly created workspace: <em>Basic concepts tutorial</em>. This workspace is empty, so the first step is to add some widgets.</p><div class="alert alert-info"><p>In next steps we need some widgets, so we are going to install them for you in the catalogue. You can safetly uninstall these widgets after finishing the tutorial.</p></div>')},{'type':'autoAction','action':install_input_box},{'type':'autoAction','action':install_youtubebrowser},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("<p>Ok, widgets have been installed successfuly.</p><p>Next step is to add the <em>YouTube Browser</em> widget to the workspace.</p>")},{'type':'userAction','msg':gettext("Click the <em>add widget button</em>"),'elem':BS.toolbar_button.bind(null,'icon-plus'),'pos':'downLeft'},{'type':'autoAction','action':BA.sleep.bind(null,0.5)},{'type':'autoAction','msg':gettext('Typing "browser" we can filter widgets that contains in their name or description these words'),'elem':BS.mac_wallet_input,'pos':'downRight','action':BA.input.bind(null,'browser')},{'type':'userAction','msg':gettext("Once you have the results, you can add the widget. So click <em>Add to workspace</em>"),'elem':BS.mac_wallet_resource_mainbutton.bind(null,"YouTube Browser"),'pos':'downRight'},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("<p><span class=\"label label-success\">Great!</span> That was easy, wasn't it?.</p><p>Let's continue adding the <em>Input Box</em> widget.</p>"),'elem':null},{'type':'autoAction','msg':gettext('Typing <em>input box</em>...'),'elem':BS.mac_wallet_input,'pos':'downRight','action':BA.input.bind(null,'input box')},{'type':'userAction','msg':gettext("Click <em>Add to workspace</em>"),'elem':BS.mac_wallet_resource_mainbutton.bind(null,"Input Box"),'pos':'downRight'},{'type':'userAction','msg':gettext("Close the widget wallet"),'elem':BS.mac_wallet_close_button,'pos':'downRight'},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("<p>One of the main features of WireCloud is that you can edit your workspaces' layout not only by adding and removing widgets, but also moving, resizing, renaming, etc.</p>"),'elem':null},{'type':'userAction','msg':gettext("Drag &amp; drop to resize the widget"),'elem':ResizeButton,'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown'},{'type':'userAction','msg':gettext("Drag &amp; drop to move the widget"),'elem':widget_title.bind(null,1),'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':getDocument},{'type':'userAction','msg':gettext("Open <em>Input Box</em> menu"),'elem':widget_menu.bind(null,1),'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':getDocument},{'type':'userAction','msg':gettext("Click <em>Rename</em>"),'elem':get_menu_item.bind(null,gettext('Rename')),'pos':'downRight','event':'click'},{'type':'userAction','msg':gettext("Enter a new name for the widget (e.g <em>Search</em>) and press Enter"),'elem':widget_title.bind(null,1),'pos':'downRight','event':'blur'},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("<p>Also, some widgets can be parameterized through settings giving you the chance to use them for very general purporses.</p>"),'elem':null},{'type':'userAction','msg':gettext("Open <em>Input Box</em> menu"),'elem':widget_menu.bind(null,1),'pos':'downRight','event':'mouseup','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':getDocument},{'type':'userAction','msg':gettext("Click <em>Settings</em>"),'elem':get_menu_item.bind(null,gettext('Settings')),'pos':'downRight','event':'click'},{'type':'formAction','form':windowForm,'actionElements':[getField.bind(null,'input_label_pref'),getField.bind(null,'input_placeholder_pref'),getField.bind(null,'button_label_pref')],'actionElementsValidators':[isNotEmpty,isNotEmpty,isNotEmpty],'actionMsgs':[gettext("Write a label for the input, e.g. <em>Multimedia</em>."),gettext("Write a better placeholder text for the input, e.g. <em>Keywords</em>"),gettext("Write a better label for the button, e.g <em>Search</em>.")],'actionElementsPos':['topRight','topRight','topRight'],'endElementMsg':gettext("Click here to submit"),'endElementPos':'topLeft','asynchronous':true},{'type':'userAction','msg':gettext("Click <em>Wiring</em> to continue"),'elem':BS.toolbar_button.bind(null,'icon-puzzle-piece'),'pos':'downLeft'},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("<p>This is the <em>Wiring</em> view.</p><p>Here you can wire widgets and operators together turning your workspace into and <em>application mashup</em>.</p>"),'elem':null},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("<p>In left menu you can find all the widgets that have been added into your workspace. In our example these widgets will be the <em>YouTube Browser</em> and the <em>Input Box</em> (It will be listed using the new name given in previous step).</p><p>You can also find <em>operators</em>. These components can act as source, transformators or data targets and a combination of these behaviours.</p>"),'elem':get_menubar},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("<p>In the next steps, we are going to connect the <em>Input Box</em> and <em>YouTube Browser</em> widgets together. This will allow you to perform searches in the <em>YouTube Browser</em> through the <em>Input Box</em> widget.</p>"),'elem':get_menubar},{'type':'userAction','msg':gettext("Drag &amp; drop the <em>Input Box</em> widget"),'elem':get_mini_widget.bind(null,1),'pos':'downRight','restartHandlers':[{'element':get_wiring,'event':'widgetaddfail'},],'event':'widgetadded','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':get_wiring,},{'type':'userAction','msg':gettext("Drag &amp; drop the <em>YouTube Browser</em> widget"),'elem':get_mini_widget.bind(null,0),'pos':'downRight','restartHandlers':[{'element':get_wiring,'event':'widgetaddfail'},],'event':'widgetadded','eventToDeactivateLayer':'mousedown','elemToApplyNextStepEvent':get_wiring,},{'type':'userAction','msg':gettext("Drag &amp; drop a new connection from <em>Search Box</em>'s <em>keyword</em> endpoint ..."),'elem':get_endpoint.bind(null,1,'outputKeyword'),'eventToDeactivateLayer':'mousedown','pos':'downLeft','restartHandlers':[{'element':get_wiring_canvas,'event':'arrowremoved'},{'element':get_wiring_canvas,'event':'arrowadded'}],'disableElems':[wirecloud_header,get_menubar],'nextStepMsg':gettext("... to <em>YouTube Browser</em>'s <em>keyword</em> endpoint"),'elemToApplyNextStepEvent':get_full_endpoint.bind(null,0,'keyword'),'event':'mouseup','secondPos':'downLeft',},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext("Now it's time to test our creation.")},{'type':'userAction','msg':gettext("Click <em>Editor</em>"),'elem':BS.back_button,'pos':'downLeft'},{'type':'userAction','msg':gettext("Enter a search keyword and press Enter"),'elem':input_box_input,'pos':'downLeft','event':'keypress','eventFilterFunction':enter_keypress},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext('<p><span class="label label-success">Congratulations!</span> you have finished your first <em>application mashup</em>.</p><p>As you can see, the <em>YouTube Browser</em> widget has been updated successfuly.</p>'),'elem':widget.bind(null,0)},{'type':'autoAction','action':deploy_tutorial_menu},{'type':'simpleDescription','title':gettext('WireCloud Basic Tutorial'),'msg':gettext('<p>This is the end of this tutorial. Remember that you can always go to the Tutorial menu for others.</p>'),'elem':get_menu_item.bind(null,'Tutorials')},]));})();(function(){"use strict";var onMenuClick=function onMenuClick(view_name){LayoutManagerFactory.getInstance().changeCurrentView(view_name);};var WirecloudHeader=function WirecloudHeader(){};WirecloudHeader.prototype._initUserMenu=function _initUserMenu(){};WirecloudHeader.prototype._paintBreadcrum=function _paintBreadcrum(newView){};WirecloudHeader.prototype._notifyViewChange=function _notifyViewChange(newView){};WirecloudHeader.prototype._notifyWorkspaceLoaded=function _notifyWorkspaceLoaded(workspace){};WirecloudHeader.prototype.refresh=function refresh(){};Wirecloud.ui.WirecloudHeader=WirecloudHeader;})();(function(){"use strict";var NGSI;if((typeof require=='function')&&typeof exports!=null){NGSI=exports;}else{NGSI={};}
NGSI.endpoints={REGISTER_CONTEXT:'ngsi9/registerContext',DISCOVER_CONTEXT_AVAILABILITY:'ngsi9/discoverContextAvailability',SUBSCRIBE_CONTEXT_AVAILABILITY:'ngsi9/subscribeContextAvailability',UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION:'ngsi9/updateContextAvailabilitySubscription',UNSUBSCRIBE_CONTEXT_AVAILABILITY:'ngsi9/unsubscribeContextAvailability',QUERY_CONTEXT:'ngsi10/queryContext',UPDATE_CONTEXT:'ngsi10/updateContext',SUBSCRIBE_CONTEXT:'ngsi10/subscribeContext',UPDATE_CONTEXT_SUBSCRIPTION:'ngsi10/updateContextSubscription',UNSUBSCRIBE_CONTEXT:'ngsi10/unsubscribeContext'};NGSI.proxy_endpoints={EVENTSOURCE_COLLECTION:'eventsource',CALLBACK_COLLECTION:'callbacks'};NGSI.XML={};if(typeof document==='object'&&document!=null&&typeof document.implementation=='object'&&document.implementation.createDocument){NGSI.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){return document.implementation.createDocument(namespaceURL,rootTagName,null);};}else if(typeof DOMImplementation!=='undefined'){NGSI.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){var implementation=new DOMImplementation();return implementation.createDocument(namespaceURL,rootTagName,null);};}else if(typeof window==='object'&&window!=null&&window.ActiveXObject){NGSI.XML.createDocument=function createDocument(namespaceURL,rootTagName,doctype){var doc=new ActiveXObject("MSXML2.DOMDocument");doc.appendChild(NGSI.XML.createElementNS(doc,namespaceURL,rootTagName));return doc;};}else{throw new Error('NGSI.js is not able to create DOM documents in this enviroment');}
if(typeof DOMParser!=='undefined'){NGSI.XML.parseFromString=function parseFromString(text,type,fromAjax){var result,new_header,parser=new DOMParser();fromAjax=fromAjax!==undefined?fromAjax:true;if(fromAjax){result=text.match(new RegExp('<?xml(?:[^\/]|\/[^>])*standalone="([^"]+)"(?:[^\/]|\/[^>])*?>'));if(result&&(result[1]==='yes'||result[1]==='no')){new_header='<?xml version="1.0" standalone="'+result[1]+'" ?>';}else{new_header='<?xml version="1.0" ?>';}
text=text.replace(/<\?xml([^\/]|\/[^>])*\?>/g,new_header);}
return parser.parseFromString(text,type);};}else if(window.ActiveXObject){NGSI.XML.parseFromString=function parseFromString(text,type,fromAjax){var xml=new ActiveXObject("Microsoft.XMLDOM");xml.async=false;xml.loadXML(text);return xml;};}else{NGSI.XML.parseFromString=function parseFromString(text,type,fromAjax){var req=new XMLHttpRequest();req.open('GET','data:'+(type||"application/xml")+';charset=utf-8,'+encodeURIComponent(text),false);if(req.overrideMimeType){req.overrideMimeType(type);}
req.send(null);return req.responseXML;};}
NGSI.XML.getTextContent=function getTextContent(element){if("textContent"in element){return element.textContent;}else if("innerText"in element){return element.innerText;}else if("nodeValue"in element){return element.nodeValue;}
return"";};NGSI.XML.setTextContent=function setTextContent(element,text){if("textContent"in element){element.textContent=text;}else if("innerText"in element){element.innerText=text;}else if("text"in element){element.text=text;}else if("nodeValue"in element){element.nodeValue=text;}};if(typeof XMLSerializer!=='undefined'){NGSI.XML.serialize=function serialize(node){return(new XMLSerializer()).serializeToString(node);};}else{NGSI.XML.serialize=function serialize(node){if(node.xml){return node.xml;}else{throw new Error("Error serializating xml");}};}
if(typeof XPathResult!=='undefined'){NGSI.XML.getChildElementByTagName=function getChildElementByTagName(element,tagName){var xpathResult=element.ownerDocument.evaluate(tagName,element,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return xpathResult.singleNodeValue;};NGSI.XML.getChildElementsByTagName=function getChildElementsByTagName(element,tagName){var xpathResult,result,i;xpathResult=element.ownerDocument.evaluate(tagName,element,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);result=[];for(i=0;i<xpathResult.snapshotLength;i+=1){result.push(xpathResult.snapshotItem(i));}
return result;};}else{NGSI.XML.getChildElementByTagName=function getChildElementByTagName(element,tagName){var i,child;for(i=0;i<element.childNodes.length;i+=1){child=element.childNodes[i];if(child.nodeType===Node.ELEMENT_TYPE||child.localName===tagName){return element.childNodes[i];}}
return null;};NGSI.XML.getChildElementsByTagName=function getChildElementsByTagName(element,tagName){var i,child,result=[];for(i=0;i<element.childNodes.length;i+=1){child=element.childNodes[i];if(child.nodeType===Node.ELEMENT_TYPE||child.localName===tagName){result.push(element.childNodes[i]);}}
return result;};}
var makeXMLRequest=function makeXMLRequest(url,payload,parse_func,callbacks,parameters){this.makeRequest(url,{method:'POST',contentType:'application/xml',requestHeaders:this.request_headers,parameters:parameters,postBody:NGSI.XML.serialize(payload),onSuccess:function(response){if(typeof callbacks.onSuccess==='function'){var doc,data;if(response.responseXML==null){doc=NGSI.XML.parseFromString(response.responseText,'application/xml');}else{doc=response.responseXML;}
try{if(doc.getElementsByTagName('parsererror').length>0){throw new NGSI.InvalidResponseError('Server returned invalid xml content');}
data=parse_func(doc,callbacks);}catch(e){if(typeof callbacks.onFailure==='function'){callbacks.onFailure(e);}
return;}
callbacks.onSuccess.apply(null,data);}},onFailure:function(response){var error;if(typeof callbacks.onFailure==='function'){if([0,502,504].indexOf(response.status)!==-1){error=new NGSI.ConnectionError('Connection Error');}else{error=new NGSI.InvalidResponseError('Unexpected error code: '+response.status);}
callbacks.onFailure(error);}},onComplete:function(response){if(typeof callbacks.onComplete==='function'){callbacks.onComplete();}}});};var assert_root_element=function assert_root_element(doc,expected_root_element){if(doc.documentElement.tagName!==expected_root_element){throw new NGSI.InvalidResponseError('Unexpected root element in response: '+doc.documentElement.tagName);}};var ngsi_build_entity_id_element=function ngsi_build_entity_id_element(doc,entity){var entityId,id;entityId=doc.createElement('entityId');if(entity.type!=null){entityId.setAttribute('type',entity.type);}
entityId.setAttribute('isPattern',(typeof entity.isPattern==='string'&&entity.isPattern.trim().toLowerCase()==='true')||(entity.isPattern===true));id=doc.createElement('id');NGSI.XML.setTextContent(id,entity.id);entityId.appendChild(id);return entityId;};var ngsi_build_scope_restriction_element=function ngsi_build_scope_restriction_element(doc,scope){var restrictionValueElement,vertexListElement,i,vertice,vertexElement,latitudeElement,longitudeElement,invertedElement,centerLatitudeElement,centerLongitudeElement,radiusElement;if('polygon'in scope.value){restrictionValueElement=doc.createElement('polygon');vertexListElement=doc.createElement('vertexList');restrictionValueElement.appendChild(vertexListElement);for(i=0;i<scope.value.polygon.vertices.length;i++){vertice=scope.value.polygon.vertices[i];vertexElement=doc.createElement('vertex');vertexListElement.appendChild(vertexElement);latitudeElement=doc.createElement('latitude');NGSI.XML.setTextContent(latitudeElement,vertice.latitude);vertexElement.appendChild(latitudeElement);longitudeElement=doc.createElement('longuitude');NGSI.XML.setTextContent(longitudeElement,vertice.longitude);vertexElement.appendChild(longitudeElement);}
if(scope.value.polygon.inverted){invertedElement=doc.createElement('inverted');NGSI.XML.setTextContent(invertedElement,'true');restrictionValueElement.appendChild(invertedElement);}}else if('circle'in scope.value){restrictionValueElement=doc.createElement('circle');centerLatitudeElement=doc.createElement('centerLatitude');NGSI.XML.setTextContent(centerLatitudeElement,scope.value.circle.centerLatitude);restrictionValueElement.appendChild(centerLatitudeElement);centerLongitudeElement=doc.createElement('centerLongitude');NGSI.XML.setTextContent(centerLongitudeElement,scope.value.circle.centerLongitude);restrictionValueElement.appendChild(centerLongitudeElement);radiusElement=doc.createElement('radius');NGSI.XML.setTextContent(radiusElement,scope.value.circle.radius);restrictionValueElement.appendChild(radiusElement);if(scope.value.circle.inverted){invertedElement=doc.createElement('inverted');NGSI.XML.setTextContent(invertedElement,'true');restrictionValueElement.appendChild(invertedElement);}}
return restrictionValueElement;};var ngsi_build_restriction_element=function ngsi_build_restriction_element(doc,restriction){var restrictionElement,attributeExpressionElement,scopeElement,operationScopeElement,scopeTypeElement,scopeValueElement,i;restrictionElement=doc.createElement('restriction');if(restriction.attributeExpression!=null){attributeExpressionElement=doc.createElement('attributeExpression');NGSI.XML.setTextContent(attributeExpressionElement,restriction.attributeExpression);restrictionElement.appendChild(attributeExpressionElement);}
if(Array.isArray(restriction.scopes)){scopeElement=doc.createElement('scope');restrictionElement.appendChild(scopeElement);for(i=0;i<restriction.scopes.length;i++){operationScopeElement=doc.createElement('operationScope');scopeTypeElement=doc.createElement('scopeType');NGSI.XML.setTextContent(scopeTypeElement,restriction.scopes[i].type);operationScopeElement.appendChild(scopeTypeElement);scopeValueElement=doc.createElement('scopeValue');scopeValueElement.appendChild(ngsi_build_scope_restriction_element(doc,restriction.scopes[i]));operationScopeElement.appendChild(scopeValueElement);scopeElement.appendChild(operationScopeElement);}}
return restrictionElement;};var ngsi_build_attribute_metadata_element=function ngsi_build_attribute_metadata_element(doc,metadata){var metadataElement,i,contextMetadataElement,nameElement,typeElement,valueElement;metadataElement=doc.createElement('metadata');for(i=0;i<metadata.length;i++){contextMetadataElement=doc.createElement('contextMetadata');nameElement=doc.createElement('name');NGSI.XML.setTextContent(nameElement,metadata[i].name);contextMetadataElement.appendChild(nameElement);typeElement=doc.createElement('type');NGSI.XML.setTextContent(typeElement,metadata[i].type);contextMetadataElement.appendChild(typeElement);valueElement=doc.createElement('value');NGSI.XML.setTextContent(valueElement,metadata[i].value);contextMetadataElement.appendChild(valueElement);metadataElement.appendChild(contextMetadataElement);}
return metadataElement;};var ngsi_build_register_context_request=function ngsi_build_register_context_request(e,attr,duration,providingApplication,regId){var doc,list,registration,entityIdList,i,attributeList,attribute,attributeElement,name,type,isDomain,durationElement,registrationIdElement,providingApplicationElement;doc=NGSI.XML.createDocument(null,'registerContextRequest');list=doc.createElement('contextRegistrationList');doc.documentElement.appendChild(list);registration=doc.createElement('contextRegistration');list.appendChild(registration);entityIdList=doc.createElement('entityIdList');registration.appendChild(entityIdList);for(i=0;i<e.length;i+=1){entityIdList.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
attributeList=doc.createElement('contextRegistrationAttributeList');registration.appendChild(attributeList);for(i=0;i<attr.length;i+=1){attribute=attr[i];attributeElement=doc.createElement('contextRegistrationAttribute');name=doc.createElement('name');NGSI.XML.setTextContent(name,attribute.name);attributeElement.appendChild(name);isDomain=doc.createElement('isDomain');NGSI.XML.setTextContent(isDomain,'false');attributeElement.appendChild(isDomain);if(attribute.type!=null){type=doc.createElement('type');NGSI.XML.setTextContent(type,attribute.type);attributeElement.appendChild(type);}
attributeList.appendChild(attributeElement);}
providingApplicationElement=doc.createElement('providingApplication');NGSI.XML.setTextContent(providingApplicationElement,providingApplication);registration.appendChild(providingApplicationElement);durationElement=doc.createElement('duration');NGSI.XML.setTextContent(durationElement,duration);doc.documentElement.appendChild(durationElement);if(regId!=null){registrationIdElement=doc.createElement('registrationId');NGSI.XML.setTextContent(registrationIdElement,regId);doc.documentElement.appendChild(registrationIdElement);}
return doc;};var ngsi_build_query_context_request=function ngsi_build_query_context_request(e,attrNames,restriction){var doc,entityIdList,i,attributeList,attribute,attributeElement;doc=NGSI.XML.createDocument(null,'queryContextRequest');entityIdList=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdList);for(i=0;i<e.length;i+=1){entityIdList.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
if(Array.isArray(attrNames)){attributeList=doc.createElement('attributeList');doc.documentElement.appendChild(attributeList);for(i=0;i<attrNames.length;i+=1){attribute=attrNames[i];attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attribute);attributeList.appendChild(attributeElement);}}
if(restriction!=null){doc.documentElement.appendChild(ngsi_build_restriction_element(doc,restriction));}
return doc;};var ngsi_build_update_context_request=function ngsi_build_update_context_request(updateAction,update){var doc,list,i,j,contextElement,attributeListElement,attributes,attribute,attributeElement,name,type,contextValueElement,contextValue,updateActionElement;doc=NGSI.XML.createDocument(null,'updateContextRequest');list=doc.createElement('contextElementList');doc.documentElement.appendChild(list);for(i=0;i<update.length;i+=1){contextElement=doc.createElement('contextElement');contextElement.appendChild(ngsi_build_entity_id_element(doc,update[i].entity));attributes=update[i].attributes;attributeListElement=doc.createElement('contextAttributeList');for(j=0;j<attributes.length;j+=1){attribute=attributes[j];attributeElement=doc.createElement('contextAttribute');name=doc.createElement('name');NGSI.XML.setTextContent(name,attribute.name);attributeElement.appendChild(name);if(attribute.type!=null){type=doc.createElement('type');NGSI.XML.setTextContent(type,attribute.type);attributeElement.appendChild(type);}
contextValueElement=doc.createElement('contextValue');if(attribute.contextValue==null){contextValue='emptycontent';}else{contextValue=""+attribute.contextValue;if(contextValue.trim()===''){contextValue='emptycontent';}}
NGSI.XML.setTextContent(contextValueElement,contextValue);attributeElement.appendChild(contextValueElement);if(Array.isArray(attribute.metadata)&&attribute.metadata.length>0){attributeElement.appendChild(ngsi_build_attribute_metadata_element(doc,attribute.metadata));}
attributeListElement.appendChild(attributeElement);}
contextElement.appendChild(attributeListElement);list.appendChild(contextElement);}
updateActionElement=doc.createElement('updateAction');NGSI.XML.setTextContent(updateActionElement,updateAction);doc.documentElement.appendChild(updateActionElement);return doc;};var ngsi_build_discover_context_availability_request=function ngsi_build_discover_context_availability_request(e,attr){var doc,entityIdList,i,attributeList,attribute,attributeElement;doc=NGSI.XML.createDocument(null,'discoverContextAvailabilityRequest');entityIdList=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdList);for(i=0;i<e.length;i+=1){entityIdList.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
attributeList=doc.createElement('attributeList');doc.documentElement.appendChild(attributeList);for(i=0;i<attr.length;i+=1){attribute=attr[i];attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attribute);attributeList.appendChild(attributeElement);}
return doc;};var ngsi_build_subscribe_update_context_availability_request=function ngsi_build_subscribe_update_context_availability_request(rootElement,e,attr,duration,restriction,subscriptionId,onNotify){var doc,entityIdListElement,i,attributeListElement,attributeElement,referenceElement,durationElement,subscriptionIdElement;doc=NGSI.XML.createDocument(null,rootElement);entityIdListElement=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdListElement);for(i=0;i<e.length;i+=1){entityIdListElement.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
if(Array.isArray(attr)&&attr.length>0){attributeListElement=doc.createElement('attributeList');doc.documentElement.appendChild(attributeListElement);for(i=0;i<attr.length;i+=1){attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attr[i]);attributeListElement.appendChild(attributeElement);}}
referenceElement=doc.createElement('reference');NGSI.XML.setTextContent(referenceElement,onNotify);doc.documentElement.appendChild(referenceElement);if(duration!=null){durationElement=doc.createElement('duration');NGSI.XML.setTextContent(durationElement,duration);doc.documentElement.appendChild(durationElement);}
if(restriction!=null){doc.documentElement.appendChild(ngsi_build_restriction_element(doc,restriction));}
if(subscriptionId!=null){subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionId,subscriptionId);doc.documentElement.appendChild(subscriptionIdElement);}
return doc;};var ngsi_build_unsubscribe_context_availability_request=function ngsi_build_unsubscribe_context_availability_request(subId){var doc,subscriptionIdElement;doc=NGSI.XML.createDocument(null,'unsubscribeContextAvailabilityRequest');subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionIdElement,subId);doc.documentElement.appendChild(subscriptionIdElement);return doc;};var ngsi_build_subscribe_update_context_request=function ngsi_build_subscribe_update_context_request(subscriptionId,e,attr,duration,throttling,conditions,onNotify){var doc,entityIdListElement,i,j,attributeListElement,attributeElement,referenceElement,durationElement,notifyConditionsElement,condition,notifyConditionElement,typeElement,condValueListElement,condValueElement,throttlingElement,subscriptionIdElement;if(subscriptionId){doc=NGSI.XML.createDocument(null,'updateContextSubscriptionRequest');}else{doc=NGSI.XML.createDocument(null,'subscribeContextRequest');entityIdListElement=doc.createElement('entityIdList');doc.documentElement.appendChild(entityIdListElement);for(i=0;i<e.length;i+=1){entityIdListElement.appendChild(ngsi_build_entity_id_element(doc,e[i]));}
if(Array.isArray(attr)){attributeListElement=doc.createElement('attributeList');doc.documentElement.appendChild(attributeListElement);for(i=0;i<attr.length;i+=1){attributeElement=doc.createElement('attribute');NGSI.XML.setTextContent(attributeElement,attr[i]);attributeListElement.appendChild(attributeElement);}}}
if(subscriptionId==null){referenceElement=doc.createElement('reference');NGSI.XML.setTextContent(referenceElement,onNotify);doc.documentElement.appendChild(referenceElement);}else{subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionIdElement,subscriptionId);doc.documentElement.appendChild(subscriptionIdElement);}
if(duration!=null){durationElement=doc.createElement('duration');NGSI.XML.setTextContent(durationElement,duration);doc.documentElement.appendChild(durationElement);}
if(Array.isArray(conditions)){notifyConditionsElement=doc.createElement('notifyConditions');doc.documentElement.appendChild(notifyConditionsElement);for(i=0;i<conditions.length;i+=1){condition=conditions[i];notifyConditionElement=doc.createElement('notifyCondition');notifyConditionsElement.appendChild(notifyConditionElement);typeElement=doc.createElement('type');NGSI.XML.setTextContent(typeElement,condition.type);notifyConditionElement.appendChild(typeElement);if(Array.isArray(condition.condValues)){condValueListElement=doc.createElement('condValueList');notifyConditionElement.appendChild(condValueListElement);for(j=0;j<condition.condValues.length;j+=1){condValueElement=doc.createElement('condValue');NGSI.XML.setTextContent(condValueElement,condition.condValues[j]);condValueListElement.appendChild(condValueElement);}}}}
if(throttling!=null){throttlingElement=doc.createElement('throttling');NGSI.XML.setTextContent(throttlingElement,throttling);doc.documentElement.appendChild(throttlingElement);}
return doc;};var ngsi_build_unsubscribe_context_request=function ngsi_build_unsubscribe_context_request(subId){var doc,subscriptionIdElement;doc=NGSI.XML.createDocument(null,'unsubscribeContextRequest');subscriptionIdElement=doc.createElement('subscriptionId');NGSI.XML.setTextContent(subscriptionIdElement,subId);doc.documentElement.appendChild(subscriptionIdElement);return doc;};var parse_metadata_element=function parse_metadata_element(metadataElement){var metadata,metadataElements,i,nameElement,typeElement,valueElement;metadata=[];if(metadataElement==null){return metadata;}
metadataElements=NGSI.XML.getChildElementsByTagName(metadataElement,'contextMetadata');for(i=0;i<metadataElements.length;i++){nameElement=NGSI.XML.getChildElementByTagName(metadataElements[i],'name');typeElement=NGSI.XML.getChildElementByTagName(metadataElements[i],'type');valueElement=NGSI.XML.getChildElementByTagName(metadataElements[i],'value');metadata.push({name:NGSI.XML.getTextContent(nameElement),type:NGSI.XML.getTextContent(typeElement),value:NGSI.XML.getTextContent(valueElement)});}
return metadata;};var parse_register_context_response=function parse_register_context_response(doc){assert_root_element(doc,'registerContextResponse');return[{duration:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'duration')),registrationId:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'registrationId'))}];};var parse_context_registration_response_list=function parse_context_registration_response_list(list){var registrationResponses,registrationResponse,registration,contextRegistrationElement,entityIdListElement,entityIdList,entityIdElement,nameElement,typeElement,entity,idElement,i,j,contextRegistrationAttributeListElement,attributeList,attribute,providingApplicationElement,data=[];registrationResponses=NGSI.XML.getChildElementsByTagName(list,'contextRegistrationResponse');for(i=0;i<registrationResponses.length;i+=1){registrationResponse=registrationResponses[i];registration={entities:[],attributes:[]};contextRegistrationElement=NGSI.XML.getChildElementByTagName(registrationResponse,'contextRegistration');entityIdListElement=NGSI.XML.getChildElementByTagName(contextRegistrationElement,'entityIdList');if(entityIdListElement!=null){entityIdList=NGSI.XML.getChildElementsByTagName(entityIdListElement,'entityId');for(j=0;j<entityIdList.length;j+=1){entityIdElement=entityIdList[j];idElement=NGSI.XML.getChildElementByTagName(entityIdElement,'id');entity={id:NGSI.XML.getTextContent(idElement),type:entityIdElement.getAttribute('type')};registration.entities.push(entity);}}
contextRegistrationAttributeListElement=NGSI.XML.getChildElementByTagName(contextRegistrationElement,'contextRegistrationAttributeList');if(contextRegistrationAttributeListElement!=null){attributeList=NGSI.XML.getChildElementsByTagName(contextRegistrationAttributeListElement,'contextRegistrationAttribute');for(j=0;j<attributeList.length;j+=1){nameElement=NGSI.XML.getChildElementByTagName(attributeList[j],'name');typeElement=NGSI.XML.getChildElementByTagName(attributeList[j],'type');attribute={name:NGSI.XML.getTextContent(nameElement),type:NGSI.XML.getTextContent(typeElement)};registration.attributes.push(attribute);}}
providingApplicationElement=NGSI.XML.getChildElementByTagName(contextRegistrationElement,'providingApplication');registration.providingApplication=NGSI.XML.getTextContent(providingApplicationElement);data.push(registration);}
return data;};var parse_discover_context_availability_response=function parse_discover_context_availability_response(doc){assert_root_element(doc,'discoverContextAvailabilityResponse');var list=NGSI.XML.getChildElementByTagName(doc.documentElement,'contextRegistrationResponseList');return[parse_context_registration_response_list(list)];};var parse_subscribe_update_context_availability_response=function parse_subscribe_update_context_availability_response(doc){var data,durationElement,errorCodeElement;data={subscriptionId:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId'))};durationElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'duration');if(durationElement!==null){data.duration=NGSI.XML.getTextContent(durationElement);}
errorCodeElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'errorCode');if(errorCodeElement!==null){data.errorCode=NGSI.XML.getTextContent(errorCodeElement);}
return[data];};var parse_unsubscribe_context_availability_response=function parse_unsubscribe_context_availability_response(doc){assert_root_element(doc,'unsubscribeContextAvailabilityResponse');return[{subscriptionId:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId')),statusCode:NGSI.XML.getTextContent(NGSI.XML.getChildElementByTagName(doc.documentElement,'statusCode'))}];};var parse_context_response_list=function parse_context_response_list(element,update_response,options){var contextResponses,contextResponse,entry,entityIdElement,nameElement,flat,typeElement,attributeName,contextValueElement,entityId,idElement,i,j,contextAttributeListElement,attributeList,contextValue,data,metadataElement,status_info,error_data;flat=!!options.flat;if(flat){data={};}else{data=[];}
error_data=[];if(update_response){contextValue="";}
contextResponses=NGSI.XML.getChildElementsByTagName(element,'contextElementResponse');for(i=0;i<contextResponses.length;i+=1){contextResponse=NGSI.XML.getChildElementByTagName(contextResponses[i],'contextElement');status_info=process_status_info(contextResponses[i]);if(flat){entry={};}else{entry={entity:null,attributes:[]};}
entityIdElement=NGSI.XML.getChildElementByTagName(contextResponse,'entityId');idElement=NGSI.XML.getChildElementByTagName(entityIdElement,'id');entityId=NGSI.XML.getTextContent(idElement);if(status_info.code===200&&flat){entry.id=entityId;entry.type=entityIdElement.getAttribute('type');}else{entry.entity={id:NGSI.XML.getTextContent(idElement),type:entityIdElement.getAttribute('type')};}
contextAttributeListElement=NGSI.XML.getChildElementByTagName(contextResponse,'contextAttributeList');if(contextAttributeListElement!=null){attributeList=NGSI.XML.getChildElementsByTagName(contextAttributeListElement,'contextAttribute');for(j=0;j<attributeList.length;j+=1){nameElement=NGSI.XML.getChildElementByTagName(attributeList[j],'name');attributeName=NGSI.XML.getTextContent(nameElement);if(!update_response){contextValueElement=NGSI.XML.getChildElementByTagName(attributeList[j],'contextValue');contextValue=NGSI.XML.getTextContent(contextValueElement);if(contextValue==='emptycontent'){contextValue='';}}
if(flat){entry[attributeName]=contextValue;}else{typeElement=NGSI.XML.getChildElementByTagName(attributeList[j],'type');metadataElement=NGSI.XML.getChildElementByTagName(attributeList[j],'metadata');if(update_response){entry.attributes.push({name:attributeName,type:NGSI.XML.getTextContent(typeElement)});if(metadataElement!=null){entry.attributes[entry.attributes.length-1].metadata=parse_metadata_element(metadataElement);}}else{entry.attributes.push({name:attributeName,type:NGSI.XML.getTextContent(typeElement),contextValue:contextValue,metadata:parse_metadata_element(metadataElement)});}}}}
if(status_info.code===200){if(flat){data[entityId]=entry;}else{data.push(entry);}}else{if(update_response){entry.statusCode=status_info;}
error_data.push(entry);}}
return[data,error_data];};var process_status_info=function process_status_info(element){var statusCodeElement,status_info,detailsElement;statusCodeElement=NGSI.XML.getChildElementByTagName(element,'statusCode');status_info={code:parseInt(NGSI.XML.getChildElementByTagName(statusCodeElement,'code').textContent,10),reasonPhrase:NGSI.XML.getChildElementByTagName(statusCodeElement,'reasonPhrase').textContent};detailsElement=NGSI.XML.getChildElementByTagName(statusCodeElement,'details');if(detailsElement!=null){status_info.details=detailsElement.textContent;}
return status_info;};var process_error_code=function process_error_code(element){var errorCodeElement,codeElement,reasonPhraseElement,detailsElement,details;errorCodeElement=NGSI.XML.getChildElementByTagName(element,'errorCode');if(errorCodeElement!=null){codeElement=NGSI.XML.getChildElementByTagName(errorCodeElement,'code');reasonPhraseElement=NGSI.XML.getChildElementByTagName(errorCodeElement,'reasonPhrase');detailsElement=NGSI.XML.getChildElementByTagName(errorCodeElement,'details');if(detailsElement!=null){details=detailsElement.textContent;}
throw new NGSI.InvalidRequestError(parseInt(codeElement.textContent,10),reasonPhraseElement.textContent,details);}};var NGSI_QUERY_COUNT_RE=new RegExp('Count: (\\d+)');var NGSI_INVALID_OFFSET_RE=new RegExp('Number of matching entities: (\\d+). Offset is (\\d+)');var parse_query_context_response=function parse_query_context_response(doc,options){var details,parsed_details,data;assert_root_element(doc,'queryContextResponse');try{process_error_code(doc.documentElement);}catch(e){switch(e.code){case 200:parsed_details=e.details.match(NGSI_QUERY_COUNT_RE);if(parsed_details){details={"count":parseInt(parsed_details[1],10)};}
break;case 404:data=options.flat?{}:[];parsed_details=e.details.match(NGSI_INVALID_OFFSET_RE);if(parsed_details){details=e.details={"text":e.details,"matches":parseInt(parsed_details[1]),"offset":parseInt(parsed_details[2])};}
if(options.offset!=null&&options.offset!==0){throw e;}else{return[data,details];}
break;default:throw e;}}
return[parse_context_response_list(NGSI.XML.getChildElementByTagName(doc.documentElement,'contextResponseList'),false,options)[0],details];};var parse_update_context_response=function parse_update_context_response(doc,options){assert_root_element(doc,'updateContextResponse');process_error_code(doc.documentElement);return parse_context_response_list(NGSI.XML.getChildElementByTagName(doc.documentElement,'contextResponseList'),true,options);};var parse_subscribe_response_element=function parse_subscribe_response_element(element){var data,durationElement,throttlingElement;var subIdElement=NGSI.XML.getChildElementByTagName(element,'subscriptionId');data={subscriptionId:NGSI.XML.getTextContent(subIdElement)};durationElement=NGSI.XML.getChildElementByTagName(element,'duration');if(durationElement!=null){data.duration=NGSI.XML.getTextContent(durationElement);}
throttlingElement=NGSI.XML.getChildElementByTagName(element,'throttling');if(throttlingElement!=null){data.throttling=NGSI.XML.getTextContent(throttlingElement);}
return data;};var parse_subscribe_context_response=function parse_subscribe_context_response(doc){assert_root_element(doc,'subscribeContextResponse');var subscribeResponse=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscribeResponse');return[parse_subscribe_response_element(subscribeResponse)];};var parse_update_context_subscription_response=function parse_update_context_subscription_response(doc){assert_root_element(doc,'updateContextSubscriptionResponse');var subscribeResponse=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscribeResponse');return[parse_subscribe_response_element(subscribeResponse)];};var parse_unsubscribe_context_response=function parse_unsubscribe_context_response(doc){assert_root_element(doc,'unsubscribeContextResponse');var subIdElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId');return[{subscriptionId:NGSI.XML.getTextContent(subIdElement)}];};var parse_notify_context_availability_request=function parse_notify_context_availability_request(doc,options){assert_root_element(doc,'notifyContextAvailabilityRequest');var list=NGSI.XML.getChildElementByTagName(doc.documentElement,'contextRegistrationResponseList');return[parse_context_registration_response_list(list)];};NGSI.parseNotifyContextRequest=function parseNotifyContextRequest(doc,options){var subscriptionIdElement,originatorElement,data;assert_root_element(doc,'notifyContextRequest');data=parse_context_response_list(NGSI.XML.getChildElementByTagName(doc.documentElement,'contextResponseList'),false,options)[0];data={elements:data};subscriptionIdElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'subscriptionId');originatorElement=NGSI.XML.getChildElementByTagName(doc.documentElement,'originator');data.subscriptionId=NGSI.XML.getTextContent(subscriptionIdElement);data.originator=NGSI.XML.getTextContent(originatorElement);return data;};var onInitFailure=function(response,error){var i;this.connected=false;this.connecting=false;if(error==null){if([0,502,504].indexOf(response.status)!==-1){error=new NGSI.ConnectionError();}else{error=new NGSI.InvalidResponseError('Unexpected error code: '+response.status);}}
for(i=0;i<this.onerror_callbacks.length;i+=1){try{this.onerror_callbacks[i](error);}catch(e){}}
this.onload_callbacks=[];this.onerror_callbacks=[];};var init=function init(){this.connecting=true;this.makeRequest(this.url+NGSI.proxy_endpoints.EVENTSOURCE_COLLECTION,{method:'POST',onSuccess:function(response){if(response.status!==201){onInitFailure.call(this,response);}else{this.source_url=response.getHeader('Location');if(this.source_url==null){onInitFailure.call(this,response,new NGSI.InvalidResponseError('Missing Location Header'));}else{connect_to_eventsource.call(this);}}}.bind(this),onFailure:onInitFailure.bind(this)});};var connect_to_eventsource=function connect_to_eventsource(){var source,closeTimeout;var _wait_event_source_init=null;var wait_event_source_init=function wait_event_source_init(e){var data,i;data=JSON.parse(e.data);clearTimeout(closeTimeout);source.removeEventListener('init',_wait_event_source_init,true);this.connected=true;this.connecting=false;this.connection_id=data.id;for(i=0;i<this.onload_callbacks.length;i+=1){try{this.onload_callbacks[i]();}catch(exception){}}
this.onload_callbacks=[];this.onerror_callbacks=[];source.addEventListener('close',function(){this.connected=false;}.bind(this),true);source.addEventListener('notification',function(e){var data;data=JSON.parse(e.data);this.callbacks[data.callback_id].method(data.payload);}.bind(this),true);};_wait_event_source_init=wait_event_source_init.bind(this);source=new EventSource(this.source_url);source.addEventListener('init',_wait_event_source_init,true);closeTimeout=setTimeout(function(){var i,error=new NGSI.ConnectionError("Connection timeout");for(i=0;i<this.onerror_callbacks.length;i+=1){try{this.onerror_callbacks[i](error);}catch(e){}}
this.onload_callbacks=[];this.onerror_callbacks=[];source.close();}.bind(this),30000);};NGSI.ProxyConnection=function ProxyConnection(url,makeRequest){this.url=""+url;if(this.url[this.url.length-1]!=='/'){this.url+='/';}
this.connected=false;this.connecting=false;this.makeRequest=makeRequest;this.callbacks={};this.callbacks_by_subscriptionId={};this.onload_callbacks=[];this.onerror_callbacks=[];};NGSI.ProxyConnection.prototype.connect=function connect(options){if(options==null){options={};}
if(this.connected===false){if(typeof options.onSuccess==='function'){this.onload_callbacks.push(options.onSuccess);}
if(typeof options.onFailure==='function'){this.onerror_callbacks.push(options.onFailure);}}
if(this.connected===false&&this.connecting===false){init.call(this);}else if(this.connected===true&&typeof options.onSuccess==='function'){options.onSuccess();}};NGSI.ProxyConnection.prototype.request_callback=function request_callback(callback,onSuccess,onFailure){if(typeof callback!=='function'){throw new TypeError('callback parameter must be a function');}
var wrappedOnSuccess=function(){this.makeRequest(this.url+NGSI.proxy_endpoints.CALLBACK_COLLECTION,{contentType:'application/json',postBody:JSON.stringify({connection_id:this.connection_id}),onSuccess:function(response){var data=JSON.parse(response.responseText);this.callbacks[data.callback_id]={callback_id:data.callback_id,method:callback,subscription_id:null};onSuccess(data);}.bind(this),onFailure:function(response){var error;if(response.status===0){error=new NGSI.ConnectionError();}else{error=new NGSI.InvalidResponseError('Unexpected error code: '+response.status);}
if(typeof onFailure==='function'){onFailure(error);}}});}.bind(this);if(this.connected===false){this.connect({onSuccess:wrappedOnSuccess,onFailure:function(e){if(typeof onFailure==='function'){onFailure(e);}}});}else{wrappedOnSuccess();}};NGSI.ProxyConnection.prototype.close_callback=function close_callback(callback_id,onSuccess,onFailure){this.makeRequest(this.url+NGSI.proxy_endpoints.CALLBACK_COLLECTION+'/'+callback_id,{method:'DELETE',onSuccess:function(response){this.purge_callback(callback_id);if(typeof onSuccess==='function'){onSuccess();}}.bind(this),onFailure:function(response){if(typeof onFailure==='function'){onFailure();}}});};NGSI.ProxyConnection.prototype.associate_subscription_id_to_callback=function associate_subscription_id_to_callback(callback_id,subscription_id){if(callback_id in this.callbacks&&this.callbacks[callback_id].subscription_id===null){this.callbacks_by_subscriptionId[subscription_id]=this.callbacks[callback_id];this.callbacks[callback_id].subscription_id=subscription_id;}};NGSI.ProxyConnection.prototype.close_callback_by_subscriptionId=function close_callback_by_subscriptionId(subscription_id,onSuccess,onFailure){if(subscription_id in this.callbacks_by_subscriptionId){this.close_callback(this.callbacks_by_subscriptionId[subscription_id].callback_id,onSuccess,onFailure);}else{if(typeof onSuccess==='function'){onSuccess();}}};NGSI.ProxyConnection.prototype.purge_callback=function purge_callback(callback_id){if(this.callbacks[callback_id].subscription_id!=null){delete this.callbacks_by_subscriptionId[this.callbacks[callback_id].subscription_id];}
delete this.callbacks[callback_id];};NGSI.ConnectionError=function ConnectionError(message){this.name='ConnectionError';this.message=message||'Connection Error';};NGSI.ConnectionError.prototype=new Error();NGSI.ConnectionError.prototype.constructor=NGSI.ConnectionError;NGSI.InvalidRequestError=function InvalidRequestError(code,message,details){this.name='InvalidRequest';this.code=code;this.message=message||'';this.details=details||'';};NGSI.InvalidRequestError.prototype=new Error();NGSI.InvalidRequestError.prototype.constructor=NGSI.InvalidRequestError;NGSI.InvalidResponseError=function InvalidResponseError(message){this.name='InvalidResponse';this.message=message||'';};NGSI.InvalidResponseError.prototype=new Error();NGSI.InvalidResponseError.prototype.constructor=NGSI.InvalidResponseError;NGSI.ProxyConnectionError=function ProxyConnectionError(cause){this.name='ProxyConnectionError';this.cause=cause;};NGSI.ProxyConnectionError.prototype=new Error();NGSI.ProxyConnectionError.prototype.constructor=NGSI.ProxyConnectionError;NGSI.Connection=function NGSIConnection(url,options){this.url=""+url;if(this.url[this.url.length-1]!=='/'){this.url+='/';}
if(options==null){options={};}
this.request_headers=options.request_headers;if(typeof options.requestFunction==='function'){this.makeRequest=options.requestFunction;}
if(options.ngsi_proxy_connection instanceof NGSI.ProxyConnection){this.ngsi_proxy=options.ngsi_proxy_connection;}else if(typeof options.ngsi_proxy_url==='string'){this.ngsi_proxy=new NGSI.ProxyConnection(options.ngsi_proxy_url,this.makeRequest);}};NGSI.Connection.prototype.createRegistration=function createRegistration(entities,attributes,duration,providingApplication,callbacks){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributes!=null&&!Array.isArray(attributes)){throw new TypeError('attributes parameter must be an array or null');}else if(attributes==null){attributes=[];}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_register_context_request(entities,attributes,duration,providingApplication);var url=this.url+NGSI.endpoints.REGISTER_CONTEXT;makeXMLRequest.call(this,url,payload,parse_register_context_response,callbacks);};NGSI.Connection.prototype.updateRegistration=function updateRegistration(regId,entities,attributes,duration,providingApplication,callbacks){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributes!=null&&!Array.isArray(attributes)){throw new TypeError('attributes parameter must be an array or null');}else if(attributes==null){attributes=[];}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_register_context_request(entities,attributes,duration,providingApplication,regId);var url=this.url+NGSI.endpoints.REGISTER_CONTEXT;makeXMLRequest.call(this,url,payload,parse_register_context_response,callbacks);};NGSI.Connection.prototype.cancelRegistration=function cancelRegistration(regId,callbacks){this.updateRegistration(regId,[{id:'canceled registration'}],[],'PT0H','http://canceled.registration.com',callbacks);};NGSI.Connection.prototype.discoverAvailability=function discoverAvailability(entities,attributeNames,callbacks){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}else if(attributeNames==null){attributeNames=[];}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_discover_context_availability_request(entities,attributeNames);var url=this.url+NGSI.endpoints.DISCOVER_CONTEXT_AVAILABILITY;makeXMLRequest.call(this,url,payload,parse_discover_context_availability_response,callbacks);};NGSI.Connection.prototype.createAvailabilitySubscription=function createAvailabilitySubscription(entities,attributeNames,duration,restriction,options){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}
if(options==null){throw new TypeError('Missing options parameter');}
if(typeof options.onNotify!='string'&&typeof options.onNotify!='function'){throw new TypeError('Invalid onNotify callback');}
if(typeof options.onNotify==='function'&&this.ngsi_proxy==null){throw new Error('A ngsi-proxy is needed for using local onNotify callbacks');}
var url=this.url+NGSI.endpoints.SUBSCRIBE_CONTEXT_AVAILABILITY;if(typeof options.onNotify==='function'&&this.ngsi_proxy!=null){var onNotify=function onNotify(payload){var doc=NGSI.XML.parseFromString(payload,'application/xml');var data=parse_notify_context_availability_request(doc,options);options.onNotify(data);};this.ngsi_proxy.request_callback(onNotify,function(proxy_callback){var payload=ngsi_build_subscribe_update_context_availability_request('subscribeContextAvailabilityRequest',entities,attributeNames,duration,restriction,null,proxy_callback.url);var oldOnFailure=options.onFailure;options.onFailure=function(){this.ngsi_proxy.close_callback(proxy_callback.callback_id);if(typeof oldOnFailure==='function'){oldOnFailure();}}.bind(this);var oldOnSuccess=options.onSuccess;options.onSuccess=function(data){this.ngsi_proxy.associate_subscription_id_to_callback(proxy_callback.callback_id,data.subscriptionId);if(typeof oldOnSuccess==='function'){oldOnSuccess(data);}}.bind(this);makeXMLRequest.call(this,url,payload,parse_subscribe_update_context_availability_response,options);}.bind(this),function(){if(typeof options.onFailure==='function'){options.onFailure();}});}else{var payload=ngsi_build_subscribe_update_context_availability_request('subscribeContextAvailabilityRequest',entities,attributeNames,duration,restriction,null,options.onNotify);makeXMLRequest.call(this,url,payload,parse_subscribe_update_context_availability_response,options);}};NGSI.Connection.prototype.updateAvailabilitySubscription=function updateAvailabilitySubscription(subId,entities,attributeNames,duration,restriction,callbacks){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_subscribe_update_context_availability_request('updateContextAvailabilitySubscriptionRequest',entities,attributeNames,duration,restriction,subId);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT_AVAILABILITY_SUBSCRIPTION;makeXMLRequest.call(this,url,payload,parse_subscribe_update_context_availability_response,callbacks);};NGSI.Connection.prototype.cancelAvailabilitySubscription=function cancelAvailabilitySubscription(subId,callbacks){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_unsubscribe_context_availability_request(subId);var url=this.url+NGSI.endpoints.UNSUBSCRIBE_CONTEXT_AVAILABILITY;makeXMLRequest.call(this,url,payload,parse_unsubscribe_context_availability_response,callbacks);};NGSI.Connection.prototype.query=function query(entities,attrNames,options){var url,parameters,payload;if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attrNames!=null&&!Array.isArray(attrNames)){throw new TypeError('attrNames must be null or an array');}else if(attrNames==null){attrNames=[];}
if(options==null){options={};}
parameters={};if(options.limit!=null){if(typeof options.limit!=='number'||options.limit<20){throw new TypeError('invalid value for the limit option');}
parameters.limit=options.limit;}
if(options.offset!=null){if(typeof options.offset!=='number'||options.offset<0){throw new TypeError('invalid value for the offset option');}
parameters.offset=options.offset;}
if(options.details!=null){if(typeof options.details!=='boolean'){throw new TypeError('invalid value for the details option');}
if(options.details){parameters.details='on';}else{parameters.details='off';}}
url=this.url+NGSI.endpoints.QUERY_CONTEXT;payload=ngsi_build_query_context_request(entities,attrNames,options.restriction);makeXMLRequest.call(this,url,payload,parse_query_context_response,options,parameters);};NGSI.Connection.prototype.updateAttributes=function updateAttributes(update,callbacks){if(!Array.isArray(update)||update.length===0){throw new TypeError('update parameter must be a non-empty array');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_update_context_request('UPDATE',update);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_update_context_response,callbacks);};NGSI.Connection.prototype.addAttributes=function addAttributes(toAdd,callbacks){if(!Array.isArray(toAdd)||toAdd.length===0){throw new TypeError('toAdd parameter must be a non-empty array');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_update_context_request('APPEND',toAdd);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_update_context_response,callbacks);};NGSI.Connection.prototype.deleteAttributes=function deleteAttributes(toDelete,callbacks){if(!Array.isArray(toDelete)||toDelete.length===0){throw new TypeError('toDelete parameter must be a non-empty array');}
if(callbacks==null){callbacks={};}
var payload=ngsi_build_update_context_request('DELETE',toDelete);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_update_context_response,callbacks);};NGSI.Connection.prototype.createSubscription=function createSubscription(entities,attributeNames,duration,throttling,cond,options){if(!Array.isArray(entities)||entities.length===0){throw new TypeError('entities parameter must be a non-empty array');}
if(attributeNames!=null&&!Array.isArray(attributeNames)){throw new TypeError('attributeNames parameter must be an array or null');}
if(options==null){throw new TypeError('Missing options parameter');}
if(typeof options.onNotify!='string'&&typeof options.onNotify!='function'){throw new TypeError('Invalid onNotify callback');}
if(typeof options.onNotify==='function'&&this.ngsi_proxy==null){throw new Error('A ngsi-proxy is needed for using local onNotify callbacks');}
var url=this.url+NGSI.endpoints.SUBSCRIBE_CONTEXT;if(typeof options.onNotify==='function'&&this.ngsi_proxy!=null){var onNotify=function onNotify(payload){var doc=NGSI.XML.parseFromString(payload,'application/xml');var data=NGSI.parseNotifyContextRequest(doc,options);options.onNotify(data);};this.ngsi_proxy.request_callback(onNotify,function(proxy_callback){var payload=ngsi_build_subscribe_update_context_request(null,entities,attributeNames,duration,throttling,cond,proxy_callback.url);var oldOnFailure=options.onFailure;options.onFailure=function(){this.ngsi_proxy.close_callback(proxy_callback.callback_id);if(typeof oldOnFailure==='function'){oldOnFailure();}}.bind(this);var oldOnSuccess=options.onSuccess;options.onSuccess=function(data){this.ngsi_proxy.associate_subscription_id_to_callback(proxy_callback.callback_id,data.subscriptionId);if(typeof oldOnSuccess==='function'){oldOnSuccess(data);}}.bind(this);makeXMLRequest.call(this,url,payload,parse_subscribe_context_response,options);}.bind(this),function(e){if(typeof options.onFailure==='function'){var exception=new NGSI.ProxyConnectionError(e);try{options.onFailure(exception);}catch(error){}}
if(typeof options.onComplete==='function'){try{options.onComplete();}catch(error){}}});}else{var payload=ngsi_build_subscribe_update_context_request(null,entities,attributeNames,duration,throttling,cond,options.onNotify);makeXMLRequest.call(this,url,payload,parse_subscribe_context_response,options);}};NGSI.Connection.prototype.updateSubscription=function updateSubscription(subId,duration,throttling,cond,options){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(options==null){options={};}
var payload=ngsi_build_subscribe_update_context_request(subId,null,null,duration,throttling,cond);var url=this.url+NGSI.endpoints.UPDATE_CONTEXT_SUBSCRIPTION;makeXMLRequest.call(this,url,payload,parse_update_context_subscription_response,options);};NGSI.Connection.prototype.cancelSubscription=function cancelSubscription(subId,options){if(subId==null){throw new TypeError('subId parameter cannot be null');}
if(options==null){options={};}
if(this.ngsi_proxy){var old_success_callback=options.onSuccess;options.onSuccess=function(data){var onSuccess=old_success_callback;if(onSuccess!=null){onSuccess=onSuccess.bind(null,data);}
this.ngsi_proxy.close_callback_by_subscriptionId(data.subscriptionId,onSuccess,options.onFailure);}.bind(this);}
var payload=ngsi_build_unsubscribe_context_request(subId);var url=this.url+NGSI.endpoints.UNSUBSCRIBE_CONTEXT;makeXMLRequest.call(this,url,payload,parse_unsubscribe_context_response,options);};if(typeof window!=='undefined'){window.NGSI=NGSI;}})();(function(){var parseUri=function(str){var o={key:['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','anchor'],q:{name:'queryKey',parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser.strict.exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||'';uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;};var CONNECTING=0,OPEN=1,CLOSED=2;window.EventSource=function EventSource(resource){var that=(this===window)?{}:this,retry=1000,offset=0,boundary="\n",lastEventId=null,xhr=null,resourceLocation=null,rest='',reconnectTimeout=null,data='',name='message',eventManager=document.createElement('div');that.readyState=CONNECTING;that.toString=function(){return'[object EventSource]'};that.addEventListener=function(type,listener,useCapture){eventManager.addEventListener(type,listener,useCapture);};that.removeEventListener=function(type,listener,useCapture){eventManager.removeEventListener(type,listener,useCapture);};that.dispatchEvent=function(event){eventManager.dispatchEvent(event);};that.close=function(){that.readyState=CLOSED;if(reconnectTimeout!==null){clearTimeout(reconnectTimeout);}
if(xhr!==null){xhr.abort();}}
resourceLocation=parseUri(resource);that.URL=resourceLocation.source;var openConnectionXHR=function(){xhr=new XMLHttpRequest();xhr.open('GET',that.URL,true);var openEvent=document.createEvent('HTMLEvents');openEvent.initEvent('open',true,true);openEvent.origin=document.domain;openEvent.source=null;that.dispatchEvent(openEvent);if(lastEventId){xhr.setRequestHeader('Last-Event-ID',lastEventId);}
xhr.onreadystatechange=function(){switch(xhr.readyState){case 4:if(that.readyState!==CLOSED){that.readyState=CONNECTING;reOpenConnectionXHR();}
break;case 3:that.readyState=OPEN;processMessageFromXHR();break;}}
xhr.send(null);};var reOpenConnectionXHR=function(){xhr=null;offset=0;data='';name='message';reconnectTimeout=setTimeout(openConnectionXHR,retry);};var processMessageFromXHR=function(){var queue=(rest+xhr.responseText.substr(offset)).split(boundary);offset=xhr.responseText.length;rest=queue.pop();pseudoDispatchEvent(queue);};var pseudoDispatchEvent=function(queue){var i,line,dataIndex,field,value;for(i=0;i<queue.length;i+=1){line=queue[i];if(line===""){if(data.length>0){var fireEvent=document.createEvent('HTMLEvents');fireEvent.initEvent(name,true,true);fireEvent.lastEventId=lastEventId;fireEvent.data=data.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,'');fireEvent.origin=document.domain;fireEvent.source=null;that.dispatchEvent(fireEvent);data='';name='message';}
continue;}
dataIndex=line.indexOf(':');field=null;value='';if(dataIndex===-1){field=line;value='';}else if(dataIndex===0){continue;}else{field=line.slice(0,dataIndex);value=line.slice(dataIndex+1);}
switch(field){case'event':name=value.trim();break;case'id':lastEventId=value;break;case'retry':value=parseInt(value);if(!isNaN(value)){retry=value;}
break;case'data':if(data.length>0){data+="\n";}
data+=value;}}};openConnectionXHR();};})();(function(NGSI){"use strict";var register_widget_proxy,register_operator_proxy,unload_widget,unload_operator,proxiesByWidget,proxiesByOperator,proxy_connections,Manager;proxiesByWidget={};proxiesByOperator={};proxy_connections={};Manager={};register_widget_proxy=function register_widget_proxy(id,proxy){var iwidget;if(!(id in proxiesByWidget)){iwidget=Wirecloud.activeWorkspace.getIWidget(id).internal_iwidget;proxiesByWidget[id]=[];iwidget.addEventListener('unload',unload_widget);}
proxiesByWidget[id].push(proxy);};unload_widget=function unload_widget(iwidget){var i,proxies;proxies=proxiesByWidget[iwidget.id];for(i=0;i<proxies.length;i+=1){try{proxies[i].close();}catch(e){}}
proxies.length=0;iwidget.removeEventListener('unload',unload_widget);delete proxiesByWidget[iwidget.id];};register_operator_proxy=function register_operator_proxy(id,proxy){var ioperator;if(!(id in proxiesByOperator)){ioperator=Wirecloud.activeWorkspace.wiring.ioperators[id];proxiesByOperator[id]=[];ioperator.addEventListener('unload',unload_operator);}
proxiesByOperator[id].push(proxy);};unload_operator=function unload_operator(ioperator){var i,proxies;proxies=proxiesByOperator[ioperator.id];for(i=0;i<proxies.length;i+=1){try{proxies[i].close();}catch(e){}}
proxies.length=0;ioperator.removeEventListener('unload',unload_operator);delete proxiesByOperator[ioperator.id];};Manager.Connection=function Connection(type,id,url,options){var wrapped_proxy;if(options==null){options={};}
if(typeof options.requestFunction!=='function'){options.requestFunction=Wirecloud.io.makeRequest;}
if(options.ngsi_proxy_url!=null){if(!(options.ngsi_proxy_url in proxy_connections)){proxy_connections[options.ngsi_proxy_url]=new NGSI.ProxyConnection(options.ngsi_proxy_url,options.requestFunction);}
wrapped_proxy=new WirecloudResourceProxy(proxy_connections[options.ngsi_proxy_url],this);options.ngsi_proxy_connection=wrapped_proxy;switch(type){case"operator":register_operator_proxy(id,wrapped_proxy);break;case"widget":register_widget_proxy(id,wrapped_proxy);break;}
delete options.ngsi_proxy_url;}
if(options.use_user_fiware_token===true){if(options.request_headers==null){options.request_headers={};}
options.request_headers['X-FI-WARE-OAuth-Token']='true';options.request_headers['X-FI-WARE-OAuth-Header-Name']='X-Auth-Token';}
NGSI.Connection.call(this,url,options);};Manager.Connection.prototype=NGSI.Connection.prototype;var WirecloudResourceProxy=function WirecloudResourceProxy(real_proxy,connection){Object.defineProperty(this,'real_proxy',{value:real_proxy});Object.defineProperty(this,'connection',{value:connection});Object.defineProperty(this,'connected',{get:function(){return this.real_proxy.connected;}});Object.defineProperty(this,'connecting',{get:function(){return this.real_proxy.connecting;}});Object.defineProperty(this,'url',{get:function(){return this.real_proxy.url;}});this.callbacks=[];};WirecloudResourceProxy.prototype=new NGSI.ProxyConnection();WirecloudResourceProxy.prototype.connect=function connect(options){this.real_proxy.connect(options);};WirecloudResourceProxy.prototype.request_callback=function request_callback(onNotify,onSuccess,onFailure){var old_on_success=onSuccess;onSuccess=function(data){this.callbacks.push(data.callback_id);if(typeof old_on_success==='function'){old_on_success(data);}}.bind(this);this.real_proxy.request_callback(onNotify,onSuccess,onFailure);};WirecloudResourceProxy.prototype.close_callback=function close_callback(callback_id,onSuccess,onFailure){if(this.callbacks.indexOf(callback_id)===-1){throw new TypeError('unhandled callback: '+callback_id);}
var old_on_success=onSuccess;onSuccess=function(data){var index=this.callbacks.indexOf(callback_id);if(index!=-1){this.callbacks.splice(index,1);}
if(typeof old_on_success==='function'){old_on_success(data);}}.bind(this);this.real_proxy.close_callback(callback_id,onSuccess,onFailure);};WirecloudResourceProxy.prototype.associate_subscription_id_to_callback=function associate_subscription_id_to_callback(callback_id,subscription_id){this.real_proxy.associate_subscription_id_to_callback(callback_id,subscription_id);};WirecloudResourceProxy.prototype.close_callback_by_subscriptionId=function close_callback_by_subscriptionId(subscription_id,onSuccess,onFailure){var callback_id;if(subscription_id in this.real_proxy.callbacks_by_subscriptionId){callback_id=this.real_proxy.callbacks_by_subscriptionId[subscription_id].callback_id;if(this.callbacks.indexOf(callback_id)!==-1){var old_on_success=onSuccess;onSuccess=function(data){var index=this.callbacks.indexOf(callback_id);if(index!=-1){this.callbacks.splice(index,1);}
if(typeof old_on_success==='function'){old_on_success(data);}}.bind(this);this.real_proxy.close_callback_by_subscriptionId(subscription_id,onSuccess,onFailure);return;}}
if(typeof onSuccess==='function'){onSuccess();}};WirecloudResourceProxy.prototype.close=function close(){var i;for(i=0;i<this.callbacks.length;i++){if(this.real_proxy.callbacks[this.callbacks[i]].subscription_id!=null){this.connection.cancelSubscription(this.real_proxy.callbacks[this.callbacks[i]].subscription_id);}}};Manager.NGSI=NGSI;window.NGSIManager=Manager;})(NGSI);delete window.NGSI;